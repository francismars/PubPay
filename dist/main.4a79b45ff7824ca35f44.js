(()=>{"use strict";var e,t={576:(e,t,n)=>{var s=n(848),o=n(540),a=n(338),r=n(322);const i=["wss://relay.damus.io","wss://relay.primal.net","wss://nos.lol","wss://relay.snort.social","wss://relay.nostr.band"];class l{constructor(e=i){this.connections=new Map,this.subscriptions=new Map,this.relays=e,this.initializePool()}initializePool(){if("undefined"==typeof window||!window.NostrTools)throw new Error("NostrTools not available. Make sure nostrtools.min.js is loaded.");this.pool=new window.NostrTools.SimplePool}subscribeToEvents(e,t,n={}){const s=this.generateSubscriptionId(),o={id:s,filters:e,unsubscribe:()=>this.unsubscribe(s)};let a=null;return n.timeout&&(a=setTimeout(()=>{console.log(`Subscription ${s} timeout - keeping alive`)},n.timeout)),this.pool.subscribeMany(this.relays,e,{onevent:e=>{a&&clearTimeout(a),t(e)},oneose:()=>{a&&clearTimeout(a),n.oneose?.()},onclosed:()=>{a&&clearTimeout(a),n.onclosed?.()}}),this.subscriptions.set(s,o),o}subscribeToLiveEvents(e,t,n,s={}){const o={authors:[e],kinds:[30311],"#d":[t]};return this.subscribeToEvents([o],n,{timeout:s.timeout||3e4,onclosed:s.onclosed})}subscribeToZaps(e,t,n={}){const s={kinds:[9735],"#e":[e]};return this.subscribeToEvents([s],t,{timeout:n.timeout||3e4,onclosed:n.onclosed})}subscribeToLiveChat(e,t,n,s={}){const o={kinds:[1],"#a":[`30311:${e}:${t}`]};return this.subscribeToEvents([o],n,{timeout:s.timeout||3e4,onclosed:s.onclosed})}subscribeToProfiles(e,t,n={}){const s={authors:e,kinds:[0]};return this.subscribeToEvents([s],t,{timeout:n.timeout||3e4,onclosed:n.onclosed})}async publishEvent(e){try{await this.pool.publish(this.relays,e)}catch(e){throw console.error("Failed to publish event:",e),new Error(`Failed to publish event: ${e}`)}}async getEvents(e){return new Promise((t,n)=>{try{if(!this.pool)throw new Error("Nostr pool not initialized");if(!this.relays||0===this.relays.length)throw new Error("No relays configured");if(!e||0===e.length)throw new Error("No filters provided");for(const t of e)if(!t.kinds||0===t.kinds.length)throw new Error("Invalid filter: missing kinds");console.log("Getting events with filters:",e),console.log("Filter structure:",JSON.stringify(e,null,2));const n=e.map(e=>JSON.parse(JSON.stringify(e)));console.log("Clean filters:",n);const s=[];let o=!1;const a=this.pool.subscribeMany(this.relays,n,{onevent(e){s.push(e)},oneose(){o||(o=!0,t(s))},onclosed(){o||(o=!0,console.log("Subscription closed, resolving with",s.length,"events"),t(s))}});setTimeout(()=>{o||(o=!0,a.close(),console.log("Timeout reached, resolving with",s.length,"events"),t(s))},1e4)}catch(e){console.error("Failed to get events:",e),n(new Error(`Failed to get events: ${e}`))}})}unsubscribe(e){this.subscriptions.get(e)&&this.subscriptions.delete(e)}unsubscribeAll(){this.subscriptions.forEach(e=>{e.unsubscribe()}),this.subscriptions.clear()}getRelayStatus(){return Array.from(this.connections.values())}addRelay(e){this.relays.includes(e)||this.relays.push(e)}removeRelay(e){this.relays=this.relays.filter(t=>t!==e)}getRelays(){return[...this.relays]}generateSubscriptionId(){return`sub_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}destroy(){if(this.unsubscribeAll(),this.pool)try{this.pool.relays&&this.pool.relays.size>0&&this.pool.close()}catch(e){console.warn("Error closing Nostr pool:",e)}}}class c{constructor(e){this.sessions=new Map,this.frontendSessionId=null,this.config=e,this.frontendSessionId=this.generateFrontendSessionId()}async enableLightningPayments(e){if(!this.config.enabled)return{success:!1,error:"Lightning payments are disabled"};if(!e)return{success:!1,error:"Event ID is required"};try{console.log("🔌 LightningService: Request body:",{frontendSessionId:this.frontendSessionId,eventId:e});const t=await fetch("/lightning/enable",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({frontendSessionId:this.frontendSessionId,eventId:e})}),n=await t.json();if(n.success&&n.data){const t={sessionId:this.frontendSessionId,eventId:e,lnurlpId:n.data.lnurl,createdAt:Date.now(),expiresAt:Date.now()+864e5,status:"active"};return this.sessions.set(this.frontendSessionId,t),{success:!0,lnurl:n.data.lnurl,message:n.data.existing?"Lightning enabled (reusing existing link)":"Lightning enabled - scan QR to pay"}}return{success:!1,error:n.error||"Failed to enable Lightning payments"}}catch(e){return console.error("Error enabling Lightning payments:",e),{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}async disableLightningPayments(e){if(!e)return{success:!1,error:"Event ID is required"};try{const t=await fetch("/lightning/disable",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({frontendSessionId:this.frontendSessionId,eventId:e})}),n=await t.json();return n.success?(this.frontendSessionId&&this.sessions.delete(this.frontendSessionId),{success:!0,message:n.data?.message||"Lightning payments disabled"}):{success:!1,error:n.error||"Failed to disable Lightning payments"}}catch(e){return console.error("Error disabling Lightning payments:",e),{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}getLightningStatus(){return{enabled:this.config.enabled,sessionId:this.frontendSessionId,activeSessions:this.sessions.size}}getActiveSessions(){const e=Date.now();return Array.from(this.sessions.values()).filter(t=>"active"===t.status&&t.expiresAt>e)}getSession(e){return this.sessions.get(e)||null}async createInvoice(e,t,n){if(!this.config.enabled)return{success:!1,error:"Lightning payments are disabled"};try{return{success:!0,invoice:{payment_hash:this.generatePaymentHash(),payment_request:`lnbc${e}u1p...`,description:t,amount_msat:1e3*e,amount_sat:e,created_at:Date.now(),expires_at:Date.now()+36e5,status:"pending"}}}catch(e){return console.error("Error creating Lightning invoice:",e),{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}async checkPaymentStatus(e){try{return{success:!0,payment:{id:e,payment_hash:e,amount_msat:1e5,amount_sat:100,created_at:Date.now(),status:"completed",description:"Mock payment"}}}catch(e){return console.error("Error checking payment status:",e),{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}handleWebhook(e){try{const t=Array.from(this.sessions.values()).find(t=>t.eventId===e.description);return t?(t.status="active",{success:!0,message:"Webhook processed successfully"}):{success:!1,error:"No matching session found"}}catch(e){return console.error("Error handling webhook:",e),{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}generateLightningQR(e){return`lightning:${e}`}validateConfig(){const e=[];return this.config.lnbitsUrl||e.push("LNBits URL is required"),this.config.apiKey||e.push("LNBits API key is required"),this.config.webhookUrl||e.push("Webhook URL is required"),{valid:0===e.length,errors:e}}updateConfig(e){this.config={...this.config,...e}}getConfig(){return{...this.config}}cleanupExpiredSessions(){const e=Date.now();this.sessions.forEach((t,n)=>{t.expiresAt<e&&(t.status="expired",this.sessions.delete(n))})}generateFrontendSessionId(){return`frontend_${crypto.randomUUID()}`}generatePaymentHash(){const e=new Uint8Array(32);return crypto.getRandomValues(e),Array.from(e,e=>e.toString(16).padStart(2,"0")).join("")}destroy(){this.sessions.clear(),this.frontendSessionId=null}}class d{static async signInWithExtension(){try{if(!window.nostr)return{success:!1,error:"Nostr extension not found. Please install a Nostr extension like Alby or nos2x."};const e=await window.nostr.getPublicKey();return e&&"string"==typeof e&&64===e.length?{success:!0,publicKey:e,method:"extension"}:{success:!1,error:"Invalid public key received from extension"}}catch(e){return console.error("Extension sign in failed:",e),{success:!1,error:e instanceof Error?e.message:"Extension sign in failed"}}}static async signInWithExternalSigner(e=!1){try{sessionStorage.setItem("signIn",JSON.stringify({rememberMe:e}));const t="nostrsigner:?compressionType=none&returnType=signature&type=get_public_key";return await new Promise(e=>{let n=!1;const s=()=>{"hidden"===document.visibilityState&&(n=!0,e(!0))};document.addEventListener("visibilitychange",s),window.location.href=t,setTimeout(()=>{document.removeEventListener("visibilitychange",s),e(!1)},3e3)})?{success:!0,method:"externalSigner"}:(sessionStorage.removeItem("signIn"),{success:!1,error:"Failed to launch 'nostrsigner': Redirection did not occur."})}catch(e){return console.error("External signer failed:",e),{success:!1,error:e instanceof Error?e.message:"External signer failed"}}}static async signInWithNsec(e){try{if(!window.NostrTools)return{success:!1,error:"NostrTools not available. Please ensure nostrtools.min.js is loaded."};if(!e||"string"!=typeof e)return{success:!1,error:"No nsec provided"};const{type:t,data:n}=window.NostrTools.nip19.decode(e);if("nsec"!==t)return{success:!1,error:"Invalid nsec format. Please provide a valid nsec string."};const s=window.NostrTools.getPublicKey(n);return s&&"string"==typeof s&&64===s.length?{success:!0,publicKey:s,privateKey:e,method:"nsec"}:{success:!1,error:"Failed to derive public key from nsec"}}catch(e){return console.error("Nsec sign in failed:",e),{success:!1,error:e instanceof Error?e.message:"Invalid nsec"}}}static async handleExternalSignerReturn(){try{if(void 0!==!JSON.parse(sessionStorage.getItem("signIn")||"{}").rememberMe){sessionStorage.removeItem("signIn");const e=await this.accessClipboard();if(!e)return{success:!1,error:"No public key found in clipboard"};const t=window.NostrTools.nip19.decode(e).data;return t&&"string"==typeof t&&64===t.length?{success:!0,publicKey:t,method:"externalSigner"}:{success:!1,error:"Invalid public key from clipboard"}}return{success:!1,error:"No external signer data found"}}catch(e){return console.error("External signer return failed:",e),{success:!1,error:e instanceof Error?e.message:"Failed to process external signer return"}}}static async accessClipboard(){try{if(navigator.clipboard&&navigator.clipboard.readText)return await navigator.clipboard.readText();{const e=document.createElement("textarea");e.style.position="fixed",e.style.left="-999999px",e.style.top="-999999px",document.body.appendChild(e),e.focus(),e.select();try{const t=document.execCommand("paste"),n=e.value;return document.body.removeChild(e),t?n:null}catch(t){return document.body.removeChild(e),null}}}catch(e){return console.error("Clipboard access failed:",e),null}}static storeAuthData(e,t,n,s){const o=s?localStorage:sessionStorage;o.setItem("publicKey",e),o.setItem("signInMethod",n),t&&o.setItem("privateKey",t)}static getStoredAuthData(){return{publicKey:localStorage.getItem("publicKey")||sessionStorage.getItem("publicKey"),privateKey:localStorage.getItem("privateKey")||sessionStorage.getItem("privateKey"),method:localStorage.getItem("signInMethod")||sessionStorage.getItem("signInMethod")}}static clearAuthData(){localStorage.removeItem("publicKey"),localStorage.removeItem("privateKey"),localStorage.removeItem("signInMethod"),sessionStorage.removeItem("publicKey"),sessionStorage.removeItem("privateKey"),sessionStorage.removeItem("signInMethod"),sessionStorage.removeItem("signIn")}static validateStoredAuthData(){const{publicKey:e,method:t}=this.getStoredAuthData();return e&&"string"==typeof e&&64===e.length&&!(!t||!this.METHODS.includes(t))||(this.clearAuthData(),!1)}static isAuthenticated(){return this.validateStoredAuthData()}static getCurrentUserPublicKey(){const{publicKey:e}=this.getStoredAuthData();return this.validateStoredAuthData()?e:null}static getCurrentUserPrivateKey(){const{privateKey:e}=this.getStoredAuthData();return this.validateStoredAuthData()?e:null}static getCurrentUserMethod(){const{method:e}=this.getStoredAuthData();return this.validateStoredAuthData()?e:null}}d.METHODS=["extension","externalSigner","nsec"];class p{constructor(e=""){this.baseUrl=e}async getInvoiceCallBack(e,t){try{console.log("getInvoiceCallBack called with:",{eventData:e,authorData:t});const n=e.tags.find(e=>"zap-lnurl"===e[0]),s=JSON.parse(t.content);console.log("Parsed author content:",s);const o=n&&n.length>0?n[1]:s.lud16;if(!o)return console.error("No LUD16 address found for author"),null;const a=o.split("@");if(2!==a.length)return console.error("Invalid lud16 format"),null;let r,i=null;try{r=await fetch(`https://${a[1]}/.well-known/lnurlp/${a[0]}`)}catch{i="CAN'T PAY: Failed to fetch lud16"}if(r&&void 0!==r||(i="CAN'T PAY: Failed to fetch lud16"),i)return console.error(i),null;const l=await r.json();return!0!==l.allowsNostr&&(i="CAN'T PAY: No nostr support"),i?(console.error(i),null):{callbackToZap:l.callback,lud16ToZap:o}}catch(e){return console.error("Error getting invoice callback:",e),null}}async createZapEvent(e,t,n,s=null){try{const o=e.tags.find(e=>"zap-min"===e[0]),a=o?o[1]:1e3,r=-1!==t?1e3*parseInt(t.toString()):Math.floor(parseInt(a)),i=await window.NostrTools.nip57.makeZapRequest({event:e.id,profile:e.pubkey,amount:r,comment:"",relays:["wss://relay.damus.io","wss://relay.primal.net","wss://nostr.mutinywallet.com/","wss://relay.nostr.band/","wss://relay.nostr.nu/"]});if(console.log("Created zap event:",i),i.tags.push(["zap-lnurl",n]),i.tags.push(["t","pubpay"]),null!==s){i.pubkey=s;const e=window.NostrTools.getEventHash(i);null!==e&&(i.id=e)}return{zapEvent:i,amountPay:r}}catch(e){return console.error("Error creating zap event:",e),null}}async signZapEvent(e,t,n,s,o,a=!1){try{const r=window.signIn?.getSignInMethod();let i;if(!0===a){const t=window.NostrTools.generateSecretKey();i=window.NostrTools.finalizeEvent(e,t)}else{if("externalSigner"===r){const a=JSON.stringify(e);return sessionStorage.setItem("SignZapEvent",JSON.stringify({callback:t,amount:n,lud16:s,event:e,id:o})),window.location.href=`nostrsigner:${a}?compressionType=none&returnType=signature&type=sign_event`,!0}if("extension"===r)null!==window.nostr&&(i=await window.nostr.signEvent(e));else if("nsec"===r){const t=window.signIn?.getPrivateKey();if(!t)return console.error("No private key found. Please sign in first."),!1;const{data:n}=window.NostrTools.nip19.decode(t);i=window.NostrTools.finalizeEvent(e,n)}}return i?(await this.getInvoiceandPay(t,n,i,s,o),!0):(console.error("Failed to sign zap event - zapFinalized is undefined"),!1)}catch(e){return console.error("Error signing zap event:",e),!1}}async getInvoiceandPay(e,t,n,s,o){try{if(!n)return void console.error("Cannot get invoice - zapFinalized is undefined");const o=`${e}?amount=${t}&nostr=${JSON.stringify(n)}&lnurl=${s}`;console.log("Sending zap request to:",o);const a=await fetch(o);if(!a.ok){const e=await a.text();return void console.error("Failed to get invoice from callback:",a.status,e)}const r=await a.json();if(console.log("Lightning service response:",r),!r.pr)return void console.error("No invoice (pr) in response:",r);const{pr:i}=r;await this.handleFetchedInvoice(i,n.id)}catch(e){console.error("Error getting invoice and paying:",e)}}async handleFetchedInvoice(e,t){console.log("handleFetchedInvoice called with:",{invoice:e.substring(0,50)+"...",zapEventID:t});const n=new CustomEvent("showPaymentUI",{detail:{bolt11:e,amount:0,eventId:t}});console.log("Dispatching showPaymentUI event:",n.detail),window.dispatchEvent(n)}}const m=()=>{const[e,t]=(0,o.useState)(!1),[n,s]=(0,o.useState)("global"),[a,r]=(0,o.useState)([]),[i,m]=(0,o.useState)([]),[u,g]=(0,o.useState)([]),[h,y]=(0,o.useState)(!1),[v,w]=(0,o.useState)({isLoggedIn:!1,publicKey:null,privateKey:null,signInMethod:null,userProfile:null,displayName:null}),f=(0,o.useRef)(null),b=(0,o.useRef)(null),x=(0,o.useRef)(null),N=(0,o.useRef)([]),S=(0,o.useRef)(new Map),I=(0,o.useRef)(new Set),E=(0,o.useRef)([]),j=(0,o.useRef)(null);(0,o.useEffect)(()=>{if(f.current)return;const e=()=>{try{if("undefined"==typeof window||!window.NostrTools)return console.warn("NostrTools not available, retrying in 1 second..."),void setTimeout(e,1e3);f.current=new l;const t={enabled:!0,lnbitsUrl:"undefined"!=typeof process&&{ALLUSERSPROFILE:"C:\\ProgramData",ANDROID_HOME:"C:\\Users\\tantra\\AppData\\Local\\Android\\Sdk",APPDATA:"C:\\Users\\tantra\\AppData\\Roaming",CAMLIBS:"C:\\Program Files\\darktable\\lib\\libgphoto2\\2.5.31",CHROME_CRASHPAD_PIPE_NAME:"\\\\.\\pipe\\crashpad_21040_EGQPETFNPSMQWLBU",COLOR:"1",COLORTERM:"truecolor",CommonProgramFiles:"C:\\Program Files\\Common Files","CommonProgramFiles(x86)":"C:\\Program Files (x86)\\Common Files",CommonProgramW6432:"C:\\Program Files\\Common Files",COMPUTERNAME:"DESKTOP-4JB96TD",ComSpec:"C:\\Windows\\system32\\cmd.exe",CURSOR_TRACE_ID:"6feaa83eb99f452084eacea2d37d1776",DriverData:"C:\\Windows\\System32\\Drivers\\DriverData",EDITOR:"C:\\Windows\\notepad.exe",EFC_15356_1592913036:"1",EFC_15356_2283032206:"1",EFC_15356_2775293581:"1",EFC_15356_3789132940:"1",FPS_BROWSER_APP_PROFILE_STRING:"Internet Explorer",FPS_BROWSER_USER_PROFILE_STRING:"Default",GIT_ASKPASS:"c:\\Users\\tantra\\AppData\\Local\\Programs\\cursor\\resources\\app\\extensions\\git\\dist\\askpass.sh",HOME:"C:\\Users\\tantra",HOMEDRIVE:"C:",HOMEPATH:"\\Users\\tantra",INIT_CWD:"C:\\Users\\tantra\\Desktop\\nostrpay",IOLIBS:"C:\\Program Files\\darktable\\lib\\libgphoto2_port\\0.12.2",JAVA_HOME:"C:\\Program Files\\Java\\jdk-17",LANG:"en_US.UTF-8",LOCALAPPDATA:"C:\\Users\\tantra\\AppData\\Local",LOGONSERVER:"\\\\DESKTOP-4JB96TD",NODE:"C:\\nvm4w\\nodejs\\node.exe",npm_command:"run-script",npm_config_cache:"C:\\Users\\tantra\\AppData\\Local\\npm-cache",npm_config_globalconfig:"C:\\Users\\tantra\\AppData\\Roaming\\npm\\etc\\npmrc",npm_config_global_prefix:"C:\\Users\\tantra\\AppData\\Roaming\\npm",npm_config_init_module:"C:\\Users\\tantra\\.npm-init.js",npm_config_local_prefix:"C:\\Users\\tantra\\Desktop\\nostrpay",npm_config_node_gyp:"C:\\Users\\tantra\\AppData\\Roaming\\npm\\node_modules\\npm\\node_modules\\node-gyp\\bin\\node-gyp.js",npm_config_noproxy:"",npm_config_npm_version:"11.3.0",npm_config_prefix:"C:\\Users\\tantra\\AppData\\Roaming\\npm",npm_config_userconfig:"C:\\Users\\tantra\\.npmrc",npm_config_user_agent:"npm/11.3.0 node/v22.19.0 win32 x64 workspaces/false",npm_execpath:"C:\\Users\\tantra\\AppData\\Roaming\\npm\\node_modules\\npm\\bin\\npm-cli.js",npm_lifecycle_event:"build",npm_lifecycle_script:"webpack --mode production",npm_node_execpath:"C:\\nvm4w\\nodejs\\node.exe",npm_package_json:"C:\\Users\\tantra\\Desktop\\nostrpay\\package.json",npm_package_name:"pubpay",npm_package_version:"0.0.0",NUMBER_OF_PROCESSORS:"22",NVM_HOME:"C:\\Users\\tantra\\AppData\\Local\\nvm",NVM_SYMLINK:"C:\\nvm4w\\nodejs",OneDrive:"C:\\Users\\tantra\\OneDrive",ORIGINAL_XDG_CURRENT_DESKTOP:"undefined",OS:"Windows_NT",Path:"C:\\Users\\tantra\\Desktop\\nostrpay\\node_modules\\.bin;C:\\Users\\tantra\\Desktop\\node_modules\\.bin;C:\\Users\\tantra\\node_modules\\.bin;C:\\Users\\node_modules\\.bin;C:\\node_modules\\.bin;C:\\Users\\tantra\\AppData\\Roaming\\npm\\node_modules\\npm\\node_modules\\@npmcli\\run-script\\lib\\node-gyp-bin;C:\\Program Files\\Common Files\\Oracle\\Java\\javapath;C:\\Windows\\system32;C:\\Windows;C:\\Windows\\System32\\Wbem;C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\;C:\\Windows\\System32\\OpenSSH\\;C:\\Program Files\\Git\\cmd;%ANDROID_HOME%\\platform-tools;C:\\Program Files\\NVIDIA Corporation\\NVIDIA app\\NvDLISR;C:\\Program Files (x86)\\NVIDIA Corporation\\PhysX\\Common;C:\\Strawberry\\c\\bin;C:\\Strawberry\\perl\\site\\bin;C:\\Strawberry\\perl\\bin;C:\\Program Files\\GitHub CLI\\;%NVM_HOME%;%NVM_SYMLINK%;C:\\Program Files\\Docker\\Docker\\resources\\bin;C:\\Users\\tantra\\.cargo\\bin;C:\\Users\\tantra\\scoop\\shims;C:\\Users\\tantra\\AppData\\Local\\Microsoft\\WindowsApps;C:\\Users\\tantra\\AppData\\Local\\Programs\\Microsoft VS Code\\bin;C:\\Users\\tantra\\.bun\\bin;C:\\Users\\tantra\\AppData\\Roaming\\npm;C:\\Users\\tantra\\AppData\\Local\\Programs\\cursor\\resources\\app\\bin;C:\\Users\\tantra\\AppData\\Local\\nvm;C:\\nvm4w\\nodejs",PATHEXT:".COM;.EXE;.BAT;.CMD;.VBS;.VBE;.JS;.JSE;.WSF;.WSH;.MSC;.CPL",PROCESSOR_ARCHITECTURE:"AMD64",PROCESSOR_IDENTIFIER:"Intel64 Family 6 Model 170 Stepping 4, GenuineIntel",PROCESSOR_LEVEL:"6",PROCESSOR_REVISION:"aa04",ProgramData:"C:\\ProgramData",ProgramFiles:"C:\\Program Files","ProgramFiles(x86)":"C:\\Program Files (x86)",ProgramW6432:"C:\\Program Files",PROMPT:"$P$G",PSModulePath:"C:\\Users\\tantra\\Documents\\WindowsPowerShell\\Modules;C:\\Program Files\\WindowsPowerShell\\Modules;C:\\Windows\\system32\\WindowsPowerShell\\v1.0\\Modules",PUBLIC:"C:\\Users\\Public",SESSIONNAME:"Console",SystemDrive:"C:",SystemRoot:"C:\\Windows",TEMP:"C:\\Users\\tantra\\AppData\\Local\\Temp",TERM_PROGRAM:"vscode",TERM_PROGRAM_VERSION:"1.6.45",TMP:"C:\\Users\\tantra\\AppData\\Local\\Temp",USERDOMAIN:"DESKTOP-4JB96TD",USERDOMAIN_ROAMINGPROFILE:"DESKTOP-4JB96TD",USERNAME:"tantra",USERPROFILE:"C:\\Users\\tantra",VBOX_MSI_INSTALL_PATH:"C:\\Program Files\\Oracle\\VirtualBox\\",VSCODE_GIT_ASKPASS_EXTRA_ARGS:"",VSCODE_GIT_ASKPASS_MAIN:"c:\\Users\\tantra\\AppData\\Local\\Programs\\cursor\\resources\\app\\extensions\\git\\dist\\askpass-main.js",VSCODE_GIT_ASKPASS_NODE:"C:\\Users\\tantra\\AppData\\Local\\Programs\\cursor\\Cursor.exe",VSCODE_GIT_IPC_HANDLE:"\\\\.\\pipe\\vscode-git-e3cb8cb4de-sock",VSCODE_INJECTION:"1",windir:"C:\\Windows",ZES_ENABLE_SYSMAN:"1"}?.REACT_APP_LNBITS_URL||"",apiKey:"undefined"!=typeof process&&{ALLUSERSPROFILE:"C:\\ProgramData",ANDROID_HOME:"C:\\Users\\tantra\\AppData\\Local\\Android\\Sdk",APPDATA:"C:\\Users\\tantra\\AppData\\Roaming",CAMLIBS:"C:\\Program Files\\darktable\\lib\\libgphoto2\\2.5.31",CHROME_CRASHPAD_PIPE_NAME:"\\\\.\\pipe\\crashpad_21040_EGQPETFNPSMQWLBU",COLOR:"1",COLORTERM:"truecolor",CommonProgramFiles:"C:\\Program Files\\Common Files","CommonProgramFiles(x86)":"C:\\Program Files (x86)\\Common Files",CommonProgramW6432:"C:\\Program Files\\Common Files",COMPUTERNAME:"DESKTOP-4JB96TD",ComSpec:"C:\\Windows\\system32\\cmd.exe",CURSOR_TRACE_ID:"6feaa83eb99f452084eacea2d37d1776",DriverData:"C:\\Windows\\System32\\Drivers\\DriverData",EDITOR:"C:\\Windows\\notepad.exe",EFC_15356_1592913036:"1",EFC_15356_2283032206:"1",EFC_15356_2775293581:"1",EFC_15356_3789132940:"1",FPS_BROWSER_APP_PROFILE_STRING:"Internet Explorer",FPS_BROWSER_USER_PROFILE_STRING:"Default",GIT_ASKPASS:"c:\\Users\\tantra\\AppData\\Local\\Programs\\cursor\\resources\\app\\extensions\\git\\dist\\askpass.sh",HOME:"C:\\Users\\tantra",HOMEDRIVE:"C:",HOMEPATH:"\\Users\\tantra",INIT_CWD:"C:\\Users\\tantra\\Desktop\\nostrpay",IOLIBS:"C:\\Program Files\\darktable\\lib\\libgphoto2_port\\0.12.2",JAVA_HOME:"C:\\Program Files\\Java\\jdk-17",LANG:"en_US.UTF-8",LOCALAPPDATA:"C:\\Users\\tantra\\AppData\\Local",LOGONSERVER:"\\\\DESKTOP-4JB96TD",NODE:"C:\\nvm4w\\nodejs\\node.exe",npm_command:"run-script",npm_config_cache:"C:\\Users\\tantra\\AppData\\Local\\npm-cache",npm_config_globalconfig:"C:\\Users\\tantra\\AppData\\Roaming\\npm\\etc\\npmrc",npm_config_global_prefix:"C:\\Users\\tantra\\AppData\\Roaming\\npm",npm_config_init_module:"C:\\Users\\tantra\\.npm-init.js",npm_config_local_prefix:"C:\\Users\\tantra\\Desktop\\nostrpay",npm_config_node_gyp:"C:\\Users\\tantra\\AppData\\Roaming\\npm\\node_modules\\npm\\node_modules\\node-gyp\\bin\\node-gyp.js",npm_config_noproxy:"",npm_config_npm_version:"11.3.0",npm_config_prefix:"C:\\Users\\tantra\\AppData\\Roaming\\npm",npm_config_userconfig:"C:\\Users\\tantra\\.npmrc",npm_config_user_agent:"npm/11.3.0 node/v22.19.0 win32 x64 workspaces/false",npm_execpath:"C:\\Users\\tantra\\AppData\\Roaming\\npm\\node_modules\\npm\\bin\\npm-cli.js",npm_lifecycle_event:"build",npm_lifecycle_script:"webpack --mode production",npm_node_execpath:"C:\\nvm4w\\nodejs\\node.exe",npm_package_json:"C:\\Users\\tantra\\Desktop\\nostrpay\\package.json",npm_package_name:"pubpay",npm_package_version:"0.0.0",NUMBER_OF_PROCESSORS:"22",NVM_HOME:"C:\\Users\\tantra\\AppData\\Local\\nvm",NVM_SYMLINK:"C:\\nvm4w\\nodejs",OneDrive:"C:\\Users\\tantra\\OneDrive",ORIGINAL_XDG_CURRENT_DESKTOP:"undefined",OS:"Windows_NT",Path:"C:\\Users\\tantra\\Desktop\\nostrpay\\node_modules\\.bin;C:\\Users\\tantra\\Desktop\\node_modules\\.bin;C:\\Users\\tantra\\node_modules\\.bin;C:\\Users\\node_modules\\.bin;C:\\node_modules\\.bin;C:\\Users\\tantra\\AppData\\Roaming\\npm\\node_modules\\npm\\node_modules\\@npmcli\\run-script\\lib\\node-gyp-bin;C:\\Program Files\\Common Files\\Oracle\\Java\\javapath;C:\\Windows\\system32;C:\\Windows;C:\\Windows\\System32\\Wbem;C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\;C:\\Windows\\System32\\OpenSSH\\;C:\\Program Files\\Git\\cmd;%ANDROID_HOME%\\platform-tools;C:\\Program Files\\NVIDIA Corporation\\NVIDIA app\\NvDLISR;C:\\Program Files (x86)\\NVIDIA Corporation\\PhysX\\Common;C:\\Strawberry\\c\\bin;C:\\Strawberry\\perl\\site\\bin;C:\\Strawberry\\perl\\bin;C:\\Program Files\\GitHub CLI\\;%NVM_HOME%;%NVM_SYMLINK%;C:\\Program Files\\Docker\\Docker\\resources\\bin;C:\\Users\\tantra\\.cargo\\bin;C:\\Users\\tantra\\scoop\\shims;C:\\Users\\tantra\\AppData\\Local\\Microsoft\\WindowsApps;C:\\Users\\tantra\\AppData\\Local\\Programs\\Microsoft VS Code\\bin;C:\\Users\\tantra\\.bun\\bin;C:\\Users\\tantra\\AppData\\Roaming\\npm;C:\\Users\\tantra\\AppData\\Local\\Programs\\cursor\\resources\\app\\bin;C:\\Users\\tantra\\AppData\\Local\\nvm;C:\\nvm4w\\nodejs",PATHEXT:".COM;.EXE;.BAT;.CMD;.VBS;.VBE;.JS;.JSE;.WSF;.WSH;.MSC;.CPL",PROCESSOR_ARCHITECTURE:"AMD64",PROCESSOR_IDENTIFIER:"Intel64 Family 6 Model 170 Stepping 4, GenuineIntel",PROCESSOR_LEVEL:"6",PROCESSOR_REVISION:"aa04",ProgramData:"C:\\ProgramData",ProgramFiles:"C:\\Program Files","ProgramFiles(x86)":"C:\\Program Files (x86)",ProgramW6432:"C:\\Program Files",PROMPT:"$P$G",PSModulePath:"C:\\Users\\tantra\\Documents\\WindowsPowerShell\\Modules;C:\\Program Files\\WindowsPowerShell\\Modules;C:\\Windows\\system32\\WindowsPowerShell\\v1.0\\Modules",PUBLIC:"C:\\Users\\Public",SESSIONNAME:"Console",SystemDrive:"C:",SystemRoot:"C:\\Windows",TEMP:"C:\\Users\\tantra\\AppData\\Local\\Temp",TERM_PROGRAM:"vscode",TERM_PROGRAM_VERSION:"1.6.45",TMP:"C:\\Users\\tantra\\AppData\\Local\\Temp",USERDOMAIN:"DESKTOP-4JB96TD",USERDOMAIN_ROAMINGPROFILE:"DESKTOP-4JB96TD",USERNAME:"tantra",USERPROFILE:"C:\\Users\\tantra",VBOX_MSI_INSTALL_PATH:"C:\\Program Files\\Oracle\\VirtualBox\\",VSCODE_GIT_ASKPASS_EXTRA_ARGS:"",VSCODE_GIT_ASKPASS_MAIN:"c:\\Users\\tantra\\AppData\\Local\\Programs\\cursor\\resources\\app\\extensions\\git\\dist\\askpass-main.js",VSCODE_GIT_ASKPASS_NODE:"C:\\Users\\tantra\\AppData\\Local\\Programs\\cursor\\Cursor.exe",VSCODE_GIT_IPC_HANDLE:"\\\\.\\pipe\\vscode-git-e3cb8cb4de-sock",VSCODE_INJECTION:"1",windir:"C:\\Windows",ZES_ENABLE_SYSMAN:"1"}?.REACT_APP_LNBITS_API_KEY||"",webhookUrl:"undefined"!=typeof process&&{ALLUSERSPROFILE:"C:\\ProgramData",ANDROID_HOME:"C:\\Users\\tantra\\AppData\\Local\\Android\\Sdk",APPDATA:"C:\\Users\\tantra\\AppData\\Roaming",CAMLIBS:"C:\\Program Files\\darktable\\lib\\libgphoto2\\2.5.31",CHROME_CRASHPAD_PIPE_NAME:"\\\\.\\pipe\\crashpad_21040_EGQPETFNPSMQWLBU",COLOR:"1",COLORTERM:"truecolor",CommonProgramFiles:"C:\\Program Files\\Common Files","CommonProgramFiles(x86)":"C:\\Program Files (x86)\\Common Files",CommonProgramW6432:"C:\\Program Files\\Common Files",COMPUTERNAME:"DESKTOP-4JB96TD",ComSpec:"C:\\Windows\\system32\\cmd.exe",CURSOR_TRACE_ID:"6feaa83eb99f452084eacea2d37d1776",DriverData:"C:\\Windows\\System32\\Drivers\\DriverData",EDITOR:"C:\\Windows\\notepad.exe",EFC_15356_1592913036:"1",EFC_15356_2283032206:"1",EFC_15356_2775293581:"1",EFC_15356_3789132940:"1",FPS_BROWSER_APP_PROFILE_STRING:"Internet Explorer",FPS_BROWSER_USER_PROFILE_STRING:"Default",GIT_ASKPASS:"c:\\Users\\tantra\\AppData\\Local\\Programs\\cursor\\resources\\app\\extensions\\git\\dist\\askpass.sh",HOME:"C:\\Users\\tantra",HOMEDRIVE:"C:",HOMEPATH:"\\Users\\tantra",INIT_CWD:"C:\\Users\\tantra\\Desktop\\nostrpay",IOLIBS:"C:\\Program Files\\darktable\\lib\\libgphoto2_port\\0.12.2",JAVA_HOME:"C:\\Program Files\\Java\\jdk-17",LANG:"en_US.UTF-8",LOCALAPPDATA:"C:\\Users\\tantra\\AppData\\Local",LOGONSERVER:"\\\\DESKTOP-4JB96TD",NODE:"C:\\nvm4w\\nodejs\\node.exe",npm_command:"run-script",npm_config_cache:"C:\\Users\\tantra\\AppData\\Local\\npm-cache",npm_config_globalconfig:"C:\\Users\\tantra\\AppData\\Roaming\\npm\\etc\\npmrc",npm_config_global_prefix:"C:\\Users\\tantra\\AppData\\Roaming\\npm",npm_config_init_module:"C:\\Users\\tantra\\.npm-init.js",npm_config_local_prefix:"C:\\Users\\tantra\\Desktop\\nostrpay",npm_config_node_gyp:"C:\\Users\\tantra\\AppData\\Roaming\\npm\\node_modules\\npm\\node_modules\\node-gyp\\bin\\node-gyp.js",npm_config_noproxy:"",npm_config_npm_version:"11.3.0",npm_config_prefix:"C:\\Users\\tantra\\AppData\\Roaming\\npm",npm_config_userconfig:"C:\\Users\\tantra\\.npmrc",npm_config_user_agent:"npm/11.3.0 node/v22.19.0 win32 x64 workspaces/false",npm_execpath:"C:\\Users\\tantra\\AppData\\Roaming\\npm\\node_modules\\npm\\bin\\npm-cli.js",npm_lifecycle_event:"build",npm_lifecycle_script:"webpack --mode production",npm_node_execpath:"C:\\nvm4w\\nodejs\\node.exe",npm_package_json:"C:\\Users\\tantra\\Desktop\\nostrpay\\package.json",npm_package_name:"pubpay",npm_package_version:"0.0.0",NUMBER_OF_PROCESSORS:"22",NVM_HOME:"C:\\Users\\tantra\\AppData\\Local\\nvm",NVM_SYMLINK:"C:\\nvm4w\\nodejs",OneDrive:"C:\\Users\\tantra\\OneDrive",ORIGINAL_XDG_CURRENT_DESKTOP:"undefined",OS:"Windows_NT",Path:"C:\\Users\\tantra\\Desktop\\nostrpay\\node_modules\\.bin;C:\\Users\\tantra\\Desktop\\node_modules\\.bin;C:\\Users\\tantra\\node_modules\\.bin;C:\\Users\\node_modules\\.bin;C:\\node_modules\\.bin;C:\\Users\\tantra\\AppData\\Roaming\\npm\\node_modules\\npm\\node_modules\\@npmcli\\run-script\\lib\\node-gyp-bin;C:\\Program Files\\Common Files\\Oracle\\Java\\javapath;C:\\Windows\\system32;C:\\Windows;C:\\Windows\\System32\\Wbem;C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\;C:\\Windows\\System32\\OpenSSH\\;C:\\Program Files\\Git\\cmd;%ANDROID_HOME%\\platform-tools;C:\\Program Files\\NVIDIA Corporation\\NVIDIA app\\NvDLISR;C:\\Program Files (x86)\\NVIDIA Corporation\\PhysX\\Common;C:\\Strawberry\\c\\bin;C:\\Strawberry\\perl\\site\\bin;C:\\Strawberry\\perl\\bin;C:\\Program Files\\GitHub CLI\\;%NVM_HOME%;%NVM_SYMLINK%;C:\\Program Files\\Docker\\Docker\\resources\\bin;C:\\Users\\tantra\\.cargo\\bin;C:\\Users\\tantra\\scoop\\shims;C:\\Users\\tantra\\AppData\\Local\\Microsoft\\WindowsApps;C:\\Users\\tantra\\AppData\\Local\\Programs\\Microsoft VS Code\\bin;C:\\Users\\tantra\\.bun\\bin;C:\\Users\\tantra\\AppData\\Roaming\\npm;C:\\Users\\tantra\\AppData\\Local\\Programs\\cursor\\resources\\app\\bin;C:\\Users\\tantra\\AppData\\Local\\nvm;C:\\nvm4w\\nodejs",PATHEXT:".COM;.EXE;.BAT;.CMD;.VBS;.VBE;.JS;.JSE;.WSF;.WSH;.MSC;.CPL",PROCESSOR_ARCHITECTURE:"AMD64",PROCESSOR_IDENTIFIER:"Intel64 Family 6 Model 170 Stepping 4, GenuineIntel",PROCESSOR_LEVEL:"6",PROCESSOR_REVISION:"aa04",ProgramData:"C:\\ProgramData",ProgramFiles:"C:\\Program Files","ProgramFiles(x86)":"C:\\Program Files (x86)",ProgramW6432:"C:\\Program Files",PROMPT:"$P$G",PSModulePath:"C:\\Users\\tantra\\Documents\\WindowsPowerShell\\Modules;C:\\Program Files\\WindowsPowerShell\\Modules;C:\\Windows\\system32\\WindowsPowerShell\\v1.0\\Modules",PUBLIC:"C:\\Users\\Public",SESSIONNAME:"Console",SystemDrive:"C:",SystemRoot:"C:\\Windows",TEMP:"C:\\Users\\tantra\\AppData\\Local\\Temp",TERM_PROGRAM:"vscode",TERM_PROGRAM_VERSION:"1.6.45",TMP:"C:\\Users\\tantra\\AppData\\Local\\Temp",USERDOMAIN:"DESKTOP-4JB96TD",USERDOMAIN_ROAMINGPROFILE:"DESKTOP-4JB96TD",USERNAME:"tantra",USERPROFILE:"C:\\Users\\tantra",VBOX_MSI_INSTALL_PATH:"C:\\Program Files\\Oracle\\VirtualBox\\",VSCODE_GIT_ASKPASS_EXTRA_ARGS:"",VSCODE_GIT_ASKPASS_MAIN:"c:\\Users\\tantra\\AppData\\Local\\Programs\\cursor\\resources\\app\\extensions\\git\\dist\\askpass-main.js",VSCODE_GIT_ASKPASS_NODE:"C:\\Users\\tantra\\AppData\\Local\\Programs\\cursor\\Cursor.exe",VSCODE_GIT_IPC_HANDLE:"\\\\.\\pipe\\vscode-git-e3cb8cb4de-sock",VSCODE_INJECTION:"1",windir:"C:\\Windows",ZES_ENABLE_SYSMAN:"1"}?.REACT_APP_WEBHOOK_URL||""};b.current=new c(t),x.current=new p,console.log("Services initialized")}catch(e){console.error("Failed to initialize services:",e),console.error("Failed to initialize services. Please refresh the page.")}};e()},[]),(0,o.useEffect)(()=>{setTimeout(()=>{(()=>{if(new URLSearchParams(window.location.search).get("note"))console.log("Single note mode detected, skipping global feed load");else if(f.current&&"undefined"!=typeof window&&window.NostrTools)setTimeout(()=>{k("global")},1e3);else{const e=setInterval(()=>{f.current&&"undefined"!=typeof window&&window.NostrTools&&(new URLSearchParams(window.location.search).get("note")||k("global"),clearInterval(e))},1e3);setTimeout(()=>clearInterval(e),3e4)}})()},100)},[]),(0,o.useEffect)(()=>{C();const e=async()=>{if("visible"===document.visibilityState){const e=await d.handleExternalSignerReturn();e.success&&e.publicKey&&(d.storeAuthData(e.publicKey,null,"externalSigner",!1),w({isLoggedIn:!0,publicKey:e.publicKey,privateKey:null,signInMethod:"externalSigner",userProfile:null,displayName:null}),await L(e.publicKey))}};return document.addEventListener("visibilitychange",e),()=>{document.removeEventListener("visibilitychange",e)}},[]);const C=()=>{if(d.isAuthenticated()){const{publicKey:e,privateKey:t,method:n}=d.getStoredAuthData();w({isLoggedIn:!0,publicKey:e,privateKey:t,signInMethod:n,userProfile:null,displayName:null}),f.current&&e&&L(e)}},L=async e=>{if(f.current&&e)try{const t={kinds:[0],authors:[e]},n=JSON.parse(JSON.stringify(t)),s=await f.current.getEvents([n]);if(s&&s.length>0){const e=s[0];let t=null;try{const n=JSON.parse(e?.content||"{}");t=n.display_name||n.displayName||n.name||null}catch(e){console.error("Failed to parse profile data:",e)}w(n=>({...n,userProfile:e||null,displayName:t}))}}catch(e){console.error("Failed to load user profile:",e)}},k=async(e,n=!1)=>{if(f.current)if("undefined"!=typeof window&&window.NostrTools)try{n?y(!0):t(!0);const s={kinds:[1],"#t":["pubpay"],limit:21};if("following"===e&&N.current&&N.current.length>0&&(s.authors=[...N.current]),n){const t="following"===e?i:a;if(t.length>0){const e=t[t.length-1];e&&(s.until=e.createdAt,console.log("Loading more posts until:",e.createdAt,"for post:",e.id))}}if(!s.kinds||0===s.kinds.length)return void console.warn("Invalid filter: missing kinds");const o=[JSON.parse(JSON.stringify(s))],l=await f.current.getEvents(o);if(!l||0===l.length)return void(n?y(!1):t(!1));const c=[...new Set(l.map(e=>e.pubkey))],d=await f.current.getEvents([{kinds:[0],authors:c}]),p=l.map(e=>e.id),u=await f.current.getEvents([{kinds:[9735],"#e":p}]),g=new Set;u.forEach(e=>{const t=e.tags.find(e=>"description"===e[0]);let n=!1;if(t)try{const e=JSON.parse(t[1]||"{}");e.pubkey&&(g.add(e.pubkey),n=!0)}catch{}n||g.add(e.pubkey)});const h=g.size>0?await f.current.getEvents([{kinds:[0],authors:Array.from(g)}]):[],v=[...d,...h],w=await P(l,v);n?("following"===e?m(e=>{const t=new Set(e.map(e=>e.id)),n=w.filter(e=>!t.has(e.id));return console.log(`Adding ${n.length} new posts (${w.length-n.length} duplicates filtered)`),[...e,...n]}):r(e=>{const t=new Set(e.map(e=>e.id)),n=w.filter(e=>!t.has(e.id));return console.log(`Adding ${n.length} new posts (${w.length-n.length} duplicates filtered)`),[...e,...n]}),y(!1)):("following"===e?m(w):r(w),t(!1)),u.length>0&&await T(l,u,e)}catch(e){console.error("Failed to load posts:",e),console.error("Failed to load posts:",e instanceof Error?e.message:"Failed to load posts"),t(!1),y(!1)}else console.warn("NostrTools not available yet");else console.warn("NostrClient not available yet")},P=async(e,t)=>{const n=[],s=new Set;e.forEach(e=>{const t=e.tags.find(e=>"zap-payer"===e[0]);t&&t[1]&&s.add(t[1])});let o=[];s.size>0&&(o=await(f.current?.getEvents([{kinds:[0],authors:Array.from(s)}]))||[]);const a=[...t,...o];for(const t of e){const e=a.find(e=>e.pubkey===t.pubkey),s={id:t.id,event:t,author:e||{kind:0,id:"",pubkey:t.pubkey,content:"{}",created_at:0,sig:"",tags:[]},createdAt:t.created_at,zapMin:0,zapMax:0,zapUses:0,zapAmount:0,zaps:[],zapUsesCurrent:0,isPayable:!0,content:t.content},o=t.tags.find(e=>"zap-min"===e[0]),r=t.tags.find(e=>"zap-max"===e[0]),i=t.tags.find(e=>"zap-uses"===e[0]),l=t.tags.find(e=>"zap-payer"===e[0]);if(o&&o[1]&&(s.zapMin=parseInt(o[1])/1e3||0),r&&r[1]&&(s.zapMax=parseInt(r[1])/1e3||0),i&&i[1]&&(s.zapUses=parseInt(i[1])||0),l&&l[1]){s.zapPayer=l[1];const e=a.find(e=>e.pubkey===l[1]);if(e)try{const t=JSON.parse(e.content);s.zapPayerPicture=t.picture||"https://icon-library.com/images/generic-user-icon/generic-user-icon-10.jpg"}catch{s.zapPayerPicture="https://icon-library.com/images/generic-user-icon/generic-user-icon-10.jpg"}else s.zapPayerPicture="https://icon-library.com/images/generic-user-icon/generic-user-icon-10.jpg"}n.push(s)}return n.sort((e,t)=>t.createdAt-e.createdAt)},T=async(e,t,n)=>{const s=e.map(e=>e.id),o=t.filter(e=>e.tags.some(e=>"e"===e[0]&&e[1]&&s.includes(e[1])));if(0===o.length)return;const a=new Set;o.forEach(e=>{const t=e.tags.find(e=>"description"===e[0]);let n=!1;if(t)try{const e=JSON.parse(t[1]||"{}");e.pubkey&&(a.add(e.pubkey),n=!0)}catch{}n||a.add(e.pubkey)});const i=a.size>0?await(f.current?.getEvents([{kinds:[0],authors:Array.from(a)}])):[],l=e=>e.map(e=>{let t=o.filter(t=>t.tags.some(t=>"e"===t[0]&&t[1]===e.id));if(e.zapPayer&&(t=t.filter(t=>{const n=t.tags.find(e=>"description"===e[0]);if(n)try{return JSON.parse(n[1]||"{}").pubkey===e.zapPayer}catch{return!1}return!1})),t=t.reverse(),0===t.length)return e;const n=t.map(e=>{const t=e.tags.find(e=>"bolt11"===e[0]);let n=0;if(t&&window.lightningPayReq)try{n=window.lightningPayReq.decode(t[1]||"").satoshis||0}catch{n=0}const s=e.tags.find(e=>"description"===e[0]);let o=e.pubkey,a=!1;if(s)try{const e=JSON.parse(s[1]||"{}");e.pubkey?o=e.pubkey:a=!0}catch{a=!0}else a=!0;const r=i.find(e=>e.pubkey===o),l=r&&JSON.parse(r.content||"{}").picture||"https://icon-library.com/images/generic-user-icon/generic-user-icon-10.jpg",c=window.NostrTools?window.NostrTools.nip19.npubEncode(o):o;return{...e,zapAmount:n,zapPayerPubkey:o,zapPayerPicture:l,zapPayerNpub:c}}),s=n.reduce((e,t)=>e+t.zapAmount,0),a=n.length;return{...e,zaps:n,zapAmount:s,zapUsesCurrent:a}});"following"===n?m(e=>l(e)):r(e=>l(e))},z=async(e,t,n)=>{const s=[];for(const o of e){const e=t.find(e=>e.pubkey===o.pubkey),a=n.filter(e=>e.tags.some(e=>"e"===e[0]&&e[1]===o.id)).reverse(),r=a.map(e=>{const n=e.tags.find(e=>"bolt11"===e[0]);let s=0;if(n&&window.lightningPayReq)try{s=window.lightningPayReq.decode(n[1]||"").satoshis||0}catch{s=0}const o=e.tags.find(e=>"description"===e[0]);let a="",r=!1;if(o)try{const e=JSON.parse(o[1]||"{}");a=e.pubkey||"",r=!e.pubkey}catch{a="",r=!0}else r=!0;r&&(a=e.pubkey);const i=t.find(e=>e.pubkey===a);let l="https://icon-library.com/images/generic-user-icon/generic-user-icon-10.jpg";if(i)try{l=JSON.parse(i.content).picture||"https://icon-library.com/images/generic-user-icon/generic-user-icon-10.jpg"}catch{l="https://icon-library.com/images/generic-user-icon/generic-user-icon-10.jpg"}const c=a&&window.NostrTools?window.NostrTools.nip19.npubEncode(a):"";return{...e,zapAmount:s,zapPayerPubkey:a,zapPayerPicture:l,zapPayerNpub:c}}),i=r.reduce((e,t)=>e+t.zapAmount,0),l=o.tags.find(e=>"zap-min"===e[0]),c=o.tags.find(e=>"zap-max"===e[0]),d=o.tags.find(e=>"zap-uses"===e[0]),p=o.tags.find(e=>"zap-payer"===e[0]),m=o.tags.find(e=>"zap-lnurl"===e[0]),u=l?parseInt(l[1]||"0")/1e3:0,g=c?parseInt(c[1]||"0")/1e3:u,h=d?parseInt(d[1]||"1"):1,y=a.length,v=p?.[1],w=m?.[1],f=!(!e||!JSON.parse(e.content).lud16)||!!w;s.push({id:o.id,event:o,author:e||null,zaps:r,zapAmount:i,zapMin:u,zapMax:g,zapUses:h,zapUsesCurrent:y,content:o.content,isPayable:f,zapPayer:v,zapLNURL:w,createdAt:o.created_at})}return s.sort((e,t)=>t.createdAt-e.createdAt)},q=()=>{const e=new CustomEvent("showLoginForm");window.dispatchEvent(e)},A=async e=>{if(f.current)try{const t={kinds:[1],"#e":[e]},n=JSON.parse(JSON.stringify(t)),s=await f.current.getEvents([n]);if(!s||0===s.length)return void g([]);console.log("Found replies:",s.length);const o=[...new Set(s.map(e=>e.pubkey))],a=await f.current.getEvents([{kinds:[0],authors:o}]),r=s.map(e=>e.id),i=await f.current.getEvents([{kinds:[9735],"#e":r}]),l=new Set;i.forEach(e=>{const t=e.tags.find(e=>"description"===e[0]);let n=!1;if(t)try{const e=JSON.parse(t[1]||"{}");e.pubkey&&(l.add(e.pubkey),n=!0)}catch{}n||l.add(e.pubkey)});const c=l.size>0?await f.current.getEvents([{kinds:[0],authors:Array.from(l)}]):[],d=[...a,...c],p=(e=>{const t=[],n=new Map;for(const s of e){let e=0;const o=s.event.tags.find(e=>"e"===e[0]&&"reply"===e[3]);if(o&&o[1]){const t=o[1],s=n.get(t);void 0!==s&&(e=s+1)}n.set(s.id,e),t.push({...s,replyLevel:e})}return t})((await z(s,d,i)).sort((e,t)=>e.createdAt-t.createdAt));g(p)}catch(e){console.error("Failed to load replies:",e)}};(0,o.useEffect)(()=>{if(!f.current||e)return()=>{};let t=null;if(a.length>0){const e=a.map(e=>e.id);t=f.current.subscribeToEvents([{kinds:[9735],"#e":e}],async e=>{if(9735===e.kind)if(E.current.push(e),j.current&&clearTimeout(j.current),E.current.length>=10){const e=[...E.current];E.current=[],await _(e)}else j.current=setTimeout(async()=>{const e=[...E.current];E.current=[],await _(e)},500)},{oneose:()=>{console.log("Zap subscription EOS")},onclosed:()=>{console.log("Zap subscription closed")}})}return()=>{t&&t.unsubscribe()}},[a.length,e]);const _=async e=>{if(0===e.length)return;const t=new Set;e.forEach(e=>{const n=e.tags.find(e=>"description"===e[0]);let s="";if(n)try{s=JSON.parse(n[1]||"{}").pubkey||""}catch{s=""}s||(s=e.pubkey),s&&t.add(s)});const n=await B(Array.from(t));for(const t of e){const e=await M(t,n);if(!e)continue;const s=t.tags.find(e=>"e"===e[0]);if(!s)continue;const o=s[1],a=document.getElementById("invoiceOverlay");if(a){const e=a.getAttribute("data-event-id"),n=t.tags.find(e=>"description"===e[0]);let s="";if(n)try{s=JSON.parse(n[1]||"{}").id||""}catch{}if(e===s){a.style.display="none";const e=document.getElementById("invoiceQR");e&&(e.innerHTML="")}}r(n=>{const s=[...n],a=s.findIndex(e=>e.id===o);if(-1===a)return s;const r=s[a];if(!r)return s;if(r.zaps.find(e=>e.id===t.id))return s;const i={...r,zaps:[...r.zaps,e],zapAmount:r.zapAmount+e.zapAmount,zapUsesCurrent:r.zapUsesCurrent+1};return s[a]=i,s}),m(n=>{const s=[...n],a=s.findIndex(e=>e.id===o);if(-1===a)return s;const r=s[a];if(!r)return s;if(r.zaps.find(e=>e.id===t.id))return s;const i={...r,zaps:[...r.zaps,e],zapAmount:r.zapAmount+e.zapAmount,zapUsesCurrent:r.zapUsesCurrent+1};return s[a]=i,s})}},B=async e=>{const t=new Map,n=[];for(const s of e){const e=S.current.get(s);e?t.set(s,e):I.current.has(s)||n.push(s)}if(n.length>0&&f.current){n.forEach(e=>I.current.add(e));try{(await f.current.getEvents([{kinds:[0],authors:n}])).forEach(e=>{S.current.set(e.pubkey,e),t.set(e.pubkey,e)}),n.forEach(e=>I.current.delete(e))}catch(e){console.error("Error loading profiles:",e),n.forEach(e=>I.current.delete(e))}}return t},M=async(e,t)=>{try{const n=e.tags.find(e=>"bolt11"===e[0]);let s=0;if(n&&window.lightningPayReq)try{s=window.lightningPayReq.decode(n[1]).satoshis||0}catch{s=0}const o=e.tags.find(e=>"description"===e[0]);let r="",i=!1;if(o)try{const e=JSON.parse(o[1]||"{}");r=e.pubkey||"",i=!e.pubkey}catch{r="",i=!0}else i=!0;i&&(r=e.pubkey);const l=e.tags.find(e=>"e"===e[0]);if(l&&l[1]){const e=a.find(e=>e.id===l[1]);if(e&&e.zapPayer&&r!==e.zapPayer)return null}const c=r?t.get(r):null;let d="https://icon-library.com/images/generic-user-icon/generic-user-icon-10.jpg";if(c)try{d=JSON.parse(c.content).picture||"https://icon-library.com/images/generic-user-icon/generic-user-icon-10.jpg"}catch{d="https://icon-library.com/images/generic-user-icon/generic-user-icon-10.jpg"}const p=r&&window.NostrTools?window.NostrTools.nip19.npubEncode(r):"";return{...e,zapAmount:s,zapPayerPubkey:r,zapPayerPicture:d,zapPayerNpub:p}}catch(e){return console.error("Error processing zap:",e),null}};return(0,o.useEffect)(()=>()=>{try{f.current&&f.current.destroy(),b.current&&b.current.destroy()}catch(e){console.warn("Error during cleanup:",e)}},[]),{isLoading:e,activeFeed:n,posts:a,followingPosts:i,replies:u,isLoadingMore:h,authState:v,handleFeedChange:e=>{"following"!==e||v.isLoggedIn?(s(e),"following"===e&&0===i.length&&(async()=>{if(v.isLoggedIn&&f.current)try{const e=await f.current.getEvents([{kinds:[3],authors:[v.publicKey]}]),t=[];for(const n of e){const e=n.tags.filter(e=>"p"===e[0]);t.push(...e.map(e=>e[1]).filter(e=>Boolean(e)))}N.current=t,await k("following")}catch(e){console.error("Failed to load following posts:",e),console.error("Failed to load following posts")}})()):q()},handleQRScanner:()=>{console.log("Opening QR scanner...")},handleLogin:q,handleNewPayNote:()=>{v.isLoggedIn?console.log("Opening new pay note form..."):q()},handleSignInExtension:async(e=!0)=>{try{const t=await d.signInWithExtension();return t.success&&t.publicKey?(d.storeAuthData(t.publicKey,t.privateKey||null,"extension",e),w({isLoggedIn:!0,publicKey:t.publicKey,privateKey:t.privateKey||null,signInMethod:"extension",userProfile:null,displayName:null}),await L(t.publicKey),{success:!0}):(console.error("Extension sign in failed:",t.error||"Extension sign in failed"),{success:!1,error:t.error||"Extension sign in failed"})}catch(e){return console.error("Extension sign in failed:",e),{success:!1,error:"Extension sign in failed"}}},handleSignInExternalSigner:async(e=!0)=>{try{const t=await d.signInWithExternalSigner(e);return t.success?{success:!0}:(console.error("External signer failed:",t.error||"External signer failed"),{success:!1,error:t.error||"External signer failed"})}catch(e){return console.error("External signer failed:",e),{success:!1,error:"External signer failed"}}},handleSignInNsec:()=>{console.log("Nsec sign in initiated...")},handleContinueWithNsec:async(e,t)=>{try{const n=await d.signInWithNsec(e);n.success&&n.publicKey?(d.storeAuthData(n.publicKey,n.privateKey||null,"nsec",t),w({isLoggedIn:!0,publicKey:n.publicKey,privateKey:n.privateKey||null,signInMethod:"nsec",userProfile:null,displayName:null}),await L(n.publicKey)):console.error("Nsec sign in failed:",n.error||"Invalid nsec")}catch(e){console.error("Nsec sign in failed:",e),console.error("Invalid nsec")}},handleLogout:()=>{d.clearAuthData(),w({isLoggedIn:!1,publicKey:null,privateKey:null,signInMethod:null,userProfile:null,displayName:null}),m([]),N.current=[]},handlePayWithExtension:async(e,t)=>{if(v.isLoggedIn)if(window.nostr)if(x.current)try{if(console.log("Processing zap payment:",t,"sats for post:",e.id),!e.author)return void console.error("No author data found");const n=await x.current.getInvoiceCallBack(e.event,e.author);if(!n)return void console.error("Failed to get Lightning callback");const s=v.publicKey;if(!s)return void console.error("No public key found");const o=await x.current.createZapEvent(e.event,t,n.lud16ToZap,s);if(!o)return void console.error("Failed to create zap event");await x.current.signZapEvent(o.zapEvent,n.callbackToZap,o.amountPay,n.lud16ToZap,e.id,!1)?console.log("Zap payment initiated successfully"):console.error("Failed to sign and send zap event")}catch(e){console.error("Payment failed:",e)}else console.error("Zap service not initialized");else console.error("Nostr extension not available");else q()},handlePayAnonymously:async(e,t)=>{if(x.current)try{if(console.log("Processing anonymous zap payment:",t,"sats for post:",e.id),!e.author)return void console.error("No author data found");const n=await x.current.getInvoiceCallBack(e.event,e.author);if(!n)return void console.error("Failed to get Lightning callback");const s=await x.current.createZapEvent(e.event,t,n.lud16ToZap,null);if(!s)return void console.error("Failed to create zap event");await x.current.signZapEvent(s.zapEvent,n.callbackToZap,s.amountPay,n.lud16ToZap,e.id,!0)?console.log("Anonymous zap payment initiated successfully"):console.error("Failed to initiate anonymous zap payment")}catch(e){console.error("Anonymous zap payment failed:",e)}else console.error("Zap service not initialized")},handlePayWithWallet:async(e,t)=>{try{console.log("Paying with wallet:",t,"sats for post:",e.id)}catch(e){console.error("Payment failed:",e),console.error("Payment failed")}},handleCopyInvoice:async e=>{try{await navigator.clipboard.writeText(e),console.log("Invoice copied to clipboard")}catch(e){console.error("Failed to copy invoice:",e),console.error("Failed to copy invoice")}},handlePostNote:async e=>{if(v.isLoggedIn)if(f.current)try{const{payNoteContent:t,paymentType:s,zapFixed:o,zapMin:a,zapMax:r,zapUses:i,zapPayer:l,overrideLNURL:c}=e;if(!t||""===t.trim())return void console.error("Please enter a payment request description");const d=[["t","pubpay"]];let p,m;if("fixed"===s){const e=parseInt(o??"1")||1;p=1e3*e,m=1e3*e}else{if("range"!==s)return void console.error("Please select a payment type");if(p=1e3*(parseInt(a??"1")||1),m=1e3*(parseInt(r??"1000000")||1e6),m<p)return void console.error("Maximum amount must be greater than minimum amount")}if(d.push(["zap-min",p.toString()]),d.push(["zap-max",m.toString()]),i&&parseInt(i)>0&&d.push(["zap-uses",i]),l&&""!==l.trim())try{const e=window.NostrTools.nip19.decode(l);if("npub"!==e.type)return void console.error("Invalid payer npub format");d.push(["zap-payer",e.data])}catch{return void console.error("Invalid payer npub format")}c&&""!==c.trim()&&d.push(["zap-lnurl",c]),d.push(["client","PubPay.me"]);const u=t.match(/(nostr:|@)?((npub)1[qpzry9x8gf2tvdw0s3jn54khce6mua7l]{58,})/gi);u&&u.forEach(e=>{try{const t=e.replace(/nostr:|@/g,""),n=window.NostrTools.nip19.decode(t);"npub"===n.type&&d.push(["p",n.data,"","mention"])}catch{console.warn("Failed to decode mention:",e)}});const g={kind:1,created_at:Math.floor(Date.now()/1e3),tags:d,content:t.trim(),pubkey:"",id:"",sig:""};let h;if("extension"===v.signInMethod){if(!window.nostr)return void console.error("Nostr extension not available");h=await window.nostr.signEvent(g)}else{if("nsec"!==v.signInMethod){if("externalSigner"===v.signInMethod){g.pubkey=v.publicKey,g.id=window.NostrTools.getEventHash(g);const e=JSON.stringify(g);return sessionStorage.setItem("SignKind1",JSON.stringify({event:g})),void(window.location.href=`nostrsigner:${e}?compressionType=none&returnType=signature&type=sign_event`)}return void console.error("Invalid sign-in method")}{if(!v.privateKey)return void console.error("Private key not available");const{data:e}=window.NostrTools.nip19.decode(v.privateKey);h=window.NostrTools.finalizeEvent(g,e)}}if(!window.NostrTools.verifyEvent(h))return void console.error("Invalid signed event");await f.current.publishEvent(h),console.log("Event published successfully"),await k(n)}catch(e){console.error("Failed to post note:",e),console.error("Failed to post note:",e instanceof Error?e.message:"Failed to post note")}else console.error("Nostr client not available");else q()},loadMorePosts:async()=>{if(!h)return("following"===n?i:a).length<21?void console.log("Not enough posts to load more, skipping..."):(console.log("Loading more posts..."),k(n,!0));console.log("Already loading more posts, skipping...")},loadSingleNote:async e=>{if(f.current)if("undefined"!=typeof window&&window.NostrTools)try{t(!0),r([]),g([]);const n={kinds:[1],ids:[e]},s=JSON.parse(JSON.stringify(n)),o=await f.current.getEvents([s]);if(!o||0===o.length)return console.log("Note not found"),void t(!1);console.log("Found single note:",o[0]);const a=o[0]?.pubkey;if(!a)return console.error("No author pubkey found"),void t(!1);const i=await f.current.getEvents([{kinds:[0],authors:[a]}]),l=await f.current.getEvents([{kinds:[9735],"#e":[e]}]),c=new Set;l.forEach(e=>{const t=e.tags.find(e=>"description"===e[0]);let n=!1;if(t)try{const e=JSON.parse(t[1]||"{}");e.pubkey&&(c.add(e.pubkey),n=!0)}catch{}n||c.add(e.pubkey)});const d=c.size>0?await f.current.getEvents([{kinds:[0],authors:Array.from(c)}]):[],p=[...i,...d],m=await z(o,p,l);m.length>0&&r(m),await A(e),t(!1)}catch(e){console.error("Failed to load single note:",e),t(!1)}else console.warn("NostrTools not available yet");else console.warn("NostrClient not available yet")},loadReplies:A}},u=o.memo(({post:e,onPay:t,onPayAnonymously:n,onShare:a,onViewRaw:r,isLoggedIn:i,isReply:l=!1})=>{const[c,d]=(0,o.useState)(e.zapMin),[p,m]=(0,o.useState)(!1),[u,g]=(0,o.useState)(""),[h,y]=(0,o.useState)([]),[v,w]=(0,o.useState)([]),f=(0,o.useRef)(null),b=(0,o.useRef)(null),x=(0,o.useRef)(null);(0,o.useEffect)(()=>{const e=e=>{f.current&&x.current&&!f.current.contains(e.target)&&!x.current.contains(e.target)&&m(!1)};return p&&document.addEventListener("click",e),()=>{document.removeEventListener("click",e)}},[p]);const N=e.author?JSON.parse(e.author.content):null,S=N?.display_name||N?.name||"Anonymous",I=N?.picture||"https://icon-library.com/images/generic-user-icon/generic-user-icon-10.jpg",E=N?.nip05,j=N?.lud16,C=e.isPayable&&(0===e.zapUses||e.zapUsesCurrent<e.zapUses);return(0,o.useEffect)(()=>{if(0===e.zaps.length)return y([]),void w([]);const t=[],n=[];e.zaps.forEach((s,o)=>{const a=s.zapAmount,r=e.zapMin,i=e.zapMax;a>=r&&a<=i?t.push(s):n.push(s)}),y(t),w(n)},[e.zaps,e.zapUsesCurrent,e.zapUses]),(0,o.useEffect)(()=>{const e=e=>{const t=e.target;if(!t.matches(".dropbtn")&&!t.matches(".dropdown-element")){const e=document.getElementsByClassName("dropdown-content");for(let t=0;t<e.length;t++)e[t].classList.remove("show")}},t=e=>{const t=e.target;if(!t.matches(".dropbtn")&&!t.matches(".dropdown-element")){const e=document.getElementsByClassName("dropdown-content");for(let t=0;t<e.length;t++)e[t].classList.remove("show")}};return document.addEventListener("click",e),document.addEventListener("touchstart",t),()=>{document.removeEventListener("click",e),document.removeEventListener("touchstart",t)}},[]),(0,s.jsxs)("div",{className:l?"paynote reply":"paynote",style:l?{marginLeft:15*(e.replyLevel||0)+15+"px"}:void 0,children:[(0,s.jsx)("div",{className:"noteProfileImg",children:(0,s.jsx)("img",{className:"userImg",src:I,alt:"Profile"})}),(0,s.jsxs)("div",{className:"noteData",children:[(0,s.jsxs)("div",{className:"noteHeader",children:[(0,s.jsxs)("div",{className:"noteAuthor",children:[(0,s.jsx)("div",{className:"noteDisplayName",children:(0,s.jsx)("a",{href:`https://next.nostrudel.ninja/#/u/${e.event.pubkey}`,className:"noteAuthorLink",target:"_blank",rel:"noopener noreferrer",children:S})}),(0,s.jsx)("div",{className:"noteNIP05 label",children:E?(0,s.jsxs)("a",{href:`https://${E.split("@")[1]}/.well-known/nostr.json?name=${E.split("@")[0]}`,target:"_blank",rel:"noopener noreferrer",children:[(0,s.jsx)("span",{className:"material-symbols-outlined",children:"check_circle"}),E]}):(0,s.jsxs)("span",{className:"unverified label",children:[(0,s.jsx)("span",{className:"material-symbols-outlined",children:"block"}),"Unverified"]})}),(0,s.jsx)("div",{className:"noteLNAddress label",children:j?(0,s.jsxs)("a",{href:`https://${j.split("@")[1]}/.well-known/lnurlp/${j.split("@")[0]}`,target:"_blank",rel:"noopener noreferrer",children:[(0,s.jsx)("span",{className:"material-symbols-outlined",children:"bolt"}),j]}):(0,s.jsx)("span",{children:"NOT PAYABLE"})})]}),(0,s.jsx)("div",{className:"noteDate label",onClick:()=>{if(console.log("noteDate clicked for post:",e.id),"undefined"!=typeof window&&window.NostrTools){const t=window.NostrTools.nip19.noteEncode(e.id);console.log("Navigating to single note:",t),window.location.href=`/?note=${t}`}else console.error("NostrTools not available")},style:{cursor:"pointer"},children:(e=>{const t=Date.now()-1e3*e,n=Math.floor(t/6e4),s=Math.floor(t/36e5),o=Math.floor(t/864e5);return n<60?`${n}m`:s<24?`${s}h`:`${o}d`})(e.createdAt)})]}),(0,s.jsx)("div",{className:"noteContent",dangerouslySetInnerHTML:{__html:(L=e.event.content,L=(L=(L=(L=(L=(L=L.replace(/(https?:\/\/[\w\-\.~:\/?#\[\]@!$&'()*+,;=%]+)\.(gif|png|jpg|jpeg)/gi,e=>`<img src="${e}" style="max-width: 100%; height: auto; border-radius: 8px; margin: 8px 0;">`)).replace(/(https?:\/\/[\w\-\.~:\/?#\[\]@!$&'()*+,;=%]+)\.(mp4|webm|ogg|mov)/gi,e=>`<div style="position: relative; width: 100%; height: 0; padding-bottom: 56.25%; margin: 8px 0;">\n        <video src="${e}" controls style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border-radius: 8px;">\n          Your browser does not support the video tag.\n        </video>\n      </div>`)).replace(/(https?:\/\/(?:www\.)?youtube\.com\/watch\?v=([\w\-]+)|https?:\/\/youtu\.be\/([\w\-]+))/gi,(e,t,n)=>`<div style="position: relative; width: 100%; height: 0; padding-bottom: 56.25%; margin: 8px 0;">\n          <iframe src="https://www.youtube.com/embed/${n||t}" \n                  style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border-radius: 8px;"\n                  frameborder="0" allowfullscreen>\n          </iframe>\n        </div>`)).replace(/(https?:\/\/[\w\-\.~:\/?#\[\]@!$&'()*+,;=%]+|www\.[\w\-\.~:\/?#\[\]@!$&'()*+,;=%]+)/gi,e=>L.includes(`src="${e}"`)?e:`<a href="${e.startsWith("http")?e:`http://${e}`}" target="_blank" rel="noopener noreferrer" style="color: #0066cc; text-decoration: underline;">${e}</a>`)).replace(/(nostr:|@)?((npub|nprofile)1[qpzry9x8gf2tvdw0s3jn54khce6mua7l]{58,})/gi,(e,t,n)=>{const s=n.replace("nostr:","").replace("@",""),o=s.length>35?s.substr(0,4)+"..."+s.substr(s.length-4):s;return`<a href="https://next.nostrudel.ninja/#/u/${s}" \n                   target="_blank" \n                   rel="noopener noreferrer"\n                   style="color: #0066cc; text-decoration: underline;">\n                   ${o}\n                 </a>`})).replace(/\n/g,"<br />"))}}),(0,s.jsxs)("div",{className:"noteValues",children:[(0,s.jsxs)("div",{className:"zapMin",children:[(0,s.jsx)("span",{className:"zapMinVal",children:e.zapMin.toLocaleString()}),(0,s.jsxs)("span",{className:"label",children:["sats",(0,s.jsx)("br",{}),e.zapMin!==e.zapMax?"Min":""]})]}),e.zapMin!==e.zapMax&&(0,s.jsxs)("div",{className:"zapMax",children:[(0,s.jsx)("span",{className:"zapMaxVal",children:e.zapMax.toLocaleString()}),(0,s.jsxs)("span",{className:"label",children:["sats",(0,s.jsx)("br",{}),"Max"]})]}),e.zapUses>1&&(0,s.jsxs)("div",{className:"zapUses",children:[(0,s.jsx)("span",{className:"zapUsesCurrent",children:e.zapUsesCurrent}),(0,s.jsx)("span",{className:"label",children:"of"}),(0,s.jsx)("span",{className:"zapUsesTotal",children:e.zapUses})]})]}),e.zapPayer&&(0,s.jsxs)("div",{className:"zapPayer",children:["Payer ",(0,s.jsx)("span",{className:"material-symbols-outlined main-icon",children:"target"}),(0,s.jsxs)("div",{className:"zapPayerInner",children:[(0,s.jsx)("img",{className:"userImg",src:e.zapPayerPicture||"https://icon-library.com/images/generic-user-icon/generic-user-icon-10.jpg"}),(0,s.jsx)("div",{className:"userName",children:(()=>{if(window.NostrTools){const t=window.NostrTools.nip19.npubEncode(e.zapPayer);return t.length>35?t.substr(0,4)+"..."+t.substr(t.length-4,t.length):t}return e.zapPayer.substr(0,8)+"..."+e.zapPayer.substr(-8)})()})]})]}),e.zapLNURL&&(0,s.jsxs)("div",{className:"zapLNURL",children:[(0,s.jsx)("span",{className:"material-symbols-outlined",children:"double_arrow"}),"Redirect to: ",(0,s.jsx)("a",{href:e.zapLNURL,target:"_blank",rel:"noopener noreferrer",children:e.zapLNURL})]}),e.zapMin!==e.zapMax&&C&&(0===e.zapUses||e.zapUsesCurrent<e.zapUses)&&(0,s.jsxs)("div",{className:"zapSliderContainer",children:[(0,s.jsx)("input",{type:"range",className:"zapSlider",min:e.zapMin,max:e.zapMax,value:c,onChange:e=>{return t=parseInt(e.target.value),void d(t);var t}}),(0,s.jsxs)("div",{className:"zapSliderVal",children:[c.toLocaleString(),(0,s.jsx)("span",{className:"label",children:" sats"})]})]}),(0,s.jsx)("div",{className:"noteHeroZaps noteZapReactions",children:h.map((e,t)=>(0,s.jsxs)("div",{className:"zapReaction",children:[(0,s.jsx)("a",{href:`https://next.nostrudel.ninja/#/u/${e.zapPayerNpub}`,target:"_blank",rel:"noopener noreferrer",children:(0,s.jsx)("img",{className:"userImg",src:e.zapPayerPicture})}),(0,s.jsx)("a",{href:`https://next.nostrudel.ninja/#/n/${e.id}`,target:"_blank",rel:"noopener noreferrer",className:"zapReactionAmount",children:e.zapAmount?e.zapAmount.toLocaleString():"0"})]},t))}),(0,s.jsx)("div",{className:"noteCTA",children:(0,s.jsx)("button",{className:"noteMainCTA cta "+(C&&i&&!l?"":"disabled"),onClick:()=>!l&&C&&t(e,c),disabled:!C||!i||l,children:e.zapUses>0&&e.zapUsesCurrent>=e.zapUses?"Paid":"Pay"})}),(0,s.jsxs)("div",{className:"noteActionsReactions",children:[(0,s.jsx)("div",{className:"noteZaps noteZapReactions",children:v.map((e,t)=>(0,s.jsxs)("div",{className:"zapReaction",children:[(0,s.jsx)("a",{href:`https://next.nostrudel.ninja/#/u/${e.zapPayerNpub}`,target:"_blank",rel:"noopener noreferrer",children:(0,s.jsx)("img",{className:"userImg",src:e.zapPayerPicture})}),(0,s.jsx)("a",{href:`https://next.nostrudel.ninja/#/n/${e.id}`,target:"_blank",rel:"noopener noreferrer",className:"zapReactionAmount",children:e.zapAmount?e.zapAmount.toLocaleString():"0"})]},t))}),(0,s.jsxs)("div",{className:"noteActions",children:[(0,s.jsxs)("a",{ref:x,className:C&&(0===e.zapUses||e.zapUsesCurrent<e.zapUses)?"noteAction zapMenuAction":"disabled",onClick:t=>{t.preventDefault(),!C||e.zapUses>0&&e.zapUsesCurrent>=e.zapUses||m(!p)},style:{position:"relative"},children:[(0,s.jsx)("span",{className:"material-symbols-outlined",children:"bolt"}),(0,s.jsx)("div",{className:"zapMenu",style:{display:p?"block":"none"},ref:f,onClick:e=>e.stopPropagation(),children:(0,s.jsxs)("div",{className:"zapMenuCustom",children:[(0,s.jsx)("input",{type:"number",id:"customZapInput",placeholder:"sats",min:"1",value:u,onChange:e=>g(e.target.value),onClick:e=>e.stopPropagation()}),(0,s.jsx)("button",{id:"customZapButton",onClick:n=>{n.stopPropagation(),(()=>{const n=parseInt(u);n>0&&(t(e,n),m(!1),g(""))})()},children:"Zap"}),(0,s.jsx)("button",{id:"customAnonZapButton",onClick:t=>{t.stopPropagation(),(()=>{const t=parseInt(u);t>0&&(n(e,t),m(!1),g(""))})()},children:"anonZap"})]})})]}),(0,s.jsx)("a",{className:"noteAction",onClick:()=>a(e),children:(0,s.jsx)("span",{className:"material-symbols-outlined",children:"ios_share"})}),(0,s.jsxs)("div",{className:"noteAction dropdown",children:[(0,s.jsx)("button",{className:"dropbtn",onClick:e=>{e.preventDefault(),e.stopPropagation(),console.log("Dropdown button clicked"),setTimeout(()=>{b.current&&(b.current.classList.toggle("show"),console.log("Dropdown classes after toggle:",b.current.className))},100)},children:(0,s.jsx)("span",{className:"material-symbols-outlined",children:"more_horiz"})}),(0,s.jsxs)("div",{className:"dropdown-content dropdown-element",ref:b,children:[(0,s.jsx)("a",{className:"cta dropdown-element disabled",children:"New Pay Forward"}),C&&(0,s.jsx)("a",{className:"cta dropdown-element "+(C?"":"disabled"),onClick:t=>{t.preventDefault(),C&&C&&n(e,c)},children:"Pay Anonymously"}),(0,s.jsx)("a",{className:"toolTipLink dropdown-element",href:"#",onClick:t=>{t.preventDefault(),r(e)},children:"View Raw"}),(0,s.jsx)("a",{href:`https://next.nostrudel.ninja/#/n/${e.id}`,className:"toolTipLink dropdown-element",target:"_blank",rel:"noopener noreferrer",children:"View on nostrudel"}),(0,s.jsx)("a",{href:`/live?note=${e.id}`,className:"toolTipLink dropdown-element",target:"_blank",rel:"noopener noreferrer",children:"View on live"})]})]})]})]})]})]});var L}),g=()=>{const[e,t]=(0,o.useState)(!1),[n,a]=(0,o.useState)(!1),[r,i]=(0,o.useState)(!1),[l,c]=(0,o.useState)(!1),[d,p]=(0,o.useState)(!1),[g,h]=(0,o.useState)(!1),[y,v]=(0,o.useState)(""),[w,f]=(0,o.useState)(!1),[b,x]=(0,o.useState)(null),[N,S]=(0,o.useState)(!0),[I,E]=(0,o.useState)(!0),[j,C]=(0,o.useState)(!1),[L,k]=(0,o.useState)(""),[P,T]=(0,o.useState)(0),[z,q]=(0,o.useState)(""),[A,_]=(0,o.useState)(!1),[B,M]=(0,o.useState)(""),{isLoading:O,activeFeed:R,posts:D,followingPosts:U,replies:F,isLoadingMore:W,authState:$,handleFeedChange:V,handleQRScanner:G,handleLogin:Z,handleNewPayNote:H,handleSignInExtension:K,handleSignInExternalSigner:J,handleSignInNsec:Q,handleContinueWithNsec:Y,handleLogout:X,handlePayWithExtension:ee,handlePayAnonymously:te,handlePayWithWallet:ne,handleCopyInvoice:se,handlePostNote:oe,loadMorePosts:ae,loadSingleNote:re,loadReplies:ie}=((0,o.useRef)(null),m()),le=()=>{document.getElementById("nsecInputGroup").style.display="none",document.getElementById("loginFormGroup").style.display="flex",v("")};(0,o.useEffect)(()=>{const e=async e=>{const t=e,{bolt11:n,amount:s,eventId:o}=t.detail;c(!1),setTimeout(()=>{k(n),T(s),q(o),c(!0),ce(n)},10)};return window.addEventListener("showPaymentUI",e),()=>{window.removeEventListener("showPaymentUI",e)}},[]);const ce=async e=>{e&&setTimeout(async()=>{const t=document.getElementById("invoiceQR");if(t)if(t.innerHTML="",window.QRCode)try{await window.QRCode.toCanvas(t,e)}catch(e){console.error("Error generating QR code:",e)}else console.error("QRCode library not available")},100)},de=async e=>{const t=e.id,n=`${window.location.origin}/?note=${t}`;if(navigator.share)try{await navigator.share({title:"Check out this PubPay!",text:"Here's a PubPay I want to share with you:",url:n})}catch(e){console.error("Error sharing the link:",e)}else try{await navigator.clipboard.writeText(n),alert("Link copied to clipboard!")}catch(e){console.error("Failed to copy the link:",e)}},pe=e=>{p(!0);const t=document.getElementById("noteJSON");t&&(t.textContent=JSON.stringify(e.event,null,2))},me=()=>{$.isLoggedIn?i(!0):(le(),a(!0))};return(0,o.useEffect)(()=>{S(!0),E(!0);const e=document.getElementById("zapFixed"),t=document.getElementById("zapMin"),n=document.getElementById("zapMax");e&&e.setAttribute("required","true"),t&&t.removeAttribute("required"),n&&n.removeAttribute("required")},[]),(0,o.useEffect)(()=>{const e=()=>{const e=new URLSearchParams(window.location.search).get("note");if(e)try{const t=window.NostrTools.nip19.decode(e);if("note"!==t.type)return void console.error("Invalid type.");if(!/^[0-9a-f]{64}$/.test(t.data))return void console.error("Invalid event ID format.");_(!0),M(t.data),re(t.data)}catch(e){console.error("Failed to decode note parameter:",e)}};if(e(),"undefined"!=typeof window&&window.NostrTools);else{const t=setInterval(()=>{"undefined"!=typeof window&&window.NostrTools&&(e(),clearInterval(t))},1e3);setTimeout(()=>clearInterval(t),3e4)}},[]),(0,o.useEffect)(()=>{let e,t=!1;const n=()=>{e&&clearTimeout(e),e=setTimeout(()=>{t||W||A||window.innerHeight+window.scrollY>=document.body.offsetHeight-100&&(t=!0,ae().finally(()=>{t=!1}))},150)};return window.addEventListener("scroll",n),()=>{window.removeEventListener("scroll",n),e&&clearTimeout(e)}},[W,A,D.length]),(0,o.useEffect)(()=>{const e=async()=>{if("visible"===document.visibilityState){for(;!document.hasFocus();)await new Promise(e=>setTimeout(e,100));const e=JSON.parse(sessionStorage.getItem("signIn")||"null");if(e&&void 0!==e.rememberMe){sessionStorage.removeItem("signIn");try{const t=await navigator.clipboard.readText(),n=window.NostrTools.nip19.decode(t).data;!0===e.rememberMe?(localStorage.setItem("publicKey",n),localStorage.setItem("signInMethod","externalSigner")):(sessionStorage.setItem("publicKey",n),sessionStorage.setItem("signInMethod","externalSigner")),C(!1),E(!0),a(!1),window.location.reload()}catch(e){console.error("Failed to process external signer return:",e),C(!1),E(!1)}}}};return document.addEventListener("visibilitychange",e),()=>{document.removeEventListener("visibilitychange",e)}},[]),(0,o.useEffect)(()=>{e&&!b&&"undefined"!=typeof window&&window.Html5Qrcode&&setTimeout(()=>{if(document.getElementById("reader")){const e=new window.Html5Qrcode("reader");x(e),e.start({facingMode:"environment"},{fps:10,qrbox:{width:250,height:250}},async n=>{console.log("QR Code scanned:",n),e.stop().then(()=>{t(!1)}),await(async e=>{try{const t=/(note1[qpzry9x8gf2tvdw0s3jn54khce6mua7l]{58,}|nevent1[qpzry9x8gf2tvdw0s3jn54khce6mua7l]{58,})/i,n=e.match(t);if(!n)return;if(e=n[0],"undefined"!=typeof window&&window.NostrTools){const t=window.NostrTools.nip19.decode(e);if("note"===t.type)window.location.href=`/?note=${e}`;else if("nevent"===t.type){const e=t.data.id,n=window.NostrTools.nip19.noteEncode(e);window.location.href=`/?note=${n}`}else console.error("Invalid QR code content. Expected 'note' or 'nevent'.")}}catch(e){console.error("Failed to decode QR code content:",e)}})(n)},e=>{console.error("QR Code scanning error:",e)}).catch(e=>{console.error("Failed to start QR scanner:",e)})}},100)},[e]),(0,o.useEffect)(()=>{!e&&b&&b.getState().then(e=>{if("ACTIVE"===e||"PAUSED"===e)return b.stop()}).then(()=>{x(null)}).catch(e=>{console.error("Error stopping QR scanner:",e),x(null)})},[e,b]),(0,o.useEffect)(()=>()=>{b&&b.getState().then(e=>{if("ACTIVE"===e||"PAUSED"===e)return b.stop()}).catch(e=>{console.error("Error stopping QR scanner on unmount:",e)})},[b]),(0,o.useEffect)(()=>{const e=()=>{me()};return window.addEventListener("showLoginForm",e),()=>{window.removeEventListener("showLoginForm",e)}},[]),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{id:"nav",children:(0,s.jsxs)("div",{id:"navInner",children:[(0,s.jsxs)("a",{id:"logo",href:"/",children:["PUB",(0,s.jsx)("span",{style:{color:"#000"},children:"PAY"}),(0,s.jsx)("span",{style:{color:"#0000001c"},children:".me"}),(0,s.jsx)("span",{className:"version",children:"alpha 0.02"})]}),(0,s.jsxs)("div",{id:"navActions",children:[(0,s.jsx)("a",{id:"scanQrCode",className:"topAction",title:"Scan QR Code",onClick:()=>{t(!0)},children:(0,s.jsx)("span",{className:"material-symbols-outlined",children:"photo_camera"})}),(0,s.jsx)("a",{id:"settings",href:"#",style:{display:"none"},className:"topAction disabled",title:"coming soon",children:(0,s.jsx)("span",{className:"material-symbols-outlined",children:"settings"})}),(0,s.jsx)("a",{id:"login",href:"#",className:"topAction",onClick:me,children:$.isLoggedIn&&$.userProfile?(0,s.jsx)("img",{className:"userImg currentUserImg",src:JSON.parse($.userProfile.content).picture||"https://icon-library.com/images/generic-user-icon/generic-user-icon-10.jpg",alt:"Profile"}):(0,s.jsx)("span",{className:"material-symbols-outlined",children:"account_circle"})}),(0,s.jsxs)("a",{id:"newPayNote",className:"cta",href:"#",onClick:()=>{$.isLoggedIn?h(!0):H()},children:["New ",(0,s.jsx)("span",{className:"hideOnMobile",children:"Paynote"})]})]})]})}),(0,s.jsxs)("div",{id:"container",children:[(0,s.jsxs)("div",{id:"feedSelector",style:A?{display:"none"}:void 0,children:[(0,s.jsx)("a",{href:"#",id:"feedGlobal",className:"feedSelectorLink "+("global"===R?"active":""),onClick:()=>V("global"),children:"Global"}),(0,s.jsx)("a",{href:"#",id:"feedFollowing",className:"feedSelectorLink "+("following"===R?"active":""),onClick:()=>V("following"),children:"Following"}),(0,s.jsx)("a",{href:"#",className:"feedSelectorLink disabled",title:"coming soon",children:"High Rollers"})]}),(0,s.jsxs)("div",{id:"main",style:{display:"global"===R||A?"block":"none"},children:[O&&0===D.length?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"paynote blink",children:[(0,s.jsx)("div",{className:"noteProfileImg",children:(0,s.jsx)("img",{className:"userImg",src:"https://icon-library.com/images/generic-user-icon/generic-user-icon-10.jpg",alt:"Profile"})}),(0,s.jsxs)("div",{className:"noteData",children:[(0,s.jsxs)("div",{className:"noteHeader",children:[(0,s.jsxs)("div",{className:"noteAuthor",children:[(0,s.jsx)("div",{className:"noteDisplayName",children:(0,s.jsx)("a",{href:"#",className:"noteAuthorLink disabled",target:"_blank",children:"Loading..."})}),(0,s.jsx)("div",{className:"noteNIP05 label",children:(0,s.jsxs)("a",{href:"#",target:"_blank",children:[(0,s.jsx)("span",{className:"material-symbols-outlined",children:"check_circle"}),"loading@example.com"]})}),(0,s.jsx)("div",{className:"noteLNAddress label",children:(0,s.jsxs)("a",{href:"#",target:"_blank",children:[(0,s.jsx)("span",{className:"material-symbols-outlined",children:"bolt"}),"loading@example.com"]})})]}),(0,s.jsx)("div",{className:"noteDate label",children:"Loading..."})]}),(0,s.jsx)("div",{className:"noteContent disabled",children:"Loading posts..."}),(0,s.jsxs)("div",{className:"noteValues",children:[(0,s.jsxs)("div",{className:"zapMin",children:[(0,s.jsx)("span",{className:"zapMinVal disabled",children:"Loading..."}),(0,s.jsxs)("span",{className:"label",children:["sats",(0,s.jsx)("br",{}),"Min"]})]}),(0,s.jsxs)("div",{className:"zapMax",children:[(0,s.jsx)("span",{className:"zapMaxVal disabled",children:"Loading..."}),(0,s.jsxs)("span",{className:"label",children:["sats",(0,s.jsx)("br",{}),"Max"]})]}),(0,s.jsxs)("div",{className:"zapUses",children:[(0,s.jsx)("span",{className:"zapUsesCurrent disabled",children:"0"}),(0,s.jsx)("span",{className:"label",children:"of"}),(0,s.jsx)("span",{className:"zapUsesTotal disabled",children:"5"})]})]}),(0,s.jsx)("div",{className:"noteCTA",children:(0,s.jsx)("button",{className:"noteMainCTA cta disabled",children:"Pay"})}),(0,s.jsxs)("div",{className:"noteActionsReactions",children:[(0,s.jsx)("div",{className:"noteZaps noteZapReactions"}),(0,s.jsxs)("div",{className:"noteActions",children:[(0,s.jsx)("a",{className:"noteAction disabled",children:(0,s.jsx)("span",{className:"material-symbols-outlined",children:"bolt"})}),(0,s.jsx)("a",{className:"noteAction disabled",children:(0,s.jsx)("span",{className:"material-symbols-outlined",children:"favorite"})}),(0,s.jsx)("a",{className:"noteAction disabled",children:(0,s.jsx)("span",{className:"material-symbols-outlined",children:"ios_share"})}),(0,s.jsx)("div",{className:"noteAction dropdown",children:(0,s.jsx)("button",{className:"dropbtn",children:(0,s.jsx)("span",{className:"material-symbols-outlined disabled",children:"more_horiz"})})})]})]})]})]}),!A&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"paynote blink",children:[(0,s.jsx)("div",{className:"noteProfileImg",children:(0,s.jsx)("img",{className:"userImg",src:"https://icon-library.com/images/generic-user-icon/generic-user-icon-10.jpg",alt:"Profile"})}),(0,s.jsxs)("div",{className:"noteData",children:[(0,s.jsxs)("div",{className:"noteHeader",children:[(0,s.jsxs)("div",{className:"noteAuthor",children:[(0,s.jsx)("div",{className:"noteDisplayName",children:(0,s.jsx)("a",{href:"#",className:"noteAuthorLink disabled",target:"_blank",children:"Loading..."})}),(0,s.jsx)("div",{className:"noteNIP05 label",children:(0,s.jsxs)("a",{href:"#",target:"_blank",children:[(0,s.jsx)("span",{className:"material-symbols-outlined",children:"check_circle"}),"loading@example.com"]})}),(0,s.jsx)("div",{className:"noteLNAddress label",children:(0,s.jsxs)("a",{href:"#",target:"_blank",children:[(0,s.jsx)("span",{className:"material-symbols-outlined",children:"bolt"}),"loading@example.com"]})})]}),(0,s.jsx)("div",{className:"noteDate label",children:"Loading..."})]}),(0,s.jsx)("div",{className:"noteContent disabled",children:"Loading posts..."}),(0,s.jsxs)("div",{className:"noteValues",children:[(0,s.jsxs)("div",{className:"zapMin",children:[(0,s.jsx)("span",{className:"zapMinVal disabled",children:"Loading..."}),(0,s.jsxs)("span",{className:"label",children:["sats",(0,s.jsx)("br",{}),"Min"]})]}),(0,s.jsxs)("div",{className:"zapMax",children:[(0,s.jsx)("span",{className:"zapMaxVal disabled",children:"Loading..."}),(0,s.jsxs)("span",{className:"label",children:["sats",(0,s.jsx)("br",{}),"Max"]})]}),(0,s.jsxs)("div",{className:"zapUses",children:[(0,s.jsx)("span",{className:"zapUsesCurrent disabled",children:"0"}),(0,s.jsx)("span",{className:"label",children:"of"}),(0,s.jsx)("span",{className:"zapUsesTotal disabled",children:"5"})]})]}),(0,s.jsx)("div",{className:"noteCTA",children:(0,s.jsx)("button",{className:"noteMainCTA cta disabled",children:"Pay"})}),(0,s.jsxs)("div",{className:"noteActionsReactions",children:[(0,s.jsx)("div",{className:"noteZaps noteZapReactions"}),(0,s.jsxs)("div",{className:"noteActions",children:[(0,s.jsx)("a",{className:"noteAction disabled",children:(0,s.jsx)("span",{className:"material-symbols-outlined",children:"bolt"})}),(0,s.jsx)("a",{className:"noteAction disabled",children:(0,s.jsx)("span",{className:"material-symbols-outlined",children:"favorite"})}),(0,s.jsx)("a",{className:"noteAction disabled",children:(0,s.jsx)("span",{className:"material-symbols-outlined",children:"ios_share"})}),(0,s.jsx)("div",{className:"noteAction dropdown",children:(0,s.jsx)("button",{className:"dropbtn",children:(0,s.jsx)("span",{className:"material-symbols-outlined disabled",children:"more_horiz"})})})]})]})]})]}),(0,s.jsxs)("div",{className:"paynote blink",children:[(0,s.jsx)("div",{className:"noteProfileImg",children:(0,s.jsx)("img",{className:"userImg",src:"https://icon-library.com/images/generic-user-icon/generic-user-icon-10.jpg",alt:"Profile"})}),(0,s.jsxs)("div",{className:"noteData",children:[(0,s.jsxs)("div",{className:"noteHeader",children:[(0,s.jsxs)("div",{className:"noteAuthor",children:[(0,s.jsx)("div",{className:"noteDisplayName",children:(0,s.jsx)("a",{href:"#",className:"noteAuthorLink disabled",target:"_blank",children:"Loading..."})}),(0,s.jsx)("div",{className:"noteNIP05 label",children:(0,s.jsxs)("a",{href:"#",target:"_blank",children:[(0,s.jsx)("span",{className:"material-symbols-outlined",children:"check_circle"}),"loading@example.com"]})}),(0,s.jsx)("div",{className:"noteLNAddress label",children:(0,s.jsxs)("a",{href:"#",target:"_blank",children:[(0,s.jsx)("span",{className:"material-symbols-outlined",children:"bolt"}),"loading@example.com"]})})]}),(0,s.jsx)("div",{className:"noteDate label",children:"Loading..."})]}),(0,s.jsx)("div",{className:"noteContent disabled",children:"Loading posts..."}),(0,s.jsxs)("div",{className:"noteValues",children:[(0,s.jsxs)("div",{className:"zapMin",children:[(0,s.jsx)("span",{className:"zapMinVal disabled",children:"Loading..."}),(0,s.jsxs)("span",{className:"label",children:["sats",(0,s.jsx)("br",{}),"Min"]})]}),(0,s.jsxs)("div",{className:"zapMax",children:[(0,s.jsx)("span",{className:"zapMaxVal disabled",children:"Loading..."}),(0,s.jsxs)("span",{className:"label",children:["sats",(0,s.jsx)("br",{}),"Max"]})]}),(0,s.jsxs)("div",{className:"zapUses",children:[(0,s.jsx)("span",{className:"zapUsesCurrent disabled",children:"0"}),(0,s.jsx)("span",{className:"label",children:"of"}),(0,s.jsx)("span",{className:"zapUsesTotal disabled",children:"5"})]})]}),(0,s.jsx)("div",{className:"noteCTA",children:(0,s.jsx)("button",{className:"noteMainCTA cta disabled",children:"Pay"})}),(0,s.jsxs)("div",{className:"noteActionsReactions",children:[(0,s.jsx)("div",{className:"noteZaps noteZapReactions"}),(0,s.jsxs)("div",{className:"noteActions",children:[(0,s.jsx)("a",{className:"noteAction disabled",children:(0,s.jsx)("span",{className:"material-symbols-outlined",children:"bolt"})}),(0,s.jsx)("a",{className:"noteAction disabled",children:(0,s.jsx)("span",{className:"material-symbols-outlined",children:"favorite"})}),(0,s.jsx)("a",{className:"noteAction disabled",children:(0,s.jsx)("span",{className:"material-symbols-outlined",children:"ios_share"})}),(0,s.jsx)("div",{className:"noteAction dropdown",children:(0,s.jsx)("button",{className:"dropbtn",children:(0,s.jsx)("span",{className:"material-symbols-outlined disabled",children:"more_horiz"})})})]})]})]})]})]})]}):0===D.length?(0,s.jsx)("div",{style:{textAlign:"center",padding:"40px",color:"#666"},children:"No posts found"}):D.map(e=>(0,s.jsx)(u,{post:e,onPay:ee,onPayAnonymously:te,onShare:de,onViewRaw:pe,isLoggedIn:$.isLoggedIn},e.id)),W&&(0,s.jsx)("div",{style:{textAlign:"center",padding:"20px",color:"#666"},children:"Loading more posts..."}),!A&&D.length>0&&(0,s.jsxs)("div",{style:{textAlign:"center",padding:"10px",fontSize:"12px",color:"#999",borderTop:"1px solid #eee",marginTop:"20px"},children:["Posts loaded: ",D.length," | Scroll to load more (100px from bottom)"]}),A&&F.map(e=>(0,s.jsx)(u,{post:e,onPay:ee,onPayAnonymously:te,onShare:de,onViewRaw:pe,isLoggedIn:$.isLoggedIn,isReply:!0},e.id))]}),(0,s.jsx)("div",{id:"following",style:{display:"following"===R?"block":"none"},children:O&&0===U.length?(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)("div",{className:"paynote blink",children:[(0,s.jsx)("div",{className:"noteProfileImg",children:(0,s.jsx)("img",{className:"userImg",src:"https://icon-library.com/images/generic-user-icon/generic-user-icon-10.jpg",alt:"Profile"})}),(0,s.jsxs)("div",{className:"noteData",children:[(0,s.jsxs)("div",{className:"noteHeader",children:[(0,s.jsxs)("div",{className:"noteAuthor",children:[(0,s.jsx)("div",{className:"noteDisplayName",children:(0,s.jsx)("a",{href:"#",className:"noteAuthorLink disabled",target:"_blank",children:"Loading..."})}),(0,s.jsx)("div",{className:"noteNIP05 label",children:(0,s.jsxs)("a",{href:"#",target:"_blank",children:[(0,s.jsx)("span",{className:"material-symbols-outlined",children:"check_circle"}),"loading@example.com"]})}),(0,s.jsx)("div",{className:"noteLNAddress label",children:(0,s.jsxs)("a",{href:"#",target:"_blank",children:[(0,s.jsx)("span",{className:"material-symbols-outlined",children:"bolt"}),"loading@example.com"]})})]}),(0,s.jsx)("div",{className:"noteDate label",children:"Loading..."})]}),(0,s.jsx)("div",{className:"noteContent disabled",children:"Loading following posts..."}),(0,s.jsxs)("div",{className:"noteValues",children:[(0,s.jsxs)("div",{className:"zapMin",children:[(0,s.jsx)("span",{className:"zapMinVal disabled",children:"Loading..."}),(0,s.jsxs)("span",{className:"label",children:["sats",(0,s.jsx)("br",{}),"Min"]})]}),(0,s.jsxs)("div",{className:"zapMax",children:[(0,s.jsx)("span",{className:"zapMaxVal disabled",children:"Loading..."}),(0,s.jsxs)("span",{className:"label",children:["sats",(0,s.jsx)("br",{}),"Max"]})]}),(0,s.jsxs)("div",{className:"zapUses",children:[(0,s.jsx)("span",{className:"zapUsesCurrent disabled",children:"0"}),(0,s.jsx)("span",{className:"label",children:"of"}),(0,s.jsx)("span",{className:"zapUsesTotal disabled",children:"5"})]})]}),(0,s.jsx)("div",{className:"noteCTA",children:(0,s.jsx)("button",{className:"noteMainCTA cta disabled",children:"Pay"})}),(0,s.jsxs)("div",{className:"noteActionsReactions",children:[(0,s.jsx)("div",{className:"noteZaps noteZapReactions"}),(0,s.jsxs)("div",{className:"noteActions",children:[(0,s.jsx)("a",{className:"noteAction disabled",children:(0,s.jsx)("span",{className:"material-symbols-outlined",children:"bolt"})}),(0,s.jsx)("a",{className:"noteAction disabled",children:(0,s.jsx)("span",{className:"material-symbols-outlined",children:"favorite"})}),(0,s.jsx)("a",{className:"noteAction disabled",children:(0,s.jsx)("span",{className:"material-symbols-outlined",children:"ios_share"})}),(0,s.jsx)("div",{className:"noteAction dropdown",children:(0,s.jsx)("button",{className:"dropbtn",children:(0,s.jsx)("span",{className:"material-symbols-outlined disabled",children:"more_horiz"})})})]})]})]})]})}):0===U.length?(0,s.jsx)("div",{style:{textAlign:"center",padding:"40px",color:"#666"},children:"No following posts found"}):U.map(e=>(0,s.jsx)(u,{post:e,onPay:ee,onPayAnonymously:te,onShare:de,onViewRaw:pe,isLoggedIn:$.isLoggedIn},e.id))})]}),(0,s.jsx)("div",{className:"overlayContainer",id:"qrScanner",style:{display:e?"flex":"none"},children:(0,s.jsxs)("div",{className:"overlayInner",children:[(0,s.jsxs)("div",{className:"brand",children:["PUB",(0,s.jsx)("span",{style:{color:"#cecece"},children:"PAY"}),(0,s.jsx)("span",{style:{color:"#00000014"},children:".me"})]}),(0,s.jsx)("p",{className:"label",id:"titleScanner",children:"Scan note1 or nevent1 QR code"}),(0,s.jsx)("div",{id:"reader"}),(0,s.jsx)("a",{id:"stopScanner",href:"#",className:"label",onClick:()=>{b?b.getState().then(e=>{if("ACTIVE"===e||"PAUSED"===e)return b.stop()}).then(()=>{t(!1)}).catch(e=>{console.error("Error stopping QR scanner:",e),t(!1)}):t(!1)},children:"cancel"})]})}),(0,s.jsx)("div",{className:"overlayContainer",id:"loginForm",style:{display:n?"flex":"none"},children:(0,s.jsxs)("div",{className:"overlayInner",children:[(0,s.jsxs)("div",{className:"brand",children:["PUB",(0,s.jsx)("span",{style:{color:"#cecece"},children:"PAY"}),(0,s.jsx)("span",{style:{color:"#00000014"},children:".me"})]}),(0,s.jsx)("p",{className:"label",id:"titleSignin",children:"Choose Sign-in Method"}),(0,s.jsxs)("div",{className:"formFieldGroup",id:"loginFormGroup",children:[(0,s.jsx)("a",{href:"#",id:"signInExtension",className:"cta "+(N?"":"disabled red"),onClick:async e=>{if(N)try{const e=await K(w);e&&e.success?a(!1):S(!1)}catch(e){console.error("Extension sign in failed:",e),S(!1)}else e.preventDefault()},children:N?"Extension":"Not found"}),(0,s.jsx)("a",{href:"#",id:"signInexternalSigner",className:"cta "+(I?"":"disabled red"),onClick:async e=>{if(I&&!j)try{C(!0);const e=await J(w);e&&e.success?a(!1):(E(!1),C(!1))}catch(e){console.error("External signer failed:",e),E(!1),C(!1)}else e.preventDefault()},children:I?j?"Loading...":"Signer":"Not found"}),(0,s.jsx)("a",{href:"#",id:"signInNsec",className:"cta",onClick:()=>{document.getElementById("nsecInputGroup").style.display="block",document.getElementById("loginFormGroup").style.display="none"},children:"NSEC"})]}),(0,s.jsx)("div",{id:"nsecInputGroup",style:{display:"none"},children:(0,s.jsxs)("form",{onSubmit:e=>{e.preventDefault(),y.trim()&&(Y(y,w),v(""),a(!1))},children:[(0,s.jsx)("input",{type:"password",id:"nsecInput",placeholder:"Enter your nsec",className:"inputField",value:y,onChange:e=>v(e.target.value),required:!0}),(0,s.jsx)("button",{id:"continueWithNsec",className:"cta",type:"submit",onClick:async()=>{await Y(y,w),a(!1)},children:"Continue"})]})}),(0,s.jsxs)("div",{className:"rememberPK",children:[(0,s.jsx)("label",{htmlFor:"rememberMe",className:"label",children:"Remember"}),(0,s.jsx)("input",{type:"checkbox",className:"checkBoxRemember",id:"rememberMe",checked:w,onChange:e=>f(e.target.checked)})]}),(0,s.jsx)("a",{id:"cancelLogin",href:"#",className:"label",onClick:()=>{le(),a(!1)},children:"cancel"})]})}),(0,s.jsx)("div",{className:"overlayContainer",id:"loggedInForm",style:{display:r?"flex":"none"},children:(0,s.jsxs)("div",{className:"overlayInner",children:[(0,s.jsxs)("div",{className:"brand",children:["PUB",(0,s.jsx)("span",{style:{color:"#cecece"},children:"PAY"}),(0,s.jsx)("span",{style:{color:"#00000014"},children:".me"})]}),(0,s.jsx)("p",{className:"label",children:"You are logged in as:"}),(0,s.jsx)("p",{id:"loggedInPublicKey",children:$.publicKey?(0,s.jsx)("a",{href:`https://next.nostrudel.ninja/#/u/${"undefined"!=typeof window&&window.NostrTools?window.NostrTools.nip19.npubEncode($.publicKey):$.publicKey}`,className:"userMention",target:"_blank",rel:"noopener noreferrer",children:$.displayName||("undefined"!=typeof window&&window.NostrTools?window.NostrTools.nip19.npubEncode($.publicKey):$.publicKey)}):"Unknown"}),(0,s.jsx)("p",{className:"label",children:"Sign-in Method:"}),(0,s.jsx)("span",{id:"loggedInMethod",children:$.signInMethod||"Unknown"}),(0,s.jsx)("a",{href:"",id:"logoutButton",className:"cta",onClick:X,children:"Logout"}),(0,s.jsx)("a",{id:"cancelLoggedin",href:"#",className:"label",onClick:()=>i(!1),children:"cancel"})]})}),(0,s.jsx)("div",{className:"overlayContainer",id:"invoiceOverlay","data-event-id":z||"",style:{display:l?"flex":"none"},children:(0,s.jsxs)("div",{className:"overlayInner",children:[(0,s.jsxs)("div",{className:"brand",children:["PUB",(0,s.jsx)("span",{style:{color:"#cecece"},children:"PAY"}),(0,s.jsx)("span",{style:{color:"#00000014"},children:".me"})]}),(0,s.jsx)("p",{id:"qrcodeTitle",className:"label",children:"Scan Invoice to Pay Zap"}),P>0&&(0,s.jsxs)("p",{className:"label",style:{fontSize:"18px",fontWeight:"bold",color:"#4a75ff"},children:[P.toLocaleString()," sats"]}),(0,s.jsx)("canvas",{id:"invoiceQR"}),(0,s.jsx)("p",{id:"qrcodeTitle",className:"label",children:"Otherwise:"}),(0,s.jsxs)("div",{className:"formFieldGroup",children:[(0,s.jsx)("button",{id:"payWithExtension",className:"cta",onClick:()=>{L&&P>0?(console.log("Paying with extension:",L),alert("Extension payment not yet implemented. Please scan the QR code with your Lightning wallet.")):alert("No invoice available to pay")},children:"Pay with Extension"}),(0,s.jsx)("button",{id:"payWithWallet",className:"cta",onClick:()=>{if(L)try{window.location.href=`lightning:${L}`}catch(e){console.error("Error opening wallet:",e)}else console.error("No invoice available to pay")},children:"Pay with Wallet"}),(0,s.jsx)("button",{id:"copyInvoice",className:"cta",onClick:async()=>{if(L)try{await navigator.clipboard.writeText(L);const e=document.getElementById("copyInvoice");e&&(e.textContent="Copied!",setTimeout(()=>{e.textContent="Copy Invoice"},1e3))}catch(e){console.error("Failed to copy invoice:",e);const t=document.createElement("textarea");t.value=L,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t);const n=document.getElementById("copyInvoice");n&&(n.textContent="Copied!",setTimeout(()=>{n.textContent="Copy Invoice"},1e3))}else console.error("No invoice available to copy")},children:"Copy Invoice"})]}),(0,s.jsx)("a",{id:"closeInvoiceOverlay",href:"#",className:"label",onClick:()=>c(!1),children:"Close"})]})}),(0,s.jsx)("div",{className:"overlayContainer",id:"viewJSON",style:{display:d?"flex":"none"},children:(0,s.jsxs)("div",{className:"overlayInner",children:[(0,s.jsx)("pre",{id:"noteJSON"}),(0,s.jsx)("a",{id:"closeJSON",href:"#",className:"label",onClick:()=>p(!1),children:"close"})]})}),(0,s.jsx)("div",{className:"overlayContainer",id:"newPayNoteForm",style:{display:g?"flex":"none"},children:(0,s.jsxs)("div",{className:"overlayInner",children:[(0,s.jsxs)("div",{className:"brand",children:["PUB",(0,s.jsx)("span",{style:{color:"#cecece"},children:"PAY"}),(0,s.jsx)("span",{style:{color:"#00000014"},children:".me"})]}),(0,s.jsxs)("form",{id:"newKind1",onSubmit:async e=>{e.preventDefault();const t=new FormData(e.target),n={};for(const[e,s]of t.entries())n[e]=s.toString();const s=document.getElementById("postNote");s&&(s.textContent="Publishing...");try{await oe(n),h(!1),e.target.reset();const t=document.getElementById("fixedFlow");t&&(t.checked=!0,document.getElementById("fixedInterface").style.display="block",document.getElementById("rangeInterface").style.display="none",document.getElementById("zapFixed").setAttribute("required","true"),document.getElementById("zapMin").removeAttribute("required"),document.getElementById("zapMax").removeAttribute("required"))}catch(e){console.error("Failed to post note:",e)}finally{s&&(s.textContent="Publish")}},children:[(0,s.jsxs)("div",{className:"formField",children:[(0,s.jsx)("label",{htmlFor:"payNoteContent",className:"label",children:"Your Payment Request"}),(0,s.jsx)("textarea",{id:"payNoteContent",name:"payNoteContent",rows:4,placeholder:"Payment Request Description"})]}),(0,s.jsxs)("fieldset",{className:"formField formSelector",children:[(0,s.jsx)("legend",{className:"uppercase",children:"Select type"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("input",{type:"radio",id:"fixedFlow",name:"paymentType",value:"fixed",defaultChecked:!0,onChange:e=>{e.target.checked&&(document.getElementById("fixedInterface").style.display="block",document.getElementById("rangeInterface").style.display="none",document.getElementById("zapMin").value="",document.getElementById("zapMax").value="",document.getElementById("zapFixed").setAttribute("required","true"),document.getElementById("zapMin").removeAttribute("required"),document.getElementById("zapMax").removeAttribute("required"))}}),(0,s.jsx)("label",{htmlFor:"fixedFlow",children:"Fixed"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("input",{type:"radio",id:"rangeFlow",name:"paymentType",value:"range",onChange:e=>{e.target.checked&&(document.getElementById("rangeInterface").style.display="flex",document.getElementById("fixedInterface").style.display="none",document.getElementById("zapFixed").value="",document.getElementById("zapMin").setAttribute("required","true"),document.getElementById("zapMax").setAttribute("required","true"),document.getElementById("zapFixed").removeAttribute("required"))}}),(0,s.jsx)("label",{htmlFor:"rangeFlow",children:"Range"})]}),(0,s.jsxs)("div",{className:"disabled",children:[(0,s.jsx)("input",{type:"radio",id:"targetFlow",name:"paymentType",value:"target",disabled:!0}),(0,s.jsx)("label",{htmlFor:"targetFlow",children:"Target"})]})]}),(0,s.jsx)("div",{className:"formFieldGroup",id:"fixedInterface",children:(0,s.jsxs)("div",{className:"formField",children:[(0,s.jsxs)("label",{htmlFor:"zapFixed",className:"label",children:["Fixed Amount* ",(0,s.jsx)("span",{className:"tagName",children:"zap-min = zap-max"})]}),(0,s.jsx)("input",{type:"number",min:1,id:"zapFixed",placeholder:"1",name:"zapFixed",required:!0})]})}),(0,s.jsxs)("div",{className:"formFieldGroup",id:"rangeInterface",style:{display:"none"},children:[(0,s.jsxs)("div",{className:"formField",children:[(0,s.jsxs)("label",{htmlFor:"zapMin",className:"label",children:["Minimum* ",(0,s.jsx)("span",{className:"tagName",children:"zap-min"})]}),(0,s.jsx)("input",{type:"number",min:1,id:"zapMin",placeholder:"1",name:"zapMin"})]}),(0,s.jsxs)("div",{className:"formField",children:[(0,s.jsxs)("label",{htmlFor:"zapMax",className:"label",children:["Maximum* ",(0,s.jsx)("span",{className:"tagName",children:"zap-max"})]}),(0,s.jsx)("input",{type:"number",min:1,id:"zapMax",placeholder:"1000000000",name:"zapMax"})]})]}),(0,s.jsxs)("details",{className:"formField",children:[(0,s.jsx)("summary",{className:"legend summaryOptions",children:"Advanced Options"}),(0,s.jsxs)("div",{className:"formFieldGroup",children:[(0,s.jsxs)("div",{className:"formField",children:[(0,s.jsxs)("label",{htmlFor:"zapUses",className:"label",children:["Uses ",(0,s.jsx)("span",{className:"tagName",children:"zap-uses"})]}),(0,s.jsx)("input",{type:"number",min:1,id:"zapUses",placeholder:"1",name:"zapUses"})]}),(0,s.jsxs)("div",{className:"formField disabled",children:[(0,s.jsxs)("label",{htmlFor:"zapIncrement",className:"label",children:["Increment ",(0,s.jsx)("span",{className:"tagName"})]}),(0,s.jsx)("input",{type:"text",id:"zapIncrement",placeholder:"0",name:"zapIncrement",disabled:!0})]})]}),(0,s.jsxs)("div",{className:"formField",children:[(0,s.jsxs)("label",{htmlFor:"zapPayer",className:"label",children:["Payer ",(0,s.jsx)("span",{className:"tagName",children:"zap-payer"})]}),(0,s.jsx)("input",{type:"text",id:"zapPayer",placeholder:"npub1...",name:"zapPayer"})]}),(0,s.jsxs)("div",{className:"formField",children:[(0,s.jsxs)("label",{htmlFor:"overrideLNURL",className:"label",children:["Override receiving address",(0,s.jsx)("span",{className:"tagName",children:" zap-lnurl"})]}),(0,s.jsx)("input",{type:"email",id:"overrideLNURL",placeholder:"address@lnprovider.net",name:"overrideLNURL"})]}),(0,s.jsxs)("div",{className:"formField disabled",children:[(0,s.jsxs)("label",{htmlFor:"redirectToNote",className:"label",children:["Redirect payment to note ",(0,s.jsx)("span",{className:"tagName",children:"zap-redirect"})," "]}),(0,s.jsx)("input",{type:"text",id:"redirectToNote",placeholder:"note1...",name:"redirectToNote",disabled:!0})]})]}),(0,s.jsx)("button",{type:"submit",id:"postNote",className:"cta",children:"Publish"})]}),(0,s.jsx)("a",{id:"cancelNewNote",href:"#",className:"label",onClick:()=>h(!1),children:"cancel"})]})})]})};class h{constructor(){this.invoices=new Map,this.payments=new Map}createInvoice(e,t,n={}){if(!(e=>e>=1&&e<=1e6)(e))throw new Error("Invalid zap amount");const s=this.generatePaymentHash(),o=this.generatePaymentRequest(e,t,s),a=Date.now(),r={payment_hash:s,payment_request:o,description:n.comment?`${t} - ${n.comment}`:t,amount_msat:1e3*e,amount_sat:e,created_at:a,expires_at:a+(n.expiry||36e5),status:"pending"};return this.invoices.set(s,r),r}getInvoice(e){return this.invoices.get(e)||null}updateInvoiceStatus(e,t){const n=this.invoices.get(e);return!!n&&(n.status=t,!0)}markInvoiceAsPaid(e,t,n=Date.now()){const s=this.invoices.get(e);if(!s)return null;s.status="paid";const o={id:e,payment_hash:e,amount_msat:s.amount_msat,amount_sat:s.amount_sat,created_at:s.created_at,status:"completed",description:s.description,preimage:t};return this.payments.set(e,o),o}getPayment(e){return this.payments.get(e)||null}getAllPayments(){return Array.from(this.payments.values())}getPaymentsByStatus(e){return Array.from(this.payments.values()).filter(t=>t.status===e)}isInvoiceExpired(e){const t=this.invoices.get(e);return!t||Date.now()>t.expires_at}getExpiredInvoices(){const e=Date.now();return Array.from(this.invoices.values()).filter(t=>t.expires_at<e&&"pending"===t.status)}cleanupExpiredInvoices(){const e=this.getExpiredInvoices();let t=0;return e.forEach(e=>{e.status="expired",t++}),t}getInvoiceStats(){const e=Array.from(this.invoices.values()),t=Array.from(this.payments.values());return{total:e.length,pending:e.filter(e=>"pending"===e.status).length,paid:e.filter(e=>"paid"===e.status).length,expired:e.filter(e=>"expired"===e.status).length,totalAmount:e.reduce((e,t)=>e+t.amount_sat,0),totalPaid:t.reduce((e,t)=>e+t.amount_sat,0)}}validateInvoice(e){const t=[];return e.payment_hash||t.push("Payment hash is required"),e.payment_request||t.push("Payment request is required"),e.amount_sat<=0&&t.push("Amount must be greater than 0"),e.description||t.push("Description is required"),e.created_at<=0&&t.push("Created timestamp is required"),e.expires_at<=e.created_at&&t.push("Expiry must be after creation time"),{valid:0===t.length,errors:t}}generatePaymentHash(){const e=new Uint8Array(32);return crypto.getRandomValues(e),Array.from(e,e=>e.toString(16).padStart(2,"0")).join("")}generatePaymentRequest(e,t,n){Math.floor(Date.now()/1e3);const s=e.toString().padStart(4,"0"),o=this.hashDescription(t);return`lnbc${s}u1p${n.slice(0,8)}...${o.slice(0,8)}`}hashDescription(e){const t=(new TextEncoder).encode(e);return Array.from(t,e=>e.toString(16).padStart(2,"0")).join("")}clear(){this.invoices.clear(),this.payments.clear()}}class y{constructor(e,t){this.webhookHandlers=new Map,this.lightningService=e,this.invoiceService=t}async processWebhook(e){try{const t=this.validateWebhookData(e);if(!t.valid)return{success:!1,error:`Invalid webhook data: ${t.errors.join(", ")}`};const n=this.findMatchingSession(e);return n?await this.processPayment(e,n)?(this.notifyHandlers(e),{success:!0,message:"Webhook processed successfully"}):{success:!1,error:"Failed to process payment"}:{success:!1,error:"No matching session found for webhook"}}catch(e){return console.error("Error processing webhook:",e),{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}registerHandler(e,t){this.webhookHandlers.set(e,t)}unregisterHandler(e){this.webhookHandlers.delete(e)}validateWebhookData(e){const t=[];return e.payment_hash||t.push("Payment hash is required"),e.payment_request||t.push("Payment request is required"),e.amount<=0&&t.push("Amount must be greater than 0"),e.status||t.push("Status is required"),["paid","expired","cancelled"].includes(e.status)||t.push("Invalid status"),e.created_at<=0&&t.push("Created timestamp is required"),e.paid_at&&e.paid_at<e.created_at&&t.push("Paid timestamp cannot be before created timestamp"),{valid:0===t.length,errors:t}}findMatchingSession(e){const t=this.lightningService.getActiveSessions();if(e.description){const n=t.find(t=>t.eventId===e.description);if(n)return n}if(e.comment){const n=t.find(t=>t.eventId===e.comment);if(n)return n}return null}async processPayment(e,t){try{return"paid"===e.status?!!this.invoiceService.markInvoiceAsPaid(e.payment_hash,e.payment_hash,e.paid_at)||(console.error("Failed to create payment record"),!1):"expired"===e.status?(this.invoiceService.updateInvoiceStatus(e.payment_hash,"expired"),!0):"cancelled"===e.status&&(this.invoiceService.updateInvoiceStatus(e.payment_hash,"cancelled"),!0)}catch(e){return console.error("Error processing payment:",e),!1}}notifyHandlers(e){this.webhookHandlers.forEach((t,n)=>{try{t(e)}catch(e){console.error(`Error in webhook handler ${n}:`,e)}})}getWebhookStats(){return{totalHandlers:this.webhookHandlers.size,activeSessions:this.lightningService.getActiveSessions().length,recentWebhooks:0}}async testWebhook(e){const t={payment_hash:e.payment_hash||"test_payment_hash",payment_request:e.payment_request||"lnbc100u1p...",amount:e.amount||100,description:e.description||"test_description",comment:e.comment||"test_comment",created_at:e.created_at||Date.now(),paid_at:e.paid_at||Date.now(),status:e.status||"paid"};return this.processWebhook(t)}clearHandlers(){this.webhookHandlers.clear()}}var v;!function(e){e.DEBUG="debug",e.INFO="info",e.WARN="warn",e.ERROR="error",e.CRITICAL="critical"}(v||(v={}));class w{constructor(e=!1){this.logs=[],this.maxLogs=1e3,this.isDevelopment=e,this.setupGlobalErrorHandlers()}log(e,t,n,s){const o={id:this.generateErrorId(),level:e,message:t,error:n,context:s,timestamp:Date.now(),userId:this.getCurrentUserId(),sessionId:this.getCurrentSessionId(),url:window.location.href,userAgent:navigator.userAgent};return this.logs.push(o),this.logs.length>this.maxLogs&&(this.logs=this.logs.slice(-this.maxLogs)),this.outputToConsole(o),this.isDevelopment||this.sendToExternalService(o),o.id}debug(e,t){return this.log(v.DEBUG,e,void 0,t)}info(e,t){return this.log(v.INFO,e,void 0,t)}warn(e,t,n){return this.log(v.WARN,e,t,n)}error(e,t,n){return this.log(v.ERROR,e,t,n)}critical(e,t,n){return this.log(v.CRITICAL,e,t,n)}handleError(e,t){const n=e.message||"Unknown error occurred";return this.error(n,e,t)}handleNetworkError(e,t,n){const s=`Network error: ${n} ${t}`;return this.error(s,e,{url:t,method:n})}handleNostrError(e,t){return this.error("Nostr protocol error",e,{...t,type:"nostr"})}handleLightningError(e,t){return this.error("Lightning payment error",e,{...t,type:"lightning"})}getLogs(e,t){let n=this.logs;return e&&(n=n.filter(t=>t.level===e)),t&&(n=n.slice(-t)),n}getErrorStats(){const e=Date.now(),t=this.logs.filter(t=>e-t.timestamp<36e5),n=this.logs.reduce((e,t)=>(e[t.level]=(e[t.level]||0)+1,e),{});return{total:this.logs.length,byLevel:n,recent:t.length,critical:n[v.CRITICAL]||0}}clearLogs(){this.logs=[]}exportLogs(){return JSON.stringify(this.logs,null,2)}setupGlobalErrorHandlers(){window.addEventListener("error",e=>{this.handleError(e.error,{type:"uncaught",filename:e.filename,lineno:e.lineno,colno:e.colno})}),window.addEventListener("unhandledrejection",e=>{this.handleError(new Error(e.reason),{type:"unhandledrejection"})})}outputToConsole(e){const t=`[${new Date(e.timestamp).toISOString()}] [${e.level.toUpperCase()}]`;switch(e.level){case v.DEBUG:console.debug(t,e.message,e.context);break;case v.INFO:console.info(t,e.message,e.context);break;case v.WARN:console.warn(t,e.message,e.error,e.context);break;case v.ERROR:case v.CRITICAL:console.error(t,e.message,e.error,e.context)}}sendToExternalService(e){console.log("Would send to external service:",e)}generateErrorId(){return`err_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}getCurrentUserId(){}getCurrentSessionId(){}}class f{constructor(e={}){this.isEnabled=!1,this.isLoading=!1,this.error=null,this.lnurl=null,this.sessionId=null,this.options=e,this.lightningService=new c({enabled:!1,lnbitsUrl:"",apiKey:"",webhookUrl:""}),this.invoiceService=new h,this.webhookService=new y(this.lightningService,this.invoiceService),this.errorService=new w}async enableLightning(e){const t=e||this.options.eventId;if(!t)return this.error="No event ID provided",!1;this.isLoading=!0,this.error=null;try{const e=await this.lightningService.enableLightningPayments(t);return e.success&&e.lnurl?(this.isEnabled=!0,this.lnurl=e.lnurl,this.sessionId=this.lightningService.getLightningStatus().sessionId,this.errorService.info("Lightning payments enabled",{lnurl:e.lnurl}),!0):(this.error=e.error||"Failed to enable Lightning payments",!1)}catch(e){return this.error=e instanceof Error?e.message:"Unknown error",this.errorService.error("Failed to enable Lightning payments",e),!1}finally{this.isLoading=!1}}async disableLightning(e){const t=e||this.options.eventId;if(!t)return this.error="No event ID provided",!1;this.isLoading=!0,this.error=null;try{const e=await this.lightningService.disableLightningPayments(t);return e.success?(this.isEnabled=!1,this.lnurl=null,this.sessionId=null,this.errorService.info("Lightning payments disabled"),!0):(this.error=e.error||"Failed to disable Lightning payments",!1)}catch(e){return this.error=e instanceof Error?e.message:"Unknown error",this.errorService.error("Failed to disable Lightning payments",e),!1}finally{this.isLoading=!1}}async toggleLightning(e){return this.isEnabled?await this.disableLightning(e):await this.enableLightning(e)}async createInvoice(e,t,n){if(!this.isEnabled)return this.error="Lightning payments not enabled",null;try{const s=this.invoiceService.createInvoice(e,t,{comment:n});return this.options.onInvoiceCreated?.(s),this.errorService.info("Invoice created",{amount:e,description:t}),s}catch(e){return this.errorService.error("Failed to create invoice",e),null}}async checkPaymentStatus(e){try{const t=await this.lightningService.checkPaymentStatus(e);return t.success&&t.payment?(this.options.onPayment?.(t.payment),t.payment):null}catch(e){return this.errorService.error("Failed to check payment status",e),null}}getStatus(){return{enabled:this.isEnabled,loading:this.isLoading,error:this.error,lnurl:this.lnurl,sessionId:this.sessionId,config:this.lightningService.getConfig()}}getPaymentHistory(){return this.invoiceService.getAllPayments()}getInvoiceStats(){return this.invoiceService.getInvoiceStats()}get enabled(){return this.isEnabled}get loading(){return this.isLoading}get lastError(){return this.error}get currentLnurl(){return this.lnurl}get currentSessionId(){return this.sessionId}get lightningServiceInstance(){return this.lightningService}get invoiceServiceInstance(){return this.invoiceService}get webhookServiceInstance(){return this.webhookService}get errorServiceInstance(){return this.errorService}}let b=!1;const x="#000000",N=!1,S=!1,I=!1,E=!1,j=!0,C=!1,L=!1,k=!1,P=!1,T=!1,z=!1,q=!1,A=e=>{const[t,n]=(0,o.useState)(!0),[s,a]=(0,o.useState)(null),[r,i]=(0,o.useState)(""),[l,c]=(0,o.useState)("Author"),[d,p]=(0,o.useState)("/images/gradient_color.gif"),[m,u]=(0,o.useState)([]),[g,h]=(0,o.useState)(0),[y,v]=(0,o.useState)(0),[w,A]=(0,o.useState)([]),[_,B]=(0,o.useState)(!1),M=(0,o.useRef)(null),[O,R]=(0,o.useState)(!1),[D,U]=(0,o.useState)("");(0,o.useRef)(null),(0,o.useEffect)(()=>{if(w.length>0){const e=document.getElementById("showTopZappersToggle");e?.checked&&ne()}},[w]),(0,o.useEffect)(()=>{if(m.length>0){Le(m);const e=document.getElementById("showTopZappersToggle");(e?.checked||_)&&(ne(),B(!1))}},[m,_]),(0,o.useEffect)(()=>{const t=document.querySelector(".qr-swiper");t&&(t.style.display="none"),e?(async()=>{try{n(!0),a(null),M.current=new f({eventId:e}),window.NostrTools&&!window.pool&&(window.pool=new window.NostrTools.SimplePool,window.relays=["wss://relay.damus.io","wss://relay.snort.social","wss://nos.lol","wss://relay.nostr.band"]),"undefined"!=typeof window&&window.Swiper&&new window.Swiper(".portrait-swiper .swiper",{loop:!0,autoplay:{delay:4e3,disableOnInteraction:!1},touchRatio:1,touchAngle:45,grabCursor:!0,speed:800,effect:"slide",slidesPerView:1,spaceBetween:0,breakpoints:{320:{slidesPerView:1,spaceBetween:0},768:{slidesPerView:1,spaceBetween:0},1024:{slidesPerView:1,spaceBetween:0}},on:{init(){},slideChange(){}}}),e?await me(e):await F(),setTimeout(()=>{Ge(),window.setupStyleOptions=()=>{},Re(),setTimeout(()=>{Oe()},100);const e=document.getElementById("showTopZappersToggle");e?.checked&&ne()},500),n(!1)}catch(e){a(e instanceof Error?e.message:"Failed to initialize live functionality"),n(!1)}})():(window.NostrTools&&!window.pool&&(window.pool=new window.NostrTools.SimplePool,window.relays=["wss://relay.damus.io","wss://relay.snort.social","wss://nos.lol","wss://relay.primal.net","wss://relay.nostr.band"]),setTimeout(()=>{"undefined"!=typeof window&&window.Swiper&&(document.querySelector(".portrait-swiper .swiper")?new window.Swiper(".portrait-swiper .swiper",{loop:!0,autoplay:{delay:4e3,disableOnInteraction:!1},touchRatio:1,touchAngle:45,grabCursor:!0,speed:800,effect:"slide",slidesPerView:1,spaceBetween:0,breakpoints:{320:{slidesPerView:1,spaceBetween:0},768:{slidesPerView:1,spaceBetween:0},1024:{slidesPerView:1,spaceBetween:0}}}):console.warn("Portrait swiper element not found"))},200),setTimeout(()=>{Oe()},300))},[e]),(0,o.useEffect)(()=>{"undefined"!=typeof window&&(window.frontendSessionId=null,window.lightningQRSlide=null,window.lightningEnabled=!1,window.organizeZapsHierarchically=Te,window.cleanupHierarchicalOrganization=Pe,window.updateQRSlideVisibility=tt)},[]);const F=async()=>{const e="placeholder-note-id",t=window.NostrTools?.nip19?.neventEncode({id:e,relays:[]})||"placeholder-nevent",n=window.NostrTools?.nip19?.noteEncode(e)||"placeholder-note",s=`https://njump.me/${n}`,o=`nostr:${t}`,a=`nostr:${n}`,r=Math.min(.6*window.innerWidth,.7*window.innerHeight);[{element:document.getElementById("qrCode"),value:s,link:document.getElementById("qrcodeLinkNostr"),preview:document.getElementById("qrDataPreview1")},{element:document.getElementById("qrCodeNevent"),value:o,link:document.getElementById("qrcodeNeventLink"),preview:document.getElementById("qrDataPreview2")},{element:document.getElementById("qrCodeNote"),value:a,link:document.getElementById("qrcodeNoteLink"),preview:document.getElementById("qrDataPreview3")}].forEach(({element:e,value:t,link:n,preview:s})=>{e&&window.QRious&&(e.innerHTML="",new window.QRious({element:e,size:r,value:t}),n&&(n.href=t),s&&(s.textContent=t))})},W=async(e,t,n)=>{const s={authors:[e],kinds:[30311],"#d":[t]},o=setTimeout(()=>{},3e4);window.pool.subscribeMany(window.relays,[s],{onevent(e){clearTimeout(o),Z(e),G(e)},oneose(){clearTimeout(o)},onclosed(){clearTimeout(o),window.currentLiveEventInfo&&window.reconnectionAttempts.event<3&&(window.reconnectionAttempts.event++,setTimeout(()=>{W(window.currentLiveEventInfo.pubkey,window.currentLiveEventInfo.identifier,window.currentLiveEventInfo.kind)},5e3*window.reconnectionAttempts.event))}})},$=async(e,t)=>{const n={kinds:[1311],"#a":[`30311:${e}:${t}`]};window.pool.subscribeMany(window.relays,[n],{onevent(e){H(e)},oneose(){},onclosed(){window.currentLiveEventInfo&&window.reconnectionAttempts.chat<3&&(window.reconnectionAttempts.chat++,setTimeout(()=>{$(window.currentLiveEventInfo.pubkey,window.currentLiveEventInfo.identifier)},5e3*window.reconnectionAttempts.chat))}})},V=async(e,t)=>{const n={kinds:[9735],"#a":[`30311:${e}:${t}`]};window.pool.subscribeMany(window.relays,[n],{onevent(n){K(n,e,t)},oneose(){},onclosed(){setTimeout(()=>{V(e,t)},5e3)}})},G=async e=>{const t=e.tags.filter(e=>"p"===e[0]).map(e=>e[1]);if(t.length>0){const e={kinds:[0],authors:t};window.pool.subscribeMany(window.relays,[e],{onevent(e){window.profiles=window.profiles||{},window.profiles[e.pubkey]=e},oneose(){}})}},Z=e=>{if(window.currentLiveEvent&&window.currentLiveEvent.id===e.id)return;window.currentLiveEvent=e,window.currentEventType="live-event";const t=document.querySelector(".note-content");if(t){t.classList.remove("loading");const e=t.querySelector(".loading-text");e&&e.remove()}ae();const n=e.tags.find(e=>"title"===e[0])?.[1]||"Live Event",s=e.tags.find(e=>"summary"===e[0])?.[1]||"",o=e.tags.find(e=>"status"===e[0])?.[1]||"unknown",a=e.tags.find(e=>"streaming"===e[0])?.[1],r=e.tags.find(e=>"recording"===e[0])?.[1],i=e.tags.find(e=>"starts"===e[0])?.[1],l=e.tags.find(e=>"ends"===e[0])?.[1],c=e.tags.find(e=>"current_participants"===e[0])?.[1]||"0",d=e.tags.find(e=>"total_participants"===e[0])?.[1]||"0",p=e.tags.filter(e=>"p"===e[0]),m=e=>e?new Date(1e3*parseInt(e)).toLocaleString():"",u=t?.querySelector(".live-event-content");if(t?.querySelector("#live-video"),u){const e=t?.querySelector(".live-event-status .status-indicator"),n=t?.querySelector(".participants-count");e&&(e.className=`status-indicator status-${o}`,e.textContent="live"===o?"🔴 LIVE":"planned"===o?"📅 PLANNED":"ended"===o?"✅ ENDED":o.toUpperCase()),n&&(n.innerHTML=`<strong>Participants:</strong> ${c}/${d}`)}else t&&(t.innerHTML=`\n            ${a?`\n                <div class="live-event-video">\n                    <div id="live-video-player" class="video-player-container">\n                        <video id="live-video" controls autoplay muted playsinline class="live-video">\n                            <source src="${a}" type="application/x-mpegURL">\n                            <source src="${a}" type="video/mp4">\n                            Your browser does not support the video tag.\n                        </video>\n                        <div class="video-error" id="video-error" style="display: none;">\n                            <p>Unable to load video stream</p>\n                            <a href="${a}" target="_blank" class="streaming-link">\n                                📺 Watch in External Player\n                            </a>\n                        </div>\n                    </div>\n                </div>\n            `:""}\n            \n            <div class="live-event-content">\n                ${s?`<p class="live-event-summary">${s}</p>`:""}\n                \n                <div class="live-event-status">\n                    <span class="status-indicator status-${o}">\n                        ${"live"===o?"🔴 LIVE":"planned"===o?"📅 PLANNED":"ended"===o?"✅ ENDED":o.toUpperCase()}\n                    </span>\n                </div>\n                \n                ${i?`<div class="live-event-time">\n                    <strong>Starts:</strong> ${m(i)}\n                </div>`:""}\n                \n                ${l?`<div class="live-event-time">\n                    <strong>Ends:</strong> ${m(l)}\n                </div>`:""}\n                \n                <div class="live-event-participants">\n                    <div class="participants-count">\n                        <strong>Participants:</strong> ${c}/${d}\n                    </div>\n                    ${p.length>0?`\n                        <div class="participants-list">\n                            ${p.slice(0,10).map(e=>`\n                                <div class="participant" data-pubkey="${e[1]}">\n                                    <span class="participant-role">${e[3]||"Participant"}</span>: \n                                    <span class="participant-pubkey">${e[1].slice(0,8)}...</span>\n                                </div>\n                            `).join("")}\n                            ${p.length>10?`<div class="participants-more">... and ${p.length-10} more</div>`:""}\n                        </div>\n                    `:""}\n                </div>\n                \n                ${r?`\n                    <div class="live-event-actions">\n                        <a href="${r}" target="_blank" class="recording-link">\n                            🎥 Watch Recording\n                        </a>\n                    </div>\n                `:""}\n            </div>\n        `);const g=document.getElementById("authorName");g&&(g.innerText=n);const h=p.find(e=>e[3]&&"host"===e[3].toLowerCase()),y=h?h[1]:e.pubkey;re(y),setTimeout(()=>{pe(e)},100),window.lightningEnabled&&setTimeout(()=>{window.enableLightningPayments&&window.enableLightningPayments()},150),window.cleanupLiveVideoPlayer&&window.cleanupLiveVideoPlayer(),a&&setTimeout(()=>{ce(a)},200),le()},H=e=>{if(document.querySelector(`[data-chat-id="${e.id}"]`))return;const t=document.getElementById("zaps");if(t){t.classList.remove("loading");const e=t.querySelector(".loading-text");e&&e.remove()}const n=document.getElementById("activity-list")||t,s=document.createElement("div");s.className="live-chat-message",s.dataset.pubkey=e.pubkey,s.dataset.timestamp=e.created_at,s.dataset.chatId=e.id;const o=new Date(1e3*e.created_at).toLocaleString();if(s.innerHTML=`\n        <div class="chat-message-header">\n            <img class="chat-author-img" src="/images/gradient_color.gif" data-pubkey="${e.pubkey}" />\n            <div class="chat-message-info">\n                <div class="chat-author-name" data-pubkey="${e.pubkey}">\n                    ${e.pubkey.slice(0,8)}...\n                </div>\n                <div class="chat-message-time">${o}</div>\n            </div>\n        </div>\n        <div class="chat-message-content">\n            ${e.content}\n        </div>\n    `,Q(e.pubkey),n){const t=Array.from(n.querySelectorAll(".live-chat-message, .live-event-zap")),o=t.findIndex(t=>parseInt(t.dataset.timestamp)<e.created_at);if(-1===o)n.appendChild(s);else{const e=t[o];e?n.insertBefore(s,e):n.appendChild(s)}}},K=async(e,t,n)=>{try{const t=e.tags.find(e=>"description"===e[0])?.[1];if(!t)return;let n;try{n=JSON.parse(t)}catch(e){return}const s=e.tags.find(e=>"bolt11"===e[0])[1],o=window.lightningPayReq.decode(s).satoshis,a=n.pubkey,r=n.content||"",i={id:e.id,amount:o,content:r,pubkey:a,timestamp:e.created_at,bolt11:s,zapEventID:window.NostrTools.nip19.noteEncode(e.id)};Q(a),X(a,o),J(i)}catch(e){console.error("Error processing live event zap:",e)}},J=e=>{if(document.querySelector(`[data-zap-id="${e.id}"]`))return;const t=document.getElementById("zaps");if(t){t.classList.remove("loading");const e=t.querySelector(".loading-text");e&&e.remove()}const n=document.getElementById("activity-list")||t,s=document.getElementById("zaps-only-list"),o=document.createElement("div");o.className="live-event-zap",o.dataset.pubkey=e.pubkey,o.dataset.timestamp=e.timestamp,o.dataset.amount=e.amount,o.dataset.zapId=e.id;const a=new Date(1e3*e.timestamp).toLocaleString();if(o.innerHTML=`\n        <div class="zap-header">\n            <img class="zap-author-img" src="/images/gradient_color.gif" data-pubkey="${e.pubkey}" />\n            <div class="zap-info">\n                <div class="zap-author-name" data-pubkey="${e.pubkey}">\n                    ${e.pubkey.slice(0,8)}...\n                </div>\n                <div class="zap-time">${a}</div>\n            </div>\n            <div class="zap-amount">\n                <span class="zap-amount-sats">${ke(e.amount)}</span>\n                <span class="zap-amount-label">sats</span>\n            </div>\n        </div>\n        ${e.content?`\n            <div class="zap-content">\n                ${e.content}\n            </div>\n        `:""}\n    `,n){const t=Array.from(n.querySelectorAll(".live-chat-message, .live-event-zap")),s=t.findIndex(t=>parseInt(t.dataset.timestamp)<e.timestamp);if(-1===s)n.appendChild(o);else{const e=t[s];e?n.insertBefore(o,e):n.appendChild(o)}}if(s){const t=document.createElement("div");t.className="zap live-event-zap zap-only-item",t.dataset.pubkey=e.pubkey,t.dataset.timestamp=e.timestamp,t.dataset.amount=e.amount,t.dataset.zapId=e.id,t.innerHTML=`\n            <div class="zapperProfile">\n                <img class="zapperProfileImg" src="/images/gradient_color.gif" data-pubkey="${e.pubkey}" />\n                <div class="zapperInfo">\n                    <div class="zapperName" data-pubkey="${e.pubkey}">\n                        ${e.pubkey.slice(0,8)}...\n                    </div>\n                    <div class="zapperMessage">${e.content||""}</div>\n                </div>\n            </div>\n            <div class="zapperAmount">\n                <span class="zapperAmountSats">${ke(e.amount)}</span>\n                <span class="zapperAmountLabel">sats</span>\n            </div>\n        `;const n=Array.from(s.querySelectorAll(".live-event-zap")),o=n.findIndex(t=>parseInt(t.dataset.amount||0)<e.amount);if(-1===o)s.appendChild(t);else{const e=n[o];e?s.insertBefore(t,e):s.appendChild(t)}}Y()},Q=async e=>{const t={kinds:[0],authors:[e]};window.pool.subscribeMany(window.relays,[t],{onevent(e){oe(e)},oneose(){},onclosed(){}})},Y=()=>{const e=Array.from(document.querySelectorAll(".live-event-zap")),t=e.reduce((e,t)=>e+parseInt(t.dataset.amount||"0"),0),n=e.length,s=document.getElementById("zappedTotalValue"),o=document.getElementById("zappedTotalCount");s&&(s.innerText=ke(t)),o&&(o.innerText=ke(n))},X=(e,t,n=null)=>{window.zapperTotals||(window.zapperTotals=new Map);const s=window.zapperTotals;if(s.has(e)){const o=s.get(e);o.amount+=t,n&&(o.profile=n,o.name=ee(n),o.picture=n.picture||"/images/gradient_color.gif")}else s.set(e,{amount:t,profile:n,name:n?ee(n):"Anonymous",picture:n&&n.picture||"/images/gradient_color.gif",pubkey:e});te()},ee=e=>e&&(e.display_name||e.displayName||e.name)||"Anonymous",te=()=>{if(!window.zapperTotals)return;const e=window.zapperTotals,t=Array.from(e.values()).sort((e,t)=>t.amount-e.amount).slice(0,5);window.topZappers=t,A(t)},ne=()=>{if(document.getElementById("top-zappers-bar"))if(0!==w.length){document.body.classList.add("show-top-zappers");for(let e=0;e<5;e++){const t=document.getElementById(`top-zapper-${e+1}`);if(t)if(e<w.length){const n=w[e],s=t.querySelector(".zapper-avatar"),o=t.querySelector(".zapper-name"),a=t.querySelector(".zapper-total");s&&(s.src=n.picture),s&&(s.alt=n.name),o&&(o.textContent=n.name),a&&(a.textContent=`${ke(n.amount)} sats`),t.style.opacity="1",t.style.display="flex"}else t.style.display="none"}}else document.body.classList.remove("show-top-zappers")},se=()=>{document.body.classList.remove("show-top-zappers")},oe=e=>{const t=JSON.parse(e.content||"{}"),n=t.display_name||t.displayName||t.name||`${e.pubkey.slice(0,8)}...`,s=t.picture||"/images/gradient_color.gif";if(window.zapperTotals&&window.zapperTotals.has(e.pubkey)){const o=window.zapperTotals.get(e.pubkey);o.profile=t,o.name=n,o.picture=s,te()}document.querySelectorAll(`[data-pubkey="${e.pubkey}"]`).forEach(e=>{e.classList.contains("chat-author-img")||e.classList.contains("zap-author-img")||e.classList.contains("zapperProfileImg")?e.src=s:(e.classList.contains("chat-author-name")||e.classList.contains("zap-author-name")||e.classList.contains("zapperName"))&&(e.textContent=n)})},ae=()=>{const e=document.getElementById("zaps");if(!e)return;if(e.classList.contains("live-event-two-column")&&e.querySelector(".live-event-columns"))return;const t=e.querySelector(".zaps-header");e.querySelector(".zaps-list"),e.innerHTML="",t&&e.appendChild(t);const n=document.createElement("div");n.className="live-event-columns",n.innerHTML='\n        <div class="live-event-zaps-only">\n            <div id="zaps-only-list" class="zaps-only-list"></div>\n        </div>\n        <div class="live-event-activity">\n            <div id="activity-list" class="activity-list"></div>\n        </div>\n    ',e.appendChild(n),e.classList.add("live-event-two-column");const s=document.getElementById("zapGridToggle");if(s){s.disabled=!0;const e=s.closest(".toggle-group");e&&e.classList.add("grid-toggle-disabled");const t=s.closest("label");t&&t.classList.add("grid-toggle-disabled")}},re=async e=>{const t={kinds:[0],authors:[e]};window.pool.subscribeMany(window.relays,[t],{onevent(e){ie(e)},oneose(){},onclosed(){}})},ie=e=>{const t=JSON.parse(e.content||"{}").picture||"/images/gradient_color.gif",n=document.getElementById("authorNameProfileImg");n&&(n.src=t)},le=()=>{window.contentMonitorInterval&&clearInterval(window.contentMonitorInterval),window.contentMonitorInterval=setInterval(()=>{const e=document.querySelector(".note-content"),t=document.getElementById("zaps"),n=e?.querySelector(".live-event-content"),s=t?.querySelector(".live-event-columns");"live-event"===window.currentEventType&&(n||(console.warn("Live event content disappeared! Attempting to restore..."),window.currentLiveEvent&&window.currentLiveEventInfo&&Z(window.currentLiveEvent)),s||!t||t.classList.contains("loading")||(console.warn("Two-column layout disappeared! Attempting to restore..."),ae()))},1e4)},ce=e=>{const t=document.getElementById("live-video");t&&(t.addEventListener("error",e=>{console.error("Video error:",e);const t=document.getElementById("video-error");t&&(t.style.display="block")}),t.addEventListener("loadeddata",()=>{const e=document.getElementById("video-error");e&&(e.style.display="none")}),t.src=e,t.load())},de=(e,t,n)=>{const s=document.getElementById(e);s&&window.QRious&&(s.innerHTML="",new window.QRious({element:s,size:n,value:t}))},pe=e=>{const t=e.tags.find(e=>"d"===e[0])?.[1],n=e.pubkey;if(t&&n)try{const e=window.NostrTools.nip19.naddrEncode({identifier:t,pubkey:n,kind:30311,relays:[]}),s=`https://njump.me/${e}`,o=`nostr:${e}`,a=Math.min(.6*window.innerWidth,.7*window.innerHeight);de("qrCode",s,a),de("qrCodeNevent",o,a),de("qrCodeNote",e,a),((e,t,n)=>{const s=document.getElementById("qrcodeLinkNostr"),o=document.getElementById("qrcodeNeventLink"),a=document.getElementById("qrcodeNoteLink");s&&(s.href=e),o&&(o.href=t),a&&(a.href=n)})(s,o,e),((e,t,n)=>{const s=document.getElementById("qrDataPreview1"),o=document.getElementById("qrDataPreview2"),a=document.getElementById("qrDataPreview3");s&&(s.textContent=e),o&&(o.textContent=t),a&&(a.textContent=n)})(s,o,e)}catch(e){console.error("Error generating QR codes for live event:",e)}},me=async e=>{try{xe(),be(),e=ge(e);try{ue(e),ye()}catch(e){return void he(e instanceof Error?e.message:"Unknown error")}try{const t=window.NostrTools.nip19.decode(e);let n;if("nevent"===t.type)n=t.data.id;else{if("note"!==t.type){if("naddr"===t.type){const{identifier:e,pubkey:n,kind:s}=t.data;be();const o=document.querySelector(".note-content"),a=document.getElementById("zaps");if(o&&(o.classList.add("loading"),!o.querySelector(".loading-text"))){const e=document.createElement("div");e.className="loading-text",e.textContent="Loading live event...",o.appendChild(e)}if(a&&(a.classList.add("loading"),!a.querySelector(".loading-text"))){const e=document.createElement("div");e.className="loading-text",e.textContent="Loading live activity...",a.appendChild(e)}window.currentLiveEventInfo={pubkey:n,identifier:e,kind:s},window.reconnectionAttempts={event:0,chat:0,zaps:0},W(n,e,s),$(n,e),V(n,e);const r=document.getElementById("noteLoaderContainer");return void(r&&(r.style.display="none"))}throw new Error("Invalid nostr identifier format.")}n=t.data}const s=document.querySelector(".note-content"),o=document.getElementById("zaps");if(s&&(s.classList.add("loading"),!s.querySelector(".loading-text"))){const e=document.createElement("div");e.className="loading-text",e.textContent="Loading note content...",s.appendChild(e)}if(o&&(o.classList.add("loading"),!o.querySelector(".loading-text"))){const e=document.createElement("div");e.className="loading-text",e.textContent="Loading zaps...",o.appendChild(e)}Ne(n);const a=document.getElementById("noteLoaderContainer");a&&(a.style.display="none")}catch(t){const n=document.querySelector(".note-content"),s=document.getElementById("zaps");if(n&&(n.classList.add("loading"),!n.querySelector(".loading-text"))){const e=document.createElement("div");e.className="loading-text",e.textContent="Loading note content...",n.appendChild(e)}if(s&&(s.classList.add("loading"),!s.querySelector(".loading-text"))){const e=document.createElement("div");e.className="loading-text",e.textContent="Loading zaps...",s.appendChild(e)}Ne(e);const o=document.getElementById("noteLoaderContainer");o&&(o.style.display="none")}}catch(e){a(e instanceof Error?e.message:"Failed to load note content")}},ue=e=>{if(!e||""===e.trim())throw new Error("Please enter a note ID");if(!((e=e.trim()).startsWith("note1")||e.startsWith("nevent1")||e.startsWith("naddr1")||e.startsWith("nprofile1")))throw new Error("Invalid format. Please enter a valid nostr note ID (note1...), event ID (nevent1...), addressable event (naddr1...), or profile (nprofile1...)");try{const t=window.NostrTools.nip19.decode(e);if("note"===t.type){if(!t.data||"string"!=typeof t.data||64!==t.data.length)throw new Error("Invalid note ID format")}else if("nevent"===t.type){if(!t.data||!t.data.id||"string"!=typeof t.data.id||64!==t.data.id.length)throw new Error("Invalid event ID format")}else if("naddr"===t.type){if(!t.data||!t.data.identifier||!t.data.pubkey||"number"!=typeof t.data.kind)throw new Error("Invalid addressable event format");if(30311!==t.data.kind)throw new Error("Only live events (kind 30311) are supported")}else{if("nprofile"!==t.type)throw new Error("Unsupported identifier type");if(!t.data||!t.data.pubkey)throw new Error("Invalid profile format")}return!0}catch(e){if(e instanceof Error&&(e.message.includes("Invalid")||e.message.includes("Unsupported")))throw new Error("Invalid nostr identifier format. Please check the note ID and try again.");throw new Error("Invalid nostr identifier format. Please check the note ID and try again.")}},ge=e=>e.replace(/^nostr:/,""),he=e=>{const t=document.getElementById("noteLoaderError");t&&(t.textContent=e,t.style.display="block")},ye=()=>{const e=document.getElementById("noteLoaderError");e&&(e.style.display="none")},ve=()=>{localStorage.removeItem("pubpay-styles"),Xe("lightMode")},we=()=>{const e=document.querySelector(".main-layout");if(!e)return;const t=new URLSearchParams(window.location.search);if(""===t.toString())return;if(t.has("textColor")){const n=t.get("textColor");if(n){e.style.setProperty("--text-color",n);const t=document.getElementById("textColorPicker"),s=document.getElementById("textColorValue");t&&(t.value=n),s&&(s.value=n)}}if(t.has("bgColor")){const n=t.get("bgColor");if(n){const s=t.has("opacity")?parseFloat(t.get("opacity")||"1"):1,o=Ve(n,s);e.style.backgroundColor=o;const a=document.getElementById("bgColorPicker"),r=document.getElementById("bgColorValue");a&&(a.value=n),r&&(r.value=n)}}if(t.has("bgImage")){const e=t.get("bgImage");if(e){const t=document.getElementById("bgImageUrl");t&&(t.value=e,Qe(e))}}const n=t.has("qrInvert")?"true"===t.get("qrInvert"):N,s=document.getElementById("qrInvertToggle");s&&(s.checked=n);const o=[document.getElementById("qrCode"),document.getElementById("qrCodeNevent"),document.getElementById("qrCodeNote")];O&&o.push(document.getElementById("lightningQRCode")),o.forEach(e=>{e&&(e.style.filter=n?"invert(1)":"none")});const a=t.has("qrScreenBlend")?"true"===t.get("qrScreenBlend"):S,r=document.getElementById("qrScreenBlendToggle");r&&(r.checked=a);const i=t.has("qrMultiplyBlend")?"true"===t.get("qrMultiplyBlend"):I,l=document.getElementById("qrMultiplyBlendToggle");l&&(l.checked=i),Ye();const c=t.has("qrShowWebLink")?"true"===t.get("qrShowWebLink"):E,d=document.getElementById("qrShowWebLinkToggle");d&&(d.checked=c);const p=t.has("qrShowNevent")?"true"===t.get("qrShowNevent"):j,m=document.getElementById("qrShowNeventToggle");m&&(m.checked=p);const u=t.has("qrShowNote")?"true"===t.get("qrShowNote"):C,g=document.getElementById("qrShowNoteToggle");g&&(g.checked=u);const h=t.has("layoutInvert")?"true"===t.get("layoutInvert"):L,y=document.getElementById("layoutInvertToggle");y&&(y.checked=h),document.body.classList.toggle("flex-direction-invert",h);const v=t.has("hideZapperContent")?"true"===t.get("hideZapperContent"):k,w=document.getElementById("hideZapperContentToggle");w&&(w.checked=v),document.body.classList.toggle("hide-zapper-content",v);const f=t.has("showTopZappers")?"true"===t.get("showTopZappers"):P,b=document.getElementById("showTopZappersToggle");b&&(b.checked=f),document.body.classList.toggle("show-top-zappers",f);const A=t.has("podium")?"true"===t.get("podium"):T,_=document.getElementById("podiumToggle");_&&(_.checked=A),document.body.classList.toggle("podium-enabled",A);const B=t.has("zapGrid")?"true"===t.get("zapGrid"):z,M=document.getElementById("zapGridToggle");M&&(M.checked=B);const R=document.getElementById("zaps");R&&(R.classList.toggle("grid-layout",B),B?Te():Pe());const D=t.has("lightning")?"true"===t.get("lightning"):q,U=document.getElementById("lightningToggle");if(U&&(U.checked=D),t.has("opacity")){const e=parseFloat(t.get("opacity")||"1"),n=document.getElementById("opacitySlider"),s=document.getElementById("opacityValue");n&&(n.value=e.toString()),s&&(s.textContent=`${Math.round(100*e)}%`)}if(t.has("textOpacity")){const e=parseFloat(t.get("textOpacity")||"1"),n=document.getElementById("textOpacitySlider"),s=document.getElementById("textOpacityValue");n&&(n.value=e.toString()),s&&(s.textContent=`${Math.round(100*e)}%`)}if(t.has("partnerLogo")){const e=decodeURIComponent(t.get("partnerLogo")||""),n=document.getElementById("partnerLogoSelect"),s=document.getElementById("partnerLogo"),o=document.getElementById("partnerLogoUrl"),a=document.getElementById("customPartnerLogoGroup"),r=document.getElementById("partnerLogoPreview");e?(Array.from(n.options).find(t=>t.value===e)?(n&&(n.value=e),a&&(a.style.display="none")):(n&&(n.value="custom"),a&&(a.style.display="block"),o&&(o.value=e)),s&&(s.src=e,s.style.display="inline-block"),r&&(r.src=e,r.alt="Partner logo preview")):(n&&(n.value=""),a&&(a.style.display="none"),s&&(s.style.display="none",s.src=""),r&&(r.src="",r.alt="No partner logo"))}Ke(),setTimeout(()=>{const e=document.getElementById("qrCode"),t=document.getElementById("qrCodeNevent"),n=document.getElementById("qrCodeNote");console.log("QR code elements check:",{qrCode:!!e,qrCodeNevent:!!t,qrCodeNote:!!n,qrCodeContent:e?.innerHTML,qrCodeNeventContent:t?.innerHTML,qrCodeNoteContent:n?.innerHTML}),"function"==typeof tt&&tt(!0)},500),He(),(()=>{const e=document.querySelector(".main-layout");if(!e)return;const t=document.getElementById("partnerLogoSelect"),n=document.getElementById("partnerLogoUrl");let s="";t&&(s="custom"===t.value&&n?n.value:t.value);const o={textColor:$e(e.style.getPropertyValue("--text-color")||x),bgColor:$e(e.style.backgroundColor),bgImage:document.getElementById("bgImageUrl")?.value||"",qrInvert:document.getElementById("qrInvertToggle")?.checked||!1,qrScreenBlend:document.getElementById("qrScreenBlendToggle")?.checked||!1,qrMultiplyBlend:document.getElementById("qrMultiplyBlendToggle")?.checked||!1,qrShowWebLink:document.getElementById("qrShowWebLinkToggle")?.checked??!0,qrShowNevent:document.getElementById("qrShowNeventToggle")?.checked??!0,qrShowNote:document.getElementById("qrShowNoteToggle")?.checked??!0,layoutInvert:document.getElementById("layoutInvertToggle")?.checked||!1,hideZapperContent:document.getElementById("hideZapperContentToggle")?.checked||!1,showTopZappers:document.getElementById("showTopZappersToggle")?.checked||!1,podium:document.getElementById("podiumToggle")?.checked||!1,zapGrid:document.getElementById("zapGridToggle")?.checked||!1,lightning:document.getElementById("lightningToggle")?.checked||!1,opacity:parseFloat(document.getElementById("opacitySlider")?.value||"1"),textOpacity:parseFloat(document.getElementById("textOpacitySlider")?.value||"1"),partnerLogo:s};localStorage.setItem("pubpay-styles",JSON.stringify(o));const a=window.location.pathname.split("/"),r=a[a.length-1],i=r&&"live"!==r?`/live/${r}`:"/live";window.location.href!==window.location.origin+i&&window.history.replaceState({},"",i)})()},fe=()=>{const e=localStorage.getItem("pubpay-styles");let t=window.location.origin+window.location.pathname;if(e)try{const n=JSON.parse(e),s=new URLSearchParams;n.textColor&&n.textColor!==x&&s.set("textColor",n.textColor),n.bgColor&&"#ffffff"!==n.bgColor&&s.set("bgColor",n.bgColor),n.bgImage&&""!==n.bgImage&&s.set("bgImage",n.bgImage),n.qrInvert!==N&&s.set("qrInvert",n.qrInvert),n.qrScreenBlend!==S&&s.set("qrScreenBlend",n.qrScreenBlend),n.qrMultiplyBlend!==I&&s.set("qrMultiplyBlend",n.qrMultiplyBlend),n.qrShowWebLink!==E&&s.set("qrShowWebLink",n.qrShowWebLink),n.qrShowNevent!==j&&s.set("qrShowNevent",n.qrShowNevent),n.qrShowNote!==C&&s.set("qrShowNote",n.qrShowNote),n.layoutInvert!==L&&s.set("layoutInvert",n.layoutInvert),n.hideZapperContent!==k&&s.set("hideZapperContent",n.hideZapperContent),n.showTopZappers!==P&&s.set("showTopZappers",n.showTopZappers),n.podium!==T&&s.set("podium",n.podium),n.zapGrid!==z&&s.set("zapGrid",n.zapGrid),n.lightning!==q&&s.set("lightning",n.lightning),1!==n.opacity&&s.set("opacity",n.opacity),1!==n.textOpacity&&s.set("textOpacity",n.textOpacity),n.partnerLogo&&""!==n.partnerLogo&&s.set("partnerLogo",encodeURIComponent(n.partnerLogo)),s.toString()&&(t+=`?${s.toString()}`)}catch(e){console.error("Error parsing saved styles:",e)}navigator.clipboard.writeText(t).then(()=>{const e=document.getElementById("copyStyleUrl");if(e){const t=e.textContent;e.textContent="Copied!",e.style.background="#28a745",setTimeout(()=>{e.textContent=t,e.style.background=""},2e3)}}).catch(e=>{console.error("Failed to copy URL:",e);const n=document.createElement("textarea");n.value=t,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n)})},be=()=>{h(0),v(0),u([]),A([]),se()},xe=()=>{},Ne=async e=>{if(!window.pool||!window.relays)return void console.error("Nostr pool or relays not available");const t=window.pool,n=window.relays,s={ids:[e]},o=setTimeout(()=>{},1e4);t.subscribeMany([...n],[s],{async onevent(e){clearTimeout(o),await ze(e),await Se(e),await Ie(e)},oneose(){clearTimeout(o)},onclosed(){clearTimeout(o)}})},Se=async e=>{if(!window.pool||!window.relays)return;const t=window.pool,n=window.relays,s=e.pubkey;t.subscribeMany([...n],[{kinds:[0],authors:[s]}],{onevent(e){qe(e)},oneose(){},onclosed(){}})},Ie=async e=>{if(!window.pool||!window.relays)return;const t=window.pool,n=window.relays,s=new Set,o=[],a=e.id;let r=!0;const i=document.getElementById("zaps"),l=setTimeout(()=>{if(0===o.length&&i){i.classList.remove("loading");const e=i.querySelector(".loading-text");e&&e.remove();const t=document.createElement("div");t.className="empty-zaps-state",t.innerHTML='\n            <div class="empty-zaps-message">\n              Be the first to support\n            </div>\n          ',i.appendChild(t)}},15e3);t.subscribeMany([...n],[{kinds:[9735],"#e":[a]}],{onevent(e){clearTimeout(l),s.has(e.id)||(s.add(e.id),o.push(e),r||Ee([e]))},oneose(){clearTimeout(l),r=!1,Ee(o)},onclosed(){clearTimeout(l)}})},Ee=e=>{if(!window.pool||!window.relays)return;const t=window.pool,n=window.relays,s=[],o=[],a=new Set;for(const t of e)if(t.tags){const e=t.tags.find(e=>"description"===e[0])?.[1];if(e){const t=JSON.parse(e);s.push(t.pubkey)}}t.subscribeMany([...n],[{kinds:[0],authors:s}],{onevent(e){a.has(e.pubkey)||(a.add(e.pubkey),o.push(e))},async oneose(){je(e,o)},onclosed(){}})},je=async(e,t)=>{be();const n=[];for(const s of e){const e=JSON.parse(s.tags.find(e=>"description"==e[0])?.[1]||"{}"),o=e.pubkey,a=s.tags.find(e=>"bolt11"==e[0])?.[1];if(!a)continue;const r=window.lightningPayReq?.decode(a)?.satoshis||0,i=s.tags.find(e=>"e"==e[0])?.[1],l=window.NostrTools?.nip19?.noteEncode(s.id)||s.id,c=e.content||"";let d="",p="",m="",u="",g=null;const h=t.find(e=>o===e.pubkey);if(h){const e=JSON.parse(h.content);m=e.displayName?e.displayName:e.display_name,u=""!=m?m:e.name,d=e.picture,p=window.NostrTools?.nip19?.npubEncode(h.pubkey)||"",g=e}const y={e:i,amount:r,picture:d,npubPayer:p,pubKey:o,zapEventID:l,kind9735content:c,kind1Name:u,kind0Profile:g};n.push(y)}n.sort((e,t)=>t.amount-e.amount),Ce(n)},Ce=e=>{const t=document.getElementById("zaps");if(!t)return;t.innerHTML="",t.classList.remove("loading");const n=t.querySelector(".loading-text");n&&n.remove();const s=e.reduce((e,t)=>e+t.amount,0),o=document.getElementById("zappedTotalValue"),a=document.getElementById("zappedTotalCount");if(o&&(o.innerText=ke(s)),a&&(a.innerText=e.length.toString()),v(s),h(e.length),u(e),0===e.length){const e=document.createElement("div");return e.className="empty-zaps-state",e.innerHTML='\n        <div class="empty-zaps-message">\n          Be the first to support\n        </div>\n      ',void t.appendChild(e)}const r=e.sort((e,t)=>t.amount-e.amount);for(let e=0;e<r.length;e++){const n=r[e],s=document.createElement("div"),o="zap";s.className=o,n.picture||(n.picture="");const a=""==n.picture?"/images/gradient_color.gif":n.picture;s.innerHTML=`\n        <div class="zapperProfile">\n          <img class="zapperProfileImg" src="${a}" />\n          <div class="zapperInfo">\n            <div class="zapperName">\n              ${n.kind1Name||"Anonymous"}\n            </div>\n            <div class="zapperMessage">${n.kind9735content||""}</div>\n          </div>\n        </div>\n        <div class="zapperAmount">\n          <span class="zapperAmountSats">${ke(n.amount)}</span>\n          <span class="zapperAmountLabel">sats</span>\n        </div>\n      `,t.appendChild(s)}const i=document.getElementById("zapGridToggle");if(i&&i.checked)t.classList.add("grid-layout"),setTimeout(()=>{Te()},10);else if(t.classList.remove("grid-layout"),document.body.classList.contains("podium-enabled")){const e=[...Array.from(t.querySelectorAll(".zap"))].sort((e,t)=>{const n=parseInt(e.querySelector(".zapperAmountSats")?.textContent?.replace(/[^\d]/g,"")||"0");return parseInt(t.querySelector(".zapperAmountSats")?.textContent?.replace(/[^\d]/g,"")||"0")-n});console.log("Applying podium classes in list layout. Top 3 zaps:",e.slice(0,3).map(e=>({amount:e.querySelector(".zapperAmountSats")?.textContent,name:e.querySelector(".zapperName")?.textContent})));for(let t=0;t<Math.min(3,e.length);t++){const n=e[t];n&&n.classList.add(`podium-${t+1}`)}}Le(e)},Le=e=>{const t=new Map;for(const n of e){const e=n.pubKey||n.pubkey,s=n.amount,o=n.kind0Profile||null;if(t.has(e))t.get(e).amount+=s;else{const a={amount:s,profile:o,name:o?ee(o):n.kind1Name||"Anonymous",picture:o?.picture||n.picture||"/images/gradient_color.gif"};t.set(e,a)}}const n=Array.from(t.values()).sort((e,t)=>t.amount-e.amount).slice(0,5);A(n),window.topZappers=n},ke=e=>e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),Pe=()=>{const e=document.getElementById("zaps");e&&(e.classList.contains("live-event-two-column")||e.querySelectorAll(".zap-row").forEach(t=>{Array.from(t.children).forEach(t=>{t.className=t.className.replace(/row-\d+/g,""),t.className=t.className.replace(/podium-global-\d+/g,""),e.appendChild(t)}),t.remove()}))},Te=()=>{const e=document.getElementById("zaps");if(!e)return;if(e.classList.contains("live-event-two-column"))return;const t=Array.from(e.querySelectorAll(".zap"));if(0===t.length)return;t.forEach(e=>{e.className=e.className.replace(/row-\d+/g,""),e.className=e.className.replace(/podium-\d+/g,""),e.className=e.className.replace(/podium-global-\d+/g,"")}),e.querySelectorAll(".zap-row").forEach(e=>e.remove());const n=[...t].sort((e,t)=>{const n=parseInt(e.querySelector(".zapperAmountSats")?.textContent?.replace(/[^\d]/g,"")||"0");return parseInt(t.querySelector(".zapperAmountSats")?.textContent?.replace(/[^\d]/g,"")||"0")-n});if(document.body.classList.contains("podium-enabled")){console.log("Applying podium classes in grid layout. Top 3 zaps:",n.slice(0,3).map(e=>({amount:e.querySelector(".zapperAmountSats")?.textContent,name:e.querySelector(".zapperName")?.textContent})));for(let e=0;e<Math.min(3,n.length);e++){const t=n[e];t&&t.classList.add(`podium-global-${e+1}`)}}let s=0,o=1,a=1;for(;s<t.length;){const n=document.createElement("div");n.className=`zap-row row-${o}`;for(let e=0;e<a&&s<t.length;e++){const e=t[s];e&&(e.classList.add(`row-${o}`),n.appendChild(e)),s++}if(e.appendChild(n),a*=2,o++,o>5){for(;s<t.length;){const e=t[s];e&&(e.classList.add("row-5"),n.appendChild(e)),s++}break}}},ze=async e=>{window.currentNoteId=e.id;const t=document.getElementById("noteContent");if(t){const n=await Ae(e.content);t.innerHTML=n,t.classList.remove("loading");const s=t.querySelector(".loading-text");s&&s.remove()}i(e.content),window.lightningEnabled&&setTimeout(()=>{window.enableLightningPayments&&window.enableLightningPayments()},100);const n=e.id,s=window.NostrTools.nip19.neventEncode({id:n,relays:[]}),o=window.NostrTools.nip19.noteEncode(n),a=`https://njump.me/${o}`,r=`nostr:${s}`,l=`nostr:${o}`,c=Math.min(.6*window.innerWidth,.7*window.innerHeight);[{element:document.getElementById("qrCode"),value:a,link:document.getElementById("qrcodeLinkNostr"),preview:document.getElementById("qrDataPreview1")},{element:document.getElementById("qrCodeNevent"),value:r,link:document.getElementById("qrcodeNeventLink"),preview:document.getElementById("qrDataPreview2")},{element:document.getElementById("qrCodeNote"),value:l,link:document.getElementById("qrcodeNoteLink"),preview:document.getElementById("qrDataPreview3")}].forEach(({element:e,value:t,link:n,preview:s})=>{if(e&&(e.innerHTML="",new window.QRious({element:e,size:c,value:t}),n&&(n.href=t),s)){let e=t,n=10;t.startsWith("https://")?(e=t.substring(8),n=20):t.startsWith("nostr:")&&(e=t.substring(6));const o=`${e.substring(0,n)}...`;s.textContent=o}}),window.qrSwiper||(window.qrSwiper=new window.Swiper(".qr-swiper",{slidesPerView:1,spaceBetween:0,pagination:{el:".swiper-pagination",clickable:!0,dynamicBullets:!1},loop:!1,autoplay:{delay:1e4,disableOnInteraction:!1,pauseOnMouseEnter:!0},autoHeight:!1,height:250,watchOverflow:!0,observer:!0,observeParents:!0}))},qe=e=>{try{const t=JSON.parse(e.content);c(t.name||t.display_name||"Anonymous"),p(t.picture||"/images/gradient_color.gif")}catch(e){console.error("Error parsing profile:",e)}},Ae=async e=>e,_e=async e=>{},Be=(e,t)=>{const n=document.querySelector(".note-content"),s=document.getElementById("zaps");if(n&&(n.classList.add("loading"),!n.querySelector(".loading-text"))){const t=document.createElement("div");t.className="loading-text",t.textContent=e,n.appendChild(t)}if(s&&(s.classList.add("loading"),!s.querySelector(".loading-text"))){const e=document.createElement("div");e.className="loading-text",e.textContent=t,s.appendChild(e)}},Me=async()=>{const e=document.getElementById("note1LoaderInput"),t=e?.value?.trim();if(!t)return void he("Please enter a note ID");const s=ge(t);try{ue(s),ye()}catch(e){return void he(e instanceof Error?e.message:"Invalid note ID")}try{const e=window.NostrTools.nip19.decode(s),t=`/live/${s}`;if(window.history.pushState({},"",t),window.dispatchEvent(new CustomEvent("noteLoaderSubmitted",{detail:{noteId:s,decoded:e}})),n(!0),a(null),"naddr"===e.type){const{identifier:t,pubkey:n,kind:s}=e.data;Be("Loading live event...","Loading live activity..."),await W(n,t,s),await $(n,t),await V(n,t)}else if("nprofile"===e.type){const{pubkey:t}=e.data;Be("Loading profile...","Loading profile activity..."),await(async e=>{try{c("Profile Author"),i("Profile content will be loaded here"),await _e(e)}catch(e){throw new Error("Failed to load profile content")}})(t)}else if("nevent"===e.type){const t=e.data.id;Be("Loading note content...","Loading zaps..."),await Ne(t)}else{if("note"!==e.type)throw new Error("Invalid identifier format. Please enter a valid nostr identifier.");{const t=e.data;Be("Loading note content...","Loading zaps..."),await Ne(t)}}}catch(e){console.error("Error loading note content:",e),he("Invalid nostr identifier. Please enter a valid note ID (note1...), event ID (nevent1...), live event (naddr1...), or profile (nprofile1...)."),n(!1)}},Oe=(e=0)=>{if(b&&0===e)return;0===e&&(b=!0);const t=document.getElementById("note1LoaderSubmit"),n=document.getElementById("note1LoaderInput");if(!n||!t)return e<50?(e%10==0&&console.warn(`Input field or button not found, retrying... (attempt ${e+1}/50)`),void setTimeout(()=>Oe(e+1),100)):(console.error("Input field or button not found after 50 retries, giving up"),void(b=!1));t&&(t.removeEventListener("click",Me),t.addEventListener("click",e=>{e.preventDefault(),Me()})),n&&(n.addEventListener("keypress",e=>{"Enter"===e.key&&(e.preventDefault(),Me())}),n.addEventListener("input",e=>{ye()})),b=!1},Re=()=>{Fe("textColorPicker","textColorValue","color"),Fe("bgColorPicker","bgColorValue","backgroundColor");const t=document.getElementById("bgImagePreset"),n=document.getElementById("bgImageUrl"),s=document.getElementById("bgPresetPreview"),o=document.getElementById("clearBgImage"),a=document.getElementById("customUrlGroup");t&&t.addEventListener("change",e=>{const t=e.target.value;"custom"===t?(a&&(a.style.display="block"),n&&n.focus()):"pubpay-preset"===t?(a&&(a.style.display="none"),(()=>{const e=document.getElementById("textColorPicker"),t=document.getElementById("textColorValue");e&&t&&(e.value="#ffffff",t.value="#ffffff");const n=document.getElementById("bgImageUrl");n&&(n.value="/images/gradient_color.gif"),Qe("/images/gradient_color.gif");const s=document.getElementById("opacitySlider"),o=document.getElementById("opacityValue");s&&o&&(s.value="0",o.textContent="0%");const a=document.getElementById("qrInvertToggle");a&&(a.checked=!0);const r=document.getElementById("qrScreenBlendToggle");r&&(r.checked=!0);const i=document.getElementById("bgPresetPreview");i&&(i.src="/images/gradient_color.gif",i.alt="PubPay preset preview",i.style.display="block"),Ke(),Ye(),He()})()):(a&&(a.style.display="none"),n&&(n.value=t),Qe(t),s&&(""===t?(s.src="",s.alt="No background",s.style.display="none"):(s.src=t,s.alt="Background preview",s.style.display="block")),He())}),n&&n.addEventListener("input",e=>{const t=e.target.value.trim();if(t){const e=new Image;e.onload=()=>{Qe(t),s&&(s.src=t,s.alt="Background preview"),He()},e.onerror=()=>{s&&(s.src="",s.alt="Failed to load image")},e.src=t}else Qe(""),s&&(s.src="",s.alt="No background"),He()}),o&&o.addEventListener("click",()=>{n&&(n.value=""),t&&(t.value=""),a&&(a.style.display="none"),Qe(""),s&&(s.src="",s.alt="No background"),He()}),We("layoutInvertToggle",e=>{e?document.body.classList.add("flex-direction-invert"):document.body.classList.remove("flex-direction-invert")}),We("hideZapperContentToggle",e=>{e?document.body.classList.add("hide-zapper-content"):document.body.classList.remove("hide-zapper-content")}),We("showTopZappersToggle",e=>{e?(document.body.classList.add("show-top-zappers"),m.length>0&&0===w.length?Le(m):w.length>0?ne():B(!0)):(document.body.classList.remove("show-top-zappers"),se())}),We("podiumToggle",e=>{e?document.body.classList.add("podium-enabled"):document.body.classList.remove("podium-enabled");const t=document.getElementById("zapGridToggle"),n=t?.checked;n?setTimeout(()=>{Te()},10):m.length>0&&Ce(m)}),We("zapGridToggle",e=>{const t=document.getElementById("zaps");if(t){if(t.classList.contains("live-event-two-column"))return;t.classList.toggle("grid-layout",e),e?Te():Pe(),m.length>0&&Ce(m)}}),We("qrInvertToggle",()=>{const e=document.getElementById("qrInvertToggle");[document.getElementById("qrCode"),document.getElementById("qrCodeNevent"),document.getElementById("qrCodeNote")].forEach((t,n)=>{t&&(t.style.filter=e?.checked?"invert(1)":"none")})}),We("qrScreenBlendToggle",()=>{const e=document.getElementById("qrScreenBlendToggle"),t=document.getElementById("qrMultiplyBlendToggle");e?.checked&&(t.checked=!1),Ye()}),We("qrMultiplyBlendToggle",()=>{const e=document.getElementById("qrScreenBlendToggle"),t=document.getElementById("qrMultiplyBlendToggle");t?.checked&&(e.checked=!1),Ye()});const r=document.getElementById("opacitySlider"),i=document.getElementById("opacityValue"),l=document.getElementById("textOpacitySlider"),c=document.getElementById("textOpacityValue");r&&i&&r.addEventListener("input",e=>{const t=parseFloat(e.target.value);i.textContent=`${Math.round(100*t)}%`,Ue(),He()}),l&&c&&l.addEventListener("input",e=>{const t=parseFloat(e.target.value);c.textContent=`${Math.round(100*t)}%`,Ue(),He()}),We("qrShowWebLinkToggle",()=>{"function"==typeof tt&&tt()}),We("qrShowNeventToggle",()=>{"function"==typeof tt&&tt()}),We("qrShowNoteToggle",()=>{"function"==typeof tt&&tt()}),We("lightningToggle",async()=>{if(M.current)try{if(O)await M.current.disableLightning(e)?(R(!1),U("")):console.error("❌ Failed to disable Lightning payments");else{const t=await M.current.enableLightning(e);if(console.log("Lightning service state after enable:",{enabled:M.current.enabled,lnurl:M.current.currentLnurl,loading:M.current.loading,error:M.current.lastError}),t){R(!0);const e=M.current.currentLnurl||"";U(e),e?(e=>{let t=document.getElementById("lightningQRSlide");if(t){const n=t.querySelector("#qrCodeLightning");return void(n&&window.QRious?(n.innerHTML="",new window.QRious({element:n,size:200,value:e})):console.error("❌ QR element not found or QRious not available"))}t=document.createElement("div"),t.id="lightningQRSlide",t.className="swiper-slide",t.innerHTML='\n      <div class="qr-container">\n        <div class="qr-code" id="qrCodeLightning"></div>\n        <div class="qr-label">Lightning Payment</div>\n      </div>\n    ';const n=document.querySelector(".qr-swiper .swiper-wrapper");n?(n.appendChild(t),window.QRious?new window.QRious({element:document.getElementById("qrCodeLightning"),size:200,value:e}):console.error("❌ QRious library not available"),window.lightningQRSlide=t):console.error("❌ Swiper wrapper not found")})(e):console.error("❌ No LNURL received from Lightning service")}else console.error("❌ Failed to enable Lightning payments"),console.error("Error from service:",M.current.lastError)}"function"==typeof tt&&tt()}catch(e){console.error("❌ Error toggling Lightning payments:",e)}else console.error("❌ Lightning service not initialized")});const d=document.getElementById("partnerLogoSelect"),p=(document.getElementById("partnerLogo"),document.getElementById("partnerLogoUrl")),u=document.getElementById("customPartnerLogoGroup"),g=(document.getElementById("partnerLogoPreview"),document.getElementById("clearPartnerLogo"));d&&d.addEventListener("change",()=>{"custom"===d.value?u&&(u.style.display="block"):(u&&(u.style.display="none"),p&&(p.value="")),Ue(),He()}),p&&p.addEventListener("input",()=>{Ue(),He()}),g&&g.addEventListener("click",()=>{d&&(d.value=""),p&&(p.value=""),u&&(u.style.display="none"),Ue(),He()}),Ke(),document.querySelectorAll(".preset-btn").forEach(e=>{e.addEventListener("click",e=>{const t=e.target.getAttribute("data-preset");Xe(t)})});const h=document.getElementById("resetStyles"),y=document.getElementById("copyStyleUrl");h&&h.addEventListener("click",ve),y&&y.addEventListener("click",fe)};let De=null;const Ue=()=>{De&&clearTimeout(De),De=setTimeout(()=>{Ke()},50)},Fe=(e,t,n)=>{const s=document.getElementById(e),o=document.getElementById(t);s&&o&&(s.addEventListener("input",()=>{const e=$e(s.value);o.value=e,Ue(),He()}),o.addEventListener("input",()=>{const e=$e(o.value);s.value=e,Ue(),He()}))},We=(e,t)=>{const n=document.getElementById(e);n&&n.addEventListener("change",()=>{t(n.checked),He()})},$e=e=>{if(e.startsWith("#"))return e;if(e.startsWith("rgb")){const t=e.match(/\d+/g);if(t&&t.length>=3){const e=parseInt(t[0]||"0"),n=parseInt(t[1]||"0"),s=parseInt(t[2]||"0");return`#${e.toString(16).padStart(2,"0")}${n.toString(16).padStart(2,"0")}${s.toString(16).padStart(2,"0")}`}}return"#000000"},Ve=(e,t)=>(e=e.replace("#",""),`rgba(${parseInt(e.substring(0,2),16)}, ${parseInt(e.substring(2,4),16)}, ${parseInt(e.substring(4,6),16)}, ${t})`),Ge=()=>{if(""!==new URLSearchParams(window.location.search).toString())return void we();const e=localStorage.getItem("pubpay-styles");if(e)try{const t=JSON.parse(e);if(t.bgImage||t.backgroundImage,t.textColor){const e=document.getElementById("textColorPicker"),n=document.getElementById("textColorValue");e&&(e.value=t.textColor),n&&(n.value=t.textColor)}const n=t.bgColor||t.backgroundColor;if(n){const e=document.getElementById("bgColorPicker"),t=document.getElementById("bgColorValue");e&&(e.value=n),t&&(t.value=n)}if(void 0!==t.opacity){const e=document.getElementById("opacitySlider"),n=document.getElementById("opacityValue");e&&(e.value=t.opacity.toString()),n&&(n.textContent=`${Math.round(100*t.opacity)}%`)}if(void 0!==t.textOpacity){const e=document.getElementById("textOpacitySlider"),n=document.getElementById("textOpacityValue");e&&(e.value=t.textOpacity.toString()),n&&(n.textContent=`${Math.round(100*t.textOpacity)}%`)}if(void 0!==t.partnerLogo){const e=document.getElementById("partnerLogoSelect"),n=document.getElementById("partnerLogoUrl"),s=document.getElementById("customPartnerLogoGroup");e&&(t.partnerLogo?Array.from(e.options).find(e=>e.value===t.partnerLogo)?(e.value=t.partnerLogo,s&&(s.style.display="none")):(e.value="custom",s&&(s.style.display="block"),n&&(n.value=t.partnerLogo)):(e.value="",s&&(s.style.display="none"),n&&(n.value="")))}const s=t.bgImage||t.backgroundImage;if(void 0!==s){const e=document.getElementById("bgImagePreset"),t=document.getElementById("bgImageUrl"),n=document.getElementById("customBgImageGroup"),o=document.getElementById("bgPresetPreview");e&&(s?(Array.from(e.options).find(e=>e.value===s)?(e.value=s,n&&(n.style.display="none"),t&&(t.value=s)):(e.value="custom",n&&(n.style.display="block"),t&&(t.value=s)),o&&(o.src=s,o.alt="Background preview")):(e.value="",n&&(n.style.display="none"),t&&(t.value=""),o&&(o.src="",o.alt="No background")))}const o={qrShowWebLink:"qrShowWebLinkToggle",qrShowNevent:"qrShowNeventToggle",qrShowNote:"qrShowNoteToggle",qrInvert:"qrInvertToggle",qrScreenBlend:"qrScreenBlendToggle",qrMultiplyBlend:"qrMultiplyBlendToggle",layoutInvert:"layoutInvertToggle",hideZapperContent:"hideZapperContentToggle",showTopZappers:"showTopZappersToggle",podium:"podiumToggle",zapGrid:"zapGridToggle",lightning:"lightningToggle"};["layoutInvertToggle","hideZapperContentToggle","showTopZappersToggle","podiumToggle","zapGridToggle","qrInvertToggle","qrScreenBlendToggle","qrMultiplyBlendToggle","qrShowWebLinkToggle","qrShowNeventToggle","qrShowNoteToggle","lightningToggle"].forEach(e=>{const n=document.getElementById(e),s=Object.keys(o).find(t=>o[t]===e);if(n&&s&&void 0!==t[s]){n.checked=t[s];const o={layoutInvertToggle:e=>{e?document.body.classList.add("flex-direction-invert"):document.body.classList.remove("flex-direction-invert")},hideZapperContentToggle:e=>{e?document.body.classList.add("hide-zapper-content"):document.body.classList.remove("hide-zapper-content")},showTopZappersToggle:e=>{if(e)document.body.classList.add("show-top-zappers");else{document.body.classList.remove("show-top-zappers");const e=document.getElementById("top-zappers-bar");e&&(e.style.display="none")}},podiumToggle:e=>{e?document.body.classList.add("podium-enabled"):document.body.classList.remove("podium-enabled")},zapGridToggle:e=>{const t=document.getElementById("zaps");t&&(e?t.classList.add("grid-layout"):t.classList.remove("grid-layout"))},qrInvertToggle:e=>{[document.getElementById("qrCode"),document.getElementById("qrCodeNevent"),document.getElementById("qrCodeNote")].forEach((t,n)=>{t&&(t.style.filter=e?"invert(1)":"none")})},qrScreenBlendToggle:e=>{Ye()},qrMultiplyBlendToggle:e=>{Ye()},qrShowWebLinkToggle:e=>{},qrShowNeventToggle:e=>{},qrShowNoteToggle:e=>{},lightningToggle:e=>{}}[e];o&&o(t[s])}})}catch(e){console.error("Error loading saved styles:",e)}else{const e=document.getElementById("textColorPicker"),t=document.getElementById("textColorValue"),n=document.getElementById("bgColorPicker"),s=document.getElementById("bgColorValue"),o=document.getElementById("opacitySlider"),a=document.getElementById("opacityValue"),r=document.getElementById("textOpacitySlider"),i=document.getElementById("textOpacityValue"),l="#ffffff",c="#000000",d=1,p=1;e&&(e.value=l),t&&(t.value=l),n&&(n.value=c),s&&(s.value=c),o&&(o.value=d.toString()),a&&(a.textContent=`${Math.round(100*d)}%`),r&&(r.value=p.toString()),i&&(i.textContent=`${Math.round(100*p)}%`)}setTimeout(()=>{Ke(),Ze(),setTimeout(()=>{"function"==typeof tt&&tt(!0)},200)},100)},Ze=()=>{const e=document.getElementById("textColorValue"),t=document.getElementById("bgColorValue"),n=document.getElementById("bgImageUrl"),s=document.getElementById("textOpacitySlider"),o=document.getElementById("opacitySlider"),a=document.getElementById("partnerLogoSelect"),r=document.getElementById("partnerLogoUrl");if(!e||!t)return;const i=e.value,l=t.value,c=n?.value||"",d=parseFloat(s?.value||"1"),p=parseFloat(o?.value||"1"),m="custom"===a?.value?r?.value||"":a?.value||"",u=["layoutInvertToggle","hideZapperContentToggle","showTopZappersToggle","podiumToggle","zapGridToggle","qrInvertToggle","qrScreenBlendToggle","qrMultiplyBlendToggle","qrShowWebLinkToggle","qrShowNeventToggle","qrShowNoteToggle","lightningToggle"],g={};u.forEach(e=>{const t=document.getElementById(e);t&&(g[e]=t.checked)});const h={lightMode:{textColor:"#000000",bgColor:"#ffffff",bgImage:"",textOpacity:1,opacity:1,partnerLogo:"",layoutInvert:!1,hideZapperContent:!1,showTopZappers:!1,podium:!1,zapGrid:!1,qrInvert:!1,qrScreenBlend:!1,qrMultiplyBlend:!1,qrShowWebLink:!1,qrShowNevent:!0,qrShowNote:!1,lightning:!1},darkMode:{textColor:"#ffffff",bgColor:"#000000",bgImage:"",textOpacity:1,opacity:1,partnerLogo:"",layoutInvert:!1,hideZapperContent:!1,showTopZappers:!1,podium:!1,zapGrid:!1,qrInvert:!1,qrScreenBlend:!1,qrMultiplyBlend:!1,qrShowWebLink:!1,qrShowNevent:!0,qrShowNote:!1,lightning:!1},cosmic:{textColor:"#ffffff",bgColor:"#0a0a1a",bgImage:"/images/bitcoin-space.gif",textOpacity:1,opacity:.4,partnerLogo:"",layoutInvert:!1,hideZapperContent:!1,showTopZappers:!1,podium:!0,zapGrid:!1,qrInvert:!1,qrScreenBlend:!0,qrMultiplyBlend:!1,qrShowWebLink:!1,qrShowNevent:!0,qrShowNote:!1,lightning:!1},vibrant:{textColor:"#ffd700",bgColor:"#2d1b69",bgImage:"/images/nostr-ostriches.gif",textOpacity:1,opacity:.6,partnerLogo:"",layoutInvert:!1,hideZapperContent:!1,showTopZappers:!1,podium:!1,zapGrid:!1,qrInvert:!1,qrScreenBlend:!1,qrMultiplyBlend:!1,qrShowWebLink:!1,qrShowNevent:!0,qrShowNote:!1,lightning:!1},electric:{textColor:"#00ffff",bgColor:"#000033",bgImage:"/images/send-zaps.gif",textOpacity:1,opacity:.7,partnerLogo:"",layoutInvert:!1,hideZapperContent:!1,showTopZappers:!1,podium:!1,zapGrid:!1,qrInvert:!1,qrScreenBlend:!0,qrMultiplyBlend:!1,qrShowWebLink:!1,qrShowNevent:!0,qrShowNote:!1,lightning:!1},warm:{textColor:"#8B4513",bgColor:"#FFE4B5",bgImage:"",textOpacity:1,opacity:.9,partnerLogo:"",layoutInvert:!1,hideZapperContent:!1,showTopZappers:!1,podium:!1,zapGrid:!1,qrInvert:!1,qrScreenBlend:!1,qrMultiplyBlend:!1,qrShowWebLink:!1,qrShowNevent:!0,qrShowNote:!1,lightning:!1},adopting:{textColor:"#ffffff",bgColor:"#FF6B35",bgImage:"",textOpacity:1,opacity:.9,partnerLogo:"https://adoptingbitcoin.org/images/AB-logo.svg",layoutInvert:!1,hideZapperContent:!1,showTopZappers:!1,podium:!1,zapGrid:!1,qrInvert:!1,qrScreenBlend:!1,qrMultiplyBlend:!1,qrShowWebLink:!1,qrShowNevent:!0,qrShowNote:!1,lightning:!1},bitcoinConf:{textColor:"#ffffff",bgColor:"#000000",bgImage:"/images/sky.jpg",textOpacity:1,opacity:.7,partnerLogo:"https://cdn.prod.website-files.com/6488b0b0fcd2d95f6b83c9d4/653bd44cf83c3b0498c2e622_bitcoin_conference.svg",layoutInvert:!1,hideZapperContent:!1,showTopZappers:!1,podium:!1,zapGrid:!1,qrInvert:!1,qrScreenBlend:!1,qrMultiplyBlend:!1,qrShowWebLink:!1,qrShowNevent:!0,qrShowNote:!1,lightning:!1}};for(const[e,t]of Object.entries(h)){const n=t.textColor===i&&t.bgColor===l&&t.bgImage===c&&Math.abs(t.textOpacity-d)<.01&&Math.abs(t.opacity-p)<.01&&t.partnerLogo===m;let s=!0;for(const e of u)if(t[e.replace("Toggle","")]!==g[e]){s=!1;break}if(n&&s){document.querySelectorAll(".preset-btn").forEach(e=>e.classList.remove("active"));const t=document.querySelector(`[data-preset="${e}"]`);return void(t&&t.classList.add("active"))}}document.querySelectorAll(".preset-btn").forEach(e=>e.classList.remove("active"))},He=()=>{const e=document.getElementById("textColorValue"),t=document.getElementById("bgColorValue"),n=document.getElementById("opacitySlider"),s=document.getElementById("textOpacitySlider"),o=document.getElementById("partnerLogoSelect"),a=document.getElementById("partnerLogoUrl"),r=document.getElementById("bgImagePreset"),i=document.getElementById("bgImageUrl");if(e&&t&&n&&s){let l="";o&&(l="custom"===o.value&&a?a.value:o.value);let c="";r&&(c="custom"===r.value&&i?i.value:r.value);const d={};[{toggleId:"layoutInvertToggle",propertyName:"layoutInvert"},{toggleId:"hideZapperContentToggle",propertyName:"hideZapperContent"},{toggleId:"showTopZappersToggle",propertyName:"showTopZappers"},{toggleId:"podiumToggle",propertyName:"podium"},{toggleId:"zapGridToggle",propertyName:"zapGrid"},{toggleId:"qrInvertToggle",propertyName:"qrInvert"},{toggleId:"qrScreenBlendToggle",propertyName:"qrScreenBlend"},{toggleId:"qrMultiplyBlendToggle",propertyName:"qrMultiplyBlend"},{toggleId:"qrShowWebLinkToggle",propertyName:"qrShowWebLink"},{toggleId:"qrShowNeventToggle",propertyName:"qrShowNevent"},{toggleId:"qrShowNoteToggle",propertyName:"qrShowNote"},{toggleId:"lightningToggle",propertyName:"lightning"}].forEach(({toggleId:e,propertyName:t})=>{const n=document.getElementById(e);n&&(d[t]=n.checked)});const p={textColor:e.value,bgColor:t.value,textOpacity:parseFloat(s.value),opacity:parseFloat(n.value),partnerLogo:l,bgImage:c,...d};localStorage.setItem("pubpay-styles",JSON.stringify(p))}},Ke=()=>{const e=document.getElementById("textColorValue"),t=document.getElementById("bgColorValue"),n=document.getElementById("opacitySlider"),s=document.getElementById("textOpacitySlider");if(!(e&&t&&n&&s))return void console.error("Style input elements not found:",{textColorElement:e,bgColorElement:t,opacitySlider:n,textOpacitySlider:s});const o=e.value,a=t.value,r=parseFloat(n.value),i=parseFloat(s.value),l=document.querySelector(".main-layout");if(l){const e=Ve(o,i);l.style.setProperty("--text-color",e),l.querySelectorAll("\n        .zaps-header-left h2,\n        .total-label,\n        .total-sats,\n        .total-amount,\n        .zapperName,\n        .zapperMessage,\n        .zapperAmount,\n        .zapperAmountSats,\n        .zapperAmountLabel,\n        .authorName,\n        .noteContent,\n        .qr-slide-title,\n        .qr-slide-label,\n        .zap-author-name,\n        .zap-message,\n        .zap-amount,\n        .zap-amount-sats,\n        .zap-amount-label,\n        .zapperProfile .zapperName,\n        .zapperProfile .zapperMessage,\n        .zapperProfile .zapperAmount,\n        .zapperProfile .zapperAmountSats,\n        .zapperProfile .zapperAmountLabel\n      ").forEach(t=>{t.style.color=e}),l.querySelectorAll("\n        .zap .zapperName,\n        .zap .zapperMessage,\n        .zap .zapperAmount,\n        .zap .zapperAmountSats,\n        .zap .zapperAmountLabel,\n        .zapperProfile .zapperName,\n        .zapperProfile .zapperMessage,\n        .zapperProfile .zapperAmount,\n        .zapperProfile .zapperAmountSats,\n        .zapperProfile .zapperAmountLabel\n      ").forEach(t=>{t.style.color=e});const t=Ve(a,r);l.style.backgroundColor=t;const n=document.getElementById("bgImageUrl");n&&n.value?Qe(n.value):Qe("");const s=document.getElementById("partnerLogoSelect"),c=document.getElementById("partnerLogo"),d=document.getElementById("partnerLogoUrl"),p=document.getElementById("partnerLogoPreview");if(s&&c){let e="";e="custom"===s.value&&d?d.value:s.value,e?(c.src=e,c.style.display="inline-block",p&&(p.src=e,p.alt="Partner logo preview")):(c.style.display="none",c.src="",p&&(p.src="",p.alt="No partner logo"))}}},Je=(e,t)=>{const n=document.querySelector(".main-layout"),s=document.querySelector(".live");if("color"===e){n&&n.style.setProperty("--text-color",t);const e=n?.querySelectorAll("\n        .zaps-header-left h2,\n        .total-label,\n        .total-sats,\n        .total-amount,\n        .zapperName,\n        .zapperMessage,\n        .zapperAmount,\n        .zapperAmountSats,\n        .zapperAmountLabel\n      ");e&&e.forEach(e=>{e.style.color=t})}else if("backgroundColor"===e){const e=document.getElementById("opacitySlider"),s=e?parseFloat(e.value):1,o=Ve(t,s);n&&(n.style.backgroundColor=o)}else s&&s.style.setProperty(`--${e}`,t)},Qe=e=>{const t=document.querySelector(".liveZapOverlay");t&&(e?(t.style.backgroundImage=`url(${e})`,t.style.backgroundSize="cover",t.style.backgroundPosition="center",t.style.backgroundRepeat="no-repeat"):t.style.backgroundImage="")},Ye=()=>{const e=document.getElementById("qrScreenBlendToggle"),t=document.getElementById("qrMultiplyBlendToggle");e?.checked?(t.checked=!1,document.body.classList.add("qr-blend-active"),document.body.classList.remove("qr-multiply-active")):t?.checked?(e.checked=!1,document.body.classList.add("qr-blend-active"),document.body.classList.add("qr-multiply-active")):(document.body.classList.remove("qr-blend-active"),document.body.classList.remove("qr-multiply-active"))},Xe=e=>{const t={lightMode:{textColor:"#000000",bgColor:"#ffffff",bgImage:"",qrInvert:!1,qrScreenBlend:!1,qrMultiplyBlend:!1,qrShowWebLink:!1,qrShowNevent:!0,qrShowNote:!1,layoutInvert:!1,hideZapperContent:!1,showTopZappers:!1,podium:!1,zapGrid:!1,opacity:1,textOpacity:1,partnerLogo:""},darkMode:{textColor:"#ffffff",bgColor:"#000000",bgImage:"",qrInvert:!1,qrScreenBlend:!1,qrMultiplyBlend:!1,qrShowWebLink:!1,qrShowNevent:!0,qrShowNote:!1,layoutInvert:!1,hideZapperContent:!1,showTopZappers:!1,podium:!1,zapGrid:!1,opacity:1,textOpacity:1,partnerLogo:""},pubpay:{textColor:"#ffffff",bgColor:"#ffffff",bgImage:"/images/gradient_color.gif",qrInvert:!0,qrScreenBlend:!0,qrMultiplyBlend:!1,qrShowWebLink:!0,qrShowNevent:!0,qrShowNote:!0,layoutInvert:!1,hideZapperContent:!1,showTopZappers:!1,podium:!1,zapGrid:!1,opacity:0,textOpacity:1,partnerLogo:""},cosmic:{textColor:"#ffffff",bgColor:"#0a0a1a",bgImage:"/images/bitcoin-space.gif",qrInvert:!1,qrScreenBlend:!0,qrMultiplyBlend:!1,qrShowWebLink:!1,qrShowNevent:!0,qrShowNote:!1,layoutInvert:!1,hideZapperContent:!1,showTopZappers:!1,podium:!0,zapGrid:!1,opacity:.4,textOpacity:1,partnerLogo:""},vibrant:{textColor:"#ffd700",bgColor:"#2d1b69",bgImage:"/images/nostr-ostriches.gif",qrInvert:!1,qrScreenBlend:!1,qrMultiplyBlend:!1,qrShowWebLink:!1,qrShowNevent:!0,qrShowNote:!1,layoutInvert:!1,hideZapperContent:!1,showTopZappers:!1,podium:!1,zapGrid:!1,opacity:.6,textOpacity:1,partnerLogo:""},electric:{textColor:"#00ffff",bgColor:"#000033",bgImage:"/images/send-zaps.gif",qrInvert:!1,qrScreenBlend:!0,qrMultiplyBlend:!1,qrShowWebLink:!1,qrShowNevent:!0,qrShowNote:!1,layoutInvert:!1,hideZapperContent:!1,showTopZappers:!1,podium:!1,zapGrid:!1,opacity:.7,textOpacity:1,partnerLogo:""},warm:{textColor:"#ff8c42",bgColor:"#2c1810",bgImage:"/images/bitcoin-sunset.gif",qrInvert:!1,qrScreenBlend:!1,qrMultiplyBlend:!1,qrShowWebLink:!1,qrShowNevent:!0,qrShowNote:!1,layoutInvert:!1,hideZapperContent:!1,showTopZappers:!1,podium:!1,zapGrid:!1,opacity:.8,textOpacity:1,partnerLogo:""},adopting:{textColor:"#eedb5f",bgColor:"#05051f",bgImage:"/images/adopting.webp",qrInvert:!1,qrScreenBlend:!1,qrMultiplyBlend:!1,qrShowWebLink:!1,qrShowNevent:!0,qrShowNote:!1,layoutInvert:!1,hideZapperContent:!1,showTopZappers:!1,podium:!1,zapGrid:!1,opacity:.7,textOpacity:1,partnerLogo:"https://adoptingbitcoin.org/images/AB-logo.svg"},bitcoinConf:{textColor:"#ffffff",bgColor:"#000000",bgImage:"/images/sky.jpg",qrInvert:!1,qrScreenBlend:!1,qrMultiplyBlend:!1,qrShowWebLink:!1,qrShowNevent:!0,qrShowNote:!1,layoutInvert:!1,hideZapperContent:!1,showTopZappers:!1,podium:!1,zapGrid:!1,opacity:.7,textOpacity:1,partnerLogo:"https://cdn.prod.website-files.com/6488b0b0fcd2d95f6b83c9d4/653bd44cf83c3b0498c2e622_bitcoin_conference.svg"}}[e];if(t){const n=document.getElementById("textColorPicker"),s=document.getElementById("bgColorPicker"),o=document.getElementById("textColorValue"),a=document.getElementById("bgColorValue"),r=document.getElementById("textOpacitySlider"),i=document.getElementById("opacitySlider"),l=document.getElementById("textOpacityValue"),c=document.getElementById("opacityValue");n&&(n.value=t.textColor),o&&(o.value=t.textColor),s&&(s.value=t.bgColor),a&&(a.value=t.bgColor),r&&(r.value=t.textOpacity.toString()),i&&(i.value=t.opacity.toString()),l&&(l.textContent=`${Math.round(100*t.textOpacity)}%`),c&&(c.textContent=`${Math.round(100*t.opacity)}%`);const d=document.getElementById("bgImageUrl"),p=document.getElementById("bgImagePreset"),m=document.getElementById("bgPresetPreview"),u=document.getElementById("customUrlGroup");if(d&&(d.value=t.bgImage),p)if(""===t.bgImage)p.value="";else{const e=Array.from(p.options).find(e=>e.value===t.bgImage);p.value=e?t.bgImage:"custom"}if(m&&(m.src=t.bgImage,m.alt=t.bgImage?"Background preview":"No background"),u&&(u.style.display="custom"===p?.value?"block":"none"),["qrInvertToggle","qrScreenBlendToggle","qrMultiplyBlendToggle","qrShowWebLinkToggle","qrShowNeventToggle","qrShowNoteToggle","layoutInvertToggle","hideZapperContentToggle","showTopZappersToggle","zapGridToggle","podiumToggle","lightningToggle"].forEach(e=>{const n=document.getElementById(e);if(n){const s=e.replace("Toggle",""),o=void 0!==t[s]&&t[s];n.checked=o;const a=new Event("change",{bubbles:!0});n.dispatchEvent(a)}}),Ke(),setTimeout(()=>{"function"==typeof tt&&tt()},100),Je("color",t.textColor),Je("backgroundColor",t.bgColor),void 0!==t.partnerLogo){const e=document.getElementById("partnerLogoSelect"),n=document.getElementById("partnerLogoUrl"),s=document.getElementById("customPartnerLogoGroup");e&&(t.partnerLogo?Array.from(e.options).find(e=>e.value===t.partnerLogo)?(e.value=t.partnerLogo,s&&(s.style.display="none")):(e.value="custom",s&&(s.style.display="block"),n&&(n.value=t.partnerLogo)):(e.value="",s&&(s.style.display="none"),n&&(n.value="")))}Ke(),document.querySelectorAll(".preset-btn").forEach(e=>e.classList.remove("active"));const g=document.querySelector(`[data-preset="${e}"]`);g&&g.classList.add("active");const h={textColor:t.textColor,bgColor:t.bgColor,bgImage:t.bgImage,qrInvert:t.qrInvert,qrScreenBlend:t.qrScreenBlend,qrMultiplyBlend:t.qrMultiplyBlend,qrShowWebLink:t.qrShowWebLink,qrShowNevent:t.qrShowNevent,qrShowNote:t.qrShowNote,layoutInvert:t.layoutInvert,hideZapperContent:t.hideZapperContent,showTopZappers:t.showTopZappers,podium:t.podium,zapGrid:t.zapGrid,textOpacity:t.textOpacity,opacity:t.opacity,partnerLogo:t.partnerLogo||""};localStorage.setItem("pubpay-styles",JSON.stringify(h))}};let et=null;const tt=(e=!1)=>{et&&clearTimeout(et),e?nt(e):et=setTimeout(()=>{nt(e)},150)},nt=(e=!1)=>{const t=document.getElementById("qrShowWebLinkToggle"),n=document.getElementById("qrShowNeventToggle"),s=document.getElementById("qrShowNoteToggle"),o=document.getElementById("lightningToggle"),a=t?.checked??!1,r=n?.checked??!0,i=s?.checked??!1,l=o?.checked??!1,c=document.querySelector(".swiper-slide:has(#qrCode)");let d=document.querySelector(".swiper-slide:has(#qrCodeNevent)");const p=document.querySelector(".swiper-slide:has(#qrCodeNote)"),m=document.getElementById("lightningQRSlide");if(!d){const e=document.getElementById("qrCodeNevent");e&&(d=e.closest(".swiper-slide"))}let u=document.getElementById("hiddenSlidesContainer");u||(u=document.createElement("div"),u.id="hiddenSlidesContainer",u.style.display="none",document.body.appendChild(u));const g=document.querySelector(".qr-swiper .swiper-wrapper");if(!g)return;c&&(a?(g.contains(c)||g.appendChild(c),c.style.display="block"):u.appendChild(c)),d&&(r?(g.contains(d)||g.appendChild(d),d.style.display="block"):u.appendChild(d)),p&&(i?(g.contains(p)||g.appendChild(p),p.style.display="block"):u.appendChild(p)),m&&(l?(g.contains(m)||g.appendChild(m),m.style.display="block"):u.appendChild(m));const h=Array.from(g.children).filter(e=>e.classList.contains("swiper-slide")),y=document.querySelector(".qr-swiper");if(y&&h.length>0)if(y.style.display="block",window.qrSwiper)try{window.qrSwiper.update(),1===h.length?(window.qrSwiper.allowTouchMove=!1,window.qrSwiper.autoplay&&window.qrSwiper.autoplay.stop&&window.qrSwiper.autoplay.stop(),rt&&clearInterval(rt)):h.length>1&&(window.qrSwiper.allowTouchMove=!0,window.qrSwiper.autoplay&&(window.qrSwiper.autoplay.params.delay=1e4,window.qrSwiper.autoplay.start&&window.qrSwiper.autoplay.start()))}catch(e){st()}else st();else y&&(y.style.display="none")},st=()=>{window.qrSwiper&&(window.qrSwiper.destroy(!0,!0),window.qrSwiper=null);const e=document.querySelector(".qr-swiper .swiper-wrapper");if(!e)return;const t=Array.from(e.children).filter(e=>e.classList.contains("swiper-slide"));if(0===t.length){const e=document.querySelector(".qr-swiper");return void(e&&(e.style.display="none"))}try{window.qrSwiper=new window.Swiper(".qr-swiper",{loop:t.length>1,autoplay:t.length>1&&{delay:1e4,disableOnInteraction:!1},allowTouchMove:t.length>1,pagination:{el:".swiper-pagination",clickable:!0},on:{init(){const e=this.el||window.qrSwiper?.el;if(!e)return;e.querySelectorAll(".swiper-pagination-bullet").forEach(e=>{e.classList.remove("progress-animating"),e.style.setProperty("--progress","0%")}),it=0,at=null;const t=e.querySelector(".swiper-pagination-bullet-active");t&&(t.classList.add("progress-animating"),lt())},slideChange(){const e=this.el||window.qrSwiper?.el;if(!e)return;e.querySelectorAll(".swiper-pagination-bullet").forEach(e=>{e.style.setProperty("--progress","0%"),e.classList.remove("progress-animating")}),it=0,at=null;const t=e.querySelector(".swiper-pagination-bullet-active");t&&(t.classList.add("progress-animating"),lt())},autoplayStart(){const e=this.el||window.qrSwiper?.el;if(!e)return;e.classList.remove("swiper-paused");const t=e.querySelector(".swiper-pagination-bullet-active");t&&(t.classList.add("progress-animating"),lt())},autoplayStop(){const e=this.el||window.qrSwiper?.el;e&&(e.classList.add("swiper-paused"),rt&&(clearInterval(rt),rt=null))}}}),ct()}catch(e){console.error("Failed to initialize QR Swiper:",e)}};let ot=null,at=null,rt=null,it=0;const lt=()=>{rt&&(clearInterval(rt),rt=null);const e=window.qrSwiper;if(!e?.el)return;const t=e.el.querySelector(".swiper-pagination-bullet-active");if(!t)return;if(!t.classList.contains("progress-animating"))return;t.style.setProperty("--progress","0%"),ot=Date.now(),it=0;const n=e.params?.autoplay?.delay||1e4;rt=setInterval(()=>{const e=Date.now()-(ot||0),s=Math.min(e/n*100,100);t.style.setProperty("--progress",`${s}%`),s>=100&&(clearInterval(rt),rt=null)},16)},ct=()=>{window.qrSwiper?.el&&(window.qrSwiper.el.addEventListener("mouseenter",()=>{if(window.qrSwiper&&window.qrSwiper.autoplay&&window.qrSwiper.autoplay.pause(),rt){clearInterval(rt),rt=null,at=Date.now();const e=window.qrSwiper?.el?.querySelector(".swiper-pagination-bullet-active");if(e){const t=e.style.getPropertyValue("--progress")||"0%";it=parseFloat(t.replace("%",""))}}}),window.qrSwiper.el.addEventListener("mouseleave",()=>{if(at&&ot&&it<100){(()=>{rt&&(clearInterval(rt),rt=null);const e=window.qrSwiper;if(!e?.el)return;const t=e.el.querySelector(".swiper-pagination-bullet-active");if(!t)return;if(!t.classList.contains("progress-animating"))return;const n=e.params?.autoplay?.delay||1e4,s=(100-it)/100*n,o=Date.now();rt=setInterval(()=>{const e=Date.now()-o,n=it+e/s*(100-it),a=Math.min(n,100);t.style.setProperty("--progress",`${a}%`),a>=100&&(clearInterval(rt),rt=null)},16)})();const e=window.qrSwiper?.params?.autoplay?.delay||1e4;setTimeout(()=>{window.qrSwiper&&window.qrSwiper.slideNext&&window.qrSwiper.slideNext()},(100-it)/100*e)}else window.qrSwiper&&window.qrSwiper.autoplay&&window.qrSwiper.autoplay.resume()}))};return{isLoading:t,error:s,noteContent:r,authorName:l,authorImage:d,zaps:m,totalZaps:g,totalAmount:y,handleNoteLoaderSubmit:Me,handleStyleOptionsToggle:()=>{const e=document.getElementById("styleOptionsModal");e&&(e.style.display="none"===e.style.display?"block":"none")},handleStyleOptionsClose:()=>{const e=document.getElementById("styleOptionsModal");e&&(e.classList.remove("show"),document.body.classList.remove("style-panel-open"),setTimeout(()=>{e.style.display="none"},300))},showLoadingError:e=>{const t=document.getElementById("noteLoaderError");t&&(t.textContent=e,t.style.display="block");const n=document.getElementById("noteLoaderContainer"),s=document.getElementById("mainLayout");n&&(n.style.display="flex"),s&&(s.style.display="none")},resetToDefaults:ve,copyStyleUrl:fe,applyStylesFromURL:we,cleanup:()=>{De&&(clearTimeout(De),De=null)}}},_=()=>{const{eventId:e}=(0,r.g)(),[t,n]=(0,o.useState)(!e),[a,i]=(0,o.useState)(!!e),{isLoading:l,error:c,noteContent:d,authorName:p,authorImage:m,zaps:u,totalZaps:g,totalAmount:h,handleNoteLoaderSubmit:y,handleStyleOptionsToggle:v,handleStyleOptionsClose:w,showLoadingError:f,resetToDefaults:b,copyStyleUrl:x}=A(e);return(0,o.useEffect)(()=>{e?(async()=>{await new Promise(e=>{const t=()=>{window.NostrTools?e():setTimeout(t,100)};t()}),(e=>{if(!e)return!1;if(!["note1","nevent1","naddr1","nprofile1"].some(t=>e.startsWith(t)))return!1;try{return window.NostrTools.nip19.decode(e),!0}catch(e){return!1}})(e)?(n(!1),i(!0)):(n(!0),i(!1),setTimeout(()=>{f("Invalid nostr identifier format. Please check the note ID and try again.")},100))})():(n(!0),i(!1))},[e]),(0,o.useEffect)(()=>{const e=()=>{const e=window.location.pathname.split("/"),t=e[e.length-1];t&&"live"!==t?(n(!1),i(!0)):(n(!0),i(!1))},t=e=>{n(!1),i(!0);const t=window.location.pathname.split("/"),s=t[t.length-1];s&&"live"!==s&&(window.history.replaceState({},"",window.location.pathname),window.location.reload())};return window.addEventListener("popstate",e),window.addEventListener("noteLoaderSubmitted",t),()=>{window.removeEventListener("popstate",e),window.removeEventListener("noteLoaderSubmitted",t)}},[]),(0,o.useEffect)(()=>{new Promise(e=>{const t=()=>{window.NostrTools?e():setTimeout(t,100)};t()})},[]),(0,o.useEffect)(()=>(setTimeout(()=>{const e=document.getElementById("styleToggleBtn"),t=document.getElementById("styleOptionsModal"),n=t?.querySelector(".close-button");e&&e.addEventListener("click",e=>{e.preventDefault();const t=document.getElementById("styleOptionsModal");t&&(t.style.display="block",t.classList.add("show"),document.body.classList.add("style-panel-open"))}),n&&n.addEventListener("click",w);const s=document.querySelector(".styleOptionsModalToggle");s&&s.addEventListener("click",()=>{const e=document.getElementById("styleOptionsModal");e&&(e.style.display="block")})},100),()=>{}),[v,w]),(0,s.jsxs)("div",{className:"live",children:[t&&(0,s.jsx)("div",{id:"noteLoaderContainer",children:(0,s.jsxs)("div",{id:"noteLoader",children:[(0,s.jsx)("div",{className:"portrait-swiper",children:(0,s.jsx)("div",{className:"swiper",children:(0,s.jsxs)("div",{className:"swiper-wrapper",children:[(0,s.jsx)("div",{className:"swiper-slide",children:(0,s.jsx)("img",{src:"https://m.primal.net/Majo.jpg",alt:"Max Demarco Vicky El Salvador Chain Duel Party PubPay"})}),(0,s.jsx)("div",{className:"swiper-slide",children:(0,s.jsx)("img",{src:"https://i.nostr.build/itlLMXlxccOBG06L.jpg",alt:"Roger 9000 Adopting Bitcoin After Party PubPay"})}),(0,s.jsx)("div",{className:"swiper-slide",children:(0,s.jsx)("img",{src:"https://r2.primal.net/cache/0/c4/57/0c4571c1e9e51ba2dde56dc3af65726adac4e68299f5a5d3adf9bc09efb67e8f.jpg",alt:"Network School Flute Piano PubPay"})}),(0,s.jsx)("div",{className:"swiper-slide",children:(0,s.jsx)("img",{src:"https://r2.primal.net/cache/6/3e/9f/63e9f4b439c17fd2c88617210cbd91c6c9b1ee2be2d82f47a7085379dd183e3c.jpg",alt:"Network School Flute Piano PubPay"})}),(0,s.jsx)("div",{className:"swiper-slide",children:(0,s.jsx)("img",{src:"https://r2.primal.net/cache/b/f6/bd/bf6bde3a8c8e5568dd8ce9d2d32b31d6d4287281e9cb5650cd28cb740b9bf932.jpg",alt:"PubPay Event"})}),(0,s.jsx)("div",{className:"swiper-slide",children:(0,s.jsx)("img",{src:"https://r2a.primal.net/uploads2/8/af/e3/8afe3c42163ee657479c9d151e92e9058f9116cc05dd71829426e567020ec21e.png",alt:"PubPay Event"})})]})})}),(0,s.jsxs)("div",{className:"note-loader-content",children:[(0,s.jsxs)("div",{className:"app-header",children:[(0,s.jsxs)("h1",{children:[(0,s.jsx)("span",{style:{color:"#4a75ff"},children:"PUB"}),(0,s.jsx)("span",{style:{color:"#000"},children:"PAY"}),(0,s.jsx)("span",{style:{color:"#0000001c"},children:".me"})," ",(0,s.jsx)("span",{style:{color:"#5f5f5f"},children:"Live"})]}),(0,s.jsx)("p",{className:"app-description",children:"Real time tip tracker"})]}),(0,s.jsx)("label",{htmlFor:"note1LoaderInput",children:"Enter note, event, or profile"}),(0,s.jsx)("input",{type:"text",id:"note1LoaderInput",name:"note1LoaderInput",placeholder:"note1abc123... or nevent1xyz789... or naddr1def456... or nprofile1ghi789..."}),(0,s.jsx)("div",{id:"noteLoaderError",className:"error-message",style:{display:"none"}}),(0,s.jsxs)("div",{className:"button-container",children:[(0,s.jsx)("button",{id:"note1LoaderSubmit",className:"button",children:"Load"}),(0,s.jsx)("div",{className:"styleOptionsModalToggle button outline",children:"Style Options"})]}),(0,s.jsxs)("div",{className:"examples-section",children:[(0,s.jsx)("h3",{children:"Examples - Notes, Live Events & Profiles"}),(0,s.jsxs)("div",{className:"example-item",children:[(0,s.jsx)("a",{href:"/live/note16a7m73en9w4artfclcnhqf8jzngepmg2j2et3l2yk0ksfhftv0ls3hugv7",target:"_blank",children:"Zap my set at at Plan B at Adopting Bitcoin after party ⚡️"}),(0,s.jsxs)("div",{className:"author-name",children:[(0,s.jsx)("img",{src:"https://primal.b-cdn.net/media-upload?u=https%3A%2F%2Fmedia.primal.net%2Fuploads%2Fd%2F87%2F9f%2Fd879f18ec704fed0700a3c2befae75b0148822d19166feb9293192279864db82.jpg",alt:"Roger 9000",className:"author-avatar"}),"Roger 9000"]})]}),(0,s.jsxs)("div",{className:"example-item",children:[(0,s.jsx)("a",{href:"/live/note1j8fpjg60gkw266lz86ywmyr2mmy5e6kfkhtfu4umaxneff6qeyhqrl37gu",target:"_blank",children:"Bienvenidos a nuestro querido el salvador 🇸🇻"}),(0,s.jsxs)("div",{className:"author-name",children:[(0,s.jsx)("img",{src:"https://cdn.satellite.earth/080a8d6c0664cd39b386a27f095d6dac8e223a26c69357e3e144da2d54dc39a3.png",alt:"Vicky",className:"author-avatar"}),"Vicky"]})]}),(0,s.jsxs)("div",{className:"example-item",children:[(0,s.jsx)("a",{href:"/live/note1lsreglfs5s5zm6e8ssavaak2adsajkad27axp00rvz734u443znqspwhvv",target:"_blank",children:"The Network School of Rock is Live from Malaysia!"}),(0,s.jsxs)("div",{className:"author-name",children:[(0,s.jsx)("img",{src:"https://m.primal.net/QIbm.jpg",alt:"lucas",className:"author-avatar"}),"lucas"]})]}),(0,s.jsxs)("div",{className:"example-item",children:[(0,s.jsx)("a",{href:"/live/nevent1qqsphk43g2pzpwfr8qcp5zdx8ftgaj7gvxk682y4sedjvscrsm0lpssc96mm3",target:"_blank",children:"Hola Barcelona! Pubpay me at the After Party of Bitcoin Cypher Conference!!!! @BCC 8333"}),(0,s.jsxs)("div",{className:"author-name",children:[(0,s.jsx)("img",{src:"https://i.nostr.build/itlLMXlxccOBG06L.jpg",alt:"Roger 9000",className:"author-avatar"}),"Roger 9000"]})]}),(0,s.jsxs)("div",{className:"example-item",children:[(0,s.jsx)("a",{href:"/live/naddr1qqjr2vehvyenvdtr94nrzetr956rgctr94skvvfs95eryep3x3snwve389nxyqg3waehxw309ahx7um5wgh8w6twv5hsygx0gknt5ymr44ldyyaq0rn3p5jpzkh8y8ymg773a06ytr4wldxz55psgqqqwensuq723w",target:"_blank",children:"NoGood Radio is a 24/7 pirate radio station running on scrap parts and broadcasting from a basement somewhere."}),(0,s.jsxs)("div",{className:"author-name",children:[(0,s.jsx)("img",{src:"https://blossom.nogood.studio/458fee0afeba08618c9b9bea4f77b73d62f480c00dffe60d14b4b6a51045d122.jpg",alt:"NoGood Radio",className:"author-avatar"}),"NoGood Radio"]})]})]}),(0,s.jsx)("div",{className:"note-loader-footer",children:(0,s.jsxs)("div",{className:"footer-links",children:[(0,s.jsx)("a",{href:"https://nostr.com",target:"_blank",className:"footer-link",children:"Follow us"}),(0,s.jsx)("a",{href:"/",className:"footer-link",children:"Powered by PubPay"})]})})]})]})}),a&&(0,s.jsxs)("div",{id:"mainLayout",className:"main-layout",children:[(0,s.jsx)("div",{className:"liveZapOverlay"}),(0,s.jsx)("div",{className:"left-side",children:(0,s.jsxs)("div",{className:"post-info",children:[(0,s.jsx)("h3",{className:"section-label",children:"Note Content"}),(0,s.jsxs)("div",{className:"author-section",children:[(0,s.jsx)("img",{id:"authorNameProfileImg",className:"author-image",src:m||"/images/gradient_color.gif"}),(0,s.jsx)("div",{className:"author-info",children:(0,s.jsx)("div",{id:"authorName",className:"author-name",children:p})})]}),(0,s.jsx)("div",{className:"note-section",children:(0,s.jsx)("div",{id:"noteContent",className:"note-content",children:d||""})}),(0,s.jsx)("div",{className:"qr-section",children:(0,s.jsxs)("div",{className:"swiper qr-swiper",children:[(0,s.jsxs)("div",{className:"swiper-wrapper",children:[(0,s.jsxs)("div",{className:"swiper-slide",children:[(0,s.jsxs)("div",{className:"qr-slide-title",children:["Web ",(0,s.jsx)("span",{className:"qr-data-preview",id:"qrDataPreview1"})]}),(0,s.jsx)("a",{href:"",target:"_blank",id:"qrcodeLinkNostr",children:(0,s.jsx)("img",{id:"qrCode",className:"qr-code"})}),(0,s.jsx)("div",{className:"qr-slide-label",children:"Scan with Camera APP"})]}),(0,s.jsxs)("div",{className:"swiper-slide",children:[(0,s.jsxs)("div",{className:"qr-slide-title",children:["Nostr ",(0,s.jsx)("span",{className:"qr-data-preview",id:"qrDataPreview2"})]}),(0,s.jsx)("a",{href:"",target:"_blank",id:"qrcodeNeventLink",children:(0,s.jsx)("img",{id:"qrCodeNevent",className:"qr-code"})}),(0,s.jsx)("div",{className:"qr-slide-label",children:"Scan with Nostr client"})]}),(0,s.jsxs)("div",{className:"swiper-slide",children:[(0,s.jsxs)("div",{className:"qr-slide-title",children:["Nostr ",(0,s.jsx)("span",{className:"qr-data-preview",id:"qrDataPreview3"})]}),(0,s.jsx)("a",{href:"",target:"_blank",id:"qrcodeNoteLink",children:(0,s.jsx)("img",{id:"qrCodeNote",className:"qr-code"})}),(0,s.jsx)("div",{className:"qr-slide-label",children:"Scan with Nostr client"})]}),(0,s.jsxs)("div",{className:"swiper-slide lightning-qr-slide",id:"lightningQRSlide",style:{display:"none"},children:[(0,s.jsxs)("div",{className:"qr-slide-title",children:["Lightning ",(0,s.jsx)("span",{className:"qr-data-preview",id:"qrDataPreview4"})]}),(0,s.jsx)("a",{href:"",target:"_blank",id:"lightningQRLink",children:(0,s.jsx)("div",{id:"lightningQRCode",className:"qr-code"})}),(0,s.jsx)("div",{className:"qr-slide-label",children:"Scan with Lightning Wallet"})]})]}),(0,s.jsx)("div",{className:"swiper-pagination"})]})})]})}),(0,s.jsxs)("div",{className:"right-side",children:[(0,s.jsxs)("div",{className:"zaps-header",children:[(0,s.jsxs)("div",{className:"zaps-header-left",children:[(0,s.jsx)("span",{className:"total-label",children:"Total:"}),(0,s.jsx)("span",{id:"zappedTotalValue",className:"total-amount",children:h}),(0,s.jsx)("span",{className:"total-sats",children:"sats"}),(0,s.jsx)("span",{className:"zap-count-separator",children:"•"}),(0,s.jsx)("span",{id:"zappedTotalCount",className:"total-count",children:g}),(0,s.jsx)("span",{className:"total-zaps",children:"zaps"})]}),(0,s.jsxs)("div",{className:"zaps-header-right",children:[(0,s.jsx)("button",{id:"styleToggleBtn",className:"style-toggle-btn",children:"⚙️"}),(0,s.jsxs)("div",{className:"powered-by",children:[(0,s.jsx)("img",{id:"partnerLogo",src:"/images/gradient_color.gif",alt:"Partner Logo",style:{display:"none"}}),(0,s.jsx)("a",{href:"https://pubpay.me",target:"_blank",children:(0,s.jsx)("img",{src:"/images/powered_by_white_bg.png"})})]})]})]}),(0,s.jsx)("div",{id:"top-zappers-bar",className:"top-zappers-bar",style:{display:"none"},children:(0,s.jsxs)("div",{className:"top-zappers-list",children:[(0,s.jsxs)("div",{className:"top-zapper",id:"top-zapper-1",children:[(0,s.jsx)("div",{className:"zapper-rank",children:"1"}),(0,s.jsx)("img",{className:"zapper-avatar",src:"/images/gradient_color.gif",alt:"Top Zapper"}),(0,s.jsxs)("div",{className:"zapper-info",children:[(0,s.jsx)("div",{className:"zapper-name",children:"Loading..."}),(0,s.jsx)("div",{className:"zapper-total",children:"0 sats"})]})]}),(0,s.jsxs)("div",{className:"top-zapper",id:"top-zapper-2",children:[(0,s.jsx)("div",{className:"zapper-rank",children:"2"}),(0,s.jsx)("img",{className:"zapper-avatar",src:"/images/gradient_color.gif",alt:"Top Zapper"}),(0,s.jsxs)("div",{className:"zapper-info",children:[(0,s.jsx)("div",{className:"zapper-name",children:"Loading..."}),(0,s.jsx)("div",{className:"zapper-total",children:"0 sats"})]})]}),(0,s.jsxs)("div",{className:"top-zapper",id:"top-zapper-3",children:[(0,s.jsx)("div",{className:"zapper-rank",children:"3"}),(0,s.jsx)("img",{className:"zapper-avatar",src:"/images/gradient_color.gif",alt:"Top Zapper"}),(0,s.jsxs)("div",{className:"zapper-info",children:[(0,s.jsx)("div",{className:"zapper-name",children:"Loading..."}),(0,s.jsx)("div",{className:"zapper-total",children:"0 sats"})]})]}),(0,s.jsxs)("div",{className:"top-zapper",id:"top-zapper-4",children:[(0,s.jsx)("div",{className:"zapper-rank",children:"4"}),(0,s.jsx)("img",{className:"zapper-avatar",src:"/images/gradient_color.gif",alt:"Top Zapper"}),(0,s.jsxs)("div",{className:"zapper-info",children:[(0,s.jsx)("div",{className:"zapper-name",children:"Loading..."}),(0,s.jsx)("div",{className:"zapper-total",children:"0 sats"})]})]}),(0,s.jsxs)("div",{className:"top-zapper",id:"top-zapper-5",children:[(0,s.jsx)("div",{className:"zapper-rank",children:"5"}),(0,s.jsx)("img",{className:"zapper-avatar",src:"/images/gradient_color.gif",alt:"Top Zapper"}),(0,s.jsxs)("div",{className:"zapper-info",children:[(0,s.jsx)("div",{className:"zapper-name",children:"Loading..."}),(0,s.jsx)("div",{className:"zapper-total",children:"0 sats"})]})]})]})}),(0,s.jsx)("div",{className:"zaps-container",children:(0,s.jsx)("div",{id:"zaps",className:"zaps-list"})})]})]}),(0,s.jsx)("div",{id:"styleOptionsModal",children:(0,s.jsxs)("div",{className:"style-options-content",children:[(0,s.jsxs)("div",{className:"style-options-header",children:[(0,s.jsx)("h2",{children:"STYLE OPTIONS"}),(0,s.jsx)("button",{className:"close-button",onClick:w,children:"×"})]}),(0,s.jsxs)("div",{className:"style-options-body",children:[(0,s.jsxs)("div",{className:"style-section",children:[(0,s.jsx)("h3",{className:"section-title",children:"QUICK PRESETS"}),(0,s.jsxs)("div",{className:"presets-container",children:[(0,s.jsx)("button",{className:"preset-btn","data-preset":"lightMode",children:"Light Mode"}),(0,s.jsx)("button",{className:"preset-btn","data-preset":"darkMode",children:"Dark Mode"}),(0,s.jsx)("button",{className:"preset-btn","data-preset":"pubpay",children:"PubPay"}),(0,s.jsx)("button",{className:"preset-btn","data-preset":"cosmic",children:"Cosmic"}),(0,s.jsx)("button",{className:"preset-btn","data-preset":"vibrant",children:"Vibrant"}),(0,s.jsx)("button",{className:"preset-btn","data-preset":"electric",children:"Electric"}),(0,s.jsx)("button",{className:"preset-btn","data-preset":"warm",children:"Warm"}),(0,s.jsx)("button",{className:"preset-btn","data-preset":"adopting",children:"Adopting"}),(0,s.jsx)("button",{className:"preset-btn","data-preset":"bitcoinConf",children:"Bitcoin Conf"})]})]}),(0,s.jsxs)("div",{className:"style-section",children:[(0,s.jsx)("h3",{className:"section-title",children:"COLORS"}),(0,s.jsxs)("div",{className:"colors-container",children:[(0,s.jsxs)("div",{className:"style-option-group",children:[(0,s.jsx)("label",{htmlFor:"textColorPicker",children:"Text Color"}),(0,s.jsxs)("div",{className:"color-picker-container",children:[(0,s.jsx)("input",{type:"color",id:"textColorPicker",defaultValue:"#000000"}),(0,s.jsx)("input",{type:"text",id:"textColorValue",defaultValue:"#000000",placeholder:"#000000"})]})]}),(0,s.jsxs)("div",{className:"style-option-group",children:[(0,s.jsx)("label",{htmlFor:"bgColorPicker",children:"Background Color"}),(0,s.jsxs)("div",{className:"color-picker-container",children:[(0,s.jsx)("input",{type:"color",id:"bgColorPicker",defaultValue:"#ffffff"}),(0,s.jsx)("input",{type:"text",id:"bgColorValue",defaultValue:"#ffffff",placeholder:"#ffffff"})]})]})]}),(0,s.jsxs)("div",{className:"opacity-container",children:[(0,s.jsxs)("div",{className:"style-option-group",children:[(0,s.jsx)("label",{htmlFor:"textOpacitySlider",children:"Text Opacity"}),(0,s.jsxs)("div",{className:"slider-container",children:[(0,s.jsx)("input",{type:"range",id:"textOpacitySlider",min:"0.1",max:"1.0",step:"0.1",defaultValue:"1.0"}),(0,s.jsx)("span",{id:"textOpacityValue",children:"100%"})]})]}),(0,s.jsxs)("div",{className:"style-option-group",children:[(0,s.jsx)("label",{htmlFor:"opacitySlider",children:"Background Opacity"}),(0,s.jsxs)("div",{className:"slider-container",children:[(0,s.jsx)("input",{type:"range",id:"opacitySlider",min:"0.0",max:"1.0",step:"0.1",defaultValue:"1.0"}),(0,s.jsx)("span",{id:"opacityValue",children:"100%"})]})]})]})]}),(0,s.jsxs)("div",{className:"style-section",children:[(0,s.jsx)("h3",{className:"section-title",children:"BACKGROUND"}),(0,s.jsxs)("div",{className:"style-option-group full-width",children:[(0,s.jsx)("label",{htmlFor:"bgImagePreset",children:"Choose Background"}),(0,s.jsxs)("div",{className:"bg-preset-controls",children:[(0,s.jsxs)("div",{className:"preset-inputs",children:[(0,s.jsxs)("select",{id:"bgImagePreset",className:"bg-preset-select",children:[(0,s.jsx)("option",{value:"",children:"No Background (Default)"}),(0,s.jsx)("option",{value:"/images/gradient_color.gif",children:"Gradient Color"}),(0,s.jsx)("option",{value:"/images/adopting.webp",children:"Adopting Bitcoin"}),(0,s.jsx)("option",{value:"/images/sky.jpg",children:"Sky"}),(0,s.jsx)("option",{value:"/images/lightning.gif",children:"Lightning"}),(0,s.jsx)("option",{value:"/images/bitcoin-rocket.gif",children:"Bitcoin Rocket"}),(0,s.jsx)("option",{value:"/images/bitcoin-astronaut.gif",children:"Bitcoin Astronaut"}),(0,s.jsx)("option",{value:"/images/bitcoin-space.gif",children:"Bitcoin Space"}),(0,s.jsx)("option",{value:"/images/bitcoin-sunset.gif",children:"Bitcoin Sunset"}),(0,s.jsx)("option",{value:"/images/bitcoin-rotating.gif",children:"Bitcoin Rotating"}),(0,s.jsx)("option",{value:"/images/nostr-ostriches.gif",children:"Nostr Ostriches"}),(0,s.jsx)("option",{value:"/images/send-zaps.gif",children:"Send Zaps"}),(0,s.jsx)("option",{value:"/images/gm-nostr.gif",children:"GM Nostr"}),(0,s.jsx)("option",{value:"custom",children:"Custom URL"})]}),(0,s.jsxs)("div",{className:"url-input-container",id:"customUrlGroup",style:{display:"none"},children:[(0,s.jsx)("input",{type:"text",id:"bgImageUrl",defaultValue:"",placeholder:"Enter image URL"}),(0,s.jsx)("button",{id:"clearBgImage",className:"clear-button",children:"Clear"})]})]}),(0,s.jsx)("div",{className:"preset-preview-container",children:(0,s.jsx)("img",{id:"bgPresetPreview",src:"/images/gradient_color.gif",alt:"No background"})})]})]})]}),(0,s.jsxs)("div",{className:"style-section",children:[(0,s.jsx)("h3",{className:"section-title",children:"PARTNER LOGO"}),(0,s.jsxs)("div",{className:"style-option-group full-width",children:[(0,s.jsx)("label",{htmlFor:"partnerLogoSelect",children:"Partner Logo"}),(0,s.jsxs)("div",{className:"partner-logo-controls",children:[(0,s.jsxs)("div",{className:"preset-inputs",children:[(0,s.jsxs)("select",{id:"partnerLogoSelect",className:"partner-logo-select",children:[(0,s.jsx)("option",{value:"",children:"None (Default)"}),(0,s.jsx)("option",{value:"https://adoptingbitcoin.org/images/AB-logo.svg",children:"Adopting Bitcoin"}),(0,s.jsx)("option",{value:"https://cdn.prod.website-files.com/6488b0b0fcd2d95f6b83c9d4/653bd44cf83c3b0498c2e622_bitcoin_conference.svg",children:"Bitcoin Conference"}),(0,s.jsx)("option",{value:"custom",children:"Custom URL"})]}),(0,s.jsxs)("div",{className:"url-input-container",id:"customPartnerLogoGroup",style:{display:"none"},children:[(0,s.jsx)("input",{type:"text",id:"partnerLogoUrl",defaultValue:"",placeholder:"Enter logo URL"}),(0,s.jsx)("button",{id:"clearPartnerLogo",className:"clear-button",children:"Clear"})]})]}),(0,s.jsx)("div",{className:"preset-preview-container",children:(0,s.jsx)("img",{id:"partnerLogoPreview",src:"/images/gradient_color.gif",alt:"No partner logo",style:{height:"30px",maxWidth:"100px",objectFit:"contain"}})})]})]})]}),(0,s.jsxs)("div",{className:"style-section",children:[(0,s.jsx)("h3",{className:"section-title",children:"LAYOUT"}),(0,s.jsxs)("div",{className:"toggles-container",children:[(0,s.jsx)("div",{className:"style-option-group toggle-group",children:(0,s.jsxs)("label",{className:"toggle-label",children:[(0,s.jsxs)("div",{className:"toggle-switch",children:[(0,s.jsx)("input",{type:"checkbox",id:"layoutInvertToggle"}),(0,s.jsx)("span",{className:"toggle-slider"})]}),(0,s.jsx)("span",{children:"Invert Layout"})]})}),(0,s.jsx)("div",{className:"style-option-group toggle-group",children:(0,s.jsxs)("label",{className:"toggle-label",children:[(0,s.jsxs)("div",{className:"toggle-switch",children:[(0,s.jsx)("input",{type:"checkbox",id:"hideZapperContentToggle"}),(0,s.jsx)("span",{className:"toggle-slider"})]}),(0,s.jsx)("span",{children:"Hide Zapper Content"})]})}),(0,s.jsx)("div",{className:"style-option-group toggle-group",children:(0,s.jsxs)("label",{className:"toggle-label",children:[(0,s.jsxs)("div",{className:"toggle-switch",children:[(0,s.jsx)("input",{type:"checkbox",id:"showTopZappersToggle"}),(0,s.jsx)("span",{className:"toggle-slider"})]}),(0,s.jsx)("span",{children:"Show All Time Zappers"})]})}),(0,s.jsx)("div",{className:"style-option-group toggle-group",children:(0,s.jsxs)("label",{className:"toggle-label",children:[(0,s.jsxs)("div",{className:"toggle-switch",children:[(0,s.jsx)("input",{type:"checkbox",id:"podiumToggle"}),(0,s.jsx)("span",{className:"toggle-slider"})]}),(0,s.jsx)("span",{children:"Top 3 Podium"})]})}),(0,s.jsx)("div",{className:"style-option-group toggle-group",children:(0,s.jsxs)("label",{className:"toggle-label",children:[(0,s.jsxs)("div",{className:"toggle-switch",children:[(0,s.jsx)("input",{type:"checkbox",id:"zapGridToggle"}),(0,s.jsx)("span",{className:"toggle-slider"})]}),(0,s.jsx)("span",{children:"Grid Layout"})]})})]})]}),(0,s.jsxs)("div",{className:"style-section",children:[(0,s.jsx)("h3",{className:"section-title",children:"QR CODE EFFECTS"}),(0,s.jsxs)("div",{className:"toggles-container",children:[(0,s.jsx)("div",{className:"style-option-group toggle-group",children:(0,s.jsxs)("label",{className:"toggle-label",children:[(0,s.jsxs)("div",{className:"toggle-switch",children:[(0,s.jsx)("input",{type:"checkbox",id:"qrInvertToggle"}),(0,s.jsx)("span",{className:"toggle-slider"})]}),(0,s.jsx)("span",{children:"Invert QR Code"})]})}),(0,s.jsx)("div",{className:"style-option-group toggle-group",children:(0,s.jsxs)("label",{className:"toggle-label",children:[(0,s.jsxs)("div",{className:"toggle-switch",children:[(0,s.jsx)("input",{type:"checkbox",id:"qrScreenBlendToggle"}),(0,s.jsx)("span",{className:"toggle-slider"})]}),(0,s.jsx)("span",{children:"Screen Blend Mode"})]})}),(0,s.jsx)("div",{className:"style-option-group toggle-group",children:(0,s.jsxs)("label",{className:"toggle-label",children:[(0,s.jsxs)("div",{className:"toggle-switch",children:[(0,s.jsx)("input",{type:"checkbox",id:"qrMultiplyBlendToggle"}),(0,s.jsx)("span",{className:"toggle-slider"})]}),(0,s.jsx)("span",{children:"Multiply Blend Mode"})]})})]})]}),(0,s.jsxs)("div",{className:"style-section",children:[(0,s.jsx)("h3",{className:"section-title",children:"QR SLIDE VISIBILITY"}),(0,s.jsxs)("div",{className:"toggles-container",children:[(0,s.jsx)("div",{className:"style-option-group toggle-group",children:(0,s.jsxs)("label",{className:"toggle-label",children:[(0,s.jsxs)("div",{className:"toggle-switch",children:[(0,s.jsx)("input",{type:"checkbox",id:"qrShowWebLinkToggle"}),(0,s.jsx)("span",{className:"toggle-slider"})]}),(0,s.jsx)("span",{children:"Show Web Link"})]})}),(0,s.jsx)("div",{className:"style-option-group toggle-group",children:(0,s.jsxs)("label",{className:"toggle-label",children:[(0,s.jsxs)("div",{className:"toggle-switch",children:[(0,s.jsx)("input",{type:"checkbox",id:"qrShowNeventToggle"}),(0,s.jsx)("span",{className:"toggle-slider"})]}),(0,s.jsx)("span",{children:"Show Nostr Event"})]})}),(0,s.jsx)("div",{className:"style-option-group toggle-group",children:(0,s.jsxs)("label",{className:"toggle-label",children:[(0,s.jsxs)("div",{className:"toggle-switch",children:[(0,s.jsx)("input",{type:"checkbox",id:"qrShowNoteToggle"}),(0,s.jsx)("span",{className:"toggle-slider"})]}),(0,s.jsx)("span",{children:"Show Note ID"})]})}),(0,s.jsx)("div",{className:"style-option-group toggle-group",children:(0,s.jsxs)("label",{className:"toggle-label",children:[(0,s.jsxs)("div",{className:"toggle-switch",children:[(0,s.jsx)("input",{type:"checkbox",id:"lightningToggle"}),(0,s.jsx)("span",{className:"toggle-slider"})]}),(0,s.jsx)("span",{children:"Enable Lightning Payments"})]})})]}),(0,s.jsx)("div",{className:"lightning-status-container",id:"lightningStatusContainer",style:{display:"none"},children:(0,s.jsx)("div",{className:"payment-status",id:"paymentStatus"})})]})]}),(0,s.jsxs)("div",{className:"style-actions",children:[(0,s.jsx)("button",{id:"resetStyles",className:"action-btn secondary",onClick:b,children:"Reset"}),(0,s.jsx)("button",{id:"copyStyleUrl",className:"action-btn primary",onClick:x,children:"Copy Style URL"})]})]})})]})},B=()=>{const[e,t]=(0,o.useState)(!0),[n,a]=(0,o.useState)(!1),{isLoading:r,error:i,noteContent:l,authorName:c,authorImage:d,queue:p,currentTrack:m,isPlaying:u,queueCount:g,playedCount:h,handleJukeboxSubmit:y,handleStyleOptionsToggle:v,handleStyleOptionsClose:w,handleSkipSong:f}=(()=>{const[e,t]=(0,o.useState)(!1),[n,s]=(0,o.useState)(null),[a,r]=(0,o.useState)(""),[i,l]=(0,o.useState)("Author"),[c,d]=(0,o.useState)("/images/gradient_color.gif"),[p,m]=(0,o.useState)([]),[u,g]=(0,o.useState)(null),[h,y]=(0,o.useState)(!1),[v,w]=(0,o.useState)(0),[f,b]=(0,o.useState)(0);(0,o.useRef)(null),(0,o.useEffect)(()=>{(async()=>{try{t(!0),s(null),"undefined"!=typeof window&&window.YT&&window.YT.ready(()=>{console.log("YouTube API ready")}),t(!1)}catch(e){s(e instanceof Error?e.message:"Failed to initialize jukebox functionality"),t(!1)}})()},[]);const x=e=>!!e&&["note1","nevent1","naddr1","nprofile1"].some(t=>e.startsWith(t)),N=async()=>{try{console.log("Initializing jukebox..."),w(0),b(0),m([]),g(null),y(!1)}catch(e){throw new Error("Failed to initialize jukebox")}};return{isLoading:e,error:n,noteContent:a,authorName:i,authorImage:c,queue:p,currentTrack:u,isPlaying:h,queueCount:v,playedCount:f,handleJukeboxSubmit:async()=>{const e=document.getElementById("note1LoaderInput"),t=e?.value?.trim();t&&await(async e=>{try{if(!x(e))throw new Error("Invalid note ID format");r("Jukebox content will be loaded here"),l("Jukebox Author"),await N()}catch(e){s(e instanceof Error?e.message:"Failed to load jukebox content")}})(t)},handleStyleOptionsToggle:()=>{const e=document.getElementById("styleOptionsModal");e&&(e.style.display="none"===e.style.display?"block":"none")},handleStyleOptionsClose:()=>{const e=document.getElementById("styleOptionsModal");e&&(e.style.display="none")},handleSkipSong:()=>{console.log("Skipping song...")}}})(),b=()=>{t(!1),a(!0)};return(0,o.useEffect)(()=>{const e=document.getElementById("note1LoaderSubmit"),t=document.getElementById("styleToggleBtn"),n=document.getElementById("styleOptionsModal"),s=n?.querySelector(".close-button"),o=document.getElementById("skipSong");return e&&e.addEventListener("click",()=>{y(),b()}),t&&t.addEventListener("click",v),s&&s.addEventListener("click",w),o&&o.addEventListener("click",f),()=>{e&&e.removeEventListener("click",y),t&&t.removeEventListener("click",v),s&&s.removeEventListener("click",w),o&&o.removeEventListener("click",f)}},[y,v,w,f]),(0,s.jsxs)("div",{className:"jukebox",children:[e&&(0,s.jsx)("div",{id:"noteLoaderContainer",children:(0,s.jsxs)("div",{id:"noteLoader",children:[(0,s.jsxs)("div",{className:"app-header",children:[(0,s.jsx)("h1",{children:"🎵 PUBPAY Jukebox"}),(0,s.jsx)("p",{className:"app-description",children:"Competitive YouTube Music Queue powered by Nostr zaps"}),(0,s.jsxs)("div",{className:"viral-features",children:[(0,s.jsx)("span",{className:"feature-badge",children:"🔥 Zap to compete"}),(0,s.jsx)("span",{className:"feature-badge",children:"🎯 Higher zaps = priority"}),(0,s.jsx)("span",{className:"feature-badge",children:"⚡ Lightning fast"})]})]}),(0,s.jsxs)("div",{className:"note-input-section",children:[(0,s.jsx)("label",{htmlFor:"note1LoaderInput",children:"Enter a Nostr post ID to create your jukebox:"}),(0,s.jsx)("br",{}),(0,s.jsx)("input",{type:"text",id:"note1LoaderInput",name:"note1LoaderInput",value:"",placeholder:"note16a..."}),(0,s.jsx)("br",{}),(0,s.jsx)("button",{id:"note1LoaderSubmit",className:"button primary-button",onClick:b,children:"🚀 Launch Jukebox"})]}),(0,s.jsxs)("div",{className:"how-it-works",children:[(0,s.jsx)("h3",{children:"🎯 How it works"}),(0,s.jsxs)("div",{className:"steps",children:[(0,s.jsxs)("div",{className:"step",children:[(0,s.jsx)("div",{className:"step-number",children:"1"}),(0,s.jsx)("div",{className:"step-text",children:"Load a Nostr post to create your jukebox"})]}),(0,s.jsxs)("div",{className:"step",children:[(0,s.jsx)("div",{className:"step-number",children:"2"}),(0,s.jsx)("div",{className:"step-text",children:"People scan QR code and zap with song requests"})]}),(0,s.jsxs)("div",{className:"step",children:[(0,s.jsx)("div",{className:"step-number",children:"3"}),(0,s.jsx)("div",{className:"step-text",children:"Higher zaps get priority in the queue"})]}),(0,s.jsxs)("div",{className:"step",children:[(0,s.jsx)("div",{className:"step-number",children:"4"}),(0,s.jsx)("div",{className:"step-text",children:"Songs automatically play in priority order"})]})]})]}),(0,s.jsxs)("div",{className:"examples-section",children:[(0,s.jsx)("h3",{children:"💡 Examples"}),(0,s.jsx)("p",{children:"Zap with a YouTube URL or video ID in your comment:"}),(0,s.jsxs)("div",{className:"example-comments",children:[(0,s.jsx)("div",{className:"example-comment",children:'"https://youtube.com/watch?v=dQw4w9WgXcQ"'}),(0,s.jsx)("div",{className:"example-comment",children:'"https://youtu.be/dQw4w9WgXcQ"'}),(0,s.jsx)("div",{className:"example-comment",children:'"dQw4w9WgXcQ"'})]}),(0,s.jsx)("p",{className:"example-note",children:"⚠️ Only YouTube URLs and video IDs are accepted. General search terms are not supported."})]}),(0,s.jsx)("div",{className:"styleOptionsModalToggle button secondary-button",children:"⚙️ Style Options"})]})}),n&&(0,s.jsxs)("div",{id:"mainLayout",className:"main-layout jukebox-layout",children:[(0,s.jsx)("div",{className:"liveZapOverlay"}),(0,s.jsx)("div",{className:"left-side",children:(0,s.jsxs)("div",{className:"post-info",children:[(0,s.jsx)("h3",{className:"section-label",children:"🎵 Jukebox Post"}),(0,s.jsxs)("div",{className:"author-section",children:[(0,s.jsx)("img",{id:"authorNameProfileImg",className:"author-image",src:d}),(0,s.jsx)("div",{className:"author-info",children:(0,s.jsx)("div",{id:"authorName",className:"author-name",children:c})})]}),(0,s.jsx)("div",{className:"note-section",children:(0,s.jsx)("div",{id:"noteContent",className:"note-content",children:l||"Note content will be populated here"})}),(0,s.jsxs)("div",{className:"qr-section",children:[(0,s.jsx)("a",{href:"",target:"_blank",id:"qrcodeLinkNostr",children:(0,s.jsx)("img",{id:"qrCode",className:"qr-code"})}),(0,s.jsx)("div",{className:"qr-instructions",children:"📱 Scan to zap and request songs"}),(0,s.jsxs)("div",{className:"qr-stats",children:[(0,s.jsxs)("div",{className:"stat-item",children:[(0,s.jsx)("span",{className:"stat-label",children:"Queue:"}),(0,s.jsx)("span",{id:"queueCount",className:"stat-value",children:g})]}),(0,s.jsxs)("div",{className:"stat-item",children:[(0,s.jsx)("span",{className:"stat-label",children:"Played:"}),(0,s.jsx)("span",{id:"playedCount",className:"stat-value",children:h})]})]})]})]})}),(0,s.jsx)("div",{className:"center-side",children:(0,s.jsxs)("div",{className:"currently-playing",children:[(0,s.jsxs)("h3",{className:"section-label",children:["🎵 Now Playing",(0,s.jsxs)("div",{className:"zaps-header-right",children:[(0,s.jsx)("button",{id:"styleToggleBtn",className:"style-toggle-btn",children:"⚙️"}),(0,s.jsx)("div",{className:"powered-by",children:(0,s.jsx)("img",{src:"/images/powered_by_white_bg.png"})})]})]}),(0,s.jsx)("div",{id:"currentVideo",className:"video-container",children:(0,s.jsxs)("div",{className:"no-video-message",children:[(0,s.jsx)("div",{className:"no-video-icon",children:"🎵"}),(0,s.jsx)("div",{className:"no-video-text",children:"No song playing yet"}),(0,s.jsx)("div",{className:"no-video-subtext",children:"Zap with a YouTube URL or video ID to request a song!"}),(0,s.jsxs)("div",{className:"no-video-examples",children:[(0,s.jsx)("div",{className:"example-item",children:"📺 youtube.com/watch?v=VIDEO_ID"}),(0,s.jsx)("div",{className:"example-item",children:"🔗 youtu.be/VIDEO_ID"}),(0,s.jsx)("div",{className:"example-item",children:"🎯 Just the video ID (11 characters)"})]})]})}),(0,s.jsxs)("div",{id:"videoProgressContainer",className:"video-progress-container",style:{display:"none"},children:[(0,s.jsx)("div",{className:"progress-bar",children:(0,s.jsx)("div",{id:"videoProgressBar",className:"progress-fill"})}),(0,s.jsxs)("div",{className:"progress-time",children:[(0,s.jsx)("span",{id:"currentTime",children:"0:00"})," / ",(0,s.jsx)("span",{id:"totalTime",children:"0:00"})]})]}),(0,s.jsx)("div",{id:"currentSongInfo",className:"song-info"}),(0,s.jsx)("div",{className:"player-controls",children:(0,s.jsx)("button",{id:"skipSong",className:"control-button skip-button",disabled:!0,children:"⏭️ Skip Song"})})]})}),(0,s.jsxs)("div",{className:"right-side",children:[(0,s.jsxs)("div",{className:"queue-section",children:[(0,s.jsx)("h3",{className:"section-label",children:"📋 Next Up (Queue)"}),(0,s.jsxs)("div",{id:"queueStats",className:"queue-stats",children:[(0,s.jsx)("span",{className:"queue-count",children:"0 songs in queue"}),(0,s.jsx)("span",{className:"queue-total",children:"Total: 0 sats"})]}),(0,s.jsx)("div",{id:"songQueue",className:"song-queue"})]}),(0,s.jsxs)("div",{className:"history-section",children:[(0,s.jsx)("h3",{className:"section-label",children:"📚 Recently Played"}),(0,s.jsx)("div",{id:"playedSongs",className:"played-songs"})]})]})]}),(0,s.jsx)("div",{id:"styleOptionsModal",children:(0,s.jsxs)("div",{className:"style-options-content",children:[(0,s.jsxs)("div",{className:"style-options-header",children:[(0,s.jsx)("h2",{children:"Style Options"}),(0,s.jsx)("button",{className:"close-button",children:"×"})]}),(0,s.jsx)("div",{className:"style-options-body",children:(0,s.jsx)("p",{children:"Style options will be implemented here"})})]})})]})},M=()=>(0,s.jsx)("div",{className:"overlayContainer",style:{display:"block"},children:(0,s.jsxs)("div",{className:"overlayInner",children:[(0,s.jsxs)("div",{className:"brand",children:["PUB",(0,s.jsx)("span",{style:{color:"#cecece"},children:"PAY"}),(0,s.jsx)("span",{style:{color:"#00000014"},children:".me"})]}),(0,s.jsx)("h2",{children:"404 - Page Not Found"}),(0,s.jsx)("p",{children:"The page you're looking for doesn't exist."}),(0,s.jsxs)("div",{style:{marginTop:"2rem"},children:[(0,s.jsx)(r.N_,{to:"/",className:"cta",style:{marginRight:"1rem"},children:"Go Home"}),(0,s.jsx)(r.N_,{to:"/live",className:"cta",style:{marginRight:"1rem"},children:"Live Display"}),(0,s.jsx)(r.N_,{to:"/jukebox",className:"cta",children:"Jukebox"})]})]})}),O=document.getElementById("root");if(!O)throw new Error("Root element not found");(0,a.createRoot)(O).render((0,s.jsx)(o.StrictMode,{children:(0,s.jsx)(r.Kd,{children:(0,s.jsx)(()=>(0,s.jsxs)(r.BV,{children:[(0,s.jsx)(r.qh,{path:"/",element:(0,s.jsx)(g,{})}),(0,s.jsx)(r.qh,{path:"/live",element:(0,s.jsx)(_,{})}),(0,s.jsx)(r.qh,{path:"/live/:eventId",element:(0,s.jsx)(_,{})}),(0,s.jsx)(r.qh,{path:"/jukebox",element:(0,s.jsx)(B,{})}),(0,s.jsx)(r.qh,{path:"/404",element:(0,s.jsx)(M,{})}),(0,s.jsx)(r.qh,{path:"*",element:(0,s.jsx)(r.C5,{to:"/404",replace:!0})})]}),{})})}))}},n={};function s(e){var o=n[e];if(void 0!==o)return o.exports;var a=n[e]={exports:{}};return t[e](a,a.exports,s),a.exports}s.m=t,e=[],s.O=(t,n,o,a)=>{if(!n){var r=1/0;for(d=0;d<e.length;d++){for(var[n,o,a]=e[d],i=!0,l=0;l<n.length;l++)(!1&a||r>=a)&&Object.keys(s.O).every(e=>s.O[e](n[l]))?n.splice(l--,1):(i=!1,a<r&&(r=a));if(i){e.splice(d--,1);var c=o();void 0!==c&&(t=c)}}return t}a=a||0;for(var d=e.length;d>0&&e[d-1][2]>a;d--)e[d]=e[d-1];e[d]=[n,o,a]},s.d=(e,t)=>{for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={792:0};s.O.j=t=>0===e[t];var t=(t,n)=>{var o,a,[r,i,l]=n,c=0;if(r.some(t=>0!==e[t])){for(o in i)s.o(i,o)&&(s.m[o]=i[o]);if(l)var d=l(s)}for(t&&t(n);c<r.length;c++)a=r[c],s.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return s.O(d)},n=self.webpackChunkpubpay=self.webpackChunkpubpay||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var o=s.O(void 0,[96],()=>s(576));o=s.O(o)})();