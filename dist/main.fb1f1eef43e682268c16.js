(()=>{"use strict";var e,t={212:(e,t,n)=>{var o=n(848),s=n(540),l=n(338),a=n(322);const i=()=>{const[e,t]=(0,s.useState)(!1),[n,l]=(0,s.useState)(!1),[a,i]=(0,s.useState)(!1),[r,c]=(0,s.useState)(!1),[d,p]=(0,s.useState)(!1),[g,u]=(0,s.useState)(!1),{isLoading:m,error:h,activeFeed:y,posts:v,isLoggedIn:w,userProfile:b,handleFeedChange:f,handleQRScanner:x,handleLogin:N,handleNewPayNote:S,handleSignInExtension:I,handleSignInExternalSigner:j,handleSignInNsec:k,handleContinueWithNsec:L,handleLogout:E,handlePayWithExtension:q,handlePayWithWallet:C,handleCopyInvoice:B,handlePostNote:z}=(()=>{const[e,t]=(0,s.useState)(!1),[n,o]=(0,s.useState)(null),[l,a]=(0,s.useState)("global"),[i,r]=(0,s.useState)([]),[c,d]=(0,s.useState)(!1),[p,g]=(0,s.useState)(null);(0,s.useRef)(null),(0,s.useEffect)(()=>{(async()=>{try{t(!0),o(null),"undefined"!=typeof window&&window.Html5QrcodeScanner&&console.log("QR Scanner available"),await u("global"),t(!1)}catch(e){o(e instanceof Error?e.message:"Failed to initialize home functionality"),t(!1)}})()},[]);const u=async e=>{try{console.log("Loading posts for feed:",e),r([])}catch(e){o(e instanceof Error?e.message:"Failed to load posts")}};return{isLoading:e,error:n,activeFeed:l,posts:i,isLoggedIn:c,userProfile:p,handleFeedChange:e=>{a(e),u(e)},handleQRScanner:()=>{console.log("Opening QR scanner...")},handleLogin:()=>{console.log("Opening login form...")},handleNewPayNote:()=>{console.log("Opening new pay note form...")},handleSignInExtension:()=>{console.log("Signing in with extension...")},handleSignInExternalSigner:()=>{console.log("Signing in with external signer...")},handleSignInNsec:()=>{console.log("Signing in with nsec...")},handleContinueWithNsec:()=>{console.log("Continuing with nsec...")},handleLogout:()=>{console.log("Logging out..."),d(!1),g(null)},handlePayWithExtension:()=>{console.log("Paying with extension...")},handlePayWithWallet:()=>{console.log("Paying with wallet...")},handleCopyInvoice:()=>{console.log("Copying invoice...")},handlePostNote:()=>{console.log("Posting note...")}}})();return(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{id:"nav",children:(0,o.jsxs)("div",{id:"navInner",children:[(0,o.jsxs)("a",{id:"logo",href:"/",children:["PUB",(0,o.jsx)("span",{style:{color:"#000"},children:"PAY"}),(0,o.jsx)("span",{style:{color:"#0000001c"},children:".me"}),(0,o.jsx)("span",{className:"version",children:"alpha 0.02"})]}),(0,o.jsxs)("div",{id:"navActions",children:[(0,o.jsx)("a",{id:"scanQrCode",className:"topAction",title:"Scan QR Code",onClick:()=>{x(),t(!0)},children:(0,o.jsx)("span",{className:"material-symbols-outlined",children:"photo_camera"})}),(0,o.jsx)("a",{id:"settings",href:"#",style:{display:"none"},className:"topAction disabled",title:"coming soon",children:(0,o.jsx)("span",{className:"material-symbols-outlined",children:"settings"})}),(0,o.jsx)("a",{id:"login",href:"#",className:"topAction",onClick:()=>{N(),l(!0)},children:(0,o.jsx)("span",{className:"material-symbols-outlined",children:"account_circle"})}),(0,o.jsxs)("a",{id:"newPayNote",className:"cta",href:"#",onClick:()=>{S(),u(!0)},children:["New ",(0,o.jsx)("span",{className:"hideOnMobile",children:"Paynote"})]})]})]})}),(0,o.jsxs)("div",{id:"container",children:[(0,o.jsxs)("div",{id:"feedSelector",children:[(0,o.jsx)("a",{href:"#",id:"feedGlobal",className:"feedSelectorLink "+("global"===y?"active":""),onClick:()=>f("global"),children:"Global"}),(0,o.jsx)("a",{href:"#",id:"feedFollowing",className:"feedSelectorLink "+("following"===y?"active":""),onClick:()=>f("following"),children:"Following"}),(0,o.jsx)("a",{href:"#",className:"feedSelectorLink disabled",title:"coming soon",children:"High Rollers"})]}),(0,o.jsx)("div",{id:"main",style:{display:"global"===y?"block":"none"}}),(0,o.jsx)("div",{id:"following",style:{display:"following"===y?"block":"none"}})]}),(0,o.jsx)("div",{className:"overlayContainer",id:"qrScanner",style:{display:e?"block":"none"},children:(0,o.jsxs)("div",{className:"overlayInner",children:[(0,o.jsxs)("div",{className:"brand",children:["PUB",(0,o.jsx)("span",{style:{color:"#cecece"},children:"PAY"}),(0,o.jsx)("span",{style:{color:"#00000014"},children:".me"})]}),(0,o.jsx)("p",{className:"label",id:"titleScanner",children:"Scan note1 or nevent1 QR code"}),(0,o.jsx)("div",{id:"reader"}),(0,o.jsx)("a",{id:"stopScanner",href:"#",className:"label",onClick:()=>t(!1),children:"cancel"})]})}),(0,o.jsx)("div",{className:"overlayContainer",id:"loginForm",style:{display:n?"block":"none"},children:(0,o.jsxs)("div",{className:"overlayInner",children:[(0,o.jsxs)("div",{className:"brand",children:["PUB",(0,o.jsx)("span",{style:{color:"#cecece"},children:"PAY"}),(0,o.jsx)("span",{style:{color:"#00000014"},children:".me"})]}),(0,o.jsx)("p",{className:"label",id:"titleSignin",children:"Choose Sign-in Method"}),(0,o.jsxs)("div",{className:"formFieldGroup",id:"loginFormGroup",children:[(0,o.jsx)("a",{href:"#",id:"signInExtension",className:"cta",onClick:I,children:"Extension"}),(0,o.jsx)("a",{href:"#",id:"signInexternalSigner",className:"cta",onClick:j,children:"Signer"}),(0,o.jsx)("a",{href:"#",id:"signInNsec",className:"cta",onClick:k,children:"NSEC"})]}),(0,o.jsxs)("div",{id:"nsecInputGroup",style:{display:"none"},children:[(0,o.jsx)("input",{type:"password",id:"nsecInput",placeholder:"Enter your nsec",className:"inputField",required:!0}),(0,o.jsx)("button",{id:"continueWithNsec",className:"cta",onClick:L,children:"Continue"})]}),(0,o.jsxs)("div",{className:"rememberPK",children:[(0,o.jsx)("label",{htmlFor:"rememberMe",className:"label",children:"Remember"}),(0,o.jsx)("input",{type:"checkbox",className:"checkBoxRemember",id:"rememberMe"})]}),(0,o.jsx)("a",{id:"cancelLogin",href:"#",className:"label",onClick:()=>l(!1),children:"cancel"})]})}),(0,o.jsx)("div",{className:"overlayContainer",id:"loggedInForm",style:{display:a?"block":"none"},children:(0,o.jsxs)("div",{className:"overlayInner",children:[(0,o.jsxs)("div",{className:"brand",children:["PUB",(0,o.jsx)("span",{style:{color:"#cecece"},children:"PAY"}),(0,o.jsx)("span",{style:{color:"#00000014"},children:".me"})]}),(0,o.jsx)("p",{className:"label",children:"You are logged in as:"}),(0,o.jsx)("p",{id:"loggedInPublicKey",children:"npub1..."}),(0,o.jsx)("p",{className:"label",children:"Sign-in Method:"}),(0,o.jsx)("span",{id:"loggedInMethod",children:"Extension | External Signer | NSEC"}),(0,o.jsx)("a",{href:"",id:"logoutButton",className:"cta",onClick:E,children:"Logout"}),(0,o.jsx)("a",{id:"cancelLoggedin",href:"#",className:"label",onClick:()=>i(!1),children:"cancel"})]})}),(0,o.jsx)("div",{className:"overlayContainer",id:"invoiceOverlay",style:{display:r?"block":"none"},children:(0,o.jsxs)("div",{className:"overlayInner",children:[(0,o.jsxs)("div",{className:"brand",children:["PUB",(0,o.jsx)("span",{style:{color:"#cecece"},children:"PAY"}),(0,o.jsx)("span",{style:{color:"#00000014"},children:".me"})]}),(0,o.jsx)("p",{id:"qrcodeTitle",className:"label",children:"Scan Invoice to Pay Zap"}),(0,o.jsx)("canvas",{id:"invoiceQR"}),(0,o.jsx)("p",{id:"qrcodeTitle",className:"label",children:"Otherwise:"}),(0,o.jsxs)("div",{className:"formFieldGroup",children:[(0,o.jsx)("button",{id:"payWithExtension",className:"cta",onClick:q,children:"Pay with Extension"}),(0,o.jsx)("button",{id:"payWithWallet",className:"cta",onClick:C,children:"Pay with Wallet"}),(0,o.jsx)("button",{id:"copyInvoice",className:"cta",onClick:B,children:"Copy Invoice"})]}),(0,o.jsx)("a",{id:"closeInvoiceOverlay",href:"#",className:"label",onClick:()=>c(!1),children:"Close"})]})}),(0,o.jsx)("div",{className:"overlayContainer",id:"viewJSON",style:{display:d?"block":"none"},children:(0,o.jsxs)("div",{className:"overlayInner",children:[(0,o.jsx)("pre",{id:"noteJSON"}),(0,o.jsx)("a",{id:"closeJSON",href:"#",className:"label",onClick:()=>p(!1),children:"close"})]})}),(0,o.jsx)("div",{className:"overlayContainer",id:"newPayNoteForm",style:{display:g?"block":"none"},children:(0,o.jsxs)("div",{className:"overlayInner",children:[(0,o.jsxs)("div",{className:"brand",children:["PUB",(0,o.jsx)("span",{style:{color:"#cecece"},children:"PAY"}),(0,o.jsx)("span",{style:{color:"#00000014"},children:".me"})]}),(0,o.jsxs)("form",{id:"newKind1",children:[(0,o.jsxs)("div",{className:"formField",children:[(0,o.jsx)("label",{htmlFor:"payNoteContent",className:"label",children:"Your Payment Request"}),(0,o.jsx)("textarea",{id:"payNoteContent",name:"payNoteContent",rows:4,placeholder:"Payment Request Description"})]}),(0,o.jsxs)("fieldset",{className:"formField formSelector",children:[(0,o.jsx)("legend",{className:"uppercase",children:"Select type"}),(0,o.jsxs)("div",{children:[(0,o.jsx)("input",{type:"radio",id:"fixedFlow",name:"paymentType",value:"fixed",defaultChecked:!0}),(0,o.jsx)("label",{htmlFor:"fixedFlow",children:"Fixed"})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("input",{type:"radio",id:"rangeFlow",name:"paymentType",value:"range"}),(0,o.jsx)("label",{htmlFor:"rangeFlow",children:"Range"})]}),(0,o.jsxs)("div",{className:"disabled",children:[(0,o.jsx)("input",{type:"radio",id:"targetFlow",name:"paymentType",value:"target",disabled:!0}),(0,o.jsx)("label",{htmlFor:"targetFlow",children:"Target"})]})]}),(0,o.jsx)("div",{className:"formFieldGroup",id:"fixedInterface",children:(0,o.jsxs)("div",{className:"formField",children:[(0,o.jsxs)("label",{htmlFor:"zapFixed",className:"label",children:["Fixed Amount* ",(0,o.jsx)("span",{className:"tagName",children:"zap-min = zap-max"})]}),(0,o.jsx)("input",{type:"number",min:1,id:"zapFixed",placeholder:"1",name:"zapFixed",required:!0})]})}),(0,o.jsxs)("div",{className:"formFieldGroup",id:"rangeInterface",style:{display:"none"},children:[(0,o.jsxs)("div",{className:"formField",children:[(0,o.jsxs)("label",{htmlFor:"zapMin",className:"label",children:["Minimum* ",(0,o.jsx)("span",{className:"tagName",children:"zap-min"})]}),(0,o.jsx)("input",{type:"number",min:1,id:"zapMin",placeholder:"1",name:"zapMin"})]}),(0,o.jsxs)("div",{className:"formField",children:[(0,o.jsxs)("label",{htmlFor:"zapMax",className:"label",children:["Maximum* ",(0,o.jsx)("span",{className:"tagName",children:"zap-max"})]}),(0,o.jsx)("input",{type:"number",min:1,id:"zapMax",placeholder:"1000000000",name:"zapMax"})]})]}),(0,o.jsxs)("details",{className:"formField",children:[(0,o.jsx)("summary",{className:"legend summaryOptions",children:"Advanced Options"}),(0,o.jsxs)("div",{className:"formFieldGroup",children:[(0,o.jsxs)("div",{className:"formField",children:[(0,o.jsxs)("label",{htmlFor:"zapUses",className:"label",children:["Uses ",(0,o.jsx)("span",{className:"tagName",children:"zap-uses"})]}),(0,o.jsx)("input",{type:"number",min:1,id:"zapUses",placeholder:"1",name:"zapUses"})]}),(0,o.jsxs)("div",{className:"formField disabled",children:[(0,o.jsxs)("label",{htmlFor:"zapIncrement",className:"label",children:["Increment ",(0,o.jsx)("span",{className:"tagName"})]}),(0,o.jsx)("input",{type:"text",id:"zapIncrement",placeholder:"0",name:"zapIncrement",disabled:!0})]})]}),(0,o.jsxs)("div",{className:"formField",children:[(0,o.jsxs)("label",{htmlFor:"zapPayer",className:"label",children:["Payer ",(0,o.jsx)("span",{className:"tagName",children:"zap-payer"})]}),(0,o.jsx)("input",{type:"text",id:"zapPayer",placeholder:"npub1...",name:"zapPayer"})]}),(0,o.jsxs)("div",{className:"formField",children:[(0,o.jsxs)("label",{htmlFor:"overrideLNURL",className:"label",children:["Override receiving address",(0,o.jsx)("span",{className:"tagName",children:" zap-lnurl"})]}),(0,o.jsx)("input",{type:"email",id:"overrideLNURL",placeholder:"address@lnprovider.net",name:"overrideLNURL"})]}),(0,o.jsxs)("div",{className:"formField disabled",children:[(0,o.jsxs)("label",{htmlFor:"redirectToNote",className:"label",children:["Redirect payment to note ",(0,o.jsx)("span",{className:"tagName",children:"zap-redirect"})," "]}),(0,o.jsx)("input",{type:"text",id:"redirectToNote",placeholder:"note1...",name:"redirectToNote",disabled:!0})]})]}),(0,o.jsx)("button",{type:"submit",id:"postNote",className:"cta",onClick:z,children:"Publish"})]}),(0,o.jsx)("a",{id:"cancelNewNote",href:"#",className:"label",onClick:()=>u(!1),children:"cancel"})]})})]})},r="/lightning/enable";class c{constructor(e){this.sessions=new Map,this.frontendSessionId=null,this.config=e,this.frontendSessionId=this.generateFrontendSessionId()}async enableLightningPayments(e){if(!this.config.enabled)return{success:!1,error:"Lightning payments are disabled"};if(!e)return{success:!1,error:"Event ID is required"};try{console.log("ðŸ”Œ LightningService: Making API call to:",r),console.log("ðŸ”Œ LightningService: Request body:",{frontendSessionId:this.frontendSessionId,eventId:e});const t=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({frontendSessionId:this.frontendSessionId,eventId:e})});console.log("ðŸ”Œ LightningService: Response status:",t.status),console.log("ðŸ”Œ LightningService: Response ok:",t.ok);const n=await t.json();if(console.log("ðŸ”Œ LightningService: Response data:",n),n.success&&n.data){const t={sessionId:this.frontendSessionId,eventId:e,lnurlpId:n.data.lnurl,createdAt:Date.now(),expiresAt:Date.now()+864e5,status:"active"};return this.sessions.set(this.frontendSessionId,t),{success:!0,lnurl:n.data.lnurl,message:n.data.existing?"Lightning enabled (reusing existing link)":"Lightning enabled - scan QR to pay"}}return{success:!1,error:n.error||"Failed to enable Lightning payments"}}catch(e){return console.error("Error enabling Lightning payments:",e),{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}async disableLightningPayments(e){if(!e)return{success:!1,error:"Event ID is required"};try{const t=await fetch("/lightning/disable",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({frontendSessionId:this.frontendSessionId,eventId:e})}),n=await t.json();return n.success?(this.frontendSessionId&&this.sessions.delete(this.frontendSessionId),{success:!0,message:n.data?.message||"Lightning payments disabled"}):{success:!1,error:n.error||"Failed to disable Lightning payments"}}catch(e){return console.error("Error disabling Lightning payments:",e),{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}getLightningStatus(){return{enabled:this.config.enabled,sessionId:this.frontendSessionId,activeSessions:this.sessions.size}}getActiveSessions(){const e=Date.now();return Array.from(this.sessions.values()).filter(t=>"active"===t.status&&t.expiresAt>e)}getSession(e){return this.sessions.get(e)||null}async createInvoice(e,t,n){if(!this.config.enabled)return{success:!1,error:"Lightning payments are disabled"};try{return{success:!0,invoice:{payment_hash:this.generatePaymentHash(),payment_request:`lnbc${e}u1p...`,description:t,amount_msat:1e3*e,amount_sat:e,created_at:Date.now(),expires_at:Date.now()+36e5,status:"pending"}}}catch(e){return console.error("Error creating Lightning invoice:",e),{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}async checkPaymentStatus(e){try{return{success:!0,payment:{id:e,payment_hash:e,amount_msat:1e5,amount_sat:100,created_at:Date.now(),status:"completed",description:"Mock payment"}}}catch(e){return console.error("Error checking payment status:",e),{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}handleWebhook(e){try{console.log("Processing Lightning webhook:",e);const t=Array.from(this.sessions.values()).find(t=>t.eventId===e.description);return t?(t.status="active",{success:!0,message:"Webhook processed successfully"}):{success:!1,error:"No matching session found"}}catch(e){return console.error("Error handling webhook:",e),{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}generateLightningQR(e){return`lightning:${e}`}validateConfig(){const e=[];return this.config.lnbitsUrl||e.push("LNBits URL is required"),this.config.apiKey||e.push("LNBits API key is required"),this.config.webhookUrl||e.push("Webhook URL is required"),{valid:0===e.length,errors:e}}updateConfig(e){this.config={...this.config,...e}}getConfig(){return{...this.config}}cleanupExpiredSessions(){const e=Date.now();this.sessions.forEach((t,n)=>{t.expiresAt<e&&(t.status="expired",this.sessions.delete(n))})}generateFrontendSessionId(){return`frontend_${crypto.randomUUID()}`}generatePaymentHash(){const e=new Uint8Array(32);return crypto.getRandomValues(e),Array.from(e,e=>e.toString(16).padStart(2,"0")).join("")}destroy(){this.sessions.clear(),this.frontendSessionId=null}}class d{constructor(){this.invoices=new Map,this.payments=new Map}createInvoice(e,t,n={}){if(!(e=>e>=1&&e<=1e6)(e))throw new Error("Invalid zap amount");const o=this.generatePaymentHash(),s=this.generatePaymentRequest(e,t,o),l=Date.now(),a={payment_hash:o,payment_request:s,description:n.comment?`${t} - ${n.comment}`:t,amount_msat:1e3*e,amount_sat:e,created_at:l,expires_at:l+(n.expiry||36e5),status:"pending"};return this.invoices.set(o,a),a}getInvoice(e){return this.invoices.get(e)||null}updateInvoiceStatus(e,t){const n=this.invoices.get(e);return!!n&&(n.status=t,!0)}markInvoiceAsPaid(e,t,n=Date.now()){const o=this.invoices.get(e);if(!o)return null;o.status="paid";const s={id:e,payment_hash:e,amount_msat:o.amount_msat,amount_sat:o.amount_sat,created_at:o.created_at,status:"completed",description:o.description,preimage:t};return this.payments.set(e,s),s}getPayment(e){return this.payments.get(e)||null}getAllPayments(){return Array.from(this.payments.values())}getPaymentsByStatus(e){return Array.from(this.payments.values()).filter(t=>t.status===e)}isInvoiceExpired(e){const t=this.invoices.get(e);return!t||Date.now()>t.expires_at}getExpiredInvoices(){const e=Date.now();return Array.from(this.invoices.values()).filter(t=>t.expires_at<e&&"pending"===t.status)}cleanupExpiredInvoices(){const e=this.getExpiredInvoices();let t=0;return e.forEach(e=>{e.status="expired",t++}),t}getInvoiceStats(){const e=Array.from(this.invoices.values()),t=Array.from(this.payments.values());return{total:e.length,pending:e.filter(e=>"pending"===e.status).length,paid:e.filter(e=>"paid"===e.status).length,expired:e.filter(e=>"expired"===e.status).length,totalAmount:e.reduce((e,t)=>e+t.amount_sat,0),totalPaid:t.reduce((e,t)=>e+t.amount_sat,0)}}validateInvoice(e){const t=[];return e.payment_hash||t.push("Payment hash is required"),e.payment_request||t.push("Payment request is required"),e.amount_sat<=0&&t.push("Amount must be greater than 0"),e.description||t.push("Description is required"),e.created_at<=0&&t.push("Created timestamp is required"),e.expires_at<=e.created_at&&t.push("Expiry must be after creation time"),{valid:0===t.length,errors:t}}generatePaymentHash(){const e=new Uint8Array(32);return crypto.getRandomValues(e),Array.from(e,e=>e.toString(16).padStart(2,"0")).join("")}generatePaymentRequest(e,t,n){Math.floor(Date.now()/1e3);const o=e.toString().padStart(4,"0"),s=this.hashDescription(t);return`lnbc${o}u1p${n.slice(0,8)}...${s.slice(0,8)}`}hashDescription(e){const t=(new TextEncoder).encode(e);return Array.from(t,e=>e.toString(16).padStart(2,"0")).join("")}clear(){this.invoices.clear(),this.payments.clear()}}class p{constructor(e,t){this.webhookHandlers=new Map,this.lightningService=e,this.invoiceService=t}async processWebhook(e){try{const t=this.validateWebhookData(e);if(!t.valid)return{success:!1,error:`Invalid webhook data: ${t.errors.join(", ")}`};const n=this.findMatchingSession(e);return n?await this.processPayment(e,n)?(this.notifyHandlers(e),{success:!0,message:"Webhook processed successfully"}):{success:!1,error:"Failed to process payment"}:{success:!1,error:"No matching session found for webhook"}}catch(e){return console.error("Error processing webhook:",e),{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}registerHandler(e,t){this.webhookHandlers.set(e,t)}unregisterHandler(e){this.webhookHandlers.delete(e)}validateWebhookData(e){const t=[];return e.payment_hash||t.push("Payment hash is required"),e.payment_request||t.push("Payment request is required"),e.amount<=0&&t.push("Amount must be greater than 0"),e.status||t.push("Status is required"),["paid","expired","cancelled"].includes(e.status)||t.push("Invalid status"),e.created_at<=0&&t.push("Created timestamp is required"),e.paid_at&&e.paid_at<e.created_at&&t.push("Paid timestamp cannot be before created timestamp"),{valid:0===t.length,errors:t}}findMatchingSession(e){const t=this.lightningService.getActiveSessions();if(e.description){const n=t.find(t=>t.eventId===e.description);if(n)return n}if(e.comment){const n=t.find(t=>t.eventId===e.comment);if(n)return n}return null}async processPayment(e,t){try{if("paid"===e.status){const t=this.invoiceService.markInvoiceAsPaid(e.payment_hash,e.payment_hash,e.paid_at);return t?(console.log("Payment processed successfully:",t),!0):(console.error("Failed to create payment record"),!1)}return"expired"===e.status?(this.invoiceService.updateInvoiceStatus(e.payment_hash,"expired"),console.log("Invoice expired:",e.payment_hash),!0):"cancelled"===e.status&&(this.invoiceService.updateInvoiceStatus(e.payment_hash,"cancelled"),console.log("Invoice cancelled:",e.payment_hash),!0)}catch(e){return console.error("Error processing payment:",e),!1}}notifyHandlers(e){this.webhookHandlers.forEach((t,n)=>{try{t(e)}catch(e){console.error(`Error in webhook handler ${n}:`,e)}})}getWebhookStats(){return{totalHandlers:this.webhookHandlers.size,activeSessions:this.lightningService.getActiveSessions().length,recentWebhooks:0}}async testWebhook(e){const t={payment_hash:e.payment_hash||"test_payment_hash",payment_request:e.payment_request||"lnbc100u1p...",amount:e.amount||100,description:e.description||"test_description",comment:e.comment||"test_comment",created_at:e.created_at||Date.now(),paid_at:e.paid_at||Date.now(),status:e.status||"paid"};return this.processWebhook(t)}clearHandlers(){this.webhookHandlers.clear()}}var g;!function(e){e.DEBUG="debug",e.INFO="info",e.WARN="warn",e.ERROR="error",e.CRITICAL="critical"}(g||(g={}));class u{constructor(e=!1){this.logs=[],this.maxLogs=1e3,this.isDevelopment=e,this.setupGlobalErrorHandlers()}log(e,t,n,o){const s={id:this.generateErrorId(),level:e,message:t,error:n,context:o,timestamp:Date.now(),userId:this.getCurrentUserId(),sessionId:this.getCurrentSessionId(),url:window.location.href,userAgent:navigator.userAgent};return this.logs.push(s),this.logs.length>this.maxLogs&&(this.logs=this.logs.slice(-this.maxLogs)),this.outputToConsole(s),this.isDevelopment||this.sendToExternalService(s),s.id}debug(e,t){return this.log(g.DEBUG,e,void 0,t)}info(e,t){return this.log(g.INFO,e,void 0,t)}warn(e,t,n){return this.log(g.WARN,e,t,n)}error(e,t,n){return this.log(g.ERROR,e,t,n)}critical(e,t,n){return this.log(g.CRITICAL,e,t,n)}handleError(e,t){const n=e.message||"Unknown error occurred";return this.error(n,e,t)}handleNetworkError(e,t,n){const o=`Network error: ${n} ${t}`;return this.error(o,e,{url:t,method:n})}handleNostrError(e,t){return this.error("Nostr protocol error",e,{...t,type:"nostr"})}handleLightningError(e,t){return this.error("Lightning payment error",e,{...t,type:"lightning"})}getLogs(e,t){let n=this.logs;return e&&(n=n.filter(t=>t.level===e)),t&&(n=n.slice(-t)),n}getErrorStats(){const e=Date.now(),t=this.logs.filter(t=>e-t.timestamp<36e5),n=this.logs.reduce((e,t)=>(e[t.level]=(e[t.level]||0)+1,e),{});return{total:this.logs.length,byLevel:n,recent:t.length,critical:n[g.CRITICAL]||0}}clearLogs(){this.logs=[]}exportLogs(){return JSON.stringify(this.logs,null,2)}setupGlobalErrorHandlers(){window.addEventListener("error",e=>{this.handleError(e.error,{type:"uncaught",filename:e.filename,lineno:e.lineno,colno:e.colno})}),window.addEventListener("unhandledrejection",e=>{this.handleError(new Error(e.reason),{type:"unhandledrejection"})})}outputToConsole(e){const t=`[${new Date(e.timestamp).toISOString()}] [${e.level.toUpperCase()}]`;switch(e.level){case g.DEBUG:console.debug(t,e.message,e.context);break;case g.INFO:console.info(t,e.message,e.context);break;case g.WARN:console.warn(t,e.message,e.error,e.context);break;case g.ERROR:case g.CRITICAL:console.error(t,e.message,e.error,e.context)}}sendToExternalService(e){console.log("Would send to external service:",e)}generateErrorId(){return`err_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}getCurrentUserId(){}getCurrentSessionId(){}}class m{constructor(e={}){this.isEnabled=!1,this.isLoading=!1,this.error=null,this.lnurl=null,this.sessionId=null,this.options=e,this.lightningService=new c({enabled:!1,lnbitsUrl:"",apiKey:"",webhookUrl:""}),this.invoiceService=new d,this.webhookService=new p(this.lightningService,this.invoiceService),this.errorService=new u}async enableLightning(e){const t=e||this.options.eventId;if(!t)return this.error="No event ID provided",!1;this.isLoading=!0,this.error=null;try{const e=await this.lightningService.enableLightningPayments(t);return e.success&&e.lnurl?(this.isEnabled=!0,this.lnurl=e.lnurl,this.sessionId=this.lightningService.getLightningStatus().sessionId,this.errorService.info("Lightning payments enabled",{lnurl:e.lnurl}),!0):(this.error=e.error||"Failed to enable Lightning payments",!1)}catch(e){return this.error=e instanceof Error?e.message:"Unknown error",this.errorService.error("Failed to enable Lightning payments",e),!1}finally{this.isLoading=!1}}async disableLightning(e){const t=e||this.options.eventId;if(!t)return this.error="No event ID provided",!1;this.isLoading=!0,this.error=null;try{const e=await this.lightningService.disableLightningPayments(t);return e.success?(this.isEnabled=!1,this.lnurl=null,this.sessionId=null,this.errorService.info("Lightning payments disabled"),!0):(this.error=e.error||"Failed to disable Lightning payments",!1)}catch(e){return this.error=e instanceof Error?e.message:"Unknown error",this.errorService.error("Failed to disable Lightning payments",e),!1}finally{this.isLoading=!1}}async toggleLightning(e){return this.isEnabled?await this.disableLightning(e):await this.enableLightning(e)}async createInvoice(e,t,n){if(!this.isEnabled)return this.error="Lightning payments not enabled",null;try{const o=this.invoiceService.createInvoice(e,t,{comment:n});return this.options.onInvoiceCreated?.(o),this.errorService.info("Invoice created",{amount:e,description:t}),o}catch(e){return this.errorService.error("Failed to create invoice",e),null}}async checkPaymentStatus(e){try{const t=await this.lightningService.checkPaymentStatus(e);return t.success&&t.payment?(this.options.onPayment?.(t.payment),t.payment):null}catch(e){return this.errorService.error("Failed to check payment status",e),null}}getStatus(){return{enabled:this.isEnabled,loading:this.isLoading,error:this.error,lnurl:this.lnurl,sessionId:this.sessionId,config:this.lightningService.getConfig()}}getPaymentHistory(){return this.invoiceService.getAllPayments()}getInvoiceStats(){return this.invoiceService.getInvoiceStats()}get enabled(){return this.isEnabled}get loading(){return this.isLoading}get lastError(){return this.error}get currentLnurl(){return this.lnurl}get currentSessionId(){return this.sessionId}get lightningServiceInstance(){return this.lightningService}get invoiceServiceInstance(){return this.invoiceService}get webhookServiceInstance(){return this.webhookService}get errorServiceInstance(){return this.errorService}}const h="#000000",y=e=>{const[t,n]=(0,s.useState)(!0),[o,l]=(0,s.useState)(null),[a,i]=(0,s.useState)(""),[r,c]=(0,s.useState)("Author"),[d,p]=(0,s.useState)("/images/gradient_color.gif"),[g,u]=(0,s.useState)([]),[y,v]=(0,s.useState)(0),[w,b]=(0,s.useState)(0),[f,x]=(0,s.useState)([]),[N,S]=(0,s.useState)(!1),I=(0,s.useRef)(null),[j,k]=(0,s.useState)(!1),[L,E]=(0,s.useState)("");(0,s.useRef)(null),(0,s.useEffect)(()=>{if(console.log("useEffect triggered - topZappers changed:",f),f.length>0){const e=document.getElementById("showTopZappersToggle");e?.checked?(console.log("Top zappers data available and toggle is ON, displaying..."),U()):console.log("Top zappers data available but toggle is OFF, not displaying")}else console.log("No top zappers data available")},[f]),(0,s.useEffect)(()=>{if(g.length>0){console.log("Zaps changed, recalculating top zappers..."),he(g);const e=document.getElementById("showTopZappersToggle");(e?.checked||N)&&(console.log("Show top zappers toggle is on or user wants them, displaying top zappers..."),U(),S(!1))}},[g,N]),(0,s.useEffect)(()=>{console.log("Main useEffect triggered with eventId:",e);const t=document.querySelector(".qr-swiper");t&&(t.style.display="none"),e?(async()=>{try{n(!0),l(null),I.current=new m({eventId:e}),console.log("Lightning service initialized"),window.NostrTools&&!window.pool&&(window.pool=new window.NostrTools.SimplePool,window.relays=["wss://relay.damus.io","wss://relay.snort.social","wss://nos.lol","wss://relay.nostr.band"],console.log("Nostr pool initialized in hook")),"undefined"!=typeof window&&window.Swiper&&new window.Swiper(".portrait-swiper .swiper",{loop:!0,autoplay:{delay:4e3,disableOnInteraction:!1},touchRatio:1,touchAngle:45,grabCursor:!0,speed:800,effect:"slide",slidesPerView:1,spaceBetween:0,breakpoints:{320:{slidesPerView:1,spaceBetween:0},768:{slidesPerView:1,spaceBetween:0},1024:{slidesPerView:1,spaceBetween:0}},on:{init(){console.log("Portrait swiper initialized")},slideChange(){console.log("Portrait swiper slide changed")}}}),e?await X(e):(console.log("No eventId provided, initializing QR codes with placeholder..."),await q()),setTimeout(()=>{console.log("Loading initial styles and setting up event listeners..."),Te(),window.setupStyleOptions=()=>{console.log("Original setupStyleOptions called but disabled - using React hook instead")},ke(),console.log("About to setup note loader listeners..."),je(),console.log("Note loader listeners setup complete");const e=document.getElementById("showTopZappersToggle");e?.checked&&(console.log("Page loaded with show top zappers enabled, calling displayTopZappers"),U())},500),n(!1)}catch(e){l(e instanceof Error?e.message:"Failed to initialize live functionality"),n(!1)}})():(console.log("No eventId, setting up note loader only..."),window.NostrTools&&!window.pool&&(window.pool=new window.NostrTools.SimplePool,window.relays=["wss://relay.damus.io","wss://relay.snort.social","wss://nos.lol","wss://relay.primal.net","wss://relay.nostr.band"],console.log("Nostr pool and relays initialized for note loader")),setTimeout(()=>{"undefined"!=typeof window&&window.Swiper&&(document.querySelector(".portrait-swiper .swiper")?(new window.Swiper(".portrait-swiper .swiper",{loop:!0,autoplay:{delay:4e3,disableOnInteraction:!1},touchRatio:1,touchAngle:45,grabCursor:!0,speed:800,effect:"slide",slidesPerView:1,spaceBetween:0,breakpoints:{320:{slidesPerView:1,spaceBetween:0},768:{slidesPerView:1,spaceBetween:0},1024:{slidesPerView:1,spaceBetween:0}}}),console.log("Portrait swiper initialized for note loader")):console.warn("Portrait swiper element not found"))},200),setTimeout(()=>{console.log("Setting up note loader listeners for no eventId case..."),je()},100))},[e]),(0,s.useEffect)(()=>{"undefined"!=typeof window&&(window.frontendSessionId=null,window.lightningQRSlide=null,window.lightningEnabled=!1,window.organizeZapsHierarchically=we,window.cleanupHierarchicalOrganization=ve,window.updateQRSlideVisibility=De)},[]);const q=async()=>{console.log("Initializing QR code placeholders...");const e="placeholder-note-id",t=window.NostrTools?.nip19?.neventEncode({id:e,relays:[]})||"placeholder-nevent",n=window.NostrTools?.nip19?.noteEncode(e)||"placeholder-note",o=`https://njump.me/${n}`,s=`nostr:${t}`,l=`nostr:${n}`,a=Math.min(.6*window.innerWidth,.7*window.innerHeight);[{element:document.getElementById("qrCode"),value:o,link:document.getElementById("qrcodeLinkNostr"),preview:document.getElementById("qrDataPreview1")},{element:document.getElementById("qrCodeNevent"),value:s,link:document.getElementById("qrcodeNeventLink"),preview:document.getElementById("qrDataPreview2")},{element:document.getElementById("qrCodeNote"),value:l,link:document.getElementById("qrcodeNoteLink"),preview:document.getElementById("qrDataPreview3")}].forEach(({element:e,value:t,link:n,preview:o})=>{e&&window.QRious&&(e.innerHTML="",new window.QRious({element:e,size:a,value:t}),n&&(n.href=t),o&&(o.textContent=t))}),console.log("QR code placeholders initialized")},C=async(e,t,n)=>{console.log("Subscribing to live event:",{pubkey:e,identifier:t,kind:n});const o={authors:[e],kinds:[30311],"#d":[t]},s=setTimeout(()=>{console.log("Live event subscription timeout - keeping subscription alive")},3e4);window.pool.subscribeMany(window.relays,[o],{onevent(e){clearTimeout(s),P(e),T(e)},oneose(){clearTimeout(s),console.log("Live event subscription EOSE")},onclosed(){clearTimeout(s),window.currentLiveEventInfo&&window.reconnectionAttempts.event<3&&(window.reconnectionAttempts.event++,setTimeout(()=>{C(window.currentLiveEventInfo.pubkey,window.currentLiveEventInfo.identifier,window.currentLiveEventInfo.kind)},5e3*window.reconnectionAttempts.event))}})},B=async(e,t)=>{console.log("Subscribing to live chat:",{pubkey:e,identifier:t});const n={kinds:[1311],"#a":[`30311:${e}:${t}`]};window.pool.subscribeMany(window.relays,[n],{onevent(e){R(e)},oneose(){console.log("Live chat subscription EOSE")},onclosed(){window.currentLiveEventInfo&&window.reconnectionAttempts.chat<3&&(window.reconnectionAttempts.chat++,setTimeout(()=>{B(window.currentLiveEventInfo.pubkey,window.currentLiveEventInfo.identifier)},5e3*window.reconnectionAttempts.chat))}})},z=async(e,t)=>{console.log("Subscribing to live event zaps for:",{pubkey:e,identifier:t});const n={kinds:[9735],"#a":[`30311:${e}:${t}`]};window.pool.subscribeMany(window.relays,[n],{onevent(n){O(n,e,t)},oneose(){console.log("subscribeLiveEventZaps() EOS - keeping subscription alive")},onclosed(){console.log("subscribeLiveEventZaps() Closed - attempting to reconnect"),setTimeout(()=>{console.log("Reconnecting to live event zaps..."),z(e,t)},5e3)}})},T=async e=>{console.log("Subscribing to live event participants");const t=e.tags.filter(e=>"p"===e[0]).map(e=>e[1]);if(t.length>0){const e={kinds:[0],authors:t};window.pool.subscribeMany(window.relays,[e],{onevent(e){window.profiles=window.profiles||{},window.profiles[e.pubkey]=e},oneose(){console.log("Live event participants subscription EOSE")}})}},P=e=>{if(console.log("Displaying live event:",e),window.currentLiveEvent&&window.currentLiveEvent.id===e.id)return;window.currentLiveEvent=e,window.currentEventType="live-event";const t=document.querySelector(".note-content");if(t){t.classList.remove("loading");const e=t.querySelector(".loading-text");e&&e.remove()}W();const n=e.tags.find(e=>"title"===e[0])?.[1]||"Live Event",o=e.tags.find(e=>"summary"===e[0])?.[1]||"",s=e.tags.find(e=>"status"===e[0])?.[1]||"unknown",l=e.tags.find(e=>"streaming"===e[0])?.[1],a=e.tags.find(e=>"recording"===e[0])?.[1],i=e.tags.find(e=>"starts"===e[0])?.[1],r=e.tags.find(e=>"ends"===e[0])?.[1],c=e.tags.find(e=>"current_participants"===e[0])?.[1]||"0",d=e.tags.find(e=>"total_participants"===e[0])?.[1]||"0",p=e.tags.filter(e=>"p"===e[0]),g=e=>e?new Date(1e3*parseInt(e)).toLocaleString():"",u=t?.querySelector(".live-event-content");if(t?.querySelector("#live-video"),u){const e=t?.querySelector(".live-event-status .status-indicator"),n=t?.querySelector(".participants-count");e&&(e.className=`status-indicator status-${s}`,e.textContent="live"===s?"ðŸ”´ LIVE":"planned"===s?"ðŸ“… PLANNED":"ended"===s?"âœ… ENDED":s.toUpperCase()),n&&(n.innerHTML=`<strong>Participants:</strong> ${c}/${d}`)}else t&&(t.innerHTML=`\n            ${l?`\n                <div class="live-event-video">\n                    <div id="live-video-player" class="video-player-container">\n                        <video id="live-video" controls autoplay muted playsinline class="live-video">\n                            <source src="${l}" type="application/x-mpegURL">\n                            <source src="${l}" type="video/mp4">\n                            Your browser does not support the video tag.\n                        </video>\n                        <div class="video-error" id="video-error" style="display: none;">\n                            <p>Unable to load video stream</p>\n                            <a href="${l}" target="_blank" class="streaming-link">\n                                ðŸ“º Watch in External Player\n                            </a>\n                        </div>\n                    </div>\n                </div>\n            `:""}\n            \n            <div class="live-event-content">\n                ${o?`<p class="live-event-summary">${o}</p>`:""}\n                \n                <div class="live-event-status">\n                    <span class="status-indicator status-${s}">\n                        ${"live"===s?"ðŸ”´ LIVE":"planned"===s?"ðŸ“… PLANNED":"ended"===s?"âœ… ENDED":s.toUpperCase()}\n                    </span>\n                </div>\n                \n                ${i?`<div class="live-event-time">\n                    <strong>Starts:</strong> ${g(i)}\n                </div>`:""}\n                \n                ${r?`<div class="live-event-time">\n                    <strong>Ends:</strong> ${g(r)}\n                </div>`:""}\n                \n                <div class="live-event-participants">\n                    <div class="participants-count">\n                        <strong>Participants:</strong> ${c}/${d}\n                    </div>\n                    ${p.length>0?`\n                        <div class="participants-list">\n                            ${p.slice(0,10).map(e=>`\n                                <div class="participant" data-pubkey="${e[1]}">\n                                    <span class="participant-role">${e[3]||"Participant"}</span>: \n                                    <span class="participant-pubkey">${e[1].slice(0,8)}...</span>\n                                </div>\n                            `).join("")}\n                            ${p.length>10?`<div class="participants-more">... and ${p.length-10} more</div>`:""}\n                        </div>\n                    `:""}\n                </div>\n                \n                ${a?`\n                    <div class="live-event-actions">\n                        <a href="${a}" target="_blank" class="recording-link">\n                            ðŸŽ¥ Watch Recording\n                        </a>\n                    </div>\n                `:""}\n            </div>\n        `);const m=document.getElementById("authorName");m&&(m.innerText=n);const h=p.find(e=>e[3]&&"host"===e[3].toLowerCase()),y=h?h[1]:e.pubkey;G(y),setTimeout(()=>{K(e)},100),window.lightningEnabled&&setTimeout(()=>{window.enableLightningPayments&&window.enableLightningPayments()},150),window.cleanupLiveVideoPlayer&&window.cleanupLiveVideoPlayer(),l&&setTimeout(()=>{J(l)},200),H()},R=e=>{if(console.log("Displaying live chat message:",e),document.querySelector(`[data-chat-id="${e.id}"]`))return void console.log("Chat message already displayed, skipping duplicate:",e.id);const t=document.getElementById("zaps");if(t){t.classList.remove("loading");const e=t.querySelector(".loading-text");e&&e.remove()}const n=document.getElementById("activity-list")||t,o=document.createElement("div");o.className="live-chat-message",o.dataset.pubkey=e.pubkey,o.dataset.timestamp=e.created_at,o.dataset.chatId=e.id;const s=new Date(1e3*e.created_at).toLocaleString();if(o.innerHTML=`\n        <div class="chat-message-header">\n            <img class="chat-author-img" src="/images/gradient_color.gif" data-pubkey="${e.pubkey}" />\n            <div class="chat-message-info">\n                <div class="chat-author-name" data-pubkey="${e.pubkey}">\n                    ${e.pubkey.slice(0,8)}...\n                </div>\n                <div class="chat-message-time">${s}</div>\n            </div>\n        </div>\n        <div class="chat-message-content">\n            ${e.content}\n        </div>\n    `,M(e.pubkey),n){const t=Array.from(n.querySelectorAll(".live-chat-message, .live-event-zap")),s=t.findIndex(t=>parseInt(t.dataset.timestamp)<e.created_at);if(-1===s)n.appendChild(o);else{const e=t[s];e?n.insertBefore(o,e):n.appendChild(o)}}},O=async(e,t,n)=>{console.log("Processing live event zap:",e);try{const t=e.tags.find(e=>"description"===e[0])?.[1];if(!t)return;let n;try{n=JSON.parse(t)}catch(e){return}const o=e.tags.find(e=>"bolt11"===e[0])[1],s=window.lightningPayReq.decode(o).satoshis,l=n.pubkey,a=n.content||"",i={id:e.id,amount:s,content:a,pubkey:l,timestamp:e.created_at,bolt11:o,zapEventID:window.NostrTools.nip19.noteEncode(e.id)};M(l),F(l,s),A(i)}catch(e){console.error("Error processing live event zap:",e)}},A=e=>{if(console.log("Displaying live event zap:",e),document.querySelector(`[data-zap-id="${e.id}"]`))return void console.log("Zap already displayed, skipping duplicate:",e.id);const t=document.getElementById("zaps");if(t){t.classList.remove("loading");const e=t.querySelector(".loading-text");e&&e.remove()}const n=document.getElementById("activity-list")||t,o=document.getElementById("zaps-only-list"),s=document.createElement("div");s.className="live-event-zap",s.dataset.pubkey=e.pubkey,s.dataset.timestamp=e.timestamp,s.dataset.amount=e.amount,s.dataset.zapId=e.id;const l=new Date(1e3*e.timestamp).toLocaleString();if(s.innerHTML=`\n        <div class="zap-header">\n            <img class="zap-author-img" src="/images/gradient_color.gif" data-pubkey="${e.pubkey}" />\n            <div class="zap-info">\n                <div class="zap-author-name" data-pubkey="${e.pubkey}">\n                    ${e.pubkey.slice(0,8)}...\n                </div>\n                <div class="zap-time">${l}</div>\n            </div>\n            <div class="zap-amount">\n                <span class="zap-amount-sats">${ye(e.amount)}</span>\n                <span class="zap-amount-label">sats</span>\n            </div>\n        </div>\n        ${e.content?`\n            <div class="zap-content">\n                ${e.content}\n            </div>\n        `:""}\n    `,n){const t=Array.from(n.querySelectorAll(".live-chat-message, .live-event-zap")),o=t.findIndex(t=>parseInt(t.dataset.timestamp)<e.timestamp);if(-1===o)n.appendChild(s);else{const e=t[o];e?n.insertBefore(s,e):n.appendChild(s)}}if(o){const t=document.createElement("div");t.className="zap live-event-zap zap-only-item",t.dataset.pubkey=e.pubkey,t.dataset.timestamp=e.timestamp,t.dataset.amount=e.amount,t.dataset.zapId=e.id,t.innerHTML=`\n            <div class="zapperProfile">\n                <img class="zapperProfileImg" src="/images/gradient_color.gif" data-pubkey="${e.pubkey}" />\n                <div class="zapperInfo">\n                    <div class="zapperName" data-pubkey="${e.pubkey}">\n                        ${e.pubkey.slice(0,8)}...\n                    </div>\n                    <div class="zapperMessage">${e.content||""}</div>\n                </div>\n            </div>\n            <div class="zapperAmount">\n                <span class="zapperAmountSats">${ye(e.amount)}</span>\n                <span class="zapperAmountLabel">sats</span>\n            </div>\n        `;const n=Array.from(o.querySelectorAll(".live-event-zap")),s=n.findIndex(t=>parseInt(t.dataset.amount||0)<e.amount);if(-1===s)o.appendChild(t);else{const e=n[s];e?o.insertBefore(t,e):o.appendChild(t)}}$()},M=async e=>{console.log("Subscribing to chat author profile:",e);const t={kinds:[0],authors:[e]};window.pool.subscribeMany(window.relays,[t],{onevent(e){Q(e)},oneose(){console.log("Chat author profile subscription EOSE")},onclosed(){console.log("Chat author profile subscription closed")}})},$=()=>{console.log("Updating live event zap total");const e=Array.from(document.querySelectorAll(".live-event-zap")),t=e.reduce((e,t)=>e+parseInt(t.dataset.amount||"0"),0),n=e.length,o=document.getElementById("zappedTotalValue"),s=document.getElementById("zappedTotalCount");o&&(o.innerText=ye(t)),s&&(s.innerText=ye(n))},F=(e,t,n=null)=>{console.log("Adding zap to totals:",{pubkey:e,amount:t,profile:n}),window.zapperTotals||(window.zapperTotals=new Map);const o=window.zapperTotals;if(o.has(e)){const s=o.get(e);s.amount+=t,n&&(s.profile=n,s.name=_(n),s.picture=n.picture||"/images/gradient_color.gif")}else o.set(e,{amount:t,profile:n,name:n?_(n):"Anonymous",picture:n&&n.picture||"/images/gradient_color.gif",pubkey:e});D()},_=e=>e&&(e.display_name||e.displayName||e.name)||"Anonymous",D=()=>{if(console.log("Updating top zappers"),!window.zapperTotals)return;const e=window.zapperTotals,t=Array.from(e.values()).sort((e,t)=>t.amount-e.amount).slice(0,5);window.topZappers=t,x(t)},U=()=>{if(console.log("Displaying top zappers, current topZappers state:",f),document.getElementById("top-zappers-bar")){if(0===f.length)return console.log("No top zappers to display, hiding bar"),void document.body.classList.remove("show-top-zappers");console.log("Showing top zappers bar with",f.length,"zappers"),document.body.classList.add("show-top-zappers");for(let e=0;e<5;e++){const t=document.getElementById(`top-zapper-${e+1}`);if(t)if(e<f.length){const n=f[e],o=t.querySelector(".zapper-avatar"),s=t.querySelector(".zapper-name"),l=t.querySelector(".zapper-total");o&&(o.src=n.picture),o&&(o.alt=n.name),s&&(s.textContent=n.name),l&&(l.textContent=`${ye(n.amount)} sats`),t.style.opacity="1",t.style.display="flex"}else t.style.display="none"}}else console.log("Top zappers bar not found")},Z=()=>{document.body.classList.remove("show-top-zappers")},Q=e=>{console.log("Updating profile:",e);const t=JSON.parse(e.content||"{}"),n=t.display_name||t.displayName||t.name||`${e.pubkey.slice(0,8)}...`,o=t.picture||"/images/gradient_color.gif";if(window.zapperTotals&&window.zapperTotals.has(e.pubkey)){const s=window.zapperTotals.get(e.pubkey);s.profile=t,s.name=n,s.picture=o,D()}document.querySelectorAll(`[data-pubkey="${e.pubkey}"]`).forEach(e=>{e.classList.contains("chat-author-img")||e.classList.contains("zap-author-img")||e.classList.contains("zapperProfileImg")?e.src=o:(e.classList.contains("chat-author-name")||e.classList.contains("zap-author-name")||e.classList.contains("zapperName"))&&(e.textContent=n)})},W=()=>{console.log("Setting up live event two-column layout");const e=document.getElementById("zaps");if(!e)return;if(e.classList.contains("live-event-two-column")&&e.querySelector(".live-event-columns"))return;const t=e.querySelector(".zaps-header");e.querySelector(".zaps-list"),e.innerHTML="",t&&e.appendChild(t);const n=document.createElement("div");n.className="live-event-columns",n.innerHTML='\n        <div class="live-event-zaps-only">\n            <div id="zaps-only-list" class="zaps-only-list"></div>\n        </div>\n        <div class="live-event-activity">\n            <div id="activity-list" class="activity-list"></div>\n        </div>\n    ',e.appendChild(n),e.classList.add("live-event-two-column");const o=document.getElementById("zapGridToggle");if(o){o.disabled=!0;const e=o.closest(".toggle-group");e&&e.classList.add("grid-toggle-disabled");const t=o.closest("label");t&&t.classList.add("grid-toggle-disabled")}},G=async e=>{console.log("Subscribing to live event host profile:",e);const t={kinds:[0],authors:[e]};window.pool.subscribeMany(window.relays,[t],{onevent(e){V(e)},oneose(){console.log("Live event host profile subscription EOSE")},onclosed(){console.log("Live event host profile subscription closed")}})},V=e=>{console.log("Updating live event host profile:",e);const t=JSON.parse(e.content||"{}").picture||"/images/gradient_color.gif",n=document.getElementById("authorNameProfileImg");n&&(n.src=t)},H=()=>{console.log("Starting content monitoring"),window.contentMonitorInterval&&clearInterval(window.contentMonitorInterval),window.contentMonitorInterval=setInterval(()=>{const e=document.querySelector(".note-content"),t=document.getElementById("zaps"),n=e?.querySelector(".live-event-content"),o=t?.querySelector(".live-event-columns");"live-event"===window.currentEventType&&(n||(console.warn("Live event content disappeared! Attempting to restore..."),window.currentLiveEvent&&window.currentLiveEventInfo&&(console.log("Restoring live event content"),P(window.currentLiveEvent))),o||!t||t.classList.contains("loading")||(console.warn("Two-column layout disappeared! Attempting to restore..."),W()))},1e4)},J=e=>{console.log("Initializing live video player:",e);const t=document.getElementById("live-video");t&&(t.addEventListener("error",e=>{console.error("Video error:",e);const t=document.getElementById("video-error");t&&(t.style.display="block")}),t.addEventListener("loadeddata",()=>{console.log("Video loaded successfully");const e=document.getElementById("video-error");e&&(e.style.display="none")}),t.src=e,t.load())},Y=(e,t,n)=>{const o=document.getElementById(e);o&&window.QRious&&(o.innerHTML="",new window.QRious({element:o,size:n,value:t}))},K=e=>{console.log("Generating QR codes for live event:",e);const t=e.tags.find(e=>"d"===e[0])?.[1],n=e.pubkey;if(t&&n)try{const e=window.NostrTools.nip19.naddrEncode({identifier:t,pubkey:n,kind:30311,relays:[]}),o=`https://njump.me/${e}`,s=`nostr:${e}`,l=Math.min(.6*window.innerWidth,.7*window.innerHeight);Y("qrCode",o,l),Y("qrCodeNevent",s,l),Y("qrCodeNote",e,l),((e,t,n)=>{const o=document.getElementById("qrcodeLinkNostr"),s=document.getElementById("qrcodeNeventLink"),l=document.getElementById("qrcodeNoteLink");o&&(o.href=e),s&&(s.href=t),l&&(l.href=n)})(o,s,e),((e,t,n)=>{const o=document.getElementById("qrDataPreview1"),s=document.getElementById("qrDataPreview2"),l=document.getElementById("qrDataPreview3");o&&(o.textContent=e),s&&(s.textContent=t),l&&(l.textContent=n)})(o,s,e)}catch(e){console.error("Error generating QR codes for live event:",e)}},X=async e=>{try{re(),ie(),e=te(e);try{ee(e),oe()}catch(e){return void ne(e instanceof Error?e.message:"Unknown error")}try{const t=window.NostrTools.nip19.decode(e);let n;if("nevent"===t.type)n=t.data.id;else{if("note"!==t.type){if("naddr"===t.type){const{identifier:e,pubkey:n,kind:o}=t.data;ie();const s=document.querySelector(".note-content"),l=document.getElementById("zaps");if(s&&(s.classList.add("loading"),!s.querySelector(".loading-text"))){const e=document.createElement("div");e.className="loading-text",e.textContent="Loading live event...",s.appendChild(e)}if(l&&(l.classList.add("loading"),!l.querySelector(".loading-text"))){const e=document.createElement("div");e.className="loading-text",e.textContent="Loading live activity...",l.appendChild(e)}window.currentLiveEventInfo={pubkey:n,identifier:e,kind:o},window.reconnectionAttempts={event:0,chat:0,zaps:0},C(n,e,o),B(n,e),z(n,e);const a=document.getElementById("noteLoaderContainer");return void(a&&(a.style.display="none"))}throw new Error("Invalid nostr identifier format.")}n=t.data}const o=document.querySelector(".note-content"),s=document.getElementById("zaps");if(o&&(o.classList.add("loading"),!o.querySelector(".loading-text"))){const e=document.createElement("div");e.className="loading-text",e.textContent="Loading note content...",o.appendChild(e)}if(s&&(s.classList.add("loading"),!s.querySelector(".loading-text"))){const e=document.createElement("div");e.className="loading-text",e.textContent="Loading zaps...",s.appendChild(e)}ce(n);const l=document.getElementById("noteLoaderContainer");l&&(l.style.display="none")}catch(t){const n=document.querySelector(".note-content"),o=document.getElementById("zaps");if(n&&(n.classList.add("loading"),!n.querySelector(".loading-text"))){const e=document.createElement("div");e.className="loading-text",e.textContent="Loading note content...",n.appendChild(e)}if(o&&(o.classList.add("loading"),!o.querySelector(".loading-text"))){const e=document.createElement("div");e.className="loading-text",e.textContent="Loading zaps...",o.appendChild(e)}ce(e);const s=document.getElementById("noteLoaderContainer");s&&(s.style.display="none")}}catch(e){l(e instanceof Error?e.message:"Failed to load note content")}},ee=e=>{if(!e||""===e.trim())throw new Error("Please enter a note ID");if(!((e=e.trim()).startsWith("note1")||e.startsWith("nevent1")||e.startsWith("naddr1")||e.startsWith("nprofile1")))throw new Error("Invalid format. Please enter a valid nostr note ID (note1...), event ID (nevent1...), addressable event (naddr1...), or profile (nprofile1...)");try{const t=window.NostrTools.nip19.decode(e);if("note"===t.type){if(!t.data||"string"!=typeof t.data||64!==t.data.length)throw new Error("Invalid note ID format")}else if("nevent"===t.type){if(!t.data||!t.data.id||"string"!=typeof t.data.id||64!==t.data.id.length)throw new Error("Invalid event ID format")}else if("naddr"===t.type){if(!t.data||!t.data.identifier||!t.data.pubkey||"number"!=typeof t.data.kind)throw new Error("Invalid addressable event format");if(30311!==t.data.kind)throw new Error("Only live events (kind 30311) are supported")}else{if("nprofile"!==t.type)throw new Error("Unsupported identifier type");if(!t.data||!t.data.pubkey)throw new Error("Invalid profile format")}return!0}catch(e){if(e instanceof Error&&(e.message.includes("Invalid")||e.message.includes("Unsupported")))throw new Error("Invalid nostr identifier format. Please check the note ID and try again.");throw new Error("Invalid nostr identifier format. Please check the note ID and try again.")}},te=e=>e.replace(/^nostr:/,""),ne=e=>{const t=document.getElementById("noteLoaderError");t&&(t.textContent=e,t.style.display="block")},oe=()=>{const e=document.getElementById("noteLoaderError");e&&(e.style.display="none")},se=()=>{localStorage.removeItem("pubpay-styles"),console.log("Cleared localStorage - resetting to defaults"),Fe("lightMode")},le=()=>{const e=document.querySelector(".main-layout");if(!e)return;const t=new URLSearchParams(window.location.search);if(""!==t.toString()){if(t.has("textColor")){const n=t.get("textColor");if(n){e.style.setProperty("--text-color",n);const t=document.getElementById("textColorPicker");t&&(t.value=n)}}if(t.has("bgColor")){const n=t.get("bgColor");if(n){const o=t.has("opacity")?parseFloat(t.get("opacity")||"1"):1,s=ze(n,o);e.style.backgroundColor=s;const l=document.getElementById("bgColorPicker");l&&(l.value=n)}}if(t.has("bgImage")){const e=t.get("bgImage");if(e){const t=document.getElementById("bgImageUrl");t&&(t.value=e,Me(e))}}if(t.has("qrInvert")){const e="true"===t.get("qrInvert"),n=document.getElementById("qrInvertToggle");n&&(n.checked=e);const o=[document.getElementById("qrCode"),document.getElementById("qrCodeNevent"),document.getElementById("qrCodeNote")];j&&o.push(document.getElementById("lightningQRCode")),o.forEach(t=>{t&&(t.style.filter=e?"invert(1)":"none")})}if(t.has("qrScreenBlend")){const e=document.getElementById("qrScreenBlendToggle");e&&(e.checked="true"===t.get("qrScreenBlend"))}if(t.has("qrMultiplyBlend")){const e=document.getElementById("qrMultiplyBlendToggle");e&&(e.checked="true"===t.get("qrMultiplyBlend"))}if((t.has("qrScreenBlend")||t.has("qrMultiplyBlend"))&&$e(),t.has("qrShowWebLink")){const e="true"===t.get("qrShowWebLink"),n=document.getElementById("qrShowWebLinkToggle");n&&(n.checked=e)}if(t.has("qrShowNevent")){const e="true"===t.get("qrShowNevent"),n=document.getElementById("qrShowNeventToggle");n&&(n.checked=e)}if(t.has("qrShowNote")){const e="true"===t.get("qrShowNote"),n=document.getElementById("qrShowNoteToggle");n&&(n.checked=e)}if(t.has("layoutInvert")){const e="true"===t.get("layoutInvert"),n=document.getElementById("layoutInvertToggle");n&&(n.checked=e),document.body.classList.toggle("flex-direction-invert",e)}if(t.has("hideZapperContent")){const e="true"===t.get("hideZapperContent"),n=document.getElementById("hideZapperContentToggle");n&&(n.checked=e),document.body.classList.toggle("hide-zapper-content",e)}if(t.has("showTopZappers")){const e="true"===t.get("showTopZappers"),n=document.getElementById("showTopZappersToggle");n&&(n.checked=e),document.body.classList.toggle("show-top-zappers",e)}if(t.has("podium")){const e="true"===t.get("podium"),n=document.getElementById("podiumToggle");n&&(n.checked=e),document.body.classList.toggle("podium-enabled",e)}if(t.has("zapGrid")){const e="true"===t.get("zapGrid"),n=document.getElementById("zapGridToggle");n&&(n.checked=e);const o=document.getElementById("zaps");o&&(o.classList.toggle("grid-layout",e),e?we():ve())}if(t.has("lightning")){const e="true"===t.get("lightning"),n=document.getElementById("lightningToggle");n&&(n.checked=e)}if(t.has("opacity")){const e=parseFloat(t.get("opacity")||"1"),n=document.getElementById("opacitySlider"),o=document.getElementById("opacityValue");n&&(n.value=e.toString()),o&&(o.textContent=`${Math.round(100*e)}%`)}if(t.has("textOpacity")){const e=parseFloat(t.get("textOpacity")||"1"),n=document.getElementById("textOpacitySlider"),o=document.getElementById("textOpacityValue");n&&(n.value=e.toString()),o&&(o.textContent=`${Math.round(100*e)}%`)}if(t.has("partnerLogo")){const e=decodeURIComponent(t.get("partnerLogo")||""),n=document.getElementById("partnerLogoSelect"),o=document.getElementById("partnerLogo"),s=document.getElementById("partnerLogoUrl"),l=document.getElementById("customPartnerLogoGroup"),a=document.getElementById("partnerLogoPreview");e?(Array.from(n.options).find(t=>t.value===e)?(n&&(n.value=e),l&&(l.style.display="none")):(n&&(n.value="custom"),l&&(l.style.display="block"),s&&(s.value=e)),o&&(o.src=e,o.style.display="inline-block"),a&&(a.src=e,a.alt="Partner logo preview")):(n&&(n.value=""),l&&(l.style.display="none"),o&&(o.style.display="none",o.src=""),a&&(a.src="",a.alt="No partner logo"))}Oe(),setTimeout(()=>{const e=document.getElementById("qrCode"),t=document.getElementById("qrCodeNevent"),n=document.getElementById("qrCodeNote");console.log("QR code elements check:",{qrCode:!!e,qrCodeNevent:!!t,qrCodeNote:!!n,qrCodeContent:e?.innerHTML,qrCodeNeventContent:t?.innerHTML,qrCodeNoteContent:n?.innerHTML}),"function"==typeof De&&(console.log("Updating QR slide visibility after URL styles applied..."),De(!0))},500),(()=>{const e=document.querySelector(".main-layout");if(!e)return;const t=document.getElementById("partnerLogoSelect"),n=document.getElementById("partnerLogoUrl");let o="";t&&(o="custom"===t.value&&n?n.value:t.value);const s={textColor:Be(e.style.getPropertyValue("--text-color")||h),bgColor:Be(e.style.backgroundColor),bgImage:document.getElementById("bgImageUrl")?.value||"",qrInvert:document.getElementById("qrInvertToggle")?.checked||!1,qrScreenBlend:document.getElementById("qrScreenBlendToggle")?.checked||!1,qrMultiplyBlend:document.getElementById("qrMultiplyBlendToggle")?.checked||!1,qrShowWebLink:document.getElementById("qrShowWebLinkToggle")?.checked??!0,qrShowNevent:document.getElementById("qrShowNeventToggle")?.checked??!0,qrShowNote:document.getElementById("qrShowNoteToggle")?.checked??!0,layoutInvert:document.getElementById("layoutInvertToggle")?.checked||!1,hideZapperContent:document.getElementById("hideZapperContentToggle")?.checked||!1,showTopZappers:document.getElementById("showTopZappersToggle")?.checked||!1,podium:document.getElementById("podiumToggle")?.checked||!1,zapGrid:document.getElementById("zapGridToggle")?.checked||!1,lightning:document.getElementById("lightningToggle")?.checked||!1,opacity:parseFloat(document.getElementById("opacitySlider")?.value||"1"),textOpacity:parseFloat(document.getElementById("textOpacitySlider")?.value||"1"),partnerLogo:o};localStorage.setItem("pubpay-styles",JSON.stringify(s));const l=window.location.pathname.split("/"),a=l[l.length-1],i=a&&"live"!==a?`/live/${a}`:"/live";window.location.href!==window.location.origin+i&&window.history.replaceState({},"",i)})()}},ae=()=>{const e=localStorage.getItem("pubpay-styles");let t=window.location.origin+window.location.pathname;if(e)try{const n=JSON.parse(e),o=new URLSearchParams;n.textColor&&n.textColor!==h&&o.set("textColor",n.textColor),n.bgColor&&"#ffffff"!==n.bgColor&&o.set("bgColor",n.bgColor),n.bgImage&&""!==n.bgImage&&o.set("bgImage",n.bgImage),false!==n.qrInvert&&o.set("qrInvert",n.qrInvert),false!==n.qrScreenBlend&&o.set("qrScreenBlend",n.qrScreenBlend),false!==n.qrMultiplyBlend&&o.set("qrMultiplyBlend",n.qrMultiplyBlend),false!==n.qrShowWebLink&&o.set("qrShowWebLink",n.qrShowWebLink),true!==n.qrShowNevent&&o.set("qrShowNevent",n.qrShowNevent),false!==n.qrShowNote&&o.set("qrShowNote",n.qrShowNote),false!==n.layoutInvert&&o.set("layoutInvert",n.layoutInvert),false!==n.hideZapperContent&&o.set("hideZapperContent",n.hideZapperContent),false!==n.showTopZappers&&o.set("showTopZappers",n.showTopZappers),false!==n.podium&&o.set("podium",n.podium),false!==n.zapGrid&&o.set("zapGrid",n.zapGrid),false!==n.lightning&&o.set("lightning",n.lightning),1!==n.opacity&&o.set("opacity",n.opacity),1!==n.textOpacity&&o.set("textOpacity",n.textOpacity),n.partnerLogo&&""!==n.partnerLogo&&o.set("partnerLogo",encodeURIComponent(n.partnerLogo)),o.toString()&&(t+=`?${o.toString()}`)}catch(e){console.error("Error parsing saved styles:",e)}navigator.clipboard.writeText(t).then(()=>{const e=document.getElementById("copyStyleUrl");if(e){const t=e.textContent;e.textContent="Copied!",e.style.background="#28a745",setTimeout(()=>{e.textContent=t,e.style.background=""},2e3)}}).catch(e=>{console.error("Failed to copy URL:",e);const n=document.createElement("textarea");n.value=t,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n)})},ie=()=>{v(0),b(0),u([]),x([]),Z()},re=()=>{console.log("Grid toggle enabled")},ce=async e=>{if(!window.pool||!window.relays)return void console.error("Nostr pool or relays not available");const t=window.pool,n=window.relays,o={ids:[e]},s=setTimeout(()=>{console.log("Kind1 subscription timeout - no events received after 10 seconds")},1e4);t.subscribeMany([...n],[o],{async onevent(e){clearTimeout(s),console.log("Received kind1 event:",e),await be(e),await de(e),await pe(e)},oneose(){clearTimeout(s)},onclosed(){clearTimeout(s)}})},de=async e=>{if(!window.pool||!window.relays)return;const t=window.pool,n=window.relays,o=e.pubkey;t.subscribeMany([...n],[{kinds:[0],authors:[o]}],{onevent(e){fe(e)},oneose(){},onclosed(){}})},pe=async e=>{if(console.log("subscribeKind9735fromKind1 called for kind1:",e.id),!window.pool||!window.relays)return void console.log("Pool or relays not available, skipping zap subscription");const t=window.pool,n=window.relays,o=new Set,s=[],l=e.id;let a=!0;const i=document.getElementById("zaps"),r=setTimeout(()=>{if(0===s.length&&i){i.classList.remove("loading");const e=i.querySelector(".loading-text");e&&e.remove();const t=document.createElement("div");t.className="empty-zaps-state",t.innerHTML='\n            <div class="empty-zaps-message">\n              Be the first to support\n            </div>\n          ',i.appendChild(t)}},15e3);t.subscribeMany([...n],[{kinds:[9735],"#e":[l]}],{onevent(e){console.log("Received kind9735 zap event:",e.id),clearTimeout(r),o.has(e.id)||(o.add(e.id),s.push(e),console.log("Added zap to list, total zaps:",s.length),a||ge([e]))},oneose(){clearTimeout(r),a=!1,ge(s)},onclosed(){clearTimeout(r)}})},ge=e=>{if(!window.pool||!window.relays)return;const t=window.pool,n=window.relays,o=[],s=[],l=new Set;for(const t of e)if(t.tags){const e=t.tags.find(e=>"description"===e[0])?.[1];if(e){const t=JSON.parse(e);o.push(t.pubkey)}}t.subscribeMany([...n],[{kinds:[0],authors:o}],{onevent(e){l.has(e.pubkey)||(l.add(e.pubkey),s.push(e))},async oneose(){console.log("Zap subscription closed, processing",e.length,"zaps"),ue(e,s)},onclosed(){}})},ue=async(e,t)=>{console.log("createkinds9735JSON called with",e.length,"zaps"),ie();const n=[];for(const o of e){const e=JSON.parse(o.tags.find(e=>"description"==e[0])?.[1]||"{}"),s=e.pubkey,l=o.tags.find(e=>"bolt11"==e[0])?.[1];if(!l)continue;const a=window.lightningPayReq?.decode(l)?.satoshis||0,i=o.tags.find(e=>"e"==e[0])?.[1],r=window.NostrTools?.nip19?.noteEncode(o.id)||o.id,c=e.content||"";let d="",p="",g="",u="",m=null;const h=t.find(e=>s===e.pubkey);if(h){const e=JSON.parse(h.content);g=e.displayName?e.displayName:e.display_name,u=""!=g?g:e.name,d=e.picture,p=window.NostrTools?.nip19?.npubEncode(h.pubkey)||"",m=e}const y={e:i,amount:a,picture:d,npubPayer:p,pubKey:s,zapEventID:r,kind9735content:c,kind1Name:u,kind0Profile:m};n.push(y)}n.sort((e,t)=>t.amount-e.amount),me(n)},me=e=>{console.log("drawKinds9735 called with",e.length,"zaps:",e);const t=document.getElementById("zaps");if(!t)return;t.innerHTML="",t.classList.remove("loading");const n=t.querySelector(".loading-text");n&&n.remove();const o=e.reduce((e,t)=>e+t.amount,0),s=document.getElementById("zappedTotalValue"),l=document.getElementById("zappedTotalCount");if(s&&(s.innerText=ye(o)),l&&(l.innerText=e.length.toString()),b(o),v(e.length),u(e),0===e.length){const e=document.createElement("div");return e.className="empty-zaps-state",e.innerHTML='\n        <div class="empty-zaps-message">\n          Be the first to support\n        </div>\n      ',void t.appendChild(e)}const a=e.sort((e,t)=>t.amount-e.amount);for(let e=0;e<a.length;e++){const n=a[e],o=document.createElement("div"),s="zap";o.className=s,n.picture||(n.picture="");const l=""==n.picture?"/images/gradient_color.gif":n.picture;o.innerHTML=`\n        <div class="zapperProfile">\n          <img class="zapperProfileImg" src="${l}" />\n          <div class="zapperInfo">\n            <div class="zapperName">\n              ${n.kind1Name||"Anonymous"}\n            </div>\n            <div class="zapperMessage">${n.kind9735content||""}</div>\n          </div>\n        </div>\n        <div class="zapperAmount">\n          <span class="zapperAmountSats">${ye(n.amount)}</span>\n          <span class="zapperAmountLabel">sats</span>\n        </div>\n      `,t.appendChild(o)}const i=document.getElementById("zapGridToggle");if(i&&i.checked)t.classList.add("grid-layout"),setTimeout(()=>{we()},10);else if(t.classList.remove("grid-layout"),document.body.classList.contains("podium-enabled")){const e=[...Array.from(t.querySelectorAll(".zap"))].sort((e,t)=>{const n=parseInt(e.querySelector(".zapperAmountSats")?.textContent?.replace(/[^\d]/g,"")||"0");return parseInt(t.querySelector(".zapperAmountSats")?.textContent?.replace(/[^\d]/g,"")||"0")-n});console.log("Applying podium classes in list layout. Top 3 zaps:",e.slice(0,3).map(e=>({amount:e.querySelector(".zapperAmountSats")?.textContent,name:e.querySelector(".zapperName")?.textContent})));for(let t=0;t<Math.min(3,e.length);t++){const n=e[t];n&&(n.classList.add(`podium-${t+1}`),console.log(`Applied podium-${t+1} to zap with amount:`,n.querySelector(".zapperAmountSats")?.textContent))}}he(e)},he=e=>{console.log("calculateTopZappersFromZaps called with",e.length,"zaps"),console.log("Sample zap data:",e[0]);const t=new Map;for(const n of e){const e=n.pubKey||n.pubkey,o=n.amount,s=n.kind0Profile||null;if(console.log("Processing zap:",{pubkey:e,amount:o,profile:s,zap:n}),t.has(e)){const n=t.get(e);n.amount+=o,console.log("Updated existing zapper:",n)}else{const l={amount:o,profile:s,name:s?_(s):n.kind1Name||"Anonymous",picture:s?.picture||n.picture||"/images/gradient_color.gif"};t.set(e,l),console.log("Added new zapper:",l)}}const n=Array.from(t.values()).sort((e,t)=>t.amount-e.amount).slice(0,5);console.log("Calculated top zappers:",n),console.log("Setting topZappers state..."),x(n),window.topZappers=n},ye=e=>e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),ve=()=>{const e=document.getElementById("zaps");e&&(e.classList.contains("live-event-two-column")?console.log("Skipping grid cleanup for live events"):e.querySelectorAll(".zap-row").forEach(t=>{Array.from(t.children).forEach(t=>{t.className=t.className.replace(/row-\d+/g,""),t.className=t.className.replace(/podium-global-\d+/g,""),e.appendChild(t)}),t.remove()}))},we=()=>{const e=document.getElementById("zaps");if(!e)return;if(e.classList.contains("live-event-two-column"))return void console.log("Skipping grid organization for live events");const t=Array.from(e.querySelectorAll(".zap"));if(0===t.length)return;t.forEach(e=>{e.className=e.className.replace(/row-\d+/g,""),e.className=e.className.replace(/podium-\d+/g,""),e.className=e.className.replace(/podium-global-\d+/g,"")}),e.querySelectorAll(".zap-row").forEach(e=>e.remove());const n=[...t].sort((e,t)=>{const n=parseInt(e.querySelector(".zapperAmountSats")?.textContent?.replace(/[^\d]/g,"")||"0");return parseInt(t.querySelector(".zapperAmountSats")?.textContent?.replace(/[^\d]/g,"")||"0")-n});if(document.body.classList.contains("podium-enabled")){console.log("Applying podium classes in grid layout. Top 3 zaps:",n.slice(0,3).map(e=>({amount:e.querySelector(".zapperAmountSats")?.textContent,name:e.querySelector(".zapperName")?.textContent})));for(let e=0;e<Math.min(3,n.length);e++){const t=n[e];t&&(t.classList.add(`podium-global-${e+1}`),console.log(`Applied podium-global-${e+1} to zap with amount:`,t.querySelector(".zapperAmountSats")?.textContent))}}let o=0,s=1,l=1;for(;o<t.length;){const n=document.createElement("div");n.className=`zap-row row-${s}`;for(let e=0;e<l&&o<t.length;e++){const e=t[o];e&&(e.classList.add(`row-${s}`),n.appendChild(e)),o++}if(e.appendChild(n),l*=2,s++,s>5){for(;o<t.length;){const e=t[o];e&&(e.classList.add("row-5"),n.appendChild(e)),o++}break}}},be=async e=>{console.log("Drawing kind1:",e),window.currentNoteId=e.id;const t=document.getElementById("noteContent");if(console.log("Note content element:",t),t){const n=await xe(e.content);console.log("Processed content:",n),t.innerHTML=n,t.classList.remove("loading");const o=t.querySelector(".loading-text");o&&o.remove()}i(e.content),window.lightningEnabled&&(console.log("Note loaded, attempting to enable Lightning payments..."),setTimeout(()=>{window.enableLightningPayments&&window.enableLightningPayments()},100));const n=e.id,o=window.NostrTools.nip19.neventEncode({id:n,relays:[]}),s=window.NostrTools.nip19.noteEncode(n),l=`https://njump.me/${s}`,a=`nostr:${o}`,r=`nostr:${s}`,c=Math.min(.6*window.innerWidth,.7*window.innerHeight);[{element:document.getElementById("qrCode"),value:l,link:document.getElementById("qrcodeLinkNostr"),preview:document.getElementById("qrDataPreview1")},{element:document.getElementById("qrCodeNevent"),value:a,link:document.getElementById("qrcodeNeventLink"),preview:document.getElementById("qrDataPreview2")},{element:document.getElementById("qrCodeNote"),value:r,link:document.getElementById("qrcodeNoteLink"),preview:document.getElementById("qrDataPreview3")}].forEach(({element:e,value:t,link:n,preview:o})=>{if(e&&(e.innerHTML="",new window.QRious({element:e,size:c,value:t}),n&&(n.href=t),o)){let e=t,n=10;t.startsWith("https://")?(e=t.substring(8),n=20):t.startsWith("nostr:")&&(e=t.substring(6));const s=`${e.substring(0,n)}...`;o.textContent=s}}),window.qrSwiper||(window.qrSwiper=new window.Swiper(".qr-swiper",{slidesPerView:1,spaceBetween:0,pagination:{el:".swiper-pagination",clickable:!0,dynamicBullets:!1},loop:!0,autoplay:{delay:1e4,disableOnInteraction:!1,pauseOnMouseEnter:!0},autoHeight:!1,height:250,watchOverflow:!0,observer:!0,observeParents:!0}))},fe=e=>{console.log("Drawing kind0:",e);try{const t=JSON.parse(e.content);c(t.name||t.display_name||"Anonymous"),p(t.picture||"/images/gradient_color.gif")}catch(e){console.error("Error parsing profile:",e)}},xe=async e=>e,Ne=async e=>{console.log("Subscribing to profile info:",e)},Se=(e,t)=>{const n=document.querySelector(".note-content"),o=document.getElementById("zaps");if(n&&(n.classList.add("loading"),!n.querySelector(".loading-text"))){const t=document.createElement("div");t.className="loading-text",t.textContent=e,n.appendChild(t)}if(o&&(o.classList.add("loading"),!o.querySelector(".loading-text"))){const e=document.createElement("div");e.className="loading-text",e.textContent=t,o.appendChild(e)}},Ie=async()=>{console.log("handleNoteLoaderSubmit called!");const e=document.getElementById("note1LoaderInput"),t=e?.value?.trim();if(console.log("Input field value:",t),!t)return console.log("No note ID provided"),void ne("Please enter a note ID");const o=te(t);try{ee(o),oe()}catch(e){return void ne(e instanceof Error?e.message:"Invalid note ID")}try{const e=window.NostrTools.nip19.decode(o),t=`/live/${o}`;if(window.history.pushState({},"",t),window.dispatchEvent(new CustomEvent("noteLoaderSubmitted",{detail:{noteId:o,decoded:e}})),n(!0),l(null),"naddr"===e.type){const{identifier:t,pubkey:n,kind:o}=e.data;Se("Loading live event...","Loading live activity..."),await C(n,t,o),await B(n,t),await z(n,t)}else if("nprofile"===e.type){const{pubkey:t}=e.data;Se("Loading profile...","Loading profile activity..."),await(async e=>{try{c("Profile Author"),i("Profile content will be loaded here"),await Ne(e)}catch(e){throw new Error("Failed to load profile content")}})(t)}else if("nevent"===e.type){const t=e.data.id;Se("Loading note content...","Loading zaps..."),await ce(t)}else{if("note"!==e.type)throw new Error("Invalid identifier format. Please enter a valid nostr identifier.");{const t=e.data;Se("Loading note content...","Loading zaps..."),await ce(t)}}}catch(e){console.error("Error loading note content:",e),ne("Invalid nostr identifier. Please enter a valid note ID (note1...), event ID (nevent1...), live event (naddr1...), or profile (nprofile1...)."),n(!1)}},je=()=>{const e=document.getElementById("note1LoaderSubmit"),t=document.getElementById("note1LoaderInput");if(console.log("Setting up note loader listeners..."),console.log("Submit button found:",!!e),console.log("Input field found:",!!t),!t)return console.warn("Input field not found, retrying in 100ms..."),void setTimeout(je,100);e&&(e.removeEventListener("click",Ie),e.addEventListener("click",e=>{console.log("Submit button clicked!"),e.preventDefault(),Ie()}),console.log("Submit button event listener added"),console.log("Button properties:",{disabled:e.disabled,style:e.style.cssText,pointerEvents:window.getComputedStyle(e).pointerEvents}),console.log("handleNoteLoaderSubmit function:",typeof Ie),e.addEventListener("click",()=>{console.log("TEST: Button click detected!")})),t&&(t.addEventListener("keypress",e=>{console.log("Keypress event:",e.key),"Enter"===e.key&&(console.log("Enter key pressed!"),e.preventDefault(),Ie())}),t.addEventListener("input",e=>{console.log("Input event:",e.target.value),oe()}),console.log("Input field event listeners added"))},ke=()=>{console.log("Setting up style options..."),qe("textColorPicker","textColorValue","color"),qe("bgColorPicker","bgColorValue","backgroundColor");const t=document.getElementById("bgImagePreset"),n=document.getElementById("bgImageUrl"),o=document.getElementById("bgPresetPreview"),s=document.getElementById("clearBgImage"),l=document.getElementById("customUrlGroup");t&&t.addEventListener("change",e=>{const t=e.target.value;console.log("ðŸ”„ Background preset changed to:",t),"custom"===t?(l&&(l.style.display="block"),n&&n.focus()):(l&&(l.style.display="none"),n&&(n.value=t,console.log("âœ… Set bgImageUrl.value to:",n.value)),Me(t),o&&(o.src=t,o.alt=t?"Background preview":"No background")),Re()}),n&&n.addEventListener("input",e=>{const t=e.target.value.trim();if(t){const e=new Image;e.onload=()=>{Me(t),o&&(o.src=t,o.alt="Background preview"),Re()},e.onerror=()=>{o&&(o.src="",o.alt="Failed to load image")},e.src=t}else Me(""),o&&(o.src="",o.alt="No background"),Re()}),s&&s.addEventListener("click",()=>{n&&(n.value=""),t&&(t.value=""),l&&(l.style.display="none"),Me(""),o&&(o.src="",o.alt="No background"),Re()}),Ce("layoutInvertToggle",e=>{console.log("layoutInvertToggle callback called, checked:",e),e?document.body.classList.add("flex-direction-invert"):document.body.classList.remove("flex-direction-invert"),console.log("Body classes after toggle:",document.body.className)}),Ce("hideZapperContentToggle",e=>{console.log("hideZapperContentToggle callback called, checked:",e),e?document.body.classList.add("hide-zapper-content"):document.body.classList.remove("hide-zapper-content"),console.log("Body classes after toggle:",document.body.className)}),Ce("showTopZappersToggle",e=>{console.log("showTopZappersToggle callback called, checked:",e),e?(console.log("Toggle is ON, showing top zappers"),document.body.classList.add("show-top-zappers"),console.log("Current topZappers state:",f),console.log("Current zaps state length:",g.length),g.length>0&&0===f.length?(console.log("Have zaps but no top zappers calculated, calculating now..."),he(g)):f.length>0?(console.log("Have top zappers data, displaying immediately..."),U()):(console.log("No zaps or top zappers data available yet, setting flag to show when data loads"),S(!0))):(console.log("Toggle is OFF, hiding top zappers bar"),document.body.classList.remove("show-top-zappers"),Z())}),Ce("podiumToggle",e=>{console.log("podiumToggle callback called, checked:",e),e?document.body.classList.add("podium-enabled"):document.body.classList.remove("podium-enabled"),console.log("Body classes after toggle:",document.body.className);const t=document.getElementById("zapGridToggle"),n=t?.checked;n?(console.log("Grid is active, reorganizing zaps hierarchically..."),setTimeout(()=>{we()},10)):g.length>0&&(console.log("Re-rendering zaps to apply podium styling..."),me(g))}),Ce("zapGridToggle",e=>{console.log("zapGridToggle callback called, checked:",e);const t=document.getElementById("zaps");if(t){if(t.classList.contains("live-event-two-column"))return void console.log("Grid layout not supported for live events - skipping");t.classList.toggle("grid-layout",e),e?(console.log("Grid layout enabled, organizing zaps hierarchically"),we()):(console.log("Grid layout disabled, cleaning up hierarchical organization"),ve()),g.length>0&&(console.log("Re-rendering zaps after grid toggle to apply podium styling..."),me(g))}}),Ce("qrInvertToggle",()=>{console.log("qrInvertToggle callback called");const e=document.getElementById("qrInvertToggle"),t=[document.getElementById("qrCode"),document.getElementById("qrCodeNevent"),document.getElementById("qrCodeNote")];console.log("QR codes found:",t.map(e=>e?"found":"not found")),t.forEach((t,n)=>{t&&(t.style.filter=e?.checked?"invert(1)":"none",console.log(`QR code ${n} filter after toggle:`,t.style.filter))})}),Ce("qrScreenBlendToggle",()=>{console.log("qrScreenBlendToggle callback called");const e=document.getElementById("qrScreenBlendToggle"),t=document.getElementById("qrMultiplyBlendToggle");e?.checked&&(t.checked=!1),console.log("Calling updateBlendMode..."),$e()}),Ce("qrMultiplyBlendToggle",()=>{console.log("qrMultiplyBlendToggle callback called");const e=document.getElementById("qrScreenBlendToggle"),t=document.getElementById("qrMultiplyBlendToggle");t?.checked&&(e.checked=!1),console.log("Calling updateBlendMode..."),$e()});const a=document.getElementById("opacitySlider"),i=document.getElementById("opacityValue"),r=document.getElementById("textOpacitySlider"),c=document.getElementById("textOpacityValue");a&&i&&(console.log("Setting up opacity slider"),a.addEventListener("input",e=>{const t=parseFloat(e.target.value);i.textContent=`${Math.round(100*t)}%`,Ee(),Re()})),r&&c&&(console.log("Setting up text opacity slider"),r.addEventListener("input",e=>{const t=parseFloat(e.target.value);c.textContent=`${Math.round(100*t)}%`,Ee(),Re()})),Ce("qrShowWebLinkToggle",()=>{console.log("qrShowWebLinkToggle callback called"),"function"==typeof De?(console.log("Calling updateQRSlideVisibility..."),De()):console.log("updateQRSlideVisibility function not found")}),Ce("qrShowNeventToggle",()=>{console.log("qrShowNeventToggle callback called"),"function"==typeof De?(console.log("Calling updateQRSlideVisibility..."),De()):console.log("updateQRSlideVisibility function not found")}),Ce("qrShowNoteToggle",()=>{console.log("qrShowNoteToggle callback called"),"function"==typeof De?(console.log("Calling updateQRSlideVisibility..."),De()):console.log("updateQRSlideVisibility function not found")}),Ce("lightningToggle",async()=>{if(console.log("ðŸ”Œ Lightning toggle callback called"),console.log("Current lightningEnabled state:",j),console.log("EventId:",e),I.current)try{if(j){console.log("ðŸ”Œ Disabling Lightning payments...");const t=await I.current.disableLightning(e);console.log("Disable result:",t),t?(k(!1),E(""),console.log("âœ… Lightning payments disabled")):console.error("âŒ Failed to disable Lightning payments")}else{console.log("ðŸ”Œ Enabling Lightning payments..."),console.log("Calling lightningService.enableLightning with eventId:",e);const t=await I.current.enableLightning(e);if(console.log("Enable result:",t),console.log("Lightning service state after enable:",{enabled:I.current.enabled,lnurl:I.current.currentLnurl,loading:I.current.loading,error:I.current.lastError}),t){k(!0);const e=I.current.currentLnurl||"";E(e),console.log("âœ… Lightning payments enabled with LNURL:",e),e?(console.log("ðŸ”Œ Creating Lightning QR slide..."),(e=>{console.log("ðŸ”Œ Creating Lightning QR slide with LNURL:",e),console.log("QRious available:",!!window.QRious);let t=document.getElementById("lightningQRSlide");if(t){console.log("ðŸ”Œ Lightning QR slide already exists, updating QR code");const n=t.querySelector("#qrCodeLightning");return void(n&&window.QRious?(n.innerHTML="",new window.QRious({element:n,size:200,value:e}),console.log("âœ… Lightning QR code updated")):console.error("âŒ QR element not found or QRious not available"))}console.log("ðŸ”Œ Creating new Lightning QR slide..."),t=document.createElement("div"),t.id="lightningQRSlide",t.className="swiper-slide",t.innerHTML='\n      <div class="qr-container">\n        <div class="qr-code" id="qrCodeLightning"></div>\n        <div class="qr-label">Lightning Payment</div>\n      </div>\n    ';const n=document.querySelector(".qr-swiper .swiper-wrapper");console.log("Swiper wrapper found:",!!n),n?(n.appendChild(t),console.log("âœ… Lightning QR slide added to swiper"),window.QRious?(console.log("ðŸ”Œ Generating QR code..."),new window.QRious({element:document.getElementById("qrCodeLightning"),size:200,value:e}),console.log("âœ… Lightning QR code generated")):console.error("âŒ QRious library not available"),window.lightningQRSlide=t,console.log("âœ… Lightning QR slide created and stored globally")):console.error("âŒ Swiper wrapper not found")})(e)):console.error("âŒ No LNURL received from Lightning service")}else console.error("âŒ Failed to enable Lightning payments"),console.error("Error from service:",I.current.lastError)}"function"==typeof De?(console.log("ðŸ”Œ Calling updateQRSlideVisibility..."),De()):console.log("âŒ updateQRSlideVisibility function not found")}catch(e){console.error("âŒ Error toggling Lightning payments:",e)}else console.error("âŒ Lightning service not initialized")});const d=document.getElementById("partnerLogoSelect"),p=(document.getElementById("partnerLogo"),document.getElementById("partnerLogoUrl")),u=document.getElementById("customPartnerLogoGroup"),m=(document.getElementById("partnerLogoPreview"),document.getElementById("clearPartnerLogo"));d&&d.addEventListener("change",()=>{"custom"===d.value?u&&(u.style.display="block"):(u&&(u.style.display="none"),p&&(p.value="")),Ee(),Re()}),p&&p.addEventListener("input",()=>{Ee(),Re()}),m&&m.addEventListener("click",()=>{d&&(d.value=""),p&&(p.value=""),u&&(u.style.display="none"),Ee(),Re()}),Oe(),document.querySelectorAll(".preset-btn").forEach(e=>{e.addEventListener("click",e=>{const t=e.target.getAttribute("data-preset");Fe(t)})});const h=document.getElementById("resetStyles"),y=document.getElementById("copyStyleUrl");h&&h.addEventListener("click",se),y&&y.addEventListener("click",ae)};let Le=null;const Ee=()=>{Le&&clearTimeout(Le),Le=setTimeout(()=>{Oe()},50)},qe=(e,t,n)=>{const o=document.getElementById(e),s=document.getElementById(t);o&&s?(console.log(`Setting up color picker: ${e} -> ${t}`),o.addEventListener("input",()=>{const e=Be(o.value);s.value=e,Ee(),Re()}),s.addEventListener("input",()=>{const e=Be(s.value);o.value=e,Ee(),Re()})):console.log(`Color picker not found: ${e} or ${t}`)},Ce=(e,t)=>{const n=document.getElementById(e);n?(console.log(`Setting up toggle: ${e}`),n.addEventListener("change",()=>{console.log(`Toggle ${e} changed to:`,n.checked),t(n.checked),Re()})):console.log(`Toggle not found: ${e}`)},Be=e=>{if(e.startsWith("#"))return e;if(e.startsWith("rgb")){const t=e.match(/\d+/g);if(t&&t.length>=3){const e=parseInt(t[0]||"0"),n=parseInt(t[1]||"0"),o=parseInt(t[2]||"0");return`#${e.toString(16).padStart(2,"0")}${n.toString(16).padStart(2,"0")}${o.toString(16).padStart(2,"0")}`}}return"#000000"},ze=(e,t)=>(e=e.replace("#",""),`rgba(${parseInt(e.substring(0,2),16)}, ${parseInt(e.substring(2,4),16)}, ${parseInt(e.substring(4,6),16)}, ${t})`),Te=()=>{if(console.log("Loading initial styles..."),""!==new URLSearchParams(window.location.search).toString())return console.log("URL parameters found, applying styles from URL..."),void le();const e=localStorage.getItem("pubpay-styles");if(console.log("No URL parameters, loading from localStorage:",e),e)try{const t=JSON.parse(e);if(console.log("Parsed styles:",t),(t.bgImage||t.backgroundImage)&&console.log("ðŸ” Loading background image:",t.bgImage||t.backgroundImage),t.textColor){const e=document.getElementById("textColorPicker"),n=document.getElementById("textColorValue");e&&(e.value=t.textColor),n&&(n.value=t.textColor)}const n=t.bgColor||t.backgroundColor;if(n){const e=document.getElementById("bgColorPicker"),t=document.getElementById("bgColorValue");e&&(e.value=n),t&&(t.value=n)}if(void 0!==t.opacity){const e=document.getElementById("opacitySlider"),n=document.getElementById("opacityValue");console.log("Loading opacity:",t.opacity),e&&(e.value=t.opacity.toString(),console.log("Set opacity slider to:",e.value)),n&&(n.textContent=`${Math.round(100*t.opacity)}%`,console.log("Set opacity value to:",n.textContent))}if(void 0!==t.textOpacity){const e=document.getElementById("textOpacitySlider"),n=document.getElementById("textOpacityValue");console.log("Loading textOpacity:",t.textOpacity),e&&(e.value=t.textOpacity.toString(),console.log("Set textOpacity slider to:",e.value)),n&&(n.textContent=`${Math.round(100*t.textOpacity)}%`,console.log("Set textOpacity value to:",n.textContent))}if(void 0!==t.partnerLogo){const e=document.getElementById("partnerLogoSelect"),n=document.getElementById("partnerLogoUrl"),o=document.getElementById("customPartnerLogoGroup");e&&(t.partnerLogo?Array.from(e.options).find(e=>e.value===t.partnerLogo)?(e.value=t.partnerLogo,o&&(o.style.display="none")):(e.value="custom",o&&(o.style.display="block"),n&&(n.value=t.partnerLogo)):(e.value="",o&&(o.style.display="none"),n&&(n.value="")))}const o=t.bgImage||t.backgroundImage;if(void 0!==o){const e=document.getElementById("bgImagePreset"),t=document.getElementById("bgImageUrl"),n=document.getElementById("customBgImageGroup"),s=document.getElementById("bgPresetPreview");if(e)if(o){console.log("ðŸ” Setting background image:",o);const l=Array.from(e.options).find(e=>e.value===o);l?(console.log("âœ… Found matching preset option:",l.value),e.value=o,n&&(n.style.display="none"),t&&(t.value=o,console.log("âœ… Set bgImageUrl.value to:",t.value))):(console.log("âš ï¸ No matching preset, setting as custom"),e.value="custom",n&&(n.style.display="block"),t&&(t.value=o,console.log("âœ… Set bgImageUrl.value to:",t.value))),s&&(s.src=o,s.alt="Background preview",console.log("âœ… Updated bgPresetPreview.src to:",o))}else console.log("âŒ No background image, clearing"),e.value="",n&&(n.style.display="none"),t&&(t.value=""),s&&(s.src="",s.alt="No background",console.log("âœ… Cleared bgPresetPreview"))}const s={qrShowWebLink:"qrShowWebLinkToggle",qrShowNevent:"qrShowNeventToggle",qrShowNote:"qrShowNoteToggle",qrInvert:"qrInvertToggle",qrScreenBlend:"qrScreenBlendToggle",qrMultiplyBlend:"qrMultiplyBlendToggle",layoutInvert:"layoutInvertToggle",hideZapperContent:"hideZapperContentToggle",showTopZappers:"showTopZappersToggle",podium:"podiumToggle",zapGrid:"zapGridToggle",lightning:"lightningToggle"};["layoutInvertToggle","hideZapperContentToggle","showTopZappersToggle","podiumToggle","zapGridToggle","qrInvertToggle","qrScreenBlendToggle","qrMultiplyBlendToggle","qrShowWebLinkToggle","qrShowNeventToggle","qrShowNoteToggle","lightningToggle"].forEach(e=>{const n=document.getElementById(e),o=Object.keys(s).find(t=>s[t]===e);if(n&&o&&void 0!==t[o]){console.log(`ðŸ”„ Loading toggle ${e} from property ${o}:`,t[o]),n.checked=t[o];const s={layoutInvertToggle:e=>{e?document.body.classList.add("flex-direction-invert"):document.body.classList.remove("flex-direction-invert")},hideZapperContentToggle:e=>{e?document.body.classList.add("hide-zapper-content"):document.body.classList.remove("hide-zapper-content")},showTopZappersToggle:e=>{if(e)console.log("Toggle is ON, adding show-top-zappers class"),document.body.classList.add("show-top-zappers");else{console.log("Toggle is OFF, hiding top zappers"),document.body.classList.remove("show-top-zappers");const e=document.getElementById("top-zappers-bar");e&&(e.style.display="none")}},podiumToggle:e=>{e?document.body.classList.add("podium-enabled"):document.body.classList.remove("podium-enabled")},zapGridToggle:e=>{const t=document.getElementById("zaps");t&&(e?t.classList.add("grid-layout"):t.classList.remove("grid-layout"))},qrInvertToggle:e=>{[document.getElementById("qrCode"),document.getElementById("qrCodeNevent"),document.getElementById("qrCodeNote")].forEach((t,n)=>{t&&(t.style.filter=e?"invert(1)":"none",console.log(`QR code ${n} filter after restore:`,t.style.filter))})},qrScreenBlendToggle:e=>{console.log("QR Screen Blend toggle restored:",e),$e()},qrMultiplyBlendToggle:e=>{console.log("QR Multiply Blend toggle restored:",e),$e()},qrShowWebLinkToggle:e=>{console.log("QR Web Link toggle loaded:",e)},qrShowNeventToggle:e=>{console.log("QR Nevent toggle loaded:",e)},qrShowNoteToggle:e=>{console.log("QR Note toggle loaded:",e)},lightningToggle:e=>{console.log("Lightning toggle loaded:",e)}}[e];s&&(console.log(`âœ… Applying toggle effect for ${e}:`,t[o]),s(t[o]))}})}catch(e){console.error("Error loading saved styles:",e)}else{console.log("No saved styles found, applying default styles...");const e=document.getElementById("textColorPicker"),t=document.getElementById("textColorValue"),n=document.getElementById("bgColorPicker"),o=document.getElementById("bgColorValue"),s=document.getElementById("opacitySlider"),l=document.getElementById("opacityValue"),a=document.getElementById("textOpacitySlider"),i=document.getElementById("textOpacityValue"),r="#ffffff",c="#000000",d=1,p=1;e&&(e.value=r),t&&(t.value=r),n&&(n.value=c),o&&(o.value=c),s&&(s.value=d.toString()),l&&(l.textContent=`${Math.round(100*d)}%`),a&&(a.value=p.toString()),i&&(i.textContent=`${Math.round(100*p)}%`)}setTimeout(()=>{Oe(),Pe(),setTimeout(()=>{"function"==typeof De&&(console.log("Final QR visibility update after all styles loaded"),De(!0))},200)},100)},Pe=()=>{console.log("Detecting active preset...");const e=document.getElementById("textColorValue"),t=document.getElementById("bgColorValue"),n=document.getElementById("bgImageUrl"),o=document.getElementById("textOpacitySlider"),s=document.getElementById("opacitySlider"),l=document.getElementById("partnerLogoSelect"),a=document.getElementById("partnerLogoUrl");if(!e||!t)return void console.log("Required elements not found for preset detection");const i=e.value,r=t.value,c=n?.value||"",d=parseFloat(o?.value||"1"),p=parseFloat(s?.value||"1"),g="custom"===l?.value?a?.value||"":l?.value||"",u=["layoutInvertToggle","hideZapperContentToggle","showTopZappersToggle","podiumToggle","zapGridToggle","qrInvertToggle","qrScreenBlendToggle","qrMultiplyBlendToggle","qrShowWebLinkToggle","qrShowNeventToggle","qrShowNoteToggle","lightningToggle"],m={};u.forEach(e=>{const t=document.getElementById(e);t&&(m[e]=t.checked)}),console.log("Current styles:",{textColor:i,bgColor:r,bgImage:c,textOpacity:d,opacity:p,partnerLogo:g,toggles:m});const h={lightMode:{textColor:"#000000",bgColor:"#ffffff",bgImage:"",textOpacity:1,opacity:1,partnerLogo:"",layoutInvert:!1,hideZapperContent:!1,showTopZappers:!1,podium:!1,zapGrid:!1,qrInvert:!1,qrScreenBlend:!1,qrMultiplyBlend:!1,qrShowWebLink:!1,qrShowNevent:!0,qrShowNote:!1,lightning:!1},darkMode:{textColor:"#ffffff",bgColor:"#000000",bgImage:"",textOpacity:1,opacity:1,partnerLogo:"",layoutInvert:!1,hideZapperContent:!1,showTopZappers:!1,podium:!1,zapGrid:!1,qrInvert:!1,qrScreenBlend:!1,qrMultiplyBlend:!1,qrShowWebLink:!1,qrShowNevent:!0,qrShowNote:!1,lightning:!1},cosmic:{textColor:"#ffffff",bgColor:"#0a0a1a",bgImage:"/images/bitcoin-space.gif",textOpacity:1,opacity:.4,partnerLogo:"",layoutInvert:!1,hideZapperContent:!1,showTopZappers:!1,podium:!0,zapGrid:!1,qrInvert:!1,qrScreenBlend:!0,qrMultiplyBlend:!1,qrShowWebLink:!1,qrShowNevent:!0,qrShowNote:!1,lightning:!1},vibrant:{textColor:"#ffd700",bgColor:"#2d1b69",bgImage:"/images/nostr-ostriches.gif",textOpacity:1,opacity:.6,partnerLogo:"",layoutInvert:!1,hideZapperContent:!1,showTopZappers:!1,podium:!1,zapGrid:!1,qrInvert:!1,qrScreenBlend:!1,qrMultiplyBlend:!1,qrShowWebLink:!1,qrShowNevent:!0,qrShowNote:!1,lightning:!1},electric:{textColor:"#00ffff",bgColor:"#000033",bgImage:"/images/send-zaps.gif",textOpacity:1,opacity:.7,partnerLogo:"",layoutInvert:!1,hideZapperContent:!1,showTopZappers:!1,podium:!1,zapGrid:!1,qrInvert:!1,qrScreenBlend:!0,qrMultiplyBlend:!1,qrShowWebLink:!1,qrShowNevent:!0,qrShowNote:!1,lightning:!1},warm:{textColor:"#8B4513",bgColor:"#FFE4B5",bgImage:"",textOpacity:1,opacity:.9,partnerLogo:"",layoutInvert:!1,hideZapperContent:!1,showTopZappers:!1,podium:!1,zapGrid:!1,qrInvert:!1,qrScreenBlend:!1,qrMultiplyBlend:!1,qrShowWebLink:!1,qrShowNevent:!0,qrShowNote:!1,lightning:!1},adopting:{textColor:"#ffffff",bgColor:"#FF6B35",bgImage:"",textOpacity:1,opacity:.9,partnerLogo:"https://adoptingbitcoin.org/images/AB-logo.svg",layoutInvert:!1,hideZapperContent:!1,showTopZappers:!1,podium:!1,zapGrid:!1,qrInvert:!1,qrScreenBlend:!1,qrMultiplyBlend:!1,qrShowWebLink:!1,qrShowNevent:!0,qrShowNote:!1,lightning:!1},bitcoinConf:{textColor:"#ffffff",bgColor:"#000000",bgImage:"/images/sky.jpg",textOpacity:1,opacity:.7,partnerLogo:"https://cdn.prod.website-files.com/6488b0b0fcd2d95f6b83c9d4/653bd44cf83c3b0498c2e622_bitcoin_conference.svg",layoutInvert:!1,hideZapperContent:!1,showTopZappers:!1,podium:!1,zapGrid:!1,qrInvert:!1,qrScreenBlend:!1,qrMultiplyBlend:!1,qrShowWebLink:!1,qrShowNevent:!0,qrShowNote:!1,lightning:!1}};for(const[e,t]of Object.entries(h)){const n=t.textColor===i&&t.bgColor===r&&t.bgImage===c&&Math.abs(t.textOpacity-d)<.01&&Math.abs(t.opacity-p)<.01&&t.partnerLogo===g;let o=!0;for(const e of u)if(t[e.replace("Toggle","")]!==m[e]){o=!1;break}if(n&&o){console.log(`Found matching preset: ${e}`),document.querySelectorAll(".preset-btn").forEach(e=>e.classList.remove("active"));const t=document.querySelector(`[data-preset="${e}"]`);return void(t&&(t.classList.add("active"),console.log(`Set ${e} as active preset`)))}}console.log("No matching preset found - custom settings"),document.querySelectorAll(".preset-btn").forEach(e=>e.classList.remove("active"))},Re=()=>{const e=document.getElementById("textColorValue"),t=document.getElementById("bgColorValue"),n=document.getElementById("opacitySlider"),o=document.getElementById("textOpacitySlider"),s=document.getElementById("partnerLogoSelect"),l=document.getElementById("partnerLogoUrl"),a=document.getElementById("bgImagePreset"),i=document.getElementById("bgImageUrl");if(e&&t&&n&&o){let r="";s&&(r="custom"===s.value&&l?l.value:s.value);let c="";a&&(c="custom"===a.value&&i?i.value:a.value);const d={};[{toggleId:"layoutInvertToggle",propertyName:"layoutInvert"},{toggleId:"hideZapperContentToggle",propertyName:"hideZapperContent"},{toggleId:"showTopZappersToggle",propertyName:"showTopZappers"},{toggleId:"podiumToggle",propertyName:"podium"},{toggleId:"zapGridToggle",propertyName:"zapGrid"},{toggleId:"qrInvertToggle",propertyName:"qrInvert"},{toggleId:"qrScreenBlendToggle",propertyName:"qrScreenBlend"},{toggleId:"qrMultiplyBlendToggle",propertyName:"qrMultiplyBlend"},{toggleId:"qrShowWebLinkToggle",propertyName:"qrShowWebLink"},{toggleId:"qrShowNeventToggle",propertyName:"qrShowNevent"},{toggleId:"qrShowNoteToggle",propertyName:"qrShowNote"},{toggleId:"lightningToggle",propertyName:"lightning"}].forEach(({toggleId:e,propertyName:t})=>{const n=document.getElementById(e);n&&(d[t]=n.checked)});const p={textColor:e.value,bgColor:t.value,textOpacity:parseFloat(o.value),opacity:parseFloat(n.value),partnerLogo:r,bgImage:c,...d};localStorage.setItem("pubpay-styles",JSON.stringify(p)),console.log("Custom styles saved to localStorage:",p)}},Oe=()=>{console.log("applyAllStyles called");const e=document.getElementById("textColorValue"),t=document.getElementById("bgColorValue"),n=document.getElementById("opacitySlider"),o=document.getElementById("textOpacitySlider");if(console.log("Style elements found:",{textColorElement:!!e,bgColorElement:!!t,opacitySlider:!!n,textOpacitySlider:!!o}),!(e&&t&&n&&o))return void console.error("Style input elements not found:",{textColorElement:e,bgColorElement:t,opacitySlider:n,textOpacitySlider:o});const s=e.value,l=t.value,a=parseFloat(n.value),i=parseFloat(o.value);console.log("Applying all styles:",{textColor:s,bgColor:l,opacity:a,textOpacity:i}),console.log("Opacity slider value:",n?.value),console.log("Text opacity slider value:",o?.value);const r=document.querySelector(".main-layout");if(r){const e=ze(s,i);r.style.setProperty("--text-color",e),r.querySelectorAll("\n        .zaps-header-left h2,\n        .total-label,\n        .total-sats,\n        .total-amount,\n        .zapperName,\n        .zapperMessage,\n        .zapperAmount,\n        .zapperAmountSats,\n        .zapperAmountLabel,\n        .authorName,\n        .noteContent,\n        .qr-slide-title,\n        .qr-slide-label,\n        .zap-author-name,\n        .zap-message,\n        .zap-amount,\n        .zap-amount-sats,\n        .zap-amount-label,\n        .zapperProfile .zapperName,\n        .zapperProfile .zapperMessage,\n        .zapperProfile .zapperAmount,\n        .zapperProfile .zapperAmountSats,\n        .zapperProfile .zapperAmountLabel\n      ").forEach(t=>{t.style.color=e}),r.querySelectorAll("\n        .zap .zapperName,\n        .zap .zapperMessage,\n        .zap .zapperAmount,\n        .zap .zapperAmountSats,\n        .zap .zapperAmountLabel,\n        .zapperProfile .zapperName,\n        .zapperProfile .zapperMessage,\n        .zapperProfile .zapperAmount,\n        .zapperProfile .zapperAmountSats,\n        .zapperProfile .zapperAmountLabel\n      ").forEach(t=>{t.style.color=e});const t=ze(l,a);r.style.backgroundColor=t;const n=document.getElementById("bgImageUrl");console.log("ðŸŽ¨ Background image value in applyAllStyles:",n?.value),n&&n.value?(console.log("âœ… Applying background image:",n.value),Me(n.value)):(console.log("âŒ No background image, clearing"),Me(""));const o=document.getElementById("partnerLogoSelect"),c=document.getElementById("partnerLogo"),d=document.getElementById("partnerLogoUrl"),p=document.getElementById("partnerLogoPreview");if(o&&c){let e="";e="custom"===o.value&&d?d.value:o.value,e?(c.src=e,c.style.display="inline-block",p&&(p.src=e,p.alt="Partner logo preview")):(c.style.display="none",c.src="",p&&(p.src="",p.alt="No partner logo"))}}},Ae=(e,t)=>{const n=document.querySelector(".main-layout"),o=document.querySelector(".live");if("color"===e){n&&n.style.setProperty("--text-color",t);const e=n?.querySelectorAll("\n        .zaps-header-left h2,\n        .total-label,\n        .total-sats,\n        .total-amount,\n        .zapperName,\n        .zapperMessage,\n        .zapperAmount,\n        .zapperAmountSats,\n        .zapperAmountLabel\n      ");e&&e.forEach(e=>{e.style.color=t})}else if("backgroundColor"===e){const e=document.getElementById("opacitySlider"),o=e?parseFloat(e.value):1,s=ze(t,o);n&&(n.style.backgroundColor=s)}else o&&o.style.setProperty(`--${e}`,t)},Me=e=>{console.log("ðŸ–¼ï¸ updateBackgroundImage called with:",e);const t=document.querySelector(".liveZapOverlay");t?e?(console.log("âœ… Setting background image to:",`url(${e})`),t.style.backgroundImage=`url(${e})`,t.style.backgroundSize="cover",t.style.backgroundPosition="center",t.style.backgroundRepeat="no-repeat",console.log("âœ… Background image applied successfully")):(console.log("âŒ Clearing background image"),t.style.backgroundImage=""):console.log("âŒ liveZapOverlay element not found!")},$e=()=>{console.log("updateBlendMode called");const e=document.getElementById("qrScreenBlendToggle"),t=document.getElementById("qrMultiplyBlendToggle");console.log("Blend toggles state:",{screen:e?.checked,multiply:t?.checked}),e?.checked?(t.checked=!1,document.body.classList.add("qr-blend-active"),document.body.classList.remove("qr-multiply-active"),console.log("Applied screen blend mode")):t?.checked?(e.checked=!1,document.body.classList.add("qr-blend-active"),document.body.classList.add("qr-multiply-active"),console.log("Applied multiply blend mode")):(document.body.classList.remove("qr-blend-active"),document.body.classList.remove("qr-multiply-active"),console.log("Removed blend modes")),console.log("Body classes after blend update:",document.body.className)},Fe=e=>{const t={lightMode:{textColor:"#000000",bgColor:"#ffffff",bgImage:"",qrInvert:!1,qrScreenBlend:!1,qrMultiplyBlend:!1,qrShowWebLink:!1,qrShowNevent:!0,qrShowNote:!1,layoutInvert:!1,hideZapperContent:!1,showTopZappers:!1,podium:!1,zapGrid:!1,opacity:1,textOpacity:1,partnerLogo:""},darkMode:{textColor:"#ffffff",bgColor:"#000000",bgImage:"",qrInvert:!1,qrScreenBlend:!1,qrMultiplyBlend:!1,qrShowWebLink:!1,qrShowNevent:!0,qrShowNote:!1,layoutInvert:!1,hideZapperContent:!1,showTopZappers:!1,podium:!1,zapGrid:!1,opacity:1,textOpacity:1,partnerLogo:""},cosmic:{textColor:"#ffffff",bgColor:"#0a0a1a",bgImage:"/images/bitcoin-space.gif",qrInvert:!1,qrScreenBlend:!0,qrMultiplyBlend:!1,qrShowWebLink:!1,qrShowNevent:!0,qrShowNote:!1,layoutInvert:!1,hideZapperContent:!1,showTopZappers:!1,podium:!0,zapGrid:!1,opacity:.4,textOpacity:1,partnerLogo:""},vibrant:{textColor:"#ffd700",bgColor:"#2d1b69",bgImage:"/images/nostr-ostriches.gif",qrInvert:!1,qrScreenBlend:!1,qrMultiplyBlend:!1,qrShowWebLink:!1,qrShowNevent:!0,qrShowNote:!1,layoutInvert:!1,hideZapperContent:!1,showTopZappers:!1,podium:!1,zapGrid:!1,opacity:.6,textOpacity:1,partnerLogo:""},electric:{textColor:"#00ffff",bgColor:"#000033",bgImage:"/images/send-zaps.gif",qrInvert:!1,qrScreenBlend:!0,qrMultiplyBlend:!1,qrShowWebLink:!1,qrShowNevent:!0,qrShowNote:!1,layoutInvert:!1,hideZapperContent:!1,showTopZappers:!1,podium:!1,zapGrid:!1,opacity:.7,textOpacity:1,partnerLogo:""},warm:{textColor:"#ff8c42",bgColor:"#2c1810",bgImage:"/images/bitcoin-sunset.gif",qrInvert:!1,qrScreenBlend:!1,qrMultiplyBlend:!1,qrShowWebLink:!1,qrShowNevent:!0,qrShowNote:!1,layoutInvert:!1,hideZapperContent:!1,showTopZappers:!1,podium:!1,zapGrid:!1,opacity:.8,textOpacity:1,partnerLogo:""},adopting:{textColor:"#eedb5f",bgColor:"#05051f",bgImage:"/images/adopting.webp",qrInvert:!1,qrScreenBlend:!1,qrMultiplyBlend:!1,qrShowWebLink:!1,qrShowNevent:!0,qrShowNote:!1,layoutInvert:!1,hideZapperContent:!1,showTopZappers:!1,podium:!1,zapGrid:!1,opacity:.7,textOpacity:1,partnerLogo:"https://adoptingbitcoin.org/images/AB-logo.svg"},bitcoinConf:{textColor:"#ffffff",bgColor:"#000000",bgImage:"/images/sky.jpg",qrInvert:!1,qrScreenBlend:!1,qrMultiplyBlend:!1,qrShowWebLink:!1,qrShowNevent:!0,qrShowNote:!1,layoutInvert:!1,hideZapperContent:!1,showTopZappers:!1,podium:!1,zapGrid:!1,opacity:.7,textOpacity:1,partnerLogo:"https://cdn.prod.website-files.com/6488b0b0fcd2d95f6b83c9d4/653bd44cf83c3b0498c2e622_bitcoin_conference.svg"}}[e];if(t){const n=document.getElementById("textColorPicker"),o=document.getElementById("bgColorPicker"),s=document.getElementById("textColorValue"),l=document.getElementById("bgColorValue"),a=document.getElementById("textOpacitySlider"),i=document.getElementById("opacitySlider"),r=document.getElementById("textOpacityValue"),c=document.getElementById("opacityValue");n&&(n.value=t.textColor),s&&(s.value=t.textColor),o&&(o.value=t.bgColor),l&&(l.value=t.bgColor),a&&(a.value=t.textOpacity.toString()),i&&(i.value=t.opacity.toString()),r&&(r.textContent=`${Math.round(100*t.textOpacity)}%`),c&&(c.textContent=`${Math.round(100*t.opacity)}%`);const d=document.getElementById("bgImageUrl"),p=document.getElementById("bgImagePreset"),g=document.getElementById("bgPresetPreview"),u=document.getElementById("customUrlGroup");if(d&&(d.value=t.bgImage),p)if(""===t.bgImage)p.value="";else{const e=Array.from(p.options).find(e=>e.value===t.bgImage);p.value=e?t.bgImage:"custom"}if(g&&(g.src=t.bgImage,g.alt=t.bgImage?"Background preview":"No background"),u&&(u.style.display="custom"===p?.value?"block":"none"),["qrInvertToggle","qrScreenBlendToggle","qrMultiplyBlendToggle","qrShowWebLinkToggle","qrShowNeventToggle","qrShowNoteToggle","layoutInvertToggle","hideZapperContentToggle","showTopZappersToggle","zapGridToggle","podiumToggle","lightningToggle"].forEach(e=>{const n=document.getElementById(e);if(n){const o=e.replace("Toggle",""),s=void 0!==t[o]&&t[o];n.checked=s,console.log(`ðŸ”„ Setting ${e} to ${s} (from preset property ${o})`);const l=new Event("change",{bubbles:!0});n.dispatchEvent(l)}}),Oe(),setTimeout(()=>{"function"==typeof De&&(console.log("Updating QR slide visibility after preset application..."),De())},100),Ae("color",t.textColor),Ae("backgroundColor",t.bgColor),void 0!==t.partnerLogo){const e=document.getElementById("partnerLogoSelect"),n=document.getElementById("partnerLogoUrl"),o=document.getElementById("customPartnerLogoGroup");e&&(t.partnerLogo?Array.from(e.options).find(e=>e.value===t.partnerLogo)?(e.value=t.partnerLogo,o&&(o.style.display="none")):(e.value="custom",o&&(o.style.display="block"),n&&(n.value=t.partnerLogo)):(e.value="",o&&(o.style.display="none"),n&&(n.value="")))}Oe(),document.querySelectorAll(".preset-btn").forEach(e=>e.classList.remove("active"));const m=document.querySelector(`[data-preset="${e}"]`);m&&m.classList.add("active");const h={textColor:t.textColor,bgColor:t.bgColor,bgImage:t.bgImage,qrInvert:t.qrInvert,qrScreenBlend:t.qrScreenBlend,qrMultiplyBlend:t.qrMultiplyBlend,qrShowWebLink:t.qrShowWebLink,qrShowNevent:t.qrShowNevent,qrShowNote:t.qrShowNote,layoutInvert:t.layoutInvert,hideZapperContent:t.hideZapperContent,showTopZappers:t.showTopZappers,podium:t.podium,zapGrid:t.zapGrid,textOpacity:t.textOpacity,opacity:t.opacity,partnerLogo:t.partnerLogo||""};localStorage.setItem("pubpay-styles",JSON.stringify(h)),console.log("Preset saved to localStorage:",h)}};let _e=null;const De=(e=!1)=>{_e&&clearTimeout(_e),e?Ue(e):_e=setTimeout(()=>{Ue(e)},150)},Ue=(e=!1)=>{console.log("ðŸ”„ Updating QR slide visibility...");const t=document.getElementById("qrShowWebLinkToggle"),n=document.getElementById("qrShowNeventToggle"),o=document.getElementById("qrShowNoteToggle"),s=document.getElementById("lightningToggle"),l=t?.checked??!1,a=n?.checked??!0,i=o?.checked??!1,r=s?.checked??!1;console.log("QR Visibility Update:",{showWebLink:l,showNevent:a,showNote:i,showLightning:r});const c=document.querySelector(".swiper-slide:has(#qrCode)");let d=document.querySelector(".swiper-slide:has(#qrCodeNevent)");const p=document.querySelector(".swiper-slide:has(#qrCodeNote)"),g=document.getElementById("lightningQRSlide");if(!d){const e=document.getElementById("qrCodeNevent");e&&(d=e.closest(".swiper-slide"),console.log("Found nevent slide using fallback method:",!!d))}console.log("QR Slide elements found:",{webLinkSlide:!!c,neventSlide:!!d,noteSlide:!!p,lightningSlide:!!g,qrCodeNevent:!!document.getElementById("qrCodeNevent"),allSwipesSlides:document.querySelectorAll(".swiper-slide").length});let u=document.getElementById("hiddenSlidesContainer");u||(u=document.createElement("div"),u.id="hiddenSlidesContainer",u.style.display="none",document.body.appendChild(u));const m=document.querySelector(".qr-swiper .swiper-wrapper");if(!m)return void console.log("QR swiper wrapper not found, skipping QR visibility update");c&&(l?(m.contains(c)||m.appendChild(c),c.style.display="block"):u.appendChild(c)),d&&(a?(m.contains(d)||m.appendChild(d),d.style.display="block"):u.appendChild(d)),p&&(i?(m.contains(p)||m.appendChild(p),p.style.display="block"):u.appendChild(p)),g&&(r?(m.contains(g)||m.appendChild(g),g.style.display="block"):u.appendChild(g));const h=Array.from(m.children).filter(e=>e.classList.contains("swiper-slide"));console.log("Visibility update - Toggle states:",{showWebLink:l,showNevent:a,showNote:i,showLightning:r}),console.log("Visibility update - Slides in swiper wrapper:",h.length),console.log("Visibility update - Slide IDs in swiper:",h.map(e=>e.id));const y=document.querySelector(".qr-swiper");if(y&&h.length>0)if(y.style.display="block",window.qrSwiper)try{window.qrSwiper.update(),1===h.length?(window.qrSwiper.allowTouchMove=!1,window.qrSwiper.autoplay&&window.qrSwiper.autoplay.stop&&window.qrSwiper.autoplay.stop(),Ge&&clearInterval(Ge)):h.length>1&&(window.qrSwiper.allowTouchMove=!0,window.qrSwiper.autoplay&&(window.qrSwiper.autoplay.params.delay=1e4,window.qrSwiper.autoplay.start&&window.qrSwiper.autoplay.start()))}catch(e){console.log("Swiper update failed, will reinitialize:",e),Ze()}else Ze();else y&&(y.style.display="none")},Ze=()=>{console.log("ðŸ”„ Initializing QR Swiper..."),window.qrSwiper&&(window.qrSwiper.destroy(!0,!0),window.qrSwiper=null);const e=document.querySelector(".qr-swiper .swiper-wrapper");if(!e)return;const t=Array.from(e.children).filter(e=>e.classList.contains("swiper-slide"));if(0===t.length){console.log("No visible slides, hiding swiper");const e=document.querySelector(".qr-swiper");return void(e&&(e.style.display="none"))}try{window.qrSwiper=new window.Swiper(".qr-swiper",{loop:t.length>1,autoplay:t.length>1&&{delay:1e4,disableOnInteraction:!1},allowTouchMove:t.length>1,pagination:{el:".swiper-pagination",clickable:!0},on:{init(){const e=this.el||window.qrSwiper?.el;if(!e)return;e.querySelectorAll(".swiper-pagination-bullet").forEach(e=>{e.classList.remove("progress-animating"),e.style.setProperty("--progress","0%")}),Ve=0,We=null,console.log("ðŸ”„ Initial slide - reset paused progress");const t=e.querySelector(".swiper-pagination-bullet-active");t&&(t.classList.add("progress-animating"),He())},slideChange(){const e=this.el||window.qrSwiper?.el;if(!e)return;e.querySelectorAll(".swiper-pagination-bullet").forEach(e=>{e.style.setProperty("--progress","0%"),e.classList.remove("progress-animating")}),Ve=0,We=null,console.log("ðŸ”„ New slide - reset paused progress");const t=e.querySelector(".swiper-pagination-bullet-active");t&&(t.classList.add("progress-animating"),He())},autoplayStart(){const e=this.el||window.qrSwiper?.el;if(!e)return;e.classList.remove("swiper-paused");const t=e.querySelector(".swiper-pagination-bullet-active");t&&(t.classList.add("progress-animating"),He())},autoplayStop(){const e=this.el||window.qrSwiper?.el;e&&(e.classList.add("swiper-paused"),Ge&&(clearInterval(Ge),Ge=null))}}}),Je(),console.log("âœ… QR Swiper initialized with",t.length,"slides")}catch(e){console.error("Failed to initialize QR Swiper:",e)}};let Qe=null,We=null,Ge=null,Ve=0;const He=()=>{console.log("ðŸ”„ Starting progress tracking..."),Ge&&(clearInterval(Ge),Ge=null);const e=window.qrSwiper;if(!e?.el)return void console.log("âŒ No swiper found for progress tracking");const t=e.el.querySelector(".swiper-pagination-bullet-active");if(!t)return void console.log("âŒ No active bullet found for progress tracking");if(!t.classList.contains("progress-animating"))return void console.log("âŒ Active bullet does not have progress-animating class");t.style.setProperty("--progress","0%"),Qe=Date.now(),Ve=0;const n=e.params?.autoplay?.delay||1e4;console.log("ðŸ“Š Progress tracking started:",{autoplayDelay:n,startTime:Qe}),Ge=setInterval(()=>{const e=Date.now()-(Qe||0),o=Math.min(e/n*100,100);t.style.setProperty("--progress",`${o}%`),o>=100&&(console.log("âœ… Progress tracking completed"),clearInterval(Ge),Ge=null)},16)},Je=()=>{window.qrSwiper?.el&&(window.qrSwiper.el.addEventListener("mouseenter",()=>{if(console.log("ðŸ–±ï¸ Mouse entered swiper - pausing both progress and autoplay"),window.qrSwiper&&window.qrSwiper.autoplay&&(window.qrSwiper.autoplay.pause(),console.log("â¸ï¸ Swiper autoplay paused")),Ge){clearInterval(Ge),Ge=null,We=Date.now();const e=window.qrSwiper?.el?.querySelector(".swiper-pagination-bullet-active");if(e){const t=e.style.getPropertyValue("--progress")||"0%";Ve=parseFloat(t.replace("%","")),console.log("â¸ï¸ Progress paused at:",`${Ve}%`)}}}),window.qrSwiper.el.addEventListener("mouseleave",()=>{if(console.log("ðŸ–±ï¸ Mouse left swiper - resuming both progress and autoplay"),console.log("Paused progress:",`${Ve}%`),We&&Qe&&Ve<100){console.log("ðŸ”„ Resuming from:",`${Ve}%`),(()=>{console.log("ðŸ”„ Resuming progress tracking..."),Ge&&(clearInterval(Ge),Ge=null);const e=window.qrSwiper;if(!e?.el)return void console.log("âŒ No swiper found for progress tracking");const t=e.el.querySelector(".swiper-pagination-bullet-active");if(!t)return void console.log("âŒ No active bullet found for progress tracking");if(!t.classList.contains("progress-animating"))return void console.log("âŒ Active bullet does not have progress-animating class");const n=e.params?.autoplay?.delay||1e4;console.log("ðŸ“Š Progress tracking resumed:",{autoplayDelay:n,pausedProgress:Ve});const o=(100-Ve)/100*n,s=Date.now();Ge=setInterval(()=>{const e=Date.now()-s,n=Ve+e/o*(100-Ve),l=Math.min(n,100);t.style.setProperty("--progress",`${l}%`),l>=100&&(console.log("âœ… Progress tracking completed"),clearInterval(Ge),Ge=null)},16)})();const e=window.qrSwiper?.params?.autoplay?.delay||1e4,t=(100-Ve)/100*e;console.log("â±ï¸ Remaining time for slide change:",`${t}ms`),setTimeout(()=>{window.qrSwiper&&window.qrSwiper.slideNext&&(console.log("ðŸ”„ Manually triggering slide change"),window.qrSwiper.slideNext())},t)}else console.log("âŒ Cannot resume - missing pause/start time or progress complete"),window.qrSwiper&&window.qrSwiper.autoplay&&(window.qrSwiper.autoplay.resume(),console.log("â–¶ï¸ Swiper autoplay resumed (fallback)"))}))};return{isLoading:t,error:o,noteContent:a,authorName:r,authorImage:d,zaps:g,totalZaps:y,totalAmount:w,handleNoteLoaderSubmit:Ie,handleStyleOptionsToggle:()=>{const e=document.getElementById("styleOptionsModal");e&&(e.style.display="none"===e.style.display?"block":"none")},handleStyleOptionsClose:()=>{const e=document.getElementById("styleOptionsModal");e&&(e.classList.remove("show"),document.body.classList.remove("style-panel-open"),setTimeout(()=>{e.style.display="none"},300))},showLoadingError:e=>{const t=document.getElementById("noteLoaderError");t&&(t.textContent=e,t.style.display="block");const n=document.getElementById("noteLoaderContainer"),o=document.getElementById("mainLayout");n&&(n.style.display="flex"),o&&(o.style.display="none")},resetToDefaults:se,copyStyleUrl:ae,applyStylesFromURL:le,cleanup:()=>{Le&&(clearTimeout(Le),Le=null)}}},v=()=>{const{eventId:e}=(0,a.g)(),[t,n]=(0,s.useState)(!e),[l,i]=(0,s.useState)(!!e),{isLoading:r,error:c,noteContent:d,authorName:p,authorImage:g,zaps:u,totalZaps:m,totalAmount:h,handleNoteLoaderSubmit:v,handleStyleOptionsToggle:w,handleStyleOptionsClose:b,showLoadingError:f,resetToDefaults:x,copyStyleUrl:N}=y(e);return(0,s.useEffect)(()=>{if(e){const t=async()=>{await new Promise(e=>{const t=()=>{window.NostrTools?e():setTimeout(t,100)};t()}),(e=>{if(!e)return!1;if(!["note1","nevent1","naddr1","nprofile1"].some(t=>e.startsWith(t)))return!1;try{return window.NostrTools.nip19.decode(e),!0}catch(e){return console.log("Invalid Nostr identifier decode error:",e),!1}})(e)?(n(!1),i(!0)):(console.log("Invalid note ID in URL, showing error in loader:",e),n(!0),i(!1),setTimeout(()=>{f("Invalid nostr identifier format. Please check the note ID and try again.")},100))};t()}else n(!0),i(!1)},[e]),(0,s.useEffect)(()=>{const e=()=>{const e=window.location.pathname.split("/"),t=e[e.length-1];t&&"live"!==t?(n(!1),i(!0)):(n(!0),i(!1))},t=e=>{console.log("Note loader submitted event received:",e.detail),n(!1),i(!0);const t=window.location.pathname.split("/"),o=t[t.length-1];o&&"live"!==o&&(window.history.replaceState({},"",window.location.pathname),window.location.reload())};return window.addEventListener("popstate",e),window.addEventListener("noteLoaderSubmitted",t),()=>{window.removeEventListener("popstate",e),window.removeEventListener("noteLoaderSubmitted",t)}},[]),(0,s.useEffect)(()=>{new Promise(e=>{const t=()=>{window.NostrTools?(console.log("NostrTools available"),e()):setTimeout(t,100)};t()})},[]),(0,s.useEffect)(()=>(setTimeout(()=>{const e=document.getElementById("styleToggleBtn"),t=document.getElementById("styleOptionsModal"),n=t?.querySelector(".close-button");e?(console.log("Style toggle button found:",e),e.addEventListener("click",e=>{e.preventDefault(),console.log("Style toggle button clicked");const t=document.getElementById("styleOptionsModal");console.log("Style options modal found:",t),t&&(t.style.display="block",t.classList.add("show"),document.body.classList.add("style-panel-open"),console.log("Style options modal opened"))})):console.log("Style toggle button NOT found"),n&&n.addEventListener("click",b);const o=document.querySelector(".styleOptionsModalToggle");o&&o.addEventListener("click",()=>{const e=document.getElementById("styleOptionsModal");e&&(e.style.display="block")})},100),()=>{}),[w,b]),(0,o.jsxs)("div",{className:"live",children:[t&&(0,o.jsx)("div",{id:"noteLoaderContainer",children:(0,o.jsxs)("div",{id:"noteLoader",children:[(0,o.jsx)("div",{className:"portrait-swiper",children:(0,o.jsx)("div",{className:"swiper",children:(0,o.jsxs)("div",{className:"swiper-wrapper",children:[(0,o.jsx)("div",{className:"swiper-slide",children:(0,o.jsx)("img",{src:"https://m.primal.net/Majo.jpg",alt:"Max Demarco Vicky El Salvador Chain Duel Party PubPay"})}),(0,o.jsx)("div",{className:"swiper-slide",children:(0,o.jsx)("img",{src:"https://i.nostr.build/itlLMXlxccOBG06L.jpg",alt:"Roger 9000 Adopting Bitcoin After Party PubPay"})}),(0,o.jsx)("div",{className:"swiper-slide",children:(0,o.jsx)("img",{src:"https://r2.primal.net/cache/0/c4/57/0c4571c1e9e51ba2dde56dc3af65726adac4e68299f5a5d3adf9bc09efb67e8f.jpg",alt:"Network School Flute Piano PubPay"})}),(0,o.jsx)("div",{className:"swiper-slide",children:(0,o.jsx)("img",{src:"https://r2.primal.net/cache/6/3e/9f/63e9f4b439c17fd2c88617210cbd91c6c9b1ee2be2d82f47a7085379dd183e3c.jpg",alt:"Network School Flute Piano PubPay"})}),(0,o.jsx)("div",{className:"swiper-slide",children:(0,o.jsx)("img",{src:"https://r2.primal.net/cache/b/f6/bd/bf6bde3a8c8e5568dd8ce9d2d32b31d6d4287281e9cb5650cd28cb740b9bf932.jpg",alt:"PubPay Event"})}),(0,o.jsx)("div",{className:"swiper-slide",children:(0,o.jsx)("img",{src:"https://r2a.primal.net/uploads2/8/af/e3/8afe3c42163ee657479c9d151e92e9058f9116cc05dd71829426e567020ec21e.png",alt:"PubPay Event"})})]})})}),(0,o.jsxs)("div",{className:"note-loader-content",children:[(0,o.jsxs)("div",{className:"app-header",children:[(0,o.jsxs)("h1",{children:[(0,o.jsx)("span",{style:{color:"#4a75ff"},children:"PUB"}),(0,o.jsx)("span",{style:{color:"#000"},children:"PAY"}),(0,o.jsx)("span",{style:{color:"#0000001c"},children:".me"})," ",(0,o.jsx)("span",{style:{color:"#5f5f5f"},children:"Live"})]}),(0,o.jsx)("p",{className:"app-description",children:"Real time tip tracker"})]}),(0,o.jsx)("label",{htmlFor:"note1LoaderInput",children:"Enter note, event, or profile"}),(0,o.jsx)("input",{type:"text",id:"note1LoaderInput",name:"note1LoaderInput",placeholder:"note1abc123... or nevent1xyz789... or naddr1def456... or nprofile1ghi789..."}),(0,o.jsx)("div",{id:"noteLoaderError",className:"error-message",style:{display:"none"}}),(0,o.jsxs)("div",{className:"button-container",children:[(0,o.jsx)("button",{id:"note1LoaderSubmit",className:"button",children:"Load"}),(0,o.jsx)("div",{className:"styleOptionsModalToggle button outline",children:"Style Options"})]}),(0,o.jsxs)("div",{className:"examples-section",children:[(0,o.jsx)("h3",{children:"Examples - Notes, Live Events & Profiles"}),(0,o.jsxs)("div",{className:"example-item",children:[(0,o.jsx)("a",{href:"/live/note16a7m73en9w4artfclcnhqf8jzngepmg2j2et3l2yk0ksfhftv0ls3hugv7",target:"_blank",children:"Zap my set at at Plan B at Adopting Bitcoin after party âš¡ï¸"}),(0,o.jsxs)("div",{className:"author-name",children:[(0,o.jsx)("img",{src:"https://primal.b-cdn.net/media-upload?u=https%3A%2F%2Fmedia.primal.net%2Fuploads%2Fd%2F87%2F9f%2Fd879f18ec704fed0700a3c2befae75b0148822d19166feb9293192279864db82.jpg",alt:"Roger 9000",className:"author-avatar"}),"Roger 9000"]})]}),(0,o.jsxs)("div",{className:"example-item",children:[(0,o.jsx)("a",{href:"/live/note1j8fpjg60gkw266lz86ywmyr2mmy5e6kfkhtfu4umaxneff6qeyhqrl37gu",target:"_blank",children:"Bienvenidos a nuestro querido el salvador ðŸ‡¸ðŸ‡»"}),(0,o.jsxs)("div",{className:"author-name",children:[(0,o.jsx)("img",{src:"https://cdn.satellite.earth/080a8d6c0664cd39b386a27f095d6dac8e223a26c69357e3e144da2d54dc39a3.png",alt:"Vicky",className:"author-avatar"}),"Vicky"]})]}),(0,o.jsxs)("div",{className:"example-item",children:[(0,o.jsx)("a",{href:"/live/note1lsreglfs5s5zm6e8ssavaak2adsajkad27axp00rvz734u443znqspwhvv",target:"_blank",children:"The Network School of Rock is Live from Malaysia!"}),(0,o.jsxs)("div",{className:"author-name",children:[(0,o.jsx)("img",{src:"https://m.primal.net/QIbm.jpg",alt:"lucas",className:"author-avatar"}),"lucas"]})]}),(0,o.jsxs)("div",{className:"example-item",children:[(0,o.jsx)("a",{href:"/live/nevent1qqsphk43g2pzpwfr8qcp5zdx8ftgaj7gvxk682y4sedjvscrsm0lpssc96mm3",target:"_blank",children:"Hola Barcelona! Pubpay me at the After Party of Bitcoin Cypher Conference!!!! @BCC 8333"}),(0,o.jsxs)("div",{className:"author-name",children:[(0,o.jsx)("img",{src:"https://i.nostr.build/itlLMXlxccOBG06L.jpg",alt:"Roger 9000",className:"author-avatar"}),"Roger 9000"]})]}),(0,o.jsxs)("div",{className:"example-item",children:[(0,o.jsx)("a",{href:"/live/naddr1qqjr2vehvyenvdtr94nrzetr956rgctr94skvvfs95eryep3x3snwve389nxyqg3waehxw309ahx7um5wgh8w6twv5hsygx0gknt5ymr44ldyyaq0rn3p5jpzkh8y8ymg773a06ytr4wldxz55psgqqqwensuq723w",target:"_blank",children:"NoGood Radio is a 24/7 pirate radio station running on scrap parts and broadcasting from a basement somewhere."}),(0,o.jsxs)("div",{className:"author-name",children:[(0,o.jsx)("img",{src:"https://blossom.nogood.studio/458fee0afeba08618c9b9bea4f77b73d62f480c00dffe60d14b4b6a51045d122.jpg",alt:"NoGood Radio",className:"author-avatar"}),"NoGood Radio"]})]})]}),(0,o.jsx)("div",{className:"note-loader-footer",children:(0,o.jsxs)("div",{className:"footer-links",children:[(0,o.jsx)("a",{href:"https://nostr.com",target:"_blank",className:"footer-link",children:"Follow us"}),(0,o.jsx)("a",{href:"/",className:"footer-link",children:"Powered by PubPay"})]})})]})]})}),l&&(0,o.jsxs)("div",{id:"mainLayout",className:"main-layout",children:[(0,o.jsx)("div",{className:"liveZapOverlay"}),(0,o.jsx)("div",{className:"left-side",children:(0,o.jsxs)("div",{className:"post-info",children:[(0,o.jsx)("h3",{className:"section-label",children:"Note Content"}),(0,o.jsxs)("div",{className:"author-section",children:[(0,o.jsx)("img",{id:"authorNameProfileImg",className:"author-image",src:g||"/images/gradient_color.gif"}),(0,o.jsx)("div",{className:"author-info",children:(0,o.jsx)("div",{id:"authorName",className:"author-name",children:p})})]}),(0,o.jsx)("div",{className:"note-section",children:(0,o.jsx)("div",{id:"noteContent",className:"note-content",children:d||""})}),(0,o.jsx)("div",{className:"qr-section",children:(0,o.jsxs)("div",{className:"swiper qr-swiper",children:[(0,o.jsxs)("div",{className:"swiper-wrapper",children:[(0,o.jsxs)("div",{className:"swiper-slide",children:[(0,o.jsxs)("div",{className:"qr-slide-title",children:["Web ",(0,o.jsx)("span",{className:"qr-data-preview",id:"qrDataPreview1"})]}),(0,o.jsx)("a",{href:"",target:"_blank",id:"qrcodeLinkNostr",children:(0,o.jsx)("img",{id:"qrCode",className:"qr-code"})}),(0,o.jsx)("div",{className:"qr-slide-label",children:"Scan with Camera APP"})]}),(0,o.jsxs)("div",{className:"swiper-slide",children:[(0,o.jsxs)("div",{className:"qr-slide-title",children:["Nostr ",(0,o.jsx)("span",{className:"qr-data-preview",id:"qrDataPreview2"})]}),(0,o.jsx)("a",{href:"",target:"_blank",id:"qrcodeNeventLink",children:(0,o.jsx)("img",{id:"qrCodeNevent",className:"qr-code"})}),(0,o.jsx)("div",{className:"qr-slide-label",children:"Scan with Nostr client"})]}),(0,o.jsxs)("div",{className:"swiper-slide",children:[(0,o.jsxs)("div",{className:"qr-slide-title",children:["Nostr ",(0,o.jsx)("span",{className:"qr-data-preview",id:"qrDataPreview3"})]}),(0,o.jsx)("a",{href:"",target:"_blank",id:"qrcodeNoteLink",children:(0,o.jsx)("img",{id:"qrCodeNote",className:"qr-code"})}),(0,o.jsx)("div",{className:"qr-slide-label",children:"Scan with Nostr client"})]}),(0,o.jsxs)("div",{className:"swiper-slide lightning-qr-slide",id:"lightningQRSlide",style:{display:"none"},children:[(0,o.jsxs)("div",{className:"qr-slide-title",children:["Lightning ",(0,o.jsx)("span",{className:"qr-data-preview",id:"qrDataPreview4"})]}),(0,o.jsx)("a",{href:"",target:"_blank",id:"lightningQRLink",children:(0,o.jsx)("div",{id:"lightningQRCode",className:"qr-code"})}),(0,o.jsx)("div",{className:"qr-slide-label",children:"Scan with Lightning Wallet"})]})]}),(0,o.jsx)("div",{className:"swiper-pagination"})]})})]})}),(0,o.jsxs)("div",{className:"right-side",children:[(0,o.jsxs)("div",{className:"zaps-header",children:[(0,o.jsxs)("div",{className:"zaps-header-left",children:[(0,o.jsx)("span",{className:"total-label",children:"Total:"}),(0,o.jsx)("span",{id:"zappedTotalValue",className:"total-amount",children:h}),(0,o.jsx)("span",{className:"total-sats",children:"sats"}),(0,o.jsx)("span",{className:"zap-count-separator",children:"â€¢"}),(0,o.jsx)("span",{id:"zappedTotalCount",className:"total-count",children:m}),(0,o.jsx)("span",{className:"total-zaps",children:"zaps"})]}),(0,o.jsxs)("div",{className:"zaps-header-right",children:[(0,o.jsx)("button",{id:"styleToggleBtn",className:"style-toggle-btn",children:"âš™ï¸"}),(0,o.jsxs)("div",{className:"powered-by",children:[(0,o.jsx)("img",{id:"partnerLogo",src:"",alt:"Partner Logo",style:{display:"none"}}),(0,o.jsx)("a",{href:"https://pubpay.me",target:"_blank",children:(0,o.jsx)("img",{src:"/images/powered_by_white_bg.png"})})]})]})]}),(0,o.jsx)("div",{id:"top-zappers-bar",className:"top-zappers-bar",style:{display:"none"},children:(0,o.jsxs)("div",{className:"top-zappers-list",children:[(0,o.jsxs)("div",{className:"top-zapper",id:"top-zapper-1",children:[(0,o.jsx)("div",{className:"zapper-rank",children:"1"}),(0,o.jsx)("img",{className:"zapper-avatar",src:"/images/gradient_color.gif",alt:"Top Zapper"}),(0,o.jsxs)("div",{className:"zapper-info",children:[(0,o.jsx)("div",{className:"zapper-name",children:"Loading..."}),(0,o.jsx)("div",{className:"zapper-total",children:"0 sats"})]})]}),(0,o.jsxs)("div",{className:"top-zapper",id:"top-zapper-2",children:[(0,o.jsx)("div",{className:"zapper-rank",children:"2"}),(0,o.jsx)("img",{className:"zapper-avatar",src:"/images/gradient_color.gif",alt:"Top Zapper"}),(0,o.jsxs)("div",{className:"zapper-info",children:[(0,o.jsx)("div",{className:"zapper-name",children:"Loading..."}),(0,o.jsx)("div",{className:"zapper-total",children:"0 sats"})]})]}),(0,o.jsxs)("div",{className:"top-zapper",id:"top-zapper-3",children:[(0,o.jsx)("div",{className:"zapper-rank",children:"3"}),(0,o.jsx)("img",{className:"zapper-avatar",src:"/images/gradient_color.gif",alt:"Top Zapper"}),(0,o.jsxs)("div",{className:"zapper-info",children:[(0,o.jsx)("div",{className:"zapper-name",children:"Loading..."}),(0,o.jsx)("div",{className:"zapper-total",children:"0 sats"})]})]}),(0,o.jsxs)("div",{className:"top-zapper",id:"top-zapper-4",children:[(0,o.jsx)("div",{className:"zapper-rank",children:"4"}),(0,o.jsx)("img",{className:"zapper-avatar",src:"/images/gradient_color.gif",alt:"Top Zapper"}),(0,o.jsxs)("div",{className:"zapper-info",children:[(0,o.jsx)("div",{className:"zapper-name",children:"Loading..."}),(0,o.jsx)("div",{className:"zapper-total",children:"0 sats"})]})]}),(0,o.jsxs)("div",{className:"top-zapper",id:"top-zapper-5",children:[(0,o.jsx)("div",{className:"zapper-rank",children:"5"}),(0,o.jsx)("img",{className:"zapper-avatar",src:"/images/gradient_color.gif",alt:"Top Zapper"}),(0,o.jsxs)("div",{className:"zapper-info",children:[(0,o.jsx)("div",{className:"zapper-name",children:"Loading..."}),(0,o.jsx)("div",{className:"zapper-total",children:"0 sats"})]})]})]})}),(0,o.jsx)("div",{className:"zaps-container",children:(0,o.jsx)("div",{id:"zaps",className:"zaps-list"})})]})]}),(0,o.jsx)("div",{id:"styleOptionsModal",children:(0,o.jsxs)("div",{className:"style-options-content",children:[(0,o.jsxs)("div",{className:"style-options-header",children:[(0,o.jsx)("h2",{children:"STYLE OPTIONS"}),(0,o.jsx)("button",{className:"close-button",onClick:b,children:"Ã—"})]}),(0,o.jsxs)("div",{className:"style-options-body",children:[(0,o.jsxs)("div",{className:"style-section",children:[(0,o.jsx)("h3",{className:"section-title",children:"QUICK PRESETS"}),(0,o.jsxs)("div",{className:"presets-container",children:[(0,o.jsx)("button",{className:"preset-btn","data-preset":"lightMode",children:"Light Mode"}),(0,o.jsx)("button",{className:"preset-btn","data-preset":"darkMode",children:"Dark Mode"}),(0,o.jsx)("button",{className:"preset-btn","data-preset":"cosmic",children:"Cosmic"}),(0,o.jsx)("button",{className:"preset-btn","data-preset":"vibrant",children:"Vibrant"}),(0,o.jsx)("button",{className:"preset-btn","data-preset":"electric",children:"Electric"}),(0,o.jsx)("button",{className:"preset-btn","data-preset":"warm",children:"Warm"}),(0,o.jsx)("button",{className:"preset-btn","data-preset":"adopting",children:"Adopting"}),(0,o.jsx)("button",{className:"preset-btn","data-preset":"bitcoinConf",children:"Bitcoin Conf"})]})]}),(0,o.jsxs)("div",{className:"style-section",children:[(0,o.jsx)("h3",{className:"section-title",children:"COLORS"}),(0,o.jsxs)("div",{className:"colors-container",children:[(0,o.jsxs)("div",{className:"style-option-group",children:[(0,o.jsx)("label",{htmlFor:"textColorPicker",children:"Text Color"}),(0,o.jsxs)("div",{className:"color-picker-container",children:[(0,o.jsx)("input",{type:"color",id:"textColorPicker",defaultValue:"#000000"}),(0,o.jsx)("input",{type:"text",id:"textColorValue",defaultValue:"#000000",placeholder:"#000000"})]})]}),(0,o.jsxs)("div",{className:"style-option-group",children:[(0,o.jsx)("label",{htmlFor:"bgColorPicker",children:"Background Color"}),(0,o.jsxs)("div",{className:"color-picker-container",children:[(0,o.jsx)("input",{type:"color",id:"bgColorPicker",defaultValue:"#ffffff"}),(0,o.jsx)("input",{type:"text",id:"bgColorValue",defaultValue:"#ffffff",placeholder:"#ffffff"})]})]})]}),(0,o.jsxs)("div",{className:"opacity-container",children:[(0,o.jsxs)("div",{className:"style-option-group",children:[(0,o.jsx)("label",{htmlFor:"textOpacitySlider",children:"Text Opacity"}),(0,o.jsxs)("div",{className:"slider-container",children:[(0,o.jsx)("input",{type:"range",id:"textOpacitySlider",min:"0.1",max:"1.0",step:"0.1",defaultValue:"1.0"}),(0,o.jsx)("span",{id:"textOpacityValue",children:"100%"})]})]}),(0,o.jsxs)("div",{className:"style-option-group",children:[(0,o.jsx)("label",{htmlFor:"opacitySlider",children:"Background Opacity"}),(0,o.jsxs)("div",{className:"slider-container",children:[(0,o.jsx)("input",{type:"range",id:"opacitySlider",min:"0.0",max:"1.0",step:"0.1",defaultValue:"1.0"}),(0,o.jsx)("span",{id:"opacityValue",children:"100%"})]})]})]})]}),(0,o.jsxs)("div",{className:"style-section",children:[(0,o.jsx)("h3",{className:"section-title",children:"BACKGROUND"}),(0,o.jsxs)("div",{className:"style-option-group full-width",children:[(0,o.jsx)("label",{htmlFor:"bgImagePreset",children:"Choose Background"}),(0,o.jsxs)("div",{className:"bg-preset-controls",children:[(0,o.jsxs)("div",{className:"preset-inputs",children:[(0,o.jsxs)("select",{id:"bgImagePreset",className:"bg-preset-select",children:[(0,o.jsx)("option",{value:"",children:"No Background (Default)"}),(0,o.jsx)("option",{value:"/images/adopting.webp",children:"Adopting Bitcoin"}),(0,o.jsx)("option",{value:"/images/sky.jpg",children:"Sky"}),(0,o.jsx)("option",{value:"/images/lightning.gif",children:"Lightning"}),(0,o.jsx)("option",{value:"/images/bitcoin-rocket.gif",children:"Bitcoin Rocket"}),(0,o.jsx)("option",{value:"/images/bitcoin-astronaut.gif",children:"Bitcoin Astronaut"}),(0,o.jsx)("option",{value:"/images/bitcoin-space.gif",children:"Bitcoin Space"}),(0,o.jsx)("option",{value:"/images/bitcoin-sunset.gif",children:"Bitcoin Sunset"}),(0,o.jsx)("option",{value:"/images/bitcoin-rotating.gif",children:"Bitcoin Rotating"}),(0,o.jsx)("option",{value:"/images/nostr-ostriches.gif",children:"Nostr Ostriches"}),(0,o.jsx)("option",{value:"/images/send-zaps.gif",children:"Send Zaps"}),(0,o.jsx)("option",{value:"/images/gm-nostr.gif",children:"GM Nostr"}),(0,o.jsx)("option",{value:"custom",children:"Custom URL"})]}),(0,o.jsxs)("div",{className:"url-input-container",id:"customUrlGroup",style:{display:"none"},children:[(0,o.jsx)("input",{type:"text",id:"bgImageUrl",defaultValue:"",placeholder:"Enter image URL"}),(0,o.jsx)("button",{id:"clearBgImage",className:"clear-button",children:"Clear"})]})]}),(0,o.jsx)("div",{className:"preset-preview-container",children:(0,o.jsx)("img",{id:"bgPresetPreview",src:"",alt:"No background"})})]})]})]}),(0,o.jsxs)("div",{className:"style-section",children:[(0,o.jsx)("h3",{className:"section-title",children:"PARTNER LOGO"}),(0,o.jsxs)("div",{className:"style-option-group full-width",children:[(0,o.jsx)("label",{htmlFor:"partnerLogoSelect",children:"Partner Logo"}),(0,o.jsxs)("div",{className:"partner-logo-controls",children:[(0,o.jsxs)("div",{className:"preset-inputs",children:[(0,o.jsxs)("select",{id:"partnerLogoSelect",className:"partner-logo-select",children:[(0,o.jsx)("option",{value:"",children:"None (Default)"}),(0,o.jsx)("option",{value:"https://adoptingbitcoin.org/images/AB-logo.svg",children:"Adopting Bitcoin"}),(0,o.jsx)("option",{value:"https://cdn.prod.website-files.com/6488b0b0fcd2d95f6b83c9d4/653bd44cf83c3b0498c2e622_bitcoin_conference.svg",children:"Bitcoin Conference"}),(0,o.jsx)("option",{value:"custom",children:"Custom URL"})]}),(0,o.jsxs)("div",{className:"url-input-container",id:"customPartnerLogoGroup",style:{display:"none"},children:[(0,o.jsx)("input",{type:"text",id:"partnerLogoUrl",defaultValue:"",placeholder:"Enter logo URL"}),(0,o.jsx)("button",{id:"clearPartnerLogo",className:"clear-button",children:"Clear"})]})]}),(0,o.jsx)("div",{className:"preset-preview-container",children:(0,o.jsx)("img",{id:"partnerLogoPreview",src:"",alt:"No partner logo",style:{height:"30px",maxWidth:"100px",objectFit:"contain"}})})]})]})]}),(0,o.jsxs)("div",{className:"style-section",children:[(0,o.jsx)("h3",{className:"section-title",children:"LAYOUT"}),(0,o.jsxs)("div",{className:"toggles-container",children:[(0,o.jsx)("div",{className:"style-option-group toggle-group",children:(0,o.jsxs)("label",{className:"toggle-label",children:[(0,o.jsxs)("div",{className:"toggle-switch",children:[(0,o.jsx)("input",{type:"checkbox",id:"layoutInvertToggle"}),(0,o.jsx)("span",{className:"toggle-slider"})]}),(0,o.jsx)("span",{children:"Invert Layout"})]})}),(0,o.jsx)("div",{className:"style-option-group toggle-group",children:(0,o.jsxs)("label",{className:"toggle-label",children:[(0,o.jsxs)("div",{className:"toggle-switch",children:[(0,o.jsx)("input",{type:"checkbox",id:"hideZapperContentToggle"}),(0,o.jsx)("span",{className:"toggle-slider"})]}),(0,o.jsx)("span",{children:"Hide Zapper Content"})]})}),(0,o.jsx)("div",{className:"style-option-group toggle-group",children:(0,o.jsxs)("label",{className:"toggle-label",children:[(0,o.jsxs)("div",{className:"toggle-switch",children:[(0,o.jsx)("input",{type:"checkbox",id:"showTopZappersToggle"}),(0,o.jsx)("span",{className:"toggle-slider"})]}),(0,o.jsx)("span",{children:"Show All Time Zappers"})]})}),(0,o.jsx)("div",{className:"style-option-group toggle-group",children:(0,o.jsxs)("label",{className:"toggle-label",children:[(0,o.jsxs)("div",{className:"toggle-switch",children:[(0,o.jsx)("input",{type:"checkbox",id:"podiumToggle"}),(0,o.jsx)("span",{className:"toggle-slider"})]}),(0,o.jsx)("span",{children:"Top 3 Podium"})]})}),(0,o.jsx)("div",{className:"style-option-group toggle-group",children:(0,o.jsxs)("label",{className:"toggle-label",children:[(0,o.jsxs)("div",{className:"toggle-switch",children:[(0,o.jsx)("input",{type:"checkbox",id:"zapGridToggle"}),(0,o.jsx)("span",{className:"toggle-slider"})]}),(0,o.jsx)("span",{children:"Grid Layout"})]})})]})]}),(0,o.jsxs)("div",{className:"style-section",children:[(0,o.jsx)("h3",{className:"section-title",children:"QR CODE EFFECTS"}),(0,o.jsxs)("div",{className:"toggles-container",children:[(0,o.jsx)("div",{className:"style-option-group toggle-group",children:(0,o.jsxs)("label",{className:"toggle-label",children:[(0,o.jsxs)("div",{className:"toggle-switch",children:[(0,o.jsx)("input",{type:"checkbox",id:"qrInvertToggle"}),(0,o.jsx)("span",{className:"toggle-slider"})]}),(0,o.jsx)("span",{children:"Invert QR Code"})]})}),(0,o.jsx)("div",{className:"style-option-group toggle-group",children:(0,o.jsxs)("label",{className:"toggle-label",children:[(0,o.jsxs)("div",{className:"toggle-switch",children:[(0,o.jsx)("input",{type:"checkbox",id:"qrScreenBlendToggle"}),(0,o.jsx)("span",{className:"toggle-slider"})]}),(0,o.jsx)("span",{children:"Screen Blend Mode"})]})}),(0,o.jsx)("div",{className:"style-option-group toggle-group",children:(0,o.jsxs)("label",{className:"toggle-label",children:[(0,o.jsxs)("div",{className:"toggle-switch",children:[(0,o.jsx)("input",{type:"checkbox",id:"qrMultiplyBlendToggle"}),(0,o.jsx)("span",{className:"toggle-slider"})]}),(0,o.jsx)("span",{children:"Multiply Blend Mode"})]})})]})]}),(0,o.jsxs)("div",{className:"style-section",children:[(0,o.jsx)("h3",{className:"section-title",children:"QR SLIDE VISIBILITY"}),(0,o.jsxs)("div",{className:"toggles-container",children:[(0,o.jsx)("div",{className:"style-option-group toggle-group",children:(0,o.jsxs)("label",{className:"toggle-label",children:[(0,o.jsxs)("div",{className:"toggle-switch",children:[(0,o.jsx)("input",{type:"checkbox",id:"qrShowWebLinkToggle"}),(0,o.jsx)("span",{className:"toggle-slider"})]}),(0,o.jsx)("span",{children:"Show Web Link"})]})}),(0,o.jsx)("div",{className:"style-option-group toggle-group",children:(0,o.jsxs)("label",{className:"toggle-label",children:[(0,o.jsxs)("div",{className:"toggle-switch",children:[(0,o.jsx)("input",{type:"checkbox",id:"qrShowNeventToggle"}),(0,o.jsx)("span",{className:"toggle-slider"})]}),(0,o.jsx)("span",{children:"Show Nostr Event"})]})}),(0,o.jsx)("div",{className:"style-option-group toggle-group",children:(0,o.jsxs)("label",{className:"toggle-label",children:[(0,o.jsxs)("div",{className:"toggle-switch",children:[(0,o.jsx)("input",{type:"checkbox",id:"qrShowNoteToggle"}),(0,o.jsx)("span",{className:"toggle-slider"})]}),(0,o.jsx)("span",{children:"Show Note ID"})]})}),(0,o.jsx)("div",{className:"style-option-group toggle-group",children:(0,o.jsxs)("label",{className:"toggle-label",children:[(0,o.jsxs)("div",{className:"toggle-switch",children:[(0,o.jsx)("input",{type:"checkbox",id:"lightningToggle"}),(0,o.jsx)("span",{className:"toggle-slider"})]}),(0,o.jsx)("span",{children:"Enable Lightning Payments"})]})})]}),(0,o.jsx)("div",{className:"lightning-status-container",id:"lightningStatusContainer",style:{display:"none"},children:(0,o.jsx)("div",{className:"payment-status",id:"paymentStatus"})})]})]}),(0,o.jsxs)("div",{className:"style-actions",children:[(0,o.jsx)("button",{id:"resetStyles",className:"action-btn secondary",onClick:x,children:"Reset"}),(0,o.jsx)("button",{id:"copyStyleUrl",className:"action-btn primary",onClick:N,children:"Copy Style URL"})]})]})})]})},w=()=>{const[e,t]=(0,s.useState)(!0),[n,l]=(0,s.useState)(!1),{isLoading:a,error:i,noteContent:r,authorName:c,authorImage:d,queue:p,currentTrack:g,isPlaying:u,queueCount:m,playedCount:h,handleJukeboxSubmit:y,handleStyleOptionsToggle:v,handleStyleOptionsClose:w,handleSkipSong:b}=(()=>{const[e,t]=(0,s.useState)(!1),[n,o]=(0,s.useState)(null),[l,a]=(0,s.useState)(""),[i,r]=(0,s.useState)("Author"),[c,d]=(0,s.useState)("/images/gradient_color.gif"),[p,g]=(0,s.useState)([]),[u,m]=(0,s.useState)(null),[h,y]=(0,s.useState)(!1),[v,w]=(0,s.useState)(0),[b,f]=(0,s.useState)(0);(0,s.useRef)(null),(0,s.useEffect)(()=>{(async()=>{try{t(!0),o(null),"undefined"!=typeof window&&window.YT&&window.YT.ready(()=>{console.log("YouTube API ready")}),t(!1)}catch(e){o(e instanceof Error?e.message:"Failed to initialize jukebox functionality"),t(!1)}})()},[]);const x=e=>!!e&&["note1","nevent1","naddr1","nprofile1"].some(t=>e.startsWith(t)),N=async()=>{try{console.log("Initializing jukebox..."),w(0),f(0),g([]),m(null),y(!1)}catch(e){throw new Error("Failed to initialize jukebox")}};return{isLoading:e,error:n,noteContent:l,authorName:i,authorImage:c,queue:p,currentTrack:u,isPlaying:h,queueCount:v,playedCount:b,handleJukeboxSubmit:async()=>{const e=document.getElementById("note1LoaderInput"),t=e?.value?.trim();t&&await(async e=>{try{if(!x(e))throw new Error("Invalid note ID format");a("Jukebox content will be loaded here"),r("Jukebox Author"),await N()}catch(e){o(e instanceof Error?e.message:"Failed to load jukebox content")}})(t)},handleStyleOptionsToggle:()=>{const e=document.getElementById("styleOptionsModal");e&&(e.style.display="none"===e.style.display?"block":"none")},handleStyleOptionsClose:()=>{const e=document.getElementById("styleOptionsModal");e&&(e.style.display="none")},handleSkipSong:()=>{console.log("Skipping song...")}}})(),f=()=>{t(!1),l(!0)};return(0,s.useEffect)(()=>{const e=document.getElementById("note1LoaderSubmit"),t=document.getElementById("styleToggleBtn"),n=document.getElementById("styleOptionsModal"),o=n?.querySelector(".close-button"),s=document.getElementById("skipSong");return e&&e.addEventListener("click",()=>{y(),f()}),t&&t.addEventListener("click",v),o&&o.addEventListener("click",w),s&&s.addEventListener("click",b),()=>{e&&e.removeEventListener("click",y),t&&t.removeEventListener("click",v),o&&o.removeEventListener("click",w),s&&s.removeEventListener("click",b)}},[y,v,w,b]),(0,o.jsxs)("div",{className:"jukebox",children:[e&&(0,o.jsx)("div",{id:"noteLoaderContainer",children:(0,o.jsxs)("div",{id:"noteLoader",children:[(0,o.jsxs)("div",{className:"app-header",children:[(0,o.jsx)("h1",{children:"ðŸŽµ PUBPAY Jukebox"}),(0,o.jsx)("p",{className:"app-description",children:"Competitive YouTube Music Queue powered by Nostr zaps"}),(0,o.jsxs)("div",{className:"viral-features",children:[(0,o.jsx)("span",{className:"feature-badge",children:"ðŸ”¥ Zap to compete"}),(0,o.jsx)("span",{className:"feature-badge",children:"ðŸŽ¯ Higher zaps = priority"}),(0,o.jsx)("span",{className:"feature-badge",children:"âš¡ Lightning fast"})]})]}),(0,o.jsxs)("div",{className:"note-input-section",children:[(0,o.jsx)("label",{htmlFor:"note1LoaderInput",children:"Enter a Nostr post ID to create your jukebox:"}),(0,o.jsx)("br",{}),(0,o.jsx)("input",{type:"text",id:"note1LoaderInput",name:"note1LoaderInput",value:"",placeholder:"note16a..."}),(0,o.jsx)("br",{}),(0,o.jsx)("button",{id:"note1LoaderSubmit",className:"button primary-button",onClick:f,children:"ðŸš€ Launch Jukebox"})]}),(0,o.jsxs)("div",{className:"how-it-works",children:[(0,o.jsx)("h3",{children:"ðŸŽ¯ How it works"}),(0,o.jsxs)("div",{className:"steps",children:[(0,o.jsxs)("div",{className:"step",children:[(0,o.jsx)("div",{className:"step-number",children:"1"}),(0,o.jsx)("div",{className:"step-text",children:"Load a Nostr post to create your jukebox"})]}),(0,o.jsxs)("div",{className:"step",children:[(0,o.jsx)("div",{className:"step-number",children:"2"}),(0,o.jsx)("div",{className:"step-text",children:"People scan QR code and zap with song requests"})]}),(0,o.jsxs)("div",{className:"step",children:[(0,o.jsx)("div",{className:"step-number",children:"3"}),(0,o.jsx)("div",{className:"step-text",children:"Higher zaps get priority in the queue"})]}),(0,o.jsxs)("div",{className:"step",children:[(0,o.jsx)("div",{className:"step-number",children:"4"}),(0,o.jsx)("div",{className:"step-text",children:"Songs automatically play in priority order"})]})]})]}),(0,o.jsxs)("div",{className:"examples-section",children:[(0,o.jsx)("h3",{children:"ðŸ’¡ Examples"}),(0,o.jsx)("p",{children:"Zap with a YouTube URL or video ID in your comment:"}),(0,o.jsxs)("div",{className:"example-comments",children:[(0,o.jsx)("div",{className:"example-comment",children:'"https://youtube.com/watch?v=dQw4w9WgXcQ"'}),(0,o.jsx)("div",{className:"example-comment",children:'"https://youtu.be/dQw4w9WgXcQ"'}),(0,o.jsx)("div",{className:"example-comment",children:'"dQw4w9WgXcQ"'})]}),(0,o.jsx)("p",{className:"example-note",children:"âš ï¸ Only YouTube URLs and video IDs are accepted. General search terms are not supported."})]}),(0,o.jsx)("div",{className:"styleOptionsModalToggle button secondary-button",children:"âš™ï¸ Style Options"})]})}),n&&(0,o.jsxs)("div",{id:"mainLayout",className:"main-layout jukebox-layout",children:[(0,o.jsx)("div",{className:"liveZapOverlay"}),(0,o.jsx)("div",{className:"left-side",children:(0,o.jsxs)("div",{className:"post-info",children:[(0,o.jsx)("h3",{className:"section-label",children:"ðŸŽµ Jukebox Post"}),(0,o.jsxs)("div",{className:"author-section",children:[(0,o.jsx)("img",{id:"authorNameProfileImg",className:"author-image",src:d}),(0,o.jsx)("div",{className:"author-info",children:(0,o.jsx)("div",{id:"authorName",className:"author-name",children:c})})]}),(0,o.jsx)("div",{className:"note-section",children:(0,o.jsx)("div",{id:"noteContent",className:"note-content",children:r||"Note content will be populated here"})}),(0,o.jsxs)("div",{className:"qr-section",children:[(0,o.jsx)("a",{href:"",target:"_blank",id:"qrcodeLinkNostr",children:(0,o.jsx)("img",{id:"qrCode",className:"qr-code"})}),(0,o.jsx)("div",{className:"qr-instructions",children:"ðŸ“± Scan to zap and request songs"}),(0,o.jsxs)("div",{className:"qr-stats",children:[(0,o.jsxs)("div",{className:"stat-item",children:[(0,o.jsx)("span",{className:"stat-label",children:"Queue:"}),(0,o.jsx)("span",{id:"queueCount",className:"stat-value",children:m})]}),(0,o.jsxs)("div",{className:"stat-item",children:[(0,o.jsx)("span",{className:"stat-label",children:"Played:"}),(0,o.jsx)("span",{id:"playedCount",className:"stat-value",children:h})]})]})]})]})}),(0,o.jsx)("div",{className:"center-side",children:(0,o.jsxs)("div",{className:"currently-playing",children:[(0,o.jsxs)("h3",{className:"section-label",children:["ðŸŽµ Now Playing",(0,o.jsxs)("div",{className:"zaps-header-right",children:[(0,o.jsx)("button",{id:"styleToggleBtn",className:"style-toggle-btn",children:"âš™ï¸"}),(0,o.jsx)("div",{className:"powered-by",children:(0,o.jsx)("img",{src:"/images/powered_by_white_bg.png"})})]})]}),(0,o.jsx)("div",{id:"currentVideo",className:"video-container",children:(0,o.jsxs)("div",{className:"no-video-message",children:[(0,o.jsx)("div",{className:"no-video-icon",children:"ðŸŽµ"}),(0,o.jsx)("div",{className:"no-video-text",children:"No song playing yet"}),(0,o.jsx)("div",{className:"no-video-subtext",children:"Zap with a YouTube URL or video ID to request a song!"}),(0,o.jsxs)("div",{className:"no-video-examples",children:[(0,o.jsx)("div",{className:"example-item",children:"ðŸ“º youtube.com/watch?v=VIDEO_ID"}),(0,o.jsx)("div",{className:"example-item",children:"ðŸ”— youtu.be/VIDEO_ID"}),(0,o.jsx)("div",{className:"example-item",children:"ðŸŽ¯ Just the video ID (11 characters)"})]})]})}),(0,o.jsxs)("div",{id:"videoProgressContainer",className:"video-progress-container",style:{display:"none"},children:[(0,o.jsx)("div",{className:"progress-bar",children:(0,o.jsx)("div",{id:"videoProgressBar",className:"progress-fill"})}),(0,o.jsxs)("div",{className:"progress-time",children:[(0,o.jsx)("span",{id:"currentTime",children:"0:00"})," / ",(0,o.jsx)("span",{id:"totalTime",children:"0:00"})]})]}),(0,o.jsx)("div",{id:"currentSongInfo",className:"song-info"}),(0,o.jsx)("div",{className:"player-controls",children:(0,o.jsx)("button",{id:"skipSong",className:"control-button skip-button",disabled:!0,children:"â­ï¸ Skip Song"})})]})}),(0,o.jsxs)("div",{className:"right-side",children:[(0,o.jsxs)("div",{className:"queue-section",children:[(0,o.jsx)("h3",{className:"section-label",children:"ðŸ“‹ Next Up (Queue)"}),(0,o.jsxs)("div",{id:"queueStats",className:"queue-stats",children:[(0,o.jsx)("span",{className:"queue-count",children:"0 songs in queue"}),(0,o.jsx)("span",{className:"queue-total",children:"Total: 0 sats"})]}),(0,o.jsx)("div",{id:"songQueue",className:"song-queue"})]}),(0,o.jsxs)("div",{className:"history-section",children:[(0,o.jsx)("h3",{className:"section-label",children:"ðŸ“š Recently Played"}),(0,o.jsx)("div",{id:"playedSongs",className:"played-songs"})]})]})]}),(0,o.jsx)("div",{id:"styleOptionsModal",children:(0,o.jsxs)("div",{className:"style-options-content",children:[(0,o.jsxs)("div",{className:"style-options-header",children:[(0,o.jsx)("h2",{children:"Style Options"}),(0,o.jsx)("button",{className:"close-button",children:"Ã—"})]}),(0,o.jsx)("div",{className:"style-options-body",children:(0,o.jsx)("p",{children:"Style options will be implemented here"})})]})})]})},b=()=>(0,o.jsx)("div",{className:"overlayContainer",style:{display:"block"},children:(0,o.jsxs)("div",{className:"overlayInner",children:[(0,o.jsxs)("div",{className:"brand",children:["PUB",(0,o.jsx)("span",{style:{color:"#cecece"},children:"PAY"}),(0,o.jsx)("span",{style:{color:"#00000014"},children:".me"})]}),(0,o.jsx)("h2",{children:"404 - Page Not Found"}),(0,o.jsx)("p",{children:"The page you're looking for doesn't exist."}),(0,o.jsxs)("div",{style:{marginTop:"2rem"},children:[(0,o.jsx)(a.N_,{to:"/",className:"cta",style:{marginRight:"1rem"},children:"Go Home"}),(0,o.jsx)(a.N_,{to:"/live",className:"cta",style:{marginRight:"1rem"},children:"Live Display"}),(0,o.jsx)(a.N_,{to:"/jukebox",className:"cta",children:"Jukebox"})]})]})}),f=document.getElementById("root");if(!f)throw new Error("Root element not found");(0,l.createRoot)(f).render((0,o.jsx)(s.StrictMode,{children:(0,o.jsx)(a.Kd,{children:(0,o.jsx)(()=>(0,o.jsxs)(a.BV,{children:[(0,o.jsx)(a.qh,{path:"/",element:(0,o.jsx)(i,{})}),(0,o.jsx)(a.qh,{path:"/live",element:(0,o.jsx)(v,{})}),(0,o.jsx)(a.qh,{path:"/live/:eventId",element:(0,o.jsx)(v,{})}),(0,o.jsx)(a.qh,{path:"/jukebox",element:(0,o.jsx)(w,{})}),(0,o.jsx)(a.qh,{path:"/404",element:(0,o.jsx)(b,{})}),(0,o.jsx)(a.qh,{path:"*",element:(0,o.jsx)(a.C5,{to:"/404",replace:!0})})]}),{})})}))}},n={};function o(e){var s=n[e];if(void 0!==s)return s.exports;var l=n[e]={exports:{}};return t[e](l,l.exports,o),l.exports}o.m=t,e=[],o.O=(t,n,s,l)=>{if(!n){var a=1/0;for(d=0;d<e.length;d++){for(var[n,s,l]=e[d],i=!0,r=0;r<n.length;r++)(!1&l||a>=l)&&Object.keys(o.O).every(e=>o.O[e](n[r]))?n.splice(r--,1):(i=!1,l<a&&(a=l));if(i){e.splice(d--,1);var c=s();void 0!==c&&(t=c)}}return t}l=l||0;for(var d=e.length;d>0&&e[d-1][2]>l;d--)e[d]=e[d-1];e[d]=[n,s,l]},o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={792:0};o.O.j=t=>0===e[t];var t=(t,n)=>{var s,l,[a,i,r]=n,c=0;if(a.some(t=>0!==e[t])){for(s in i)o.o(i,s)&&(o.m[s]=i[s]);if(r)var d=r(o)}for(t&&t(n);c<a.length;c++)l=a[c],o.o(e,l)&&e[l]&&e[l][0](),e[l]=0;return o.O(d)},n=self.webpackChunkpubpay=self.webpackChunkpubpay||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var s=o.O(void 0,[96],()=>o(212));s=o.O(s)})();